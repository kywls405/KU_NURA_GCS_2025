/*! For license information please see main.d36e89d2.js.LICENSE.txt */
!function(){var e={345:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=e[s],u=s+1,c=e[u];if(0>a(l,n))u<r&&0>a(c,l)?(e[i]=c,e[u]=n,i=u):(e[i]=l,e[s]=n,i=s);else{if(!(u<r&&0>a(c,n)))break e;e[i]=c,e[u]=n,i=u}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var u=[],c=[],h=1,f=null,d=3,p=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(c);null!==t;){if(null===t.callback)r(c);else{if(!(t.startTime<=e))break;r(c),t.sortIndex=t.expirationTime,n(u,t)}t=i(c)}}function b(e){if(v=!1,x(e),!m)if(null!==i(u))m=!0,I(w);else{var t=i(c);null!==t&&O(b,t.startTime-e)}}function w(e,n){m=!1,v&&(v=!1,y(E),E=-1),p=!0;var a=d;try{for(x(n),f=i(u);null!==f&&(!(f.expirationTime>n)||e&&!P());){var o=f.callback;if("function"===typeof o){f.callback=null,d=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===i(u)&&r(u),x(n)}else r(u);f=i(u)}if(null!==f)var l=!0;else{var h=i(c);null!==h&&O(b,h.startTime-n),l=!1}return l}finally{f=null,d=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,E=-1,C=5,k=-1;function P(){return!(t.unstable_now()-k<C)}function A(){if(null!==T){var e=t.unstable_now();k=e;var n=!0;try{n=T(!0,e)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,L=R.port2;R.port1.onmessage=A,S=function(){L.postMessage(null)}}else S=function(){g(A,0)};function I(e){T=e,M||(M=!0,S())}function O(e,n){E=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,I(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(u)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===i(u)&&e===i(c)&&(v?(y(E),E=-1):v=!0,O(b,a-o))):(e.sortIndex=s,n(u,e),m||p||(m=!0,I(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},545:function(e,t,n){"use strict";e.exports=n(345)},494:function(e){function t(e,t,n){var i,r,a,o,s;function l(){var u=Date.now()-o;u<t&&u>=0?i=setTimeout(l,t-u):(i=null,n||(s=e.apply(a,r),a=r=null))}null==t&&(t=100);var u=function(){a=this,r=arguments,o=Date.now();var u=n&&!i;return i||(i=setTimeout(l,t)),u&&(s=e.apply(a,r),a=r=null),s};return u.clear=function(){i&&(clearTimeout(i),i=null)},u.flush=function(){i&&(s=e.apply(a,r),a=r=null,clearTimeout(i),i=null)},u}t.debounce=t,e.exports=t},441:function(e){e.exports=function(){"use strict";function e(e,n,r,a,o){t(e,n,r||0,a||e.length-1,o||i)}function t(e,i,r,a,o){for(;a>r;){if(a-r>600){var s=a-r+1,l=i-r+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,i,Math.max(r,Math.floor(i-l*c/s+h)),Math.min(a,Math.floor(i+(s-l)*c/s+h)),o)}var f=e[i],d=r,p=a;for(n(e,r,i),o(e[a],f)>0&&n(e,r,a);d<p;){for(n(e,d,p),d++,p--;o(e[d],f)<0;)d++;for(;o(e[p],f)>0;)p--}0===o(e[r],f)?n(e,r,p):n(e,++p,a),p<=i&&(r=p+1),i<=p&&(a=p-1)}}function n(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function i(e,t){return e<t?-1:e>t?1:0}return e}()},977:function(e,t,n){"use strict";e.exports=r,e.exports.default=r;var i=n(441);function r(e,t){if(!(this instanceof r))return new r(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function a(e,t,n){if(!n)return t.indexOf(e);for(var i=0;i<t.length;i++)if(n(e,t[i]))return i;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,i,r){r||(r=v(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a,o=t;o<n;o++)a=e.children[o],l(r,e.leaf?i(a):a);return r}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){var n=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,a-i)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,t,n,r,a){for(var o,s=[t,n];s.length;)(n=s.pop())-(t=s.pop())<=r||(o=t+Math.ceil((n-t)/r/2)*r,i(e,o,t,n,a),s.push(t,o,o,n))}r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],i=this.toBBox;if(!m(e,t))return n;for(var r,a,o,s,l=[];t;){for(r=0,a=t.children.length;r<a;r++)o=t.children[r],m(e,s=t.leaf?i(o):o)&&(t.leaf?n.push(o):p(e,s)?this._all(o,n):l.push(o));t=l.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!m(e,t))return!1;for(var i,r,a,o,s=[];t;){for(i=0,r=t.children.length;i<r;i++)if(a=t.children[i],m(e,o=t.leaf?n(a):a)){if(t.leaf||p(e,o))return!0;s.push(a)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=v([]),this},remove:function(e,t){if(!e)return this;for(var n,i,r,o,s=this.data,l=this.toBBox(e),u=[],c=[];s||u.length;){if(s||(s=u.pop(),i=u[u.length-1],n=c.pop(),o=!0),s.leaf&&-1!==(r=a(e,s.children,t)))return s.children.splice(r,1),u.push(s),this._condense(u),this;o||s.leaf||!p(s,l)?i?(n++,s=i.children[n],o=!1):s=null:(u.push(s),c.push(n),n=0,i=s,s=s.children[0])}return this},toBBox:function(e){return e},compareMinX:u,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,i){var r,a=n-t+1,s=this._maxEntries;if(a<=s)return o(r=v(e.slice(t,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,i-1))),(r=v([])).leaf=!1,r.height=i;var l,u,c,h,f=Math.ceil(a/s),d=f*Math.ceil(Math.sqrt(s));for(g(e,t,n,d,this.compareMinX),l=t;l<=n;l+=d)for(g(e,l,c=Math.min(l+d-1,n),f,this.compareMinY),u=l;u<=c;u+=f)h=Math.min(u+f-1,c),r.children.push(this._build(e,u,h,i-1));return o(r,this.toBBox),r},_chooseSubtree:function(e,t,n,i){for(var r,a,o,s,l,u,c,f,d,p;i.push(t),!t.leaf&&i.length-1!==n;){for(c=f=1/0,r=0,a=t.children.length;r<a;r++)l=h(o=t.children[r]),d=e,p=o,(u=(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-l)<f?(f=u,c=l<c?l:c,s=o):u===f&&l<c&&(c=l,s=o);t=s||t.children[0]}return t},_insert:function(e,t,n){var i=this.toBBox,r=n?e:i(e),a=[],o=this._chooseSubtree(r,this.data,t,a);for(o.children.push(e),l(o,r);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(r,a,t)},_split:function(e,t){var n=e[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var a=this._chooseSplitIndex(n,r,i),s=v(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(e,t){this.data=v([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){var i,r,a,o,l,u,c,f;for(u=c=1/0,i=t;i<=n-t;i++)o=d(r=s(e,0,i,this.toBBox),a=s(e,i,n,this.toBBox)),l=h(r)+h(a),o<u?(u=o,f=i,c=l<c?l:c):o===u&&l<c&&(c=l,f=i);return f},_chooseSplitAxis:function(e,t,n){var i=e.leaf?this.compareMinX:u,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)},_allDistMargin:function(e,t,n,i){e.children.sort(i);var r,a,o=this.toBBox,u=s(e,0,t,o),c=s(e,n-t,n,o),h=f(u)+f(c);for(r=t;r<n-t;r++)a=e.children[r],l(u,e.leaf?o(a):a),h+=f(u);for(r=n-t-1;r>=t;r--)a=e.children[r],l(c,e.leaf?o(a):a),h+=f(c);return h},_adjustParentBBoxes:function(e,t,n){for(var i=n;i>=0;i--)l(t[i],e)},_condense:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():o(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},463:function(e,t,n){"use strict";var i=n(791),r=n(296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function m(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function _(e,t,n,i){var r=v.hasOwnProperty(t)?v[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(p,e)||!h.call(d,e)&&(f.test(e)?p[e]=!0:(d[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),C=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var I=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var N,z=Object.assign;function U(e){if(void 0===N)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&"string"===typeof u.stack){for(var r=u.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function H(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case T:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function K(e,t){Q(e,t);var n=V(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),i=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,ce,he=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var de={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||de.hasOwnProperty(e)&&de[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(de).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),de[t]=de[e]}))}));var ge=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Me=null;function Te(e){if(e=_r(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=br(t),we(e.stateNode,e.type,t))}}function Ee(e){Se?Me?Me.push(e):Me=[e]:Se=e}function Ce(){if(Se){var e=Se,t=Me;if(Me=Se=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function ke(e,t){return e(t)}function Pe(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return ke(e,t,n)}finally{Ae=!1,(null!==Se||null!==Me)&&(Pe(),Ce())}}function Le(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Ie=!1;if(c)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Ie=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ce){Ie=!1}function De(e,t,n,i,r,a,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(c){this.onError(c)}}var Ne=!1,ze=null,Ue=!1,Fe=null,Be={onError:function(e){Ne=!0,ze=e}};function He(e,t,n,i,r,a,o,s,l){Ne=!1,ze=null,De.apply(Be,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(je(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Ve(r),e;if(o===i)return Ve(r),t;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var Ze=r.unstable_scheduleCallback,qe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Je=r.unstable_requestPaint,Qe=r.unstable_now,Ke=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ut=64,ct=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=ht(s):0!==(a&=o)&&(i=ht(a))}else 0!==(o=n&~r)?i=ht(o):0!==a&&(i=ht(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ot(t)),i|=e[n],t&=~r;return i}function dt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var _t=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,St,Mt,Tt,Et=!1,Ct=[],kt=null,Pt=null,At=null,Rt=new Map,Lt=new Map,It=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":kt=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lt.delete(t.pointerId)}}function Nt(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=_r(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function zt(e){var t=yr(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Tt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_r(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Ft(e,t,n){Ut(e)&&n.delete(t)}function Bt(){Et=!1,null!==kt&&Ut(kt)&&(kt=null),null!==Pt&&Ut(Pt)&&(Pt=null),null!==At&&Ut(At)&&(At=null),Rt.forEach(Ft),Lt.forEach(Ft)}function Ht(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function jt(e){function t(t){return Ht(t,e)}if(0<Ct.length){Ht(Ct[0],e);for(var n=1;n<Ct.length;n++){var i=Ct[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==kt&&Ht(kt,e),null!==Pt&&Ht(Pt,e),null!==At&&Ht(At,e),Rt.forEach(t),Lt.forEach(t),n=0;n<It.length;n++)(i=It[n]).blockedOn===e&&(i.blockedOn=null);for(;0<It.length&&null===(n=It[0]).blockedOn;)zt(n),null===n.blockedOn&&It.shift()}var Gt=x.ReactCurrentBatchConfig,Vt=!0;function Wt(e,t,n,i){var r=_t,a=Gt.transition;Gt.transition=null;try{_t=1,Zt(e,t,n,i)}finally{_t=r,Gt.transition=a}}function Xt(e,t,n,i){var r=_t,a=Gt.transition;Gt.transition=null;try{_t=4,Zt(e,t,n,i)}finally{_t=r,Gt.transition=a}}function Zt(e,t,n,i){if(Vt){var r=Yt(e,t,n,i);if(null===r)Vi(e,t,i,qt,n),Dt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return kt=Nt(kt,e,t,n,i,r),!0;case"dragenter":return Pt=Nt(Pt,e,t,n,i,r),!0;case"mouseover":return At=Nt(At,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return Rt.set(a,Nt(Rt.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Lt.set(a,Nt(Lt.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Dt(e,i),4&t&&-1<Ot.indexOf(e)){for(;null!==r;){var a=_r(r);if(null!==a&&bt(a),null===(a=Yt(e,t,n,i))&&Vi(e,t,i,qt,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Vi(e,t,i,null,n)}}var qt=null;function Yt(e,t,n,i){if(qt=null,null!==(e=yr(e=be(i))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ke()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Qt=null,Kt=null,$t=null;function en(){if($t)return $t;var e,t,n=Kt,i=n.length,r="value"in Qt?Qt.value:Qt.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,ln,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=an(un),hn=z({},un,{view:0,detail:0}),fn=an(hn),dn=z({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(dn),mn=an(z({},dn,{dataTransfer:0})),vn=an(z({},hn,{relatedTarget:0})),gn=an(z({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=z({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=an(yn),xn=an(z({},un,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Tn(){return Mn}var En=z({},hn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(En),kn=an(z({},dn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=an(z({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),An=an(z({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=z({},dn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ln=an(Rn),In=[9,13,27,32],On=c&&"CompositionEvent"in window,Dn=null;c&&"documentMode"in document&&(Dn=document.documentMode);var Nn=c&&"TextEvent"in window&&!Dn,zn=c&&(!On||Dn&&8<Dn&&11>=Dn),Un=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==In.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Wn(e,t,n,i){Ee(i),0<(t=Xi(t,"onChange")).length&&(n=new cn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Xn=null,Zn=null;function qn(e){Ui(e,0)}function Yn(e){if(Z(xr(e)))return e}function Jn(e,t){if("change"===e)return t}var Qn=!1;if(c){var Kn;if(c){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Kn=$n}else Kn=!1;Qn=Kn&&(!document.documentMode||9<document.documentMode)}function ti(){Xn&&(Xn.detachEvent("onpropertychange",ni),Zn=Xn=null)}function ni(e){if("value"===e.propertyName&&Yn(Zn)){var t=[];Wn(t,Zn,e,be(e)),Re(qn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Zn=n,(Xn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Zn)}function ai(e,t){if("click"===e)return Yn(t)}function oi(e,t){if("input"===e||"change"===e)return Yn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!si(e[r],t[r]))return!1}return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ci(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fi(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function di(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pi(e){var t=fi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&di(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=ci(n,a);var o=ci(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=c&&"documentMode"in document&&11>=document.documentMode,vi=null,gi=null,yi=null,_i=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==vi||vi!==q(i)||("selectionStart"in(i=vi)&&di(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Xi(gi,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=vi)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Si={},Mi={};function Ti(e){if(Si[e])return Si[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mi)return Si[e]=n[t];return e}c&&(Mi=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ei=Ti("animationend"),Ci=Ti("animationiteration"),ki=Ti("animationstart"),Pi=Ti("transitionend"),Ai=new Map,Ri="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Li(e,t){Ai.set(e,t),l(t,[e])}for(var Ii=0;Ii<Ri.length;Ii++){var Oi=Ri[Ii];Li(Oi.toLowerCase(),"on"+(Oi[0].toUpperCase()+Oi.slice(1)))}Li(Ei,"onAnimationEnd"),Li(Ci,"onAnimationIteration"),Li(ki,"onAnimationStart"),Li("dblclick","onDoubleClick"),Li("focusin","onFocus"),Li("focusout","onBlur"),Li(Pi,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Di="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ni=new Set("cancel close invalid load scroll toggle".split(" ").concat(Di));function zi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,s,l,u){if(He.apply(this,arguments),Ne){if(!Ne)throw Error(a(198));var c=ze;Ne=!1,ze=null,Ue||(Ue=!0,Fe=c)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break e;zi(r,s,u),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,u=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break e;zi(r,s,u),a=l}}}if(Ue)throw e=Fe,Ue=!1,Fe=null,e}function Fi(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Gi(t,e,2,!1),n.add(i))}function Bi(e,t,n){var i=0;t&&(i|=4),Gi(n,e,i,t)}var Hi="_reactListening"+Math.random().toString(36).slice(2);function ji(e){if(!e[Hi]){e[Hi]=!0,o.forEach((function(t){"selectionchange"!==t&&(Ni.has(t)||Bi(t,!1,e),Bi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hi]||(t[Hi]=!0,Bi("selectionchange",!1,t))}}function Gi(e,t,n,i){switch(Jt(t)){case 1:var r=Wt;break;case 4:r=Xt;break;default:r=Zt}n=r.bind(null,t,n,e),r=void 0,!Ie||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Vi(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=yr(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue e}s=s.parentNode}}i=i.return}Re((function(){var i=a,r=be(n),o=[];e:{var s=Ai.get(e);if(void 0!==s){var l=cn,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Cn;break;case"focusin":u="focus",l=vn;break;case"focusout":u="blur",l=vn;break;case"beforeblur":case"afterblur":l=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ei:case Ci:case ki:l=gn;break;case Pi:l=An;break;case"scroll":l=fn;break;case"wheel":l=Ln;break;case"copy":case"cut":case"paste":l=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=kn}var c=0!==(4&t),h=!c&&"scroll"===e,f=c?null!==s?s+"Capture":null:s;c=[];for(var d,p=i;null!==p;){var m=(d=p).stateNode;if(5===d.tag&&null!==m&&(d=m,null!==f&&(null!=(m=Le(p,f))&&c.push(Wi(p,m,d)))),h)break;p=p.return}0<c.length&&(s=new l(s,u,null,n,r),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(u=n.relatedTarget||n.fromElement)||!yr(u)&&!u[pr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(u=(u=n.relatedTarget||n.toElement)?yr(u):null)&&(u!==(h=je(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=i),l!==u)){if(c=pn,m="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=kn,m="onPointerLeave",f="onPointerEnter",p="pointer"),h=null==l?s:xr(l),d=null==u?s:xr(u),(s=new c(m,p+"leave",l,n,r)).target=h,s.relatedTarget=d,m=null,yr(r)===i&&((c=new c(f,p+"enter",u,n,r)).target=d,c.relatedTarget=h,m=c),h=m,l&&u)e:{for(f=u,p=0,d=c=l;d;d=Zi(d))p++;for(d=0,m=f;m;m=Zi(m))d++;for(;0<p-d;)c=Zi(c),p--;for(;0<d-p;)f=Zi(f),d--;for(;p--;){if(c===f||null!==f&&c===f.alternate)break e;c=Zi(c),f=Zi(f)}c=null}else c=null;null!==l&&qi(o,s,l,c,!1),null!==u&&null!==h&&qi(o,h,u,c,!0)}if("select"===(l=(s=i?xr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var v=Jn;else if(Vn(s))if(Qn)v=oi;else{v=ri;var g=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ai);switch(v&&(v=v(e,i))?Wn(o,v,n,r):(g&&g(e,s,i),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=i?xr(i):window,e){case"focusin":(Vn(g)||"true"===g.contentEditable)&&(vi=g,gi=i,yi=null);break;case"focusout":yi=gi=vi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,xi(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(o,n,r)}var y;if(On)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else jn?Bn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(zn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==_?"onCompositionEnd"===_&&jn&&(y=en()):(Kt="value"in(Qt=r)?Qt.value:Qt.textContent,jn=!0)),0<(g=Xi(i,_)).length&&(_=new xn(_,e,null,n,r),o.push({event:_,listeners:g}),y?_.data=y:null!==(y=Hn(n))&&(_.data=y))),(y=Nn?function(e,t){switch(e){case"compositionend":return Hn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!On&&Bn(e,t)?(e=en(),$t=Kt=Qt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Xi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y))}Ui(o,t)}))}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Xi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Le(e,n))&&i.unshift(Wi(e,a,r)),null!=(a=Le(e,t))&&i.push(Wi(e,a,r))),e=e.return}return i}function Zi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qi(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,u=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==u&&(s=u,r?null!=(l=Le(n,a))&&o.unshift(Wi(n,l,s)):r||null!=(l=Le(n,a))&&o.push(Wi(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yi=/\r\n?/g,Ji=/\u0000|\uFFFD/g;function Qi(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Ji,"")}function Ki(e,t,n){if(t=Qi(t),Qi(e)!==t&&n)throw Error(a(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(e){return ar.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void jt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);jt(t)}function ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function cr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),fr="__reactFiber$"+hr,dr="__reactProps$"+hr,pr="__reactContainer$"+hr,mr="__reactEvents$"+hr,vr="__reactListeners$"+hr,gr="__reactHandles$"+hr;function yr(e){var t=e[fr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pr]||n[fr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cr(e);null!==e;){if(n=e[fr])return n;e=cr(e)}return t}n=(e=n).parentNode}return null}function _r(e){return!(e=e[fr]||e[pr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function br(e){return e[dr]||null}var wr=[],Sr=-1;function Mr(e){return{current:e}}function Tr(e){0>Sr||(e.current=wr[Sr],wr[Sr]=null,Sr--)}function Er(e,t){Sr++,wr[Sr]=e.current,e.current=t}var Cr={},kr=Mr(Cr),Pr=Mr(!1),Ar=Cr;function Rr(e,t){var n=e.type.contextTypes;if(!n)return Cr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Lr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ir(){Tr(Pr),Tr(kr)}function Or(e,t,n){if(kr.current!==Cr)throw Error(a(168));Er(kr,t),Er(Pr,n)}function Dr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(a(108,G(e)||"Unknown",r));return z({},n,i)}function Nr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,Ar=kr.current,Er(kr,e),Er(Pr,Pr.current),!0}function zr(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=Dr(e,t,Ar),i.__reactInternalMemoizedMergedChildContext=e,Tr(Pr),Tr(kr),Er(kr,e)):Tr(Pr),Er(Pr,n)}var Ur=null,Fr=!1,Br=!1;function Hr(e){null===Ur?Ur=[e]:Ur.push(e)}function jr(){if(!Br&&null!==Ur){Br=!0;var e=0,t=_t;try{var n=Ur;for(_t=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Ur=null,Fr=!1}catch(r){throw null!==Ur&&(Ur=Ur.slice(e+1)),Ze($e,jr),r}finally{_t=t,Br=!1}}return null}var Gr=[],Vr=0,Wr=null,Xr=0,Zr=[],qr=0,Yr=null,Jr=1,Qr="";function Kr(e,t){Gr[Vr++]=Xr,Gr[Vr++]=Wr,Wr=e,Xr=t}function $r(e,t,n){Zr[qr++]=Jr,Zr[qr++]=Qr,Zr[qr++]=Yr,Yr=e;var i=Jr;e=Qr;var r=32-ot(i)-1;i&=~(1<<r),n+=1;var a=32-ot(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Jr=1<<32-ot(t)+r|n<<r|i,Qr=a+e}else Jr=1<<a|n<<r|i,Qr=e}function ea(e){null!==e.return&&(Kr(e,1),$r(e,1,0))}function ta(e){for(;e===Wr;)Wr=Gr[--Vr],Gr[Vr]=null,Xr=Gr[--Vr],Gr[Vr]=null;for(;e===Yr;)Yr=Zr[--qr],Zr[qr]=null,Qr=Zr[--qr],Zr[qr]=null,Jr=Zr[--qr],Zr[qr]=null}var na=null,ia=null,ra=!1,aa=null;function oa(e,t){var n=Lu(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ia=ur(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ia=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Jr,overflow:Qr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Lu(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ia=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ua(e){if(ra){var t=ia;if(t){var n=t;if(!sa(e,t)){if(la(e))throw Error(a(418));t=ur(n.nextSibling);var i=na;t&&sa(e,t)?oa(i,n):(e.flags=-4097&e.flags|2,ra=!1,na=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,na=e}}}function ca(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ha(e){if(e!==na)return!1;if(!ra)return ca(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=ia)){if(la(e))throw fa(),Error(a(418));for(;t;)oa(e,t),t=ur(t.nextSibling)}if(ca(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ia=ur(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ia=null}}else ia=na?ur(e.stateNode.nextSibling):null;return!0}function fa(){for(var e=ia;e;)e=ur(e.nextSibling)}function da(){ia=na=null,ra=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var ma=x.ReactCurrentBatchConfig;function va(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ga=Mr(null),ya=null,_a=null,xa=null;function ba(){xa=_a=ya=null}function wa(e){var t=ga.current;Tr(ga),e._currentValue=t}function Sa(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ma(e,t){ya=e,xa=_a=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Ta(e){var t=e._currentValue;if(xa!==e)if(e={context:e,memoizedValue:t,next:null},null===_a){if(null===ya)throw Error(a(308));_a=e,ya.dependencies={lanes:0,firstContext:e}}else _a=_a.next=e;return t}var Ea=null;function Ca(e){null===Ea?Ea=[e]:Ea.push(e)}function ka(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ca(t)):(n.next=r.next,r.next=n),t.interleaved=n,Pa(e,i)}function Pa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Aa=!1;function Ra(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function La(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ia(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oa(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Pl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Pa(e,n)}return null===(r=i.interleaved)?(t.next=t,Ca(i)):(t.next=r.next,r.next=t),i.interleaved=t,Pa(e,n)}function Da(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Na(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function za(e,t,n,i){var r=e.updateQueue;Aa=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,u=l.next;l.next=null,null===o?a=u:o.next=u,o=l;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===s?c.firstBaseUpdate=u:s.next=u,c.lastBaseUpdate=l))}if(null!==a){var h=r.baseState;for(o=0,c=u=l=null,s=a;;){var f=s.lane,d=s.eventTime;if((i&f)===f){null!==c&&(c=c.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(f=t,d=n,m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(d,h,f);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(f="function"===typeof(p=m.payload)?p.call(d,h,f):p)||void 0===f)break e;h=z({},h,f);break e;case 2:Aa=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=r.effects)?r.effects=[s]:f.push(s))}else d={eventTime:d,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(u=c=d,l=h):c=c.next=d,o|=f;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(f=s).next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}if(null===c&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);zl|=o,e.lanes=o,e.memoizedState=h}}function Ua(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Fa=(new i.Component).refs;function Ba(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ha={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),a=Ia(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,r))&&(iu(t,e,r,i),Da(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),a=Ia(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,r))&&(iu(t,e,r,i),Da(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tu(),i=nu(e),r=Ia(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Oa(e,r,i))&&(iu(t,e,i,n),Da(t,e,i))}};function ja(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,a))}function Ga(e,t,n){var i=!1,r=Cr,a=t.contextType;return"object"===typeof a&&null!==a?a=Ta(a):(r=Lr(t)?Ar:kr.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?Rr(e,r):Cr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ha,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function Va(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Ha.enqueueReplaceState(t,t.state,null)}function Wa(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Fa,Ra(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Ta(a):(a=Lr(t)?Ar:kr.current,r.context=Rr(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(Ba(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Ha.enqueueReplaceState(r,r.state,null),za(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Xa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===Fa&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Za(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function qa(e){return(0,e._init)(e._payload)}function Ya(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ou(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Uu(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function u(e,t,n,i){var a=n.type;return a===S?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===L&&qa(a)===t.type)?((i=r(t,n.props)).ref=Xa(e,t,n),i.return=e,i):((i=Du(n.type,n.key,n.props,null,e.mode,i)).ref=Xa(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fu(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,a){return null===t||7!==t.tag?((t=Nu(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Du(t.type,t.key,t.props,null,e.mode,n)).ref=Xa(e,null,t),n.return=e,n;case w:return(t=Fu(t,e.mode,n)).return=e,t;case L:return f(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Nu(t,e.mode,n,null)).return=e,t;Za(e,t)}return null}function d(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?u(e,t,n,i):null;case w:return n.key===r?c(e,t,n,i):null;case L:return d(e,t,(r=n._init)(n._payload),i)}if(te(n)||D(n))return null!==r?null:h(e,t,n,i,null);Za(e,n)}return null}function p(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case L:return p(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||D(i))return h(t,e=e.get(n)||null,i,r,null);Za(t,i)}return null}function m(r,a,s,l){for(var u=null,c=null,h=a,m=a=0,v=null;null!==h&&m<s.length;m++){h.index>m?(v=h,h=null):v=h.sibling;var g=d(r,h,s[m],l);if(null===g){null===h&&(h=v);break}e&&h&&null===g.alternate&&t(r,h),a=o(g,a,m),null===c?u=g:c.sibling=g,c=g,h=v}if(m===s.length)return n(r,h),ra&&Kr(r,m),u;if(null===h){for(;m<s.length;m++)null!==(h=f(r,s[m],l))&&(a=o(h,a,m),null===c?u=h:c.sibling=h,c=h);return ra&&Kr(r,m),u}for(h=i(r,h);m<s.length;m++)null!==(v=p(h,r,m,s[m],l))&&(e&&null!==v.alternate&&h.delete(null===v.key?m:v.key),a=o(v,a,m),null===c?u=v:c.sibling=v,c=v);return e&&h.forEach((function(e){return t(r,e)})),ra&&Kr(r,m),u}function v(r,s,l,u){var c=D(l);if("function"!==typeof c)throw Error(a(150));if(null==(l=c.call(l)))throw Error(a(151));for(var h=c=null,m=s,v=s=0,g=null,y=l.next();null!==m&&!y.done;v++,y=l.next()){m.index>v?(g=m,m=null):g=m.sibling;var _=d(r,m,y.value,u);if(null===_){null===m&&(m=g);break}e&&m&&null===_.alternate&&t(r,m),s=o(_,s,v),null===h?c=_:h.sibling=_,h=_,m=g}if(y.done)return n(r,m),ra&&Kr(r,v),c;if(null===m){for(;!y.done;v++,y=l.next())null!==(y=f(r,y.value,u))&&(s=o(y,s,v),null===h?c=y:h.sibling=y,h=y);return ra&&Kr(r,v),c}for(m=i(r,m);!y.done;v++,y=l.next())null!==(y=p(m,r,v,y.value,u))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=o(y,s,v),null===h?c=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(r,e)})),ra&&Kr(r,v),c}return function e(i,a,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var u=o.key,c=a;null!==c;){if(c.key===u){if((u=o.type)===S){if(7===c.tag){n(i,c.sibling),(a=r(c,o.props.children)).return=i,i=a;break e}}else if(c.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===L&&qa(u)===c.type){n(i,c.sibling),(a=r(c,o.props)).ref=Xa(i,c,o),a.return=i,i=a;break e}n(i,c);break}t(i,c),c=c.sibling}o.type===S?((a=Nu(o.props.children,i.mode,l,o.key)).return=i,i=a):((l=Du(o.type,o.key,o.props,null,i.mode,l)).ref=Xa(i,a,o),l.return=i,i=l)}return s(i);case w:e:{for(c=o.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=Fu(o,i.mode,l)).return=i,i=a}return s(i);case L:return e(i,a,(c=o._init)(o._payload),l)}if(te(o))return m(i,a,o,l);if(D(o))return v(i,a,o,l);Za(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=Uu(o,i.mode,l)).return=i,i=a),s(i)):n(i,a)}}var Ja=Ya(!0),Qa=Ya(!1),Ka={},$a=Mr(Ka),eo=Mr(Ka),to=Mr(Ka);function no(e){if(e===Ka)throw Error(a(174));return e}function io(e,t){switch(Er(to,t),Er(eo,e),Er($a,Ka),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Tr($a),Er($a,t)}function ro(){Tr($a),Tr(eo),Tr(to)}function ao(e){no(to.current);var t=no($a.current),n=le(t,e.type);t!==n&&(Er(eo,e),Er($a,n))}function oo(e){eo.current===e&&(Tr($a),Tr(eo))}var so=Mr(0);function lo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function co(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var ho=x.ReactCurrentDispatcher,fo=x.ReactCurrentBatchConfig,po=0,mo=null,vo=null,go=null,yo=!1,_o=!1,xo=0,bo=0;function wo(){throw Error(a(321))}function So(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function Mo(e,t,n,i,r,o){if(po=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:ls,e=n(i,r),_o){o=0;do{if(_o=!1,xo=0,25<=o)throw Error(a(301));o+=1,go=vo=null,t.updateQueue=null,ho.current=us,e=n(i,r)}while(_o)}if(ho.current=os,t=null!==vo&&null!==vo.next,po=0,go=vo=mo=null,yo=!1,t)throw Error(a(300));return e}function To(){var e=0!==xo;return xo=0,e}function Eo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?mo.memoizedState=go=e:go=go.next=e,go}function Co(){if(null===vo){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=vo.next;var t=null===go?mo.memoizedState:go.next;if(null!==t)go=t,vo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(vo=e).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===go?mo.memoizedState=go=e:go=go.next=e}return go}function ko(e,t){return"function"===typeof t?t(e):t}function Po(e){var t=Co(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=vo,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=s=null,u=null,c=o;do{var h=c.lane;if((po&h)===h)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var f={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=f,s=i):u=u.next=f,mo.lanes|=h,zl|=h}c=c.next}while(null!==c&&c!==o);null===u?s=i:u.next=l,si(i,t.memoizedState)||(xs=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=u,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,mo.lanes|=o,zl|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Co(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);si(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Ro(){}function Lo(e,t){var n=mo,i=Co(),r=t(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,xs=!0),i=i.queue,Vo(Do.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Fo(9,Oo.bind(null,n,i,r,t),void 0,null),null===Al)throw Error(a(349));0!==(30&po)||Io(n,t,r)}return r}function Io(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Oo(e,t,n,i){t.value=n,t.getSnapshot=i,No(t)&&zo(e)}function Do(e,t,n){return n((function(){No(t)&&zo(e)}))}function No(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function zo(e){var t=Pa(e,1);null!==t&&iu(t,e,1,-1)}function Uo(e){var t=Eo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ko,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,mo,e),[t.memoizedState,e]}function Fo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Bo(){return Co().memoizedState}function Ho(e,t,n,i){var r=Eo();mo.flags|=e,r.memoizedState=Fo(1|t,n,void 0,void 0===i?null:i)}function jo(e,t,n,i){var r=Co();i=void 0===i?null:i;var a=void 0;if(null!==vo){var o=vo.memoizedState;if(a=o.destroy,null!==i&&So(i,o.deps))return void(r.memoizedState=Fo(t,n,a,i))}mo.flags|=e,r.memoizedState=Fo(1|t,n,a,i)}function Go(e,t){return Ho(8390656,8,e,t)}function Vo(e,t){return jo(2048,8,e,t)}function Wo(e,t){return jo(4,2,e,t)}function Xo(e,t){return jo(4,4,e,t)}function Zo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,jo(4,4,Zo.bind(null,t,e),n)}function Yo(){}function Jo(e,t){var n=Co();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&So(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Qo(e,t){var n=Co();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&So(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ko(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(si(n,t)||(n=mt(),mo.lanes|=n,zl|=n,e.baseState=!0),t)}function $o(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var i=fo.transition;fo.transition={};try{e(!1),t()}finally{_t=n,fo.transition=i}}function es(){return Co().memoizedState}function ts(e,t,n){var i=nu(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},is(e))rs(t,n);else if(null!==(n=ka(e,t,n,i))){iu(n,e,i,tu()),as(n,t,i)}}function ns(e,t,n){var i=nu(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(is(e))rs(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var l=t.interleaved;return null===l?(r.next=r,Ca(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(u){}null!==(n=ka(e,t,r,i))&&(iu(n,e,i,r=tu()),as(n,t,i))}}function is(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function rs(e,t){_o=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Ta,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ta,useCallback:function(e,t){return Eo().memoizedState=[e,void 0===t?null:t],e},useContext:Ta,useEffect:Go,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ho(4194308,4,Zo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ho(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ho(4,2,e,t)},useMemo:function(e,t){var n=Eo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Eo();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ts.bind(null,mo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Eo().memoizedState=e},useState:Uo,useDebugValue:Yo,useDeferredValue:function(e){return Eo().memoizedState=e},useTransition:function(){var e=Uo(!1),t=e[0];return e=$o.bind(null,e[1]),Eo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=mo,r=Eo();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Al)throw Error(a(349));0!==(30&po)||Io(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Go(Do.bind(null,i,o,e),[e]),i.flags|=2048,Fo(9,Oo.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Eo(),t=Al.identifierPrefix;if(ra){var n=Qr;t=":"+t+"R"+(n=(Jr&~(1<<32-ot(Jr)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:Ta,useCallback:Jo,useContext:Ta,useEffect:Vo,useImperativeHandle:qo,useInsertionEffect:Wo,useLayoutEffect:Xo,useMemo:Qo,useReducer:Po,useRef:Bo,useState:function(){return Po(ko)},useDebugValue:Yo,useDeferredValue:function(e){return Ko(Co(),vo.memoizedState,e)},useTransition:function(){return[Po(ko)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Lo,useId:es,unstable_isNewReconciler:!1},us={readContext:Ta,useCallback:Jo,useContext:Ta,useEffect:Vo,useImperativeHandle:qo,useInsertionEffect:Wo,useLayoutEffect:Xo,useMemo:Qo,useReducer:Ao,useRef:Bo,useState:function(){return Ao(ko)},useDebugValue:Yo,useDeferredValue:function(e){var t=Co();return null===vo?t.memoizedState=e:Ko(t,vo.memoizedState,e)},useTransition:function(){return[Ao(ko)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Lo,useId:es,unstable_isNewReconciler:!1};function cs(e,t){try{var n="",i=t;do{n+=H(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Ia(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Wl||(Wl=!0,Xl=i),fs(0,t)},n}function ms(e,t,n){(n=Ia(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){fs(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!==typeof i&&(null===Zl?Zl=new Set([this]):Zl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ds;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Eu.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ia(-1,1)).tag=2,Oa(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var _s=x.ReactCurrentOwner,xs=!1;function bs(e,t,n,i){t.child=null===e?Qa(t,null,n,i):Ja(t,e.child,n,i)}function ws(e,t,n,i,r){n=n.render;var a=t.ref;return Ma(t,r),i=Mo(e,t,n,i,a,r),n=To(),null===e||xs?(ra&&n&&ea(t),t.flags|=1,bs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ws(e,t,r))}function Ss(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||Iu(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Du(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ms(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&e.ref===t.ref)return Ws(e,t,r)}return t.flags|=1,(e=Ou(a,i)).ref=t.ref,e.return=t,t.child=e}function Ms(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(li(a,i)&&e.ref===t.ref){if(xs=!1,t.pendingProps=i=a,0===(e.lanes&r))return t.lanes=e.lanes,Ws(e,t,r);0!==(131072&e.flags)&&(xs=!0)}}return Cs(e,t,n,i,r)}function Ts(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Er(Ol,Il),Il|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Er(Ol,Il),Il|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Er(Ol,Il),Il|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,Er(Ol,Il),Il|=i;return bs(e,t,r,n),t.child}function Es(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,i,r){var a=Lr(n)?Ar:kr.current;return a=Rr(t,a),Ma(t,r),n=Mo(e,t,n,i,a,r),i=To(),null===e||xs?(ra&&i&&ea(t),t.flags|=1,bs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ws(e,t,r))}function ks(e,t,n,i,r){if(Lr(n)){var a=!0;Nr(t)}else a=!1;if(Ma(t,r),null===t.stateNode)Vs(e,t),Ga(t,n,i),Wa(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=Ta(u):u=Rr(t,u=Lr(n)?Ar:kr.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==u)&&Va(t,o,i,u),Aa=!1;var f=t.memoizedState;o.state=f,za(t,i,o,r),l=t.memoizedState,s!==i||f!==l||Pr.current||Aa?("function"===typeof c&&(Ba(t,n,c,i),l=t.memoizedState),(s=Aa||ja(t,n,s,i,f,l,u))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=u,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,La(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:va(t.type,s),o.props=u,h=t.pendingProps,f=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ta(l):l=Rr(t,l=Lr(n)?Ar:kr.current);var d=n.getDerivedStateFromProps;(c="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||f!==l)&&Va(t,o,i,l),Aa=!1,f=t.memoizedState,o.state=f,za(t,i,o,r);var p=t.memoizedState;s!==h||f!==p||Pr.current||Aa?("function"===typeof d&&(Ba(t,n,d,i),p=t.memoizedState),(u=Aa||ja(t,n,u,i,f,p,l)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=l,i=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),i=!1)}return Ps(e,t,n,i,a,r)}function Ps(e,t,n,i,r,a){Es(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&zr(t,n,!1),Ws(e,t,a);i=t.stateNode,_s.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Ja(t,e.child,null,a),t.child=Ja(t,null,s,a)):bs(e,t,s,a),t.memoizedState=i.state,r&&zr(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Or(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Or(0,t.context,!1),io(e,t.containerInfo)}function Rs(e,t,n,i,r){return da(),pa(r),t.flags|=256,bs(e,t,n,i),t.child}var Ls,Is,Os,Ds,Ns={dehydrated:null,treeContext:null,retryLane:0};function zs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Us(e,t,n){var i,r=t.pendingProps,o=so.current,s=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Er(so,1&o),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,s?(r=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=zu(l,r,0,null),e=Nu(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=zs(n),t.memoizedState=Ns,e):Fs(t,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,i=hs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=zu({mode:"visible",children:i.children},r,0,null),(o=Nu(o,r,s,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Ja(t,e.child,null,s),t.child.memoizedState=zs(s),t.memoizedState=Ns,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bs(e,t,s,i=hs(o=Error(a(419)),i,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(i=Al)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Pa(e,r),iu(i,e,r,-1))}return vu(),Bs(e,t,s,i=hs(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=ku.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ia=ur(r.nextSibling),na=t,ra=!0,aa=null,null!==e&&(Zr[qr++]=Jr,Zr[qr++]=Qr,Zr[qr++]=Yr,Jr=e.id,Qr=e.overflow,Yr=t),t=Fs(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,o,n);if(s){s=r.fallback,l=t.mode,i=(o=e.child).sibling;var u={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=u,t.deletions=null):(r=Ou(o,u)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Ou(i,s):(s=Nu(s,l,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,l=null===(l=e.child.memoizedState)?zs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Ns,r}return e=(s=e.child).sibling,r=Ou(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Fs(e,t){return(t=zu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,i){return null!==i&&pa(i),Ja(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Hs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Sa(e.return,t,n)}function js(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Gs(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(bs(e,t,i.children,n),0!==(2&(i=so.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Hs(e,n,t);else if(19===e.tag)Hs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Er(so,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===lo(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),js(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===lo(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}js(t,!0,n,null,a);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Vs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ws(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),zl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ou(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ou(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Xs(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Zs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function qs(e,t,n){var i=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zs(t),null;case 1:case 17:return Lr(t.type)&&Ir(),Zs(t),null;case 3:return i=t.stateNode,ro(),Tr(Pr),Tr(kr),co(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(su(aa),aa=null))),Is(e,t),Zs(t),null;case 5:oo(t);var r=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Os(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Zs(t),null}if(e=no($a.current),ha(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[fr]=t,i[dr]=o,e=0!==(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Di.length;r++)Fi(Di[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":J(i,o),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Fi("invalid",i);break;case"textarea":re(i,o),Fi("invalid",i)}for(var l in ye(n,o),r=null,o)if(o.hasOwnProperty(l)){var u=o[l];"children"===l?"string"===typeof u?i.textContent!==u&&(!0!==o.suppressHydrationWarning&&Ki(i.textContent,u,e),r=["children",u]):"number"===typeof u&&i.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&Ki(i.textContent,u,e),r=["children",""+u]):s.hasOwnProperty(l)&&null!=u&&"onScroll"===l&&Fi("scroll",i)}switch(n){case"input":X(i),$(i,o,!0);break;case"textarea":X(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[fr]=t,e[dr]=i,Ls(e,t,!1,!1),t.stateNode=e;e:{switch(l=_e(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Di.length;r++)Fi(Di[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":J(e,i),r=Y(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=z({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(o in ye(n,r),u=r)if(u.hasOwnProperty(o)){var c=u[o];"style"===o?ve(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===o?"string"===typeof c?("textarea"!==n||""!==c)&&fe(e,c):"number"===typeof c&&fe(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=c&&"onScroll"===o&&Fi("scroll",e):null!=c&&_(e,o,c,l))}switch(n){case"input":X(e),$(e,i,!1);break;case"textarea":X(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+V(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Zs(t),null;case 6:if(e&&null!=t.stateNode)Ds(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(n=no(to.current),no($a.current),ha(t)){if(i=t.stateNode,n=t.memoizedProps,i[fr]=t,(o=i.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Ki(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ki(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[fr]=t,t.stateNode=i}return Zs(t),null;case 13:if(Tr(so),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==ia&&0!==(1&t.mode)&&0===(128&t.flags))fa(),da(),t.flags|=98560,o=!1;else if(o=ha(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[fr]=t}else da(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Zs(t),o=!1}else null!==aa&&(su(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Dl&&(Dl=3):vu())),null!==t.updateQueue&&(t.flags|=4),Zs(t),null);case 4:return ro(),Is(e,t),null===e&&ji(t.stateNode.containerInfo),Zs(t),null;case 10:return wa(t.type._context),Zs(t),null;case 19:if(Tr(so),null===(o=t.memoizedState))return Zs(t),null;if(i=0!==(128&t.flags),null===(l=o.rendering))if(i)Xs(o,!1);else{if(0!==Dl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=lo(e))){for(t.flags|=128,Xs(o,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Er(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Qe()>Gl&&(t.flags|=128,i=!0,Xs(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=lo(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Xs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ra)return Zs(t),null}else 2*Qe()-o.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,i=!0,Xs(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Qe(),t.sibling=null,n=so.current,Er(so,i?1&n|2:1&n),t):(Zs(t),null);case 22:case 23:return fu(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Il)&&(Zs(t),6&t.subtreeFlags&&(t.flags|=8192)):Zs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ys(e,t){switch(ta(t),t.tag){case 1:return Lr(t.type)&&Ir(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),Tr(Pr),Tr(kr),co(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Tr(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));da()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Tr(so),null;case 4:return ro(),null;case 10:return wa(t.type._context),null;case 22:case 23:return fu(),null;default:return null}}Ls=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Is=function(){},Os=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,no($a.current);var a,o=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),o=[];break;case"select":r=z({},r,{value:void 0}),i=z({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(c in ye(n,i),n=null,r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var l=r[c];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in i){var u=i[c];if(l=null!=r?r[c]:void 0,i.hasOwnProperty(c)&&u!==l&&(null!=u||null!=l))if("style"===c)if(l){for(a in l)!l.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&l[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(o||(o=[]),o.push(c,n)),n=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(o=o||[]).push(c,u)):"children"===c?"string"!==typeof u&&"number"!==typeof u||(o=o||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&Fi("scroll",e),o||l===u||(o=[])):(o=o||[]).push(c,u))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Ds=function(e,t,n,i){n!==i&&(t.flags|=4)};var Js=!1,Qs=!1,Ks="function"===typeof WeakSet?WeakSet:Set,$s=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Tu(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Tu(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&tl(t,n,a)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function al(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fr],delete t[dr],delete t[mr],delete t[vr],delete t[gr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var hl=null,fl=!1;function dl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Qs||el(n,t);case 6:var i=hl,r=fl;hl=null,dl(e,t,n),fl=r,null!==(hl=i)&&(fl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(fl?(e=hl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),jt(e)):lr(hl,n.stateNode));break;case 4:i=hl,r=fl,hl=n.stateNode.containerInfo,fl=!0,dl(e,t,n),hl=i,fl=r;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&tl(n,t,o),r=r.next}while(r!==i)}dl(e,t,n);break;case 1:if(!Qs&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Tu(n,t,s)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Qs=(i=Qs)||null!==n.memoizedState,dl(e,t,n),Qs=i):dl(e,t,n);break;default:dl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ks),t.forEach((function(t){var i=Pu.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function vl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,fl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,fl=!0;break e}l=l.return}if(null===hl)throw Error(a(160));pl(o,s,r),hl=null,fl=!1;var u=r.alternate;null!==u&&(u.return=null),r.return=null}catch(c){Tu(r,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vl(t,e),yl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(v){Tu(e,e.return,v)}try{il(5,e,e.return)}catch(v){Tu(e,e.return,v)}}break;case 1:vl(t,e),yl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(vl(t,e),yl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{fe(r,"")}catch(v){Tu(e,e.return,v)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,l=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===l&&"radio"===o.type&&null!=o.name&&Q(r,o),_e(l,s);var c=_e(l,o);for(s=0;s<u.length;s+=2){var h=u[s],f=u[s+1];"style"===h?ve(r,f):"dangerouslySetInnerHTML"===h?he(r,f):"children"===h?fe(r,f):_(r,h,f,c)}switch(l){case"input":K(r,o);break;case"textarea":ae(r,o);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(r,!!o.multiple,p,!1):d!==!!o.multiple&&(null!=o.defaultValue?ne(r,!!o.multiple,o.defaultValue,!0):ne(r,!!o.multiple,o.multiple?[]:"",!1))}r[dr]=o}catch(v){Tu(e,e.return,v)}}break;case 6:if(vl(t,e),yl(e),4&i){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(v){Tu(e,e.return,v)}}break;case 3:if(vl(t,e),yl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(v){Tu(e,e.return,v)}break;case 4:default:vl(t,e),yl(e);break;case 13:vl(t,e),yl(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Qe())),4&i&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(c=Qs)||h,vl(t,e),Qs=c):vl(t,e),yl(e),8192&i){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&0!==(1&e.mode))for($s=e,h=e.child;null!==h;){for(f=$s=h;null!==$s;){switch(p=(d=$s).child,d.tag){case 0:case 11:case 14:case 15:il(4,d,d.return);break;case 1:el(d,d.return);var m=d.stateNode;if("function"===typeof m.componentWillUnmount){i=d,n=d.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(v){Tu(i,n,v)}}break;case 5:el(d,d.return);break;case 22:if(null!==d.memoizedState){wl(f);continue}}null!==p?(p.return=d,$s=p):wl(f)}h=h.sibling}e:for(h=null,f=e;;){if(5===f.tag){if(null===h){h=f;try{r=f.stateNode,c?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=f.stateNode,s=void 0!==(u=f.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,l.style.display=me("display",s))}catch(v){Tu(e,e.return,v)}}}else if(6===f.tag){if(null===h)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(v){Tu(e,e.return,v)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:vl(t,e),yl(e),4&i&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(fe(r,""),i.flags&=-33),cl(e,ll(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;ul(e,ll(e),o);break;default:throw Error(a(161))}}catch(s){Tu(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _l(e,t,n){$s=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==$s;){var r=$s,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Js;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Qs;s=Js;var u=Qs;if(Js=o,(Qs=l)&&!u)for($s=r;null!==$s;)l=(o=$s).child,22===o.tag&&null!==o.memoizedState?Sl(r):null!==l?(l.return=o,$s=l):Sl(r);for(;null!==a;)$s=a,xl(a,t,n),a=a.sibling;$s=r,Js=s,Qs=u}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,$s=a):bl(e)}}function bl(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Qs)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:va(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ua(t,o,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ua(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var f=h.dehydrated;null!==f&&jt(f)}}}break;default:throw Error(a(163))}Qs||512&t.flags&&al(t)}catch(d){Tu(t,t.return,d)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function wl(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Sl(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Tu(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Tu(t,r,l)}}var a=t.return;try{al(t)}catch(l){Tu(t,a,l)}break;case 5:var o=t.return;try{al(t)}catch(l){Tu(t,o,l)}}}catch(l){Tu(t,t.return,l)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Ml,Tl=Math.ceil,El=x.ReactCurrentDispatcher,Cl=x.ReactCurrentOwner,kl=x.ReactCurrentBatchConfig,Pl=0,Al=null,Rl=null,Ll=0,Il=0,Ol=Mr(0),Dl=0,Nl=null,zl=0,Ul=0,Fl=0,Bl=null,Hl=null,jl=0,Gl=1/0,Vl=null,Wl=!1,Xl=null,Zl=null,ql=!1,Yl=null,Jl=0,Ql=0,Kl=null,$l=-1,eu=0;function tu(){return 0!==(6&Pl)?Qe():-1!==$l?$l:$l=Qe()}function nu(e){return 0===(1&e.mode)?1:0!==(2&Pl)&&0!==Ll?Ll&-Ll:null!==ma.transition?(0===eu&&(eu=mt()),eu):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function iu(e,t,n,i){if(50<Ql)throw Ql=0,Kl=null,Error(a(185));gt(e,n,i),0!==(2&Pl)&&e===Al||(e===Al&&(0===(2&Pl)&&(Ul|=n),4===Dl&&lu(e,Ll)),ru(e,i),1===n&&0===Pl&&0===(1&t.mode)&&(Gl=Qe()+500,Fr&&jr()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=dt(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=ft(e,e===Al?Ll:0);if(0===i)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Fr=!0,Hr(e)}(uu.bind(null,e)):Hr(uu.bind(null,e)),or((function(){0===(6&Pl)&&jr()})),n=null;else{switch(xt(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Au(n,au.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function au(e,t){if($l=-1,eu=0,0!==(6&Pl))throw Error(a(327));var n=e.callbackNode;if(Su()&&e.callbackNode!==n)return null;var i=ft(e,e===Al?Ll:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gu(e,i);else{t=i;var r=Pl;Pl|=2;var o=mu();for(Al===e&&Ll===t||(Vl=null,Gl=Qe()+500,du(e,t));;)try{_u();break}catch(l){pu(e,l)}ba(),El.current=o,Pl=r,null!==Rl?t=0:(Al=null,Ll=0,t=Dl)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(i=r,t=ou(e,r))),1===t)throw n=Nl,du(e,0),lu(e,i),ru(e,Qe()),n;if(6===t)lu(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gu(e,i))&&(0!==(o=pt(e))&&(i=o,t=ou(e,o))),1===t))throw n=Nl,du(e,0),lu(e,i),ru(e,Qe()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(a(345));case 2:case 5:wu(e,Hl,Vl);break;case 3:if(lu(e,i),(130023424&i)===i&&10<(t=jl+500-Qe())){if(0!==ft(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tu(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(wu.bind(null,e,Hl,Vl),t);break}wu(e,Hl,Vl);break;case 4:if(lu(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-ot(i);o=1<<s,(s=t[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Qe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Tl(i/1960))-i)){e.timeoutHandle=ir(wu.bind(null,e,Hl,Vl),i);break}wu(e,Hl,Vl);break;default:throw Error(a(329))}}}return ru(e,Qe()),e.callbackNode===n?au.bind(null,e):null}function ou(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(du(e,t).flags|=256),2!==(e=gu(e,t))&&(t=Hl,Hl=n,null!==t&&su(t)),e}function su(e){null===Hl?Hl=e:Hl.push.apply(Hl,e)}function lu(e,t){for(t&=~Fl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function uu(e){if(0!==(6&Pl))throw Error(a(327));Su();var t=ft(e,0);if(0===(1&t))return ru(e,Qe()),null;var n=gu(e,t);if(0!==e.tag&&2===n){var i=pt(e);0!==i&&(t=i,n=ou(e,i))}if(1===n)throw n=Nl,du(e,0),lu(e,t),ru(e,Qe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wu(e,Hl,Vl),ru(e,Qe()),null}function cu(e,t){var n=Pl;Pl|=1;try{return e(t)}finally{0===(Pl=n)&&(Gl=Qe()+500,Fr&&jr())}}function hu(e){null!==Yl&&0===Yl.tag&&0===(6&Pl)&&Su();var t=Pl;Pl|=1;var n=kl.transition,i=_t;try{if(kl.transition=null,_t=1,e)return e()}finally{_t=i,kl.transition=n,0===(6&(Pl=t))&&jr()}}function fu(){Il=Ol.current,Tr(Ol)}function du(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Rl)for(n=Rl.return;null!==n;){var i=n;switch(ta(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Ir();break;case 3:ro(),Tr(Pr),Tr(kr),co();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:Tr(so);break;case 10:wa(i.type._context);break;case 22:case 23:fu()}n=n.return}if(Al=e,Rl=e=Ou(e.current,null),Ll=Il=t,Dl=0,Nl=null,Fl=Ul=zl=0,Hl=Bl=null,null!==Ea){for(t=0;t<Ea.length;t++)if(null!==(i=(n=Ea[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}Ea=null}return e}function pu(e,t){for(;;){var n=Rl;try{if(ba(),ho.current=os,yo){for(var i=mo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}yo=!1}if(po=0,go=vo=mo=null,_o=!1,xo=0,Cl.current=null,null===n||null===n.return){Dl=1,Nl=t,Rl=null;break}e:{var o=e,s=n.return,l=n,u=t;if(t=Ll,l.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var c=u,h=l,f=h.tag;if(0===(1&h.mode)&&(0===f||11===f||15===f)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,ys(p,s,l,0,t),1&p.mode&&vs(o,c,t),u=c;var m=(t=p).updateQueue;if(null===m){var v=new Set;v.add(u),t.updateQueue=v}else m.add(u);break e}if(0===(1&t)){vs(o,c,t),vu();break e}u=Error(a(426))}else if(ra&&1&l.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,l,0,t),pa(cs(u,l));break e}}o=u=cs(u,l),4!==Dl&&(Dl=2),null===Bl?Bl=[o]:Bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Na(o,ps(0,u,t));break e;case 1:l=u;var y=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Zl||!Zl.has(_)))){o.flags|=65536,t&=-t,o.lanes|=t,Na(o,ms(o,l,t));break e}}o=o.return}while(null!==o)}bu(n)}catch(x){t=x,Rl===n&&null!==n&&(Rl=n=n.return);continue}break}}function mu(){var e=El.current;return El.current=os,null===e?os:e}function vu(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Al||0===(268435455&zl)&&0===(268435455&Ul)||lu(Al,Ll)}function gu(e,t){var n=Pl;Pl|=2;var i=mu();for(Al===e&&Ll===t||(Vl=null,du(e,t));;)try{yu();break}catch(r){pu(e,r)}if(ba(),Pl=n,El.current=i,null!==Rl)throw Error(a(261));return Al=null,Ll=0,Dl}function yu(){for(;null!==Rl;)xu(Rl)}function _u(){for(;null!==Rl&&!Ye();)xu(Rl)}function xu(e){var t=Ml(e.alternate,e,Il);e.memoizedProps=e.pendingProps,null===t?bu(e):Rl=t,Cl.current=null}function bu(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,Il)))return void(Rl=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(Rl=n);if(null===e)return Dl=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Dl&&(Dl=5)}function wu(e,t,n){var i=_t,r=kl.transition;try{kl.transition=null,_t=1,function(e,t,n,i){do{Su()}while(null!==Yl);if(0!==(6&Pl))throw Error(a(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ot(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,o),e===Al&&(Rl=Al=null,Ll=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||ql||(ql=!0,Au(tt,(function(){return Su(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=kl.transition,kl.transition=null;var s=_t;_t=1;var l=Pl;Pl|=4,Cl.current=null,function(e,t){if(er=Vt,di(e=fi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(b){n=null;break e}var s=0,l=-1,u=-1,c=0,h=0,f=e,d=null;t:for(;;){for(var p;f!==n||0!==r&&3!==f.nodeType||(l=s+r),f!==o||0!==i&&3!==f.nodeType||(u=s+i),3===f.nodeType&&(s+=f.nodeValue.length),null!==(p=f.firstChild);)d=f,f=p;for(;;){if(f===e)break t;if(d===n&&++c===r&&(l=s),d===o&&++h===i&&(u=s),null!==(p=f.nextSibling))break;d=(f=d).parentNode}f=p}n=-1===l||-1===u?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Vt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,_=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:va(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(b){Tu(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=nl,nl=!1}(e,n),gl(n,e),pi(tr),Vt=!!er,tr=er=null,e.current=n,_l(n,e,r),Je(),Pl=l,_t=s,kl.transition=o}else e.current=n;if(ql&&(ql=!1,Yl=e,Jl=r),o=e.pendingLanes,0===o&&(Zl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ru(e,Qe()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Wl)throw Wl=!1,e=Xl,Xl=null,e;0!==(1&Jl)&&0!==e.tag&&Su(),o=e.pendingLanes,0!==(1&o)?e===Kl?Ql++:(Ql=0,Kl=e):Ql=0,jr()}(e,t,n,i)}finally{kl.transition=r,_t=i}return null}function Su(){if(null!==Yl){var e=xt(Jl),t=kl.transition,n=_t;try{if(kl.transition=null,_t=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Jl=0,0!==(6&Pl))throw Error(a(331));var r=Pl;for(Pl|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var l=o.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for($s=c;null!==$s;){var h=$s;switch(h.tag){case 0:case 11:case 15:il(8,h,o)}var f=h.child;if(null!==f)f.return=h,$s=f;else for(;null!==$s;){var d=(h=$s).sibling,p=h.return;if(ol(h),h===c){$s=null;break}if(null!==d){d.return=p,$s=d;break}$s=p}}}var m=o.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$s=y;break e}$s=o.return}}var _=e.current;for($s=_;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else e:for(s=_;null!==$s;){if(0!==(2048&(l=$s).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Tu(l,l.return,w)}if(l===s){$s=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,$s=b;break e}$s=l.return}}if(Pl=r,jr(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{_t=n,kl.transition=t}}return!1}function Mu(e,t,n){e=Oa(e,t=ps(0,t=cs(n,t),1),1),t=tu(),null!==e&&(gt(e,1,t),ru(e,t))}function Tu(e,t,n){if(3===e.tag)Mu(e,e,n);else for(;null!==t;){if(3===t.tag){Mu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Zl||!Zl.has(i))){t=Oa(t,e=ms(t,e=cs(n,e),1),1),e=tu(),null!==t&&(gt(t,1,e),ru(t,e));break}}t=t.return}}function Eu(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&n,Al===e&&(Ll&n)===n&&(4===Dl||3===Dl&&(130023424&Ll)===Ll&&500>Qe()-jl?du(e,0):Fl|=n),ru(e,t)}function Cu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=tu();null!==(e=Pa(e,t))&&(gt(e,t,n),ru(e,n))}function ku(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cu(e,n)}function Pu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(t),Cu(e,n)}function Au(e,t){return Ze(e,t)}function Ru(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lu(e,t,n,i){return new Ru(e,t,n,i)}function Iu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ou(e,t){var n=e.alternate;return null===n?((n=Lu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Du(e,t,n,i,r,o){var s=2;if(i=e,"function"===typeof e)Iu(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Nu(n.children,r,o,t);case M:s=8,r|=8;break;case T:return(e=Lu(12,n,t,2|r)).elementType=T,e.lanes=o,e;case P:return(e=Lu(13,n,t,r)).elementType=P,e.lanes=o,e;case A:return(e=Lu(19,n,t,r)).elementType=A,e.lanes=o,e;case I:return zu(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case C:s=9;break e;case k:s=11;break e;case R:s=14;break e;case L:s=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Lu(s,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Nu(e,t,n,i){return(e=Lu(7,e,i,t)).lanes=n,e}function zu(e,t,n,i){return(e=Lu(22,e,i,t)).elementType=I,e.lanes=n,e.stateNode={isHidden:!1},e}function Uu(e,t,n){return(e=Lu(6,e,null,t)).lanes=n,e}function Fu(e,t,n){return(t=Lu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bu(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Hu(e,t,n,i,r,a,o,s,l){return e=new Bu(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Lu(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ra(a),e}function ju(e){if(!e)return Cr;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Lr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Lr(n))return Dr(e,n,t)}return t}function Gu(e,t,n,i,r,a,o,s,l){return(e=Hu(n,i,!0,e,0,a,0,s,l)).context=ju(null),n=e.current,(a=Ia(i=tu(),r=nu(n))).callback=void 0!==t&&null!==t?t:null,Oa(n,a,r),e.current.lanes=r,gt(e,r,i),ru(e,i),e}function Vu(e,t,n,i){var r=t.current,a=tu(),o=nu(r);return n=ju(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ia(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Oa(r,t,o))&&(iu(e,r,o,a),Da(e,r,o)),o}function Wu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Xu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Zu(e,t){Xu(e,t),(e=e.alternate)&&Xu(e,t)}Ml=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:As(t),da();break;case 5:ao(t);break;case 1:Lr(t.type)&&Nr(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Er(ga,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Er(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Us(e,t,n):(Er(so,1&so.current),null!==(e=Ws(e,t,n))?e.sibling:null);Er(so,1&so.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Gs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Er(so,so.current),i)break;return null;case 22:case 23:return t.lanes=0,Ts(e,t,n)}return Ws(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ra&&0!==(1048576&t.flags)&&$r(t,Xr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Vs(e,t),e=t.pendingProps;var r=Rr(t,kr.current);Ma(t,n),r=Mo(null,t,i,e,r,n);var o=To();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Lr(i)?(o=!0,Nr(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ra(t),r.updater=Ha,t.stateNode=r,r._reactInternals=t,Wa(t,i,e,n),t=Ps(null,t,i,!0,o,n)):(t.tag=0,ra&&o&&ea(t),bs(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Iu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===k)return 11;if(e===R)return 14}return 2}(i),e=va(i,e),r){case 0:t=Cs(null,t,i,e,n);break e;case 1:t=ks(null,t,i,e,n);break e;case 11:t=ws(null,t,i,e,n);break e;case 14:t=Ss(null,t,i,va(i.type,e),n);break e}throw Error(a(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Cs(e,t,i,r=t.elementType===i?r:va(i,r),n);case 1:return i=t.type,r=t.pendingProps,ks(e,t,i,r=t.elementType===i?r:va(i,r),n);case 3:e:{if(As(t),null===e)throw Error(a(387));i=t.pendingProps,r=(o=t.memoizedState).element,La(e,t),za(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,i,n,r=cs(Error(a(423)),t));break e}if(i!==r){t=Rs(e,t,i,n,r=cs(Error(a(424)),t));break e}for(ia=ur(t.stateNode.containerInfo.firstChild),na=t,ra=!0,aa=null,n=Qa(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(da(),i===r){t=Ws(e,t,n);break e}bs(e,t,i,n)}t=t.child}return t;case 5:return ao(t),null===e&&ua(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==o&&nr(i,o)&&(t.flags|=32),Es(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return Us(e,t,n);case 4:return io(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ja(t,null,i,n):bs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,ws(e,t,i,r=t.elementType===i?r:va(i,r),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,Er(ga,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!Pr.current){t=Ws(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var u=l.firstContext;null!==u;){if(u.context===i){if(1===o.tag){(u=Ia(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),Sa(o.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Sa(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ma(t,n),i=i(r=Ta(r)),t.flags|=1,bs(e,t,i,n),t.child;case 14:return r=va(i=t.type,t.pendingProps),Ss(e,t,i,r=va(i.type,r),n);case 15:return Ms(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:va(i,r),Vs(e,t),t.tag=1,Lr(i)?(e=!0,Nr(t)):e=!1,Ma(t,n),Ga(t,i,r),Wa(t,i,r,n),Ps(null,t,i,!0,e,n);case 19:return Gs(e,t,n);case 22:return Ts(e,t,n)}throw Error(a(156,t.tag))};var qu="function"===typeof reportError?reportError:function(e){console.error(e)};function Yu(e){this._internalRoot=e}function Ju(e){this._internalRoot=e}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Ku(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $u(){}function ec(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var e=Wu(o);s.call(e)}}Vu(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var e=Wu(o);a.call(e)}}var o=Gu(t,i,e,0,null,!1,0,"",$u);return e._reactRootContainer=o,e[pr]=o.current,ji(8===e.nodeType?e.parentNode:e),hu(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Wu(l);s.call(e)}}var l=Hu(e,0,!1,null,0,!1,0,"",$u);return e._reactRootContainer=l,e[pr]=l.current,ji(8===e.nodeType?e.parentNode:e),hu((function(){Vu(t,l,n,i)})),l}(n,t,e,r,i);return Wu(o)}Ju.prototype.render=Yu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Vu(e,t,null,null)},Ju.prototype.unmount=Yu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hu((function(){Vu(null,e,null,null)})),t[pr]=null}},Ju.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<It.length&&0!==t&&t<It[n].priority;n++);It.splice(n,0,e),0===n&&zt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),ru(t,Qe()),0===(6&Pl)&&(Gl=Qe()+500,jr()))}break;case 13:hu((function(){var t=Pa(e,1);if(null!==t){var n=tu();iu(t,e,1,n)}})),Zu(e,1)}},wt=function(e){if(13===e.tag){var t=Pa(e,134217728);if(null!==t)iu(t,e,134217728,tu());Zu(e,134217728)}},St=function(e){if(13===e.tag){var t=nu(e),n=Pa(e,t);if(null!==n)iu(n,e,t,tu());Zu(e,t)}},Mt=function(){return _t},Tt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},we=function(e,t,n){switch(t){case"input":if(K(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(a(90));Z(i),K(i,r)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},ke=cu,Pe=hu;var tc={usingClientEntryPoint:!1,Events:[_r,xr,br,Ee,Ce,cu]},nc={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ic={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{rt=rc.inject(ic),at=rc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qu(t))throw Error(a(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qu(e))throw Error(a(299));var n=!1,i="",r=qu;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Hu(e,1,!1,null,0,n,0,i,r),e[pr]=t.current,ji(8===e.nodeType?e.parentNode:e),new Yu(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return hu(e)},t.hydrate=function(e,t,n){if(!Ku(t))throw Error(a(200));return ec(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qu(e))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=qu;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gu(t,null,e,1,null!=n?n:null,r,0,o,s),e[pr]=t.current,ji(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Ju(t)},t.render=function(e,t,n){if(!Ku(t))throw Error(a(200));return ec(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ku(e))throw Error(a(40));return!!e._reactRootContainer&&(hu((function(){ec(null,null,e,!1,(function(){e._reactRootContainer=null,e[pr]=null}))})),!0)},t.unstable_batchedUpdates=cu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Ku(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ec(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var i=n(164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},976:function(e,t){"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},721:function(e,t,n){e.exports=function(e){var t={},i=n(791),r=n(100),a=Object.assign;function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var x=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var b=Symbol.iterator;function w(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=b&&e[b]||e["@@iterator"])?e:null}function S(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case c:return"Fragment";case u:return"Portal";case f:return"Profiler";case h:return"StrictMode";case v:return"Suspense";case g:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:S(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return S(e(t))}catch(n){}}return null}function M(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return S(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function T(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function E(e){if(T(e)!==e)throw Error(o(188))}function C(e){var t=e.alternate;if(!t){if(null===(t=T(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return E(r),e;if(a===i)return E(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}function k(e){return null!==(e=C(e))?P(e):null}function P(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=P(e);if(null!==t)return t;e=e.sibling}return null}function A(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=A(e);if(null!==t)return t}e=e.sibling}return null}var R,L=Array.isArray,I=e.getPublicInstance,O=e.getRootHostContext,D=e.getChildHostContext,N=e.prepareForCommit,z=e.resetAfterCommit,U=e.createInstance,F=e.appendInitialChild,B=e.finalizeInitialChildren,H=e.prepareUpdate,j=e.shouldSetTextContent,G=e.createTextInstance,V=e.scheduleTimeout,W=e.cancelTimeout,X=e.noTimeout,Z=e.isPrimaryRenderer,q=e.supportsMutation,Y=e.supportsPersistence,J=e.supportsHydration,Q=e.getInstanceFromNode,K=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,ie=e.supportsTestSelectors,re=e.findFiberRoot,ae=e.getBoundingRect,oe=e.getTextContent,se=e.isHiddenSubtree,le=e.matchAccessibilityRole,ue=e.setFocusIfFocusable,ce=e.setupIntersectionObserver,he=e.appendChild,fe=e.appendChildToContainer,de=e.commitTextUpdate,pe=e.commitMount,me=e.commitUpdate,ve=e.insertBefore,ge=e.insertInContainerBefore,ye=e.removeChild,_e=e.removeChildFromContainer,xe=e.resetTextContent,be=e.hideInstance,we=e.hideTextInstance,Se=e.unhideInstance,Me=e.unhideTextInstance,Te=e.clearContainer,Ee=e.cloneInstance,Ce=e.createContainerChildSet,ke=e.appendChildToContainerChildSet,Pe=e.finalizeContainerChildren,Ae=e.replaceContainerChildren,Re=e.cloneHiddenInstance,Le=e.cloneHiddenTextInstance,Ie=e.canHydrateInstance,Oe=e.canHydrateTextInstance,De=e.canHydrateSuspenseInstance,Ne=e.isSuspenseInstancePending,ze=e.isSuspenseInstanceFallback,Ue=e.registerSuspenseInstanceRetry,Fe=e.getNextHydratableSibling,Be=e.getFirstHydratableChild,He=e.getFirstHydratableChildWithinContainer,je=e.getFirstHydratableChildWithinSuspenseInstance,Ge=e.hydrateInstance,Ve=e.hydrateTextInstance,We=e.hydrateSuspenseInstance,Xe=e.getNextHydratableInstanceAfterSuspenseInstance,Ze=e.commitHydratedContainer,qe=e.commitHydratedSuspenseInstance,Ye=e.clearSuspenseBoundary,Je=e.clearSuspenseBoundaryFromContainer,Qe=e.shouldDeleteUnhydratedTailInstances,Ke=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===R)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);R=t&&t[1]||""}return"\n"+R+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&"string"===typeof u.stack){for(var r=u.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var it=Object.prototype.hasOwnProperty,rt=[],at=-1;function ot(e){return{current:e}}function st(e){0>at||(e.current=rt[at],rt[at]=null,at--)}function lt(e,t){at++,rt[at]=e.current,e.current=t}var ut={},ct=ot(ut),ht=ot(!1),ft=ut;function dt(e,t){var n=e.type.contextTypes;if(!n)return ut;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function pt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mt(){st(ht),st(ct)}function vt(e,t,n){if(ct.current!==ut)throw Error(o(168));lt(ct,t),lt(ht,n)}function gt(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,M(e)||"Unknown",r));return a({},n,i)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ut,ft=ct.current,lt(ct,e),lt(ht,ht.current),!0}function _t(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=gt(e,t,ft),i.__reactInternalMemoizedMergedChildContext=e,st(ht),st(ct),lt(ct,e)):st(ht),lt(ht,n)}var xt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(bt(e)/wt|0)|0},bt=Math.log,wt=Math.LN2;var St=64,Mt=4194304;function Tt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Et(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=Tt(s):0!==(a&=o)&&(i=Tt(a))}else 0!==(o=n&~r)?i=Tt(o):0!==a&&(i=Tt(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-xt(t)),i|=e[n],t&=~r;return i}function Ct(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function kt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Pt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function At(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-xt(t)]=n}function Rt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-xt(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var Lt=0;function It(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Ot=r.unstable_scheduleCallback,Dt=r.unstable_cancelCallback,Nt=r.unstable_shouldYield,zt=r.unstable_requestPaint,Ut=r.unstable_now,Ft=r.unstable_ImmediatePriority,Bt=r.unstable_UserBlockingPriority,Ht=r.unstable_NormalPriority,jt=r.unstable_IdlePriority,Gt=null,Vt=null;var Wt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Xt=null,Zt=!1,qt=!1;function Yt(e){null===Xt?Xt=[e]:Xt.push(e)}function Jt(){if(!qt&&null!==Xt){qt=!0;var e=0,t=Lt;try{var n=Xt;for(Lt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Xt=null,Zt=!1}catch(r){throw null!==Xt&&(Xt=Xt.slice(e+1)),Ot(Ft,Jt),r}finally{Lt=t,qt=!1}}return null}var Qt=s.ReactCurrentBatchConfig;function Kt(e,t){if(Wt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!it.call(t,r)||!Wt(e[r],t[r]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=ot(null),nn=null,rn=null,an=null;function on(){an=rn=nn=null}function sn(e,t,n){Z?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;st(tn),Z?e._currentValue=t:e._currentValue2=t}function un(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function cn(e,t){nn=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Nr=!0),e.firstContext=null)}function hn(e){var t=Z?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(o(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var fn=null,dn=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function vn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==qa&&0!==(1&e.mode)&&0===(2&Za)?(null===(e=n.interleaved)?(t.next=t,null===fn?fn=[n]:fn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Rt(e,n)}}function _n(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xn(e,t,n,i){var r=e.updateQueue;dn=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var u=l,c=u.next;u.next=null,null===s?o=c:s.next=c,s=u;var h=e.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===l?h.firstBaseUpdate=c:l.next=c,h.lastBaseUpdate=u))}if(null!==o){var f=r.baseState;for(s=0,h=c=u=null,l=o;;){var d=l.lane,p=l.eventTime;if((i&d)===d){null!==h&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,v=l;switch(d=t,p=n,v.tag){case 1:if("function"===typeof(m=v.payload)){f=m.call(p,f,d);break e}f=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(d="function"===typeof(m=v.payload)?m.call(p,f,d):m)||void 0===d)break e;f=a({},f,d);break e;case 2:dn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[l]:d.push(l))}else p={eventTime:p,lane:d,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(c=h=p,u=f):h=h.next=p,s|=d;if(null===(l=l.next)){if(null===(l=r.shared.pending))break;l=(d=l).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===h&&(u=f),r.baseState=u,r.firstBaseUpdate=c,r.lastBaseUpdate=h,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);to|=s,e.lanes=s,e.memoizedState=f}}function bn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var wn=(new i.Component).refs;function Sn(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Mn={isMounted:function(e){return!!(e=e._reactInternals)&&T(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=bo(),r=wo(e),a=vn(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),gn(e,a),null!==(t=So(e,r,i))&&yn(t,e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=bo(),r=wo(e),a=vn(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),gn(e,a),null!==(t=So(e,r,i))&&yn(t,e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=bo(),i=wo(e),r=vn(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),gn(e,r),null!==(t=So(e,i,n))&&yn(t,e,i)}};function Tn(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!Kt(n,i)||!Kt(r,a))}function En(e,t,n){var i=!1,r=ut,a=t.contextType;return"object"===typeof a&&null!==a?a=hn(a):(r=pt(t)?ft:ct.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?dt(e,r):ut),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Mn,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function Cn(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Mn.enqueueReplaceState(t,t.state,null)}function kn(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=wn,pn(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=hn(a):(a=pt(t)?ft:ct.current,r.context=dt(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(Sn(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Mn.enqueueReplaceState(r,r.state,null),xn(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}var Pn=[],An=0,Rn=null,Ln=0,In=[],On=0,Dn=null,Nn=1,zn="";function Un(e,t){Pn[An++]=Ln,Pn[An++]=Rn,Rn=e,Ln=t}function Fn(e,t,n){In[On++]=Nn,In[On++]=zn,In[On++]=Dn,Dn=e;var i=Nn;e=zn;var r=32-xt(i)-1;i&=~(1<<r),n+=1;var a=32-xt(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Nn=1<<32-xt(t)+r|n<<r|i,zn=a+e}else Nn=1<<a|n<<r|i,zn=e}function Bn(e){null!==e.return&&(Un(e,1),Fn(e,1,0))}function Hn(e){for(;e===Rn;)Rn=Pn[--An],Pn[An]=null,Ln=Pn[--An],Pn[An]=null;for(;e===Dn;)Dn=In[--On],In[On]=null,zn=In[--On],In[On]=null,Nn=In[--On],In[On]=null}var jn=null,Gn=null,Vn=!1,Wn=!1,Xn=null;function Zn(e,t){var n=Ko(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function qn(e,t){switch(e.tag){case 5:return null!==(t=Ie(t,e.type,e.pendingProps))&&(e.stateNode=t,jn=e,Gn=Be(t),!0);case 6:return null!==(t=Oe(t,e.pendingProps))&&(e.stateNode=t,jn=e,Gn=null,!0);case 13:if(null!==(t=De(t))){var n=null!==Dn?{id:Nn,overflow:zn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ko(18,null,null,0)).stateNode=t,n.return=e,e.child=n,jn=e,Gn=null,!0}return!1;default:return!1}}function Yn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Jn(e){if(Vn){var t=Gn;if(t){var n=t;if(!qn(e,t)){if(Yn(e))throw Error(o(418));t=Fe(n);var i=jn;t&&qn(e,t)?Zn(i,n):(e.flags=-4097&e.flags|2,Vn=!1,jn=e)}}else{if(Yn(e))throw Error(o(418));e.flags=-4097&e.flags|2,Vn=!1,jn=e}}}function Qn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;jn=e}function Kn(e){if(!J||e!==jn)return!1;if(!Vn)return Qn(e),Vn=!0,!1;if(3!==e.tag&&(5!==e.tag||Qe(e.type)&&!j(e.type,e.memoizedProps))){var t=Gn;if(t){if(Yn(e)){for(e=Gn;e;)e=Fe(e);throw Error(o(418))}for(;t;)Zn(e,t),t=Fe(t)}}if(Qn(e),13===e.tag){if(!J)throw Error(o(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));Gn=Xe(e)}else Gn=jn?Fe(e.stateNode):null;return!0}function $n(){J&&(Gn=jn=null,Wn=Vn=!1)}function ei(e){null===Xn?Xn=[e]:Xn.push(e)}function ti(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===wn&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function ni(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ii(e){return(0,e._init)(e._payload)}function ri(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=es(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,i){return null===t||6!==t.tag?((t=rs(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function f(e,t,n,i){var a=n.type;return a===c?p(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===_&&ii(a)===t.type)?((i=r(t,n.props)).ref=ti(e,t,n),i.return=e,i):((i=ts(n.type,n.key,n.props,null,e.mode,i)).ref=ti(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=as(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function p(e,t,n,i,a){return null===t||7!==t.tag?((t=ns(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function m(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=rs(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return(n=ts(t.type,t.key,t.props,null,e.mode,n)).ref=ti(e,null,t),n.return=e,n;case u:return(t=as(t,e.mode,n)).return=e,t;case _:return m(e,(0,t._init)(t._payload),n)}if(L(t)||w(t))return(t=ns(t,e.mode,n,null)).return=e,t;ni(e,t)}return null}function v(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:h(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===r?f(e,t,n,i):null;case u:return n.key===r?d(e,t,n,i):null;case _:return v(e,t,(r=n._init)(n._payload),i)}if(L(n)||w(n))return null!==r?null:p(e,t,n,i,null);ni(e,n)}return null}function g(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return h(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case l:return f(t,e=e.get(null===i.key?n:i.key)||null,i,r);case u:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case _:return g(e,t,n,(0,i._init)(i._payload),r)}if(L(i)||w(i))return p(t,e=e.get(n)||null,i,r,null);ni(t,i)}return null}function y(r,o,s,l){for(var u=null,c=null,h=o,f=o=0,d=null;null!==h&&f<s.length;f++){h.index>f?(d=h,h=null):d=h.sibling;var p=v(r,h,s[f],l);if(null===p){null===h&&(h=d);break}e&&h&&null===p.alternate&&t(r,h),o=a(p,o,f),null===c?u=p:c.sibling=p,c=p,h=d}if(f===s.length)return n(r,h),Vn&&Un(r,f),u;if(null===h){for(;f<s.length;f++)null!==(h=m(r,s[f],l))&&(o=a(h,o,f),null===c?u=h:c.sibling=h,c=h);return Vn&&Un(r,f),u}for(h=i(r,h);f<s.length;f++)null!==(d=g(h,r,f,s[f],l))&&(e&&null!==d.alternate&&h.delete(null===d.key?f:d.key),o=a(d,o,f),null===c?u=d:c.sibling=d,c=d);return e&&h.forEach((function(e){return t(r,e)})),Vn&&Un(r,f),u}function x(r,s,l,u){var c=w(l);if("function"!==typeof c)throw Error(o(150));if(null==(l=c.call(l)))throw Error(o(151));for(var h=c=null,f=s,d=s=0,p=null,y=l.next();null!==f&&!y.done;d++,y=l.next()){f.index>d?(p=f,f=null):p=f.sibling;var _=v(r,f,y.value,u);if(null===_){null===f&&(f=p);break}e&&f&&null===_.alternate&&t(r,f),s=a(_,s,d),null===h?c=_:h.sibling=_,h=_,f=p}if(y.done)return n(r,f),Vn&&Un(r,d),c;if(null===f){for(;!y.done;d++,y=l.next())null!==(y=m(r,y.value,u))&&(s=a(y,s,d),null===h?c=y:h.sibling=y,h=y);return Vn&&Un(r,d),c}for(f=i(r,f);!y.done;d++,y=l.next())null!==(y=g(f,r,d,y.value,u))&&(e&&null!==y.alternate&&f.delete(null===y.key?d:y.key),s=a(y,s,d),null===h?c=y:h.sibling=y,h=y);return e&&f.forEach((function(e){return t(r,e)})),Vn&&Un(r,d),c}return function e(i,a,o,h){if("object"===typeof o&&null!==o&&o.type===c&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case l:e:{for(var f=o.key,d=a;null!==d;){if(d.key===f){if((f=o.type)===c){if(7===d.tag){n(i,d.sibling),(a=r(d,o.props.children)).return=i,i=a;break e}}else if(d.elementType===f||"object"===typeof f&&null!==f&&f.$$typeof===_&&ii(f)===d.type){n(i,d.sibling),(a=r(d,o.props)).ref=ti(i,d,o),a.return=i,i=a;break e}n(i,d);break}t(i,d),d=d.sibling}o.type===c?((a=ns(o.props.children,i.mode,h,o.key)).return=i,i=a):((h=ts(o.type,o.key,o.props,null,i.mode,h)).ref=ti(i,a,o),h.return=i,i=h)}return s(i);case u:e:{for(d=o.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=as(o,i.mode,h)).return=i,i=a}return s(i);case _:return e(i,a,(d=o._init)(o._payload),h)}if(L(o))return y(i,a,o,h);if(w(o))return x(i,a,o,h);ni(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=rs(o,i.mode,h)).return=i,i=a),s(i)):n(i,a)}}var ai=ri(!0),oi=ri(!1),si={},li=ot(si),ui=ot(si),ci=ot(si);function hi(e){if(e===si)throw Error(o(174));return e}function fi(e,t){lt(ci,t),lt(ui,e),lt(li,si),e=O(t),st(li),lt(li,e)}function di(){st(li),st(ui),st(ci)}function pi(e){var t=hi(ci.current),n=hi(li.current);n!==(t=D(n,e.type,t))&&(lt(ui,e),lt(li,t))}function mi(e){ui.current===e&&(st(li),st(ui))}var vi=ot(0);function gi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Ne(n)||ze(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yi=[];function _i(){for(var e=0;e<yi.length;e++){var t=yi[e];Z?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yi.length=0}var xi=s.ReactCurrentDispatcher,bi=s.ReactCurrentBatchConfig,wi=0,Si=null,Mi=null,Ti=null,Ei=!1,Ci=!1,ki=0,Pi=0;function Ai(){throw Error(o(321))}function Ri(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wt(e[n],t[n]))return!1;return!0}function Li(e,t,n,i,r,a){if(wi=a,Si=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xi.current=null===e||null===e.memoizedState?pr:mr,e=n(i,r),Ci){a=0;do{if(Ci=!1,ki=0,25<=a)throw Error(o(301));a+=1,Ti=Mi=null,t.updateQueue=null,xi.current=vr,e=n(i,r)}while(Ci)}if(xi.current=dr,t=null!==Mi&&null!==Mi.next,wi=0,Ti=Mi=Si=null,Ei=!1,t)throw Error(o(300));return e}function Ii(){var e=0!==ki;return ki=0,e}function Oi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ti?Si.memoizedState=Ti=e:Ti=Ti.next=e,Ti}function Di(){if(null===Mi){var e=Si.alternate;e=null!==e?e.memoizedState:null}else e=Mi.next;var t=null===Ti?Si.memoizedState:Ti.next;if(null!==t)Ti=t,Mi=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Mi=e).memoizedState,baseState:Mi.baseState,baseQueue:Mi.baseQueue,queue:Mi.queue,next:null},null===Ti?Si.memoizedState=Ti=e:Ti=Ti.next=e}return Ti}function Ni(e,t){return"function"===typeof t?t(e):t}function zi(e){var t=Di(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=Mi,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=s=null,u=null,c=a;do{var h=c.lane;if((wi&h)===h)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var f={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=f,s=i):u=u.next=f,Si.lanes|=h,to|=h}c=c.next}while(null!==c&&c!==a);null===u?s=i:u.next=l,Wt(i,t.memoizedState)||(Nr=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=u,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,Si.lanes|=a,to|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ui(e){var t=Di(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);Wt(a,t.memoizedState)||(Nr=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Fi(){}function Bi(e,t){var n=Si,i=Di(),r=t(),a=!Wt(i.memoizedState,r);if(a&&(i.memoizedState=r,Nr=!0),i=i.queue,Qi(Gi.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==Ti&&1&Ti.memoizedState.tag){if(n.flags|=2048,Xi(9,ji.bind(null,n,i,r,t),void 0,null),null===qa)throw Error(o(349));0!==(30&wi)||Hi(n,t,r)}return r}function Hi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Si.updateQueue)?(t={lastEffect:null,stores:null},Si.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ji(e,t,n,i){t.value=n,t.getSnapshot=i,Vi(t)&&So(e,1,-1)}function Gi(e,t,n){return n((function(){Vi(t)&&So(e,1,-1)}))}function Vi(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wt(e,n)}catch(i){return!0}}function Wi(e){var t=Oi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:e},t.queue=e,e=e.dispatch=lr.bind(null,Si,e),[t.memoizedState,e]}function Xi(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Si.updateQueue)?(t={lastEffect:null,stores:null},Si.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Zi(){return Di().memoizedState}function qi(e,t,n,i){var r=Oi();Si.flags|=e,r.memoizedState=Xi(1|t,n,void 0,void 0===i?null:i)}function Yi(e,t,n,i){var r=Di();i=void 0===i?null:i;var a=void 0;if(null!==Mi){var o=Mi.memoizedState;if(a=o.destroy,null!==i&&Ri(i,o.deps))return void(r.memoizedState=Xi(t,n,a,i))}Si.flags|=e,r.memoizedState=Xi(1|t,n,a,i)}function Ji(e,t){return qi(8390656,8,e,t)}function Qi(e,t){return Yi(2048,8,e,t)}function Ki(e,t){return Yi(4,2,e,t)}function $i(e,t){return Yi(4,4,e,t)}function er(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function tr(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Yi(4,4,er.bind(null,t,e),n)}function nr(){}function ir(e,t){var n=Di();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ri(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function rr(e,t){var n=Di();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ri(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function ar(e,t){var n=Lt;Lt=0!==n&&4>n?n:4,e(!0);var i=bi.transition;bi.transition={};try{e(!1),t()}finally{Lt=n,bi.transition=i}}function or(){return Di().memoizedState}function sr(e,t,n){var i=wo(e);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ur(e)?cr(t,n):(hr(e,t,n),null!==(e=So(e,i,n=bo()))&&fr(e,t,i))}function lr(e,t,n){var i=wo(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ur(e))cr(t,r);else{hr(e,t,r);var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,Wt(s,o))return}catch(l){}null!==(e=So(e,i,n=bo()))&&fr(e,t,i)}}function ur(e){var t=e.alternate;return e===Si||null!==t&&t===Si}function cr(e,t){Ci=Ei=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hr(e,t,n){null!==qa&&0!==(1&e.mode)&&0===(2&Za)?(null===(e=t.interleaved)?(n.next=n,null===fn?fn=[t]:fn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function fr(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Rt(e,n)}}var dr={readContext:hn,useCallback:Ai,useContext:Ai,useEffect:Ai,useImperativeHandle:Ai,useInsertionEffect:Ai,useLayoutEffect:Ai,useMemo:Ai,useReducer:Ai,useRef:Ai,useState:Ai,useDebugValue:Ai,useDeferredValue:Ai,useTransition:Ai,useMutableSource:Ai,useSyncExternalStore:Ai,useId:Ai,unstable_isNewReconciler:!1},pr={readContext:hn,useCallback:function(e,t){return Oi().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Ji,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,qi(4194308,4,er.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qi(4194308,4,e,t)},useInsertionEffect:function(e,t){return qi(4,2,e,t)},useMemo:function(e,t){var n=Oi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Oi();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=sr.bind(null,Si,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Oi().memoizedState=e},useState:Wi,useDebugValue:nr,useDeferredValue:function(e){var t=Wi(e),n=t[0],i=t[1];return Ji((function(){var t=bi.transition;bi.transition={};try{i(e)}finally{bi.transition=t}}),[e]),n},useTransition:function(){var e=Wi(!1),t=e[0];return e=ar.bind(null,e[1]),Oi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=Si,r=Oi();if(Vn){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===qa)throw Error(o(349));0!==(30&wi)||Hi(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Ji(Gi.bind(null,i,a,e),[e]),i.flags|=2048,Xi(9,ji.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=Oi(),t=qa.identifierPrefix;if(Vn){var n=zn;t=":"+t+"R"+(n=(Nn&~(1<<32-xt(Nn)-1)).toString(32)+n),0<(n=ki++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Pi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Qi,useImperativeHandle:tr,useInsertionEffect:Ki,useLayoutEffect:$i,useMemo:rr,useReducer:zi,useRef:Zi,useState:function(){return zi(Ni)},useDebugValue:nr,useDeferredValue:function(e){var t=zi(Ni),n=t[0],i=t[1];return Qi((function(){var t=bi.transition;bi.transition={};try{i(e)}finally{bi.transition=t}}),[e]),n},useTransition:function(){return[zi(Ni)[0],Di().memoizedState]},useMutableSource:Fi,useSyncExternalStore:Bi,useId:or,unstable_isNewReconciler:!1},vr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Qi,useImperativeHandle:tr,useInsertionEffect:Ki,useLayoutEffect:$i,useMemo:rr,useReducer:Ui,useRef:Zi,useState:function(){return Ui(Ni)},useDebugValue:nr,useDeferredValue:function(e){var t=Ui(Ni),n=t[0],i=t[1];return Qi((function(){var t=bi.transition;bi.transition={};try{i(e)}finally{bi.transition=t}}),[e]),n},useTransition:function(){return[Ui(Ni)[0],Di().memoizedState]},useMutableSource:Fi,useSyncExternalStore:Bi,useId:or,unstable_isNewReconciler:!1};function gr(e,t){try{var n="",i=t;do{n+=$t(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r}}function yr(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var _r,xr,br,wr,Sr="function"===typeof WeakMap?WeakMap:Map;function Mr(e,t,n){(n=vn(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){co||(co=!0,ho=i),yr(0,t)},n}function Tr(e,t,n){(n=vn(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){yr(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){yr(0,t),"function"!==typeof i&&(null===fo?fo=new Set([this]):fo.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Er(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Sr;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Xo.bind(null,e,t,n),t.then(e,e))}function Cr(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function kr(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=vn(-1,1)).tag=2,gn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}function Pr(e){e.flags|=4}function Ar(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(q)_r=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)F(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},xr=function(){},br=function(e,t,n,i,r){if((e=e.memoizedProps)!==i){var a=t.stateNode,o=hi(li.current);n=H(a,n,e,i,r,o),(t.updateQueue=n)&&Pr(t)}},wr=function(e,t,n,i){n!==i&&Pr(t)};else if(Y){_r=function(e,t,n,i){for(var r=t.child;null!==r;){if(5===r.tag){var a=r.stateNode;n&&i&&(a=Re(a,r.type,r.memoizedProps,r)),F(e,a)}else if(6===r.tag)a=r.stateNode,n&&i&&(a=Le(a,r.memoizedProps,r)),F(e,a);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(a=r.child)&&(a.return=r),_r(e,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};var Rr=function e(t,n,i,r){for(var a=n.child;null!==a;){if(5===a.tag){var o=a.stateNode;i&&r&&(o=Re(o,a.type,a.memoizedProps,a)),ke(t,o)}else if(6===a.tag)o=a.stateNode,i&&r&&(o=Le(o,a.memoizedProps,a)),ke(t,o);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(o=a.child)&&(o.return=a),e(t,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===n)break;for(;null===a.sibling;){if(null===a.return||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};xr=function(e,t){var n=t.stateNode;if(!Ar(e,t)){e=n.containerInfo;var i=Ce(e);Rr(i,t,!1,!1),n.pendingChildren=i,Pr(t),Pe(e,i)}},br=function(e,t,n,i,r){var a=e.stateNode,o=e.memoizedProps;if((e=Ar(e,t))&&o===i)t.stateNode=a;else{var s=t.stateNode,l=hi(li.current),u=null;o!==i&&(u=H(s,n,o,i,r,l)),e&&null===u?t.stateNode=a:(a=Ee(a,u,n,o,i,t,e,s),B(a,n,i,r,l)&&Pr(t),t.stateNode=a,e?Pr(t):_r(a,t,!1,!1))}},wr=function(e,t,n,i){n!==i?(e=hi(ci.current),n=hi(li.current),t.stateNode=G(i,e,n,t),Pr(t)):t.stateNode=e.stateNode}}else xr=function(){},br=function(){},wr=function(){};function Lr(e,t){if(!Vn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ir(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Or(e,t,n){var i=t.pendingProps;switch(Hn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ir(t),null;case 1:case 17:return pt(t.type)&&mt(),Ir(t),null;case 3:return i=t.stateNode,di(),st(ht),st(ct),_i(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Kn(t)?Pr(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Xn&&(ko(Xn),Xn=null))),xr(e,t),Ir(t),null;case 5:mi(t),n=hi(ci.current);var r=t.type;if(null!==e&&null!=t.stateNode)br(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Ir(t),null}if(e=hi(li.current),Kn(t)){if(!J)throw Error(o(175));e=Ge(t.stateNode,t.type,t.memoizedProps,n,e,t,!Wn),t.updateQueue=e,null!==e&&Pr(t)}else{var a=U(r,i,n,e,t);_r(a,t,!1,!1),t.stateNode=a,B(a,r,i,n,e)&&Pr(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ir(t),null;case 6:if(e&&null!=t.stateNode)wr(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(e=hi(ci.current),n=hi(li.current),Kn(t)){if(!J)throw Error(o(176));if(e=t.stateNode,i=t.memoizedProps,(n=Ve(e,i,t,!Wn))&&null!==(r=jn))switch(a=0!==(1&r.mode),r.tag){case 3:Ke(r.stateNode.containerInfo,e,i,a);break;case 5:$e(r.type,r.memoizedProps,r.stateNode,e,i,a)}n&&Pr(t)}else t.stateNode=G(i,e,n,t)}return Ir(t),null;case 13:if(st(vi),i=t.memoizedState,Vn&&null!==Gn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Gn;e;)e=Fe(e);return $n(),t.flags|=98560,t}if(null!==i&&null!==i.dehydrated){if(i=Kn(t),null===e){if(!i)throw Error(o(318));if(!J)throw Error(o(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(o(317));We(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Ir(t),null}return null!==Xn&&(ko(Xn),Xn=null),0!==(128&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?Kn(t):n=null!==e.memoizedState,i&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&vi.current)?0===$a&&($a=3):No())),null!==t.updateQueue&&(t.flags|=4),Ir(t),null);case 4:return di(),xr(e,t),null===e&&K(t.stateNode.containerInfo),Ir(t),null;case 10:return ln(t.type._context),Ir(t),null;case 19:if(st(vi),null===(r=t.memoizedState))return Ir(t),null;if(i=0!==(128&t.flags),null===(a=r.rendering))if(i)Lr(r,!1);else{if(0!==$a||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=gi(e))){for(t.flags|=128,Lr(r,!1),null!==(e=a.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,i=t.child;null!==i;)r=e,(n=i).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,r=a.dependencies,n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),i=i.sibling;return lt(vi,1&vi.current|2),t.child}e=e.sibling}null!==r.tail&&Ut()>so&&(t.flags|=128,i=!0,Lr(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=gi(a))){if(t.flags|=128,i=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Lr(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!Vn)return Ir(t),null}else 2*Ut()-r.renderingStartTime>so&&1073741824!==n&&(t.flags|=128,i=!0,Lr(r,!1),t.lanes=4194304);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=r.last)?e.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=Ut(),t.sibling=null,e=vi.current,lt(vi,i?1&e|2:1&e),t):(Ir(t),null);case 22:case 23:return Lo(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Qa)&&(Ir(t),q&&6&t.subtreeFlags&&(t.flags|=8192)):Ir(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}var Dr=s.ReactCurrentOwner,Nr=!1;function zr(e,t,n,i){t.child=null===e?oi(t,null,n,i):ai(t,e.child,n,i)}function Ur(e,t,n,i,r){n=n.render;var a=t.ref;return cn(t,r),i=Li(e,t,n,i,a,r),n=Ii(),null===e||Nr?(Vn&&n&&Bn(t),t.flags|=1,zr(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ra(e,t,r))}function Fr(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||$o(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ts(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Br(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:Kt)(o,i)&&e.ref===t.ref)return ra(e,t,r)}return t.flags|=1,(e=es(a,i)).ref=t.ref,e.return=t,t.child=e}function Br(e,t,n,i,r){if(null!==e&&Kt(e.memoizedProps,i)&&e.ref===t.ref){if(Nr=!1,0===(e.lanes&r))return t.lanes=e.lanes,ra(e,t,r);0!==(131072&e.flags)&&(Nr=!0)}return Gr(e,t,n,i,r)}function Hr(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},lt(Ka,Qa),Qa|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt(Ka,Qa),Qa|=e,null;t.memoizedState={baseLanes:0,cachePool:null},i=null!==a?a.baseLanes:n,lt(Ka,Qa),Qa|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,lt(Ka,Qa),Qa|=i;return zr(e,t,r,n),t.child}function jr(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Gr(e,t,n,i,r){var a=pt(n)?ft:ct.current;return a=dt(t,a),cn(t,r),n=Li(e,t,n,i,a,r),i=Ii(),null===e||Nr?(Vn&&i&&Bn(t),t.flags|=1,zr(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ra(e,t,r))}function Vr(e,t,n,i,r){if(pt(n)){var a=!0;yt(t)}else a=!1;if(cn(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),En(t,n,i),kn(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=hn(u):u=dt(t,u=pt(n)?ft:ct.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==u)&&Cn(t,o,i,u),dn=!1;var f=t.memoizedState;o.state=f,xn(t,i,o,r),l=t.memoizedState,s!==i||f!==l||ht.current||dn?("function"===typeof c&&(Sn(t,n,c,i),l=t.memoizedState),(s=dn||Tn(t,n,s,i,f,l,u))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=u,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,mn(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:en(t.type,s),o.props=u,h=t.pendingProps,f=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=hn(l):l=dt(t,l=pt(n)?ft:ct.current);var d=n.getDerivedStateFromProps;(c="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||f!==l)&&Cn(t,o,i,l),dn=!1,f=t.memoizedState,o.state=f,xn(t,i,o,r);var p=t.memoizedState;s!==h||f!==p||ht.current||dn?("function"===typeof d&&(Sn(t,n,d,i),p=t.memoizedState),(u=dn||Tn(t,n,u,i,f,p,l)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=l,i=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),i=!1)}return Wr(e,t,n,i,a,r)}function Wr(e,t,n,i,r,a){jr(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&_t(t,n,!1),ra(e,t,a);i=t.stateNode,Dr.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=ai(t,e.child,null,a),t.child=ai(t,null,s,a)):zr(e,t,s,a),t.memoizedState=i.state,r&&_t(t,n,!0),t.child}function Xr(e){var t=e.stateNode;t.pendingContext?vt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&vt(0,t.context,!1),fi(e,t.containerInfo)}function Zr(e,t,n,i,r){return $n(),ei(r),t.flags|=256,zr(e,t,n,i),t.child}var qr={dehydrated:null,treeContext:null,retryLane:0};function Yr(e){return{baseLanes:e,cachePool:null}}function Jr(e,t,n){var i,r=t.pendingProps,a=vi.current,s=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),lt(vi,1&a),null===e)return Jn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:ze(e)?t.lanes=8:t.lanes=1073741824,null):(a=r.children,e=r.fallback,s?(r=t.mode,s=t.child,a={mode:"hidden",children:a},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=a):s=is(a,r,0,null),e=ns(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Yr(n),t.memoizedState=qr,e):Qr(t,a));if(null!==(a=e.memoizedState)){if(null!==(i=a.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,ea(e,t,n,Error(o(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,a=t.mode,r=is({mode:"visible",children:r.children},a,0,null),(s=ns(s,a,n,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&ai(t,e.child,null,n),t.child.memoizedState=Yr(n),t.memoizedState=qr,s);if(0===(1&t.mode))t=ea(e,t,n,null);else if(ze(i))t=ea(e,t,n,Error(o(419)));else if(r=0!==(n&e.childLanes),Nr||r){if(null!==(r=qa)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(r=0!==(s&(r.suspendedLanes|n))?0:s)&&r!==a.retryLane&&(a.retryLane=r,So(e,r,-1))}No(),t=ea(e,t,n,Error(o(421)))}else Ne(i)?(t.flags|=128,t.child=e.child,t=qo.bind(null,e),Ue(i,t),t=null):(n=a.treeContext,J&&(Gn=je(i),jn=t,Vn=!0,Xn=null,Wn=!1,null!==n&&(In[On++]=Nn,In[On++]=zn,In[On++]=Dn,Nn=n.id,zn=n.overflow,Dn=t)),(t=Qr(t,t.pendingProps.children)).flags|=4096);return t}return s?(r=$r(e,t,r.children,r.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?Yr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=qr,r):(n=Kr(e,t,r.children,n),t.memoizedState=null,n)}return s?(r=$r(e,t,r.children,r.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?Yr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=qr,r):(n=Kr(e,t,r.children,n),t.memoizedState=null,n)}function Qr(e,t){return(t=is({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Kr(e,t,n,i){var r=e.child;return e=r.sibling,n=es(r,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n}function $r(e,t,n,i,r){var a=t.mode,o=(e=e.child).sibling,s={mode:"hidden",children:n};return 0===(1&a)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=s,t.deletions=null):(n=es(e,s)).subtreeFlags=14680064&e.subtreeFlags,null!==o?i=es(o,i):(i=ns(i,a,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function ea(e,t,n,i){return null!==i&&ei(i),ai(t,e.child,null,n),(e=Qr(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ta(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),un(e.return,t,n)}function na(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function ia(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(zr(e,t,i.children,n),0!==(2&(i=vi.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ta(e,n,t);else if(19===e.tag)ta(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(lt(vi,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===gi(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),na(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===gi(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}na(t,!0,n,null,a);break;case"together":na(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ra(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),to|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=es(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=es(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function aa(e,t){switch(Hn(t),t.tag){case 1:return pt(t.type)&&mt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return di(),st(ht),st(ct),_i(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return mi(t),null;case 13:if(st(vi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return st(vi),null;case 4:return di(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Lo(),null;default:return null}}var oa=!1,sa=!1,la="function"===typeof WeakSet?WeakSet:Set,ua=null;function ca(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Wo(e,t,i)}else n.current=null}function ha(e,t,n){try{n()}catch(i){Wo(e,t,i)}}var fa=!1;function da(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&ha(t,n,a)}r=r.next}while(r!==i)}}function pa(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ma(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=I(n);else e=n;"function"===typeof t?t(e):t.current=e}}function va(e,t,n){if(Vt&&"function"===typeof Vt.onCommitFiberUnmount)try{Vt.onCommitFiberUnmount(Gt,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var r=i,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&ha(t,n,a),i=i.next}while(i!==e)}break;case 1:if(ca(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){Wo(t,n,o)}break;case 5:ca(t,n);break;case 4:q?Ma(e,t,n):Y&&Y&&(t=t.stateNode.containerInfo,n=Ce(t),Ae(t,n))}}function ga(e,t,n){for(var i=t;;)if(va(e,i,n),null===i.child||q&&4===i.tag){if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function ya(e){var t=e.alternate;null!==t&&(e.alternate=null,ya(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function _a(e){return 5===e.tag||3===e.tag||4===e.tag}function xa(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||_a(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ba(e){if(q){e:{for(var t=e.return;null!==t;){if(_a(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(xe(t),n.flags&=-33),Sa(e,n=xa(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,wa(e,n=xa(e),t);break;default:throw Error(o(161))}}}function wa(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?ge(n,e,t):fe(n,e);else if(4!==i&&null!==(e=e.child))for(wa(e,t,n),e=e.sibling;null!==e;)wa(e,t,n),e=e.sibling}function Sa(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?ve(n,e,t):he(n,e);else if(4!==i&&null!==(e=e.child))for(Sa(e,t,n),e=e.sibling;null!==e;)Sa(e,t,n),e=e.sibling}function Ma(e,t,n){for(var i,r,a=t,s=!1;;){if(!s){s=a.return;e:for(;;){if(null===s)throw Error(o(160));switch(i=s.stateNode,s.tag){case 5:r=!1;break e;case 3:case 4:i=i.containerInfo,r=!0;break e}s=s.return}s=!0}if(5===a.tag||6===a.tag)ga(e,a,n),r?_e(i,a.stateNode):ye(i,a.stateNode);else if(18===a.tag)r?Je(i,a.stateNode):Ye(i,a.stateNode);else if(4===a.tag){if(null!==a.child){i=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(va(e,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function Ta(e,t){if(q){switch(t.tag){case 0:case 11:case 14:case 15:return da(3,t,t.return),pa(3,t),void da(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var r=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&me(n,a,r,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(o(162));return n=t.memoizedProps,void de(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(J&&null!==e&&e.memoizedState.isDehydrated&&Ze(t.stateNode.containerInfo));case 13:case 19:return void Ea(t)}throw Error(o(163))}switch(t.tag){case 0:case 11:case 14:case 15:return da(3,t,t.return),pa(3,t),void da(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ea(t);case 3:J&&null!==e&&e.memoizedState.isDehydrated&&Ze(t.stateNode.containerInfo)}e:if(Y){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Ae(t.containerInfo,t.pendingChildren);break e}throw Error(o(163))}}function Ea(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new la),t.forEach((function(t){var i=Yo.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function Ca(e,t,n){ua=e,ka(e,t,n)}function ka(e,t,n){for(var i=0!==(1&e.mode);null!==ua;){var r=ua,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||oa;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||sa;s=oa;var u=sa;if(oa=o,(sa=l)&&!u)for(ua=r;null!==ua;)l=(o=ua).child,22===o.tag&&null!==o.memoizedState?Ra(r):null!==l?(l.return=o,ua=l):Ra(r);for(;null!==a;)ua=a,ka(a,t,n),a=a.sibling;ua=r,oa=s,sa=u}Pa(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,ua=a):Pa(e)}}function Pa(e){for(;null!==ua;){var t=ua;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:sa||pa(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!sa)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&bn(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=I(t.child.stateNode);break;case 1:n=t.child.stateNode}bn(t,s,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&pe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(J&&null===t.memoizedState){var u=t.alternate;if(null!==u){var c=u.memoizedState;if(null!==c){var h=c.dehydrated;null!==h&&qe(h)}}}break;default:throw Error(o(163))}sa||512&t.flags&&ma(t)}catch(f){Wo(t,t.return,f)}}if(t===e){ua=null;break}if(null!==(n=t.sibling)){n.return=t.return,ua=n;break}ua=t.return}}function Aa(e){for(;null!==ua;){var t=ua;if(t===e){ua=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ua=n;break}ua=t.return}}function Ra(e){for(;null!==ua;){var t=ua;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{pa(4,t)}catch(l){Wo(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Wo(t,r,l)}}var a=t.return;try{ma(t)}catch(l){Wo(t,a,l)}break;case 5:var o=t.return;try{ma(t)}catch(l){Wo(t,o,l)}}}catch(l){Wo(t,t.return,l)}if(t===e){ua=null;break}var s=t.sibling;if(null!==s){s.return=t.return,ua=s;break}ua=t.return}}var La=0,Ia=1,Oa=2,Da=3,Na=4;if("function"===typeof Symbol&&Symbol.for){var za=Symbol.for;La=za("selector.component"),Ia=za("selector.has_pseudo_class"),Oa=za("selector.role"),Da=za("selector.test_id"),Na=za("selector.text")}function Ua(e){var t=Q(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(o(364));return t}if(null===(e=re(e)))throw Error(o(362));return e.stateNode.current}function Fa(e,t){switch(t.$$typeof){case La:if(e.type===t.value)return!0;break;case Ia:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var i=e[n++],r=e[n++],a=t[r];if(5!==i.tag||!se(i)){for(;null!=a&&Fa(i,a);)a=t[++r];if(r===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,r),i=i.sibling}}t=!1}return t;case Oa:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case Na:if((5===e.tag||6===e.tag)&&(null!==(e=oe(e))&&0<=e.indexOf(t.value)))return!0;break;case Da:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Ba(e){switch(e.$$typeof){case La:return"<"+(S(e.value)||"Unknown")+">";case Ia:return":has("+(Ba(e)||"")+")";case Oa:return'[role="'+e.value+'"]';case Na:return'"'+e.value+'"';case Da:return'[data-testname="'+e.value+'"]';default:throw Error(o(365))}}function Ha(e,t){var n=[];e=[e,0];for(var i=0;i<e.length;){var r=e[i++],a=e[i++],o=t[a];if(5!==r.tag||!se(r)){for(;null!=o&&Fa(r,o);)o=t[++a];if(a===t.length)n.push(r);else for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}}return n}function ja(e,t){if(!ie)throw Error(o(363));e=Ha(e=Ua(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++];if(5===i.tag)se(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var Ga=Math.ceil,Va=s.ReactCurrentDispatcher,Wa=s.ReactCurrentOwner,Xa=s.ReactCurrentBatchConfig,Za=0,qa=null,Ya=null,Ja=0,Qa=0,Ka=ot(0),$a=0,eo=null,to=0,no=0,io=0,ro=null,ao=null,oo=0,so=1/0;function lo(){so=Ut()+500}var uo,co=!1,ho=null,fo=null,po=!1,mo=null,vo=0,go=0,yo=null,_o=-1,xo=0;function bo(){return 0!==(6&Za)?Ut():-1!==_o?_o:_o=Ut()}function wo(e){return 0===(1&e.mode)?1:0!==(2&Za)&&0!==Ja?Ja&-Ja:null!==Qt.transition?(0===xo&&(e=St,0===(4194240&(St<<=1))&&(St=64),xo=e),xo):0!==(e=Lt)?e:$()}function So(e,t,n){if(50<go)throw go=0,yo=null,Error(o(185));var i=Mo(e,t);return null===i?null:(At(i,t,n),0!==(2&Za)&&i===qa||(i===qa&&(0===(2&Za)&&(no|=t),4===$a&&Po(i,Ja)),To(i,n),1===t&&0===Za&&0===(1&e.mode)&&(lo(),Zt&&Jt())),i)}function Mo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function To(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-xt(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=Ct(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=Et(e,e===qa?Ja:0);if(0===i)null!==n&&Dt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Dt(n),1===t)0===e.tag?function(e){Zt=!0,Yt(e)}(Ao.bind(null,e)):Yt(Ao.bind(null,e)),te?ne((function(){0===Za&&Jt()})):Ot(Ft,Jt),n=null;else{switch(It(i)){case 1:n=Ft;break;case 4:n=Bt;break;case 16:default:n=Ht;break;case 536870912:n=jt}n=Jo(n,Eo.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Eo(e,t){if(_o=-1,xo=0,0!==(6&Za))throw Error(o(327));var n=e.callbackNode;if(Go()&&e.callbackNode!==n)return null;var i=Et(e,e===qa?Ja:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=zo(e,i);else{t=i;var r=Za;Za|=2;var a=Do();for(qa===e&&Ja===t||(lo(),Io(e,t));;)try{Fo();break}catch(l){Oo(e,l)}on(),Va.current=a,Za=r,null!==Ya?t=0:(qa=null,Ja=0,t=$a)}if(0!==t){if(2===t&&(0!==(r=kt(e))&&(i=r,t=Co(e,r))),1===t)throw n=eo,Io(e,0),Po(e,i),To(e,Ut()),n;if(6===t)Po(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!Wt(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=zo(e,i))&&(0!==(a=kt(e))&&(i=a,t=Co(e,a))),1===t))throw n=eo,Io(e,0),Po(e,i),To(e,Ut()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:jo(e,ao);break;case 3:if(Po(e,i),(130023424&i)===i&&10<(t=oo+500-Ut())){if(0!==Et(e,0))break;if(((r=e.suspendedLanes)&i)!==i){bo(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=V(jo.bind(null,e,ao),t);break}jo(e,ao);break;case 4:if(Po(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-xt(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Ut()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ga(i/1960))-i)){e.timeoutHandle=V(jo.bind(null,e,ao),i);break}jo(e,ao);break;default:throw Error(o(329))}}}return To(e,Ut()),e.callbackNode===n?Eo.bind(null,e):null}function Co(e,t){var n=ro;return e.current.memoizedState.isDehydrated&&(Io(e,t).flags|=256),2!==(e=zo(e,t))&&(t=ao,ao=n,null!==t&&ko(t)),e}function ko(e){null===ao?ao=e:ao.push.apply(ao,e)}function Po(e,t){for(t&=~io,t&=~no,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xt(t),i=1<<n;e[n]=-1,t&=~i}}function Ao(e){if(0!==(6&Za))throw Error(o(327));Go();var t=Et(e,0);if(0===(1&t))return To(e,Ut()),null;var n=zo(e,t);if(0!==e.tag&&2===n){var i=kt(e);0!==i&&(t=i,n=Co(e,i))}if(1===n)throw n=eo,Io(e,0),Po(e,t),To(e,Ut()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,jo(e,ao),To(e,Ut()),null}function Ro(e){null!==mo&&0===mo.tag&&0===(6&Za)&&Go();var t=Za;Za|=1;var n=Xa.transition,i=Lt;try{if(Xa.transition=null,Lt=1,e)return e()}finally{Lt=i,Xa.transition=n,0===(6&(Za=t))&&Jt()}}function Lo(){Qa=Ka.current,st(Ka)}function Io(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==X&&(e.timeoutHandle=X,W(n)),null!==Ya)for(n=Ya.return;null!==n;){var i=n;switch(Hn(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&mt();break;case 3:di(),st(ht),st(ct),_i();break;case 5:mi(i);break;case 4:di();break;case 13:case 19:st(vi);break;case 10:ln(i.type._context);break;case 22:case 23:Lo()}n=n.return}if(qa=e,Ya=e=es(e.current,null),Ja=Qa=t,$a=0,eo=null,io=no=to=0,ao=ro=null,null!==fn){for(t=0;t<fn.length;t++)if(null!==(i=(n=fn[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}fn=null}return e}function Oo(e,t){for(;;){var n=Ya;try{if(on(),xi.current=dr,Ei){for(var i=Si.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Ei=!1}if(wi=0,Ti=Mi=Si=null,Ci=!1,ki=0,Wa.current=null,null===n||null===n.return){$a=1,eo=t,Ya=null;break}e:{var a=e,s=n.return,l=n,u=t;if(t=Ja,l.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var c=u,h=l,f=h.tag;if(0===(1&h.mode)&&(0===f||11===f||15===f)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Cr(s);if(null!==p){p.flags&=-257,kr(p,s,l,0,t),1&p.mode&&Er(a,c,t),u=c;var m=(t=p).updateQueue;if(null===m){var v=new Set;v.add(u),t.updateQueue=v}else m.add(u);break e}if(0===(1&t)){Er(a,c,t),No();break e}u=Error(o(426))}else if(Vn&&1&l.mode){var g=Cr(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),kr(g,s,l,0,t),ei(u);break e}}a=u,4!==$a&&($a=2),null===ro?ro=[a]:ro.push(a),u=gr(u,l),l=s;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,_n(l,Mr(0,u,t));break e;case 1:a=u;var y=l.type,_=l.stateNode;if(0===(128&l.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===fo||!fo.has(_)))){l.flags|=65536,t&=-t,l.lanes|=t,_n(l,Tr(l,a,t));break e}}l=l.return}while(null!==l)}Ho(n)}catch(x){t=x,Ya===n&&null!==n&&(Ya=n=n.return);continue}break}}function Do(){var e=Va.current;return Va.current=dr,null===e?dr:e}function No(){0!==$a&&3!==$a&&2!==$a||($a=4),null===qa||0===(268435455&to)&&0===(268435455&no)||Po(qa,Ja)}function zo(e,t){var n=Za;Za|=2;var i=Do();for(qa===e&&Ja===t||Io(e,t);;)try{Uo();break}catch(r){Oo(e,r)}if(on(),Za=n,Va.current=i,null!==Ya)throw Error(o(261));return qa=null,Ja=0,$a}function Uo(){for(;null!==Ya;)Bo(Ya)}function Fo(){for(;null!==Ya&&!Nt();)Bo(Ya)}function Bo(e){var t=uo(e.alternate,e,Qa);e.memoizedProps=e.pendingProps,null===t?Ho(e):Ya=t,Wa.current=null}function Ho(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Or(n,t,Qa)))return void(Ya=n)}else{if(null!==(n=aa(n,t)))return n.flags&=32767,void(Ya=n);if(null===e)return $a=6,void(Ya=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ya=t);Ya=t=e}while(null!==t);0===$a&&($a=5)}function jo(e,t){var n=Lt,i=Xa.transition;try{Xa.transition=null,Lt=1,function(e,t,n){do{Go()}while(null!==mo);if(0!==(6&Za))throw Error(o(327));var i=e.finishedWork,r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-xt(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,a),e===qa&&(Ya=qa=null,Ja=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||po||(po=!0,Jo(Ht,(function(){return Go(),null}))),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=Xa.transition,Xa.transition=null;var s=Lt;Lt=1;var l=Za;Za|=4,Wa.current=null,function(e,t){for(N(e.containerInfo),ua=t;null!==ua;)if(t=(e=ua).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,ua=t;else for(;null!==ua;){e=ua;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var i=n.memoizedProps,r=n.memoizedState,a=e.stateNode,s=a.getSnapshotBeforeUpdate(e.elementType===e.type?i:en(e.type,i),r);a.__reactInternalSnapshotBeforeUpdate=s}break;case 3:q&&Te(e.stateNode.containerInfo);break;default:throw Error(o(163))}}catch(l){Wo(e,e.return,l)}if(null!==(t=e.sibling)){t.return=e.return,ua=t;break}ua=e.return}n=fa,fa=!1}(e,i),function(e,t){for(ua=t;null!==ua;){var n=(t=ua).deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e;q?Ma(a,r,t):ga(a,r,t);var o=r.alternate;null!==o&&(o.return=null),r.return=null}catch(b){Wo(r,t,b)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,ua=n;else for(;null!==ua;){t=ua;try{var s=t.flags;if(32&s&&q&&xe(t.stateNode),512&s){var l=t.alternate;if(null!==l){var u=l.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}if(8192&s)switch(t.tag){case 13:if(null!==t.memoizedState){var c=t.alternate;null!==c&&null!==c.memoizedState||(oo=Ut())}break;case 22:var h=null!==t.memoizedState,f=t.alternate,d=null!==f&&null!==f.memoizedState;if(n=t,q)e:if(i=n,r=h,a=null,q)for(var p=i;;){if(5===p.tag){if(null===a){a=p;var m=p.stateNode;r?be(m):Se(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===a){var v=p.stateNode;r?we(v):Me(v,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===i)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===i)break;for(;null===p.sibling;){if(null===p.return||p.return===i)break e;a===p&&(a=null),p=p.return}a===p&&(a=null),p.sibling.return=p.return,p=p.sibling}if(h&&!d&&0!==(1&n.mode)){ua=n;for(var g=n.child;null!==g;){for(n=ua=g;null!==ua;){var y=(i=ua).child;switch(i.tag){case 0:case 11:case 14:case 15:da(4,i,i.return);break;case 1:ca(i,i.return);var _=i.stateNode;if("function"===typeof _.componentWillUnmount){var x=i.return;try{_.props=i.memoizedProps,_.state=i.memoizedState,_.componentWillUnmount()}catch(b){Wo(i,x,b)}}break;case 5:ca(i,i.return);break;case 22:if(null!==i.memoizedState){Aa(n);continue}}null!==y?(y.return=i,ua=y):Aa(n)}g=g.sibling}}}switch(4102&s){case 2:ba(t),t.flags&=-3;break;case 6:ba(t),t.flags&=-3,Ta(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Ta(t.alternate,t);break;case 4:Ta(t.alternate,t)}}catch(b){Wo(t,t.return,b)}if(null!==(n=t.sibling)){n.return=t.return,ua=n;break}ua=t.return}}}(e,i),z(e.containerInfo),e.current=i,Ca(i,e,r),zt(),Za=l,Lt=s,Xa.transition=a}else e.current=i;if(po&&(po=!1,mo=e,vo=r),a=e.pendingLanes,0===a&&(fo=null),function(e){if(Vt&&"function"===typeof Vt.onCommitFiberRoot)try{Vt.onCommitFiberRoot(Gt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),To(e,Ut()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)n(t[i]);if(co)throw co=!1,e=ho,ho=null,e;0!==(1&vo)&&0!==e.tag&&Go(),a=e.pendingLanes,0!==(1&a)?e===yo?go++:(go=0,yo=e):go=0,Jt()}(e,t,n)}finally{Xa.transition=i,Lt=n}return null}function Go(){if(null!==mo){var e=It(vo),t=Xa.transition,n=Lt;try{if(Xa.transition=null,Lt=16>e?16:e,null===mo)var i=!1;else{if(e=mo,mo=null,vo=0,0!==(6&Za))throw Error(o(331));var r=Za;for(Za|=4,ua=e.current;null!==ua;){var a=ua,s=a.child;if(0!==(16&ua.flags)){var l=a.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(ua=c;null!==ua;){var h=ua;switch(h.tag){case 0:case 11:case 15:da(8,h,a)}var f=h.child;if(null!==f)f.return=h,ua=f;else for(;null!==ua;){var d=(h=ua).sibling,p=h.return;if(ya(h),h===c){ua=null;break}if(null!==d){d.return=p,ua=d;break}ua=p}}}var m=a.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}ua=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,ua=s;else e:for(;null!==ua;){if(0!==(2048&(a=ua).flags))switch(a.tag){case 0:case 11:case 15:da(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,ua=y;break e}ua=a.return}}var _=e.current;for(ua=_;null!==ua;){var x=(s=ua).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,ua=x;else e:for(s=_;null!==ua;){if(0!==(2048&(l=ua).flags))try{switch(l.tag){case 0:case 11:case 15:pa(9,l)}}catch(w){Wo(l,l.return,w)}if(l===s){ua=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,ua=b;break e}ua=l.return}}if(Za=r,Jt(),Vt&&"function"===typeof Vt.onPostCommitFiberRoot)try{Vt.onPostCommitFiberRoot(Gt,e)}catch(w){}i=!0}return i}finally{Lt=n,Xa.transition=t}}return!1}function Vo(e,t,n){gn(e,t=Mr(0,t=gr(n,t),1)),t=bo(),null!==(e=Mo(e,1))&&(At(e,1,t),To(e,t))}function Wo(e,t,n){if(3===e.tag)Vo(e,e,n);else for(;null!==t;){if(3===t.tag){Vo(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===fo||!fo.has(i))){gn(t,e=Tr(t,e=gr(n,e),1)),e=bo(),null!==(t=Mo(t,1))&&(At(t,1,e),To(t,e));break}}t=t.return}}function Xo(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=bo(),e.pingedLanes|=e.suspendedLanes&n,qa===e&&(Ja&n)===n&&(4===$a||3===$a&&(130023424&Ja)===Ja&&500>Ut()-oo?Io(e,0):io|=n),To(e,t)}function Zo(e,t){0===t&&(0===(1&e.mode)?t=1:(t=Mt,0===(130023424&(Mt<<=1))&&(Mt=4194304)));var n=bo();null!==(e=Mo(e,t))&&(At(e,t,n),To(e,n))}function qo(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Zo(e,n)}function Yo(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Zo(e,n)}function Jo(e,t){return Ot(e,t)}function Qo(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ko(e,t,n,i){return new Qo(e,t,n,i)}function $o(e){return!(!(e=e.prototype)||!e.isReactComponent)}function es(e,t){var n=e.alternate;return null===n?((n=Ko(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ts(e,t,n,i,r,a){var s=2;if(i=e,"function"===typeof e)$o(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case c:return ns(n.children,r,a,t);case h:s=8,r|=8;break;case f:return(e=Ko(12,n,t,2|r)).elementType=f,e.lanes=a,e;case v:return(e=Ko(13,n,t,r)).elementType=v,e.lanes=a,e;case g:return(e=Ko(19,n,t,r)).elementType=g,e.lanes=a,e;case x:return is(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case d:s=10;break e;case p:s=9;break e;case m:s=11;break e;case y:s=14;break e;case _:s=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Ko(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function ns(e,t,n,i){return(e=Ko(7,e,i,t)).lanes=n,e}function is(e,t,n,i){return(e=Ko(22,e,i,t)).elementType=x,e.lanes=n,e.stateNode={},e}function rs(e,t,n){return(e=Ko(6,e,null,t)).lanes=n,e}function as(e,t,n){return(t=Ko(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function os(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=X,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pt(0),this.expirationTimes=Pt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pt(0),this.identifierPrefix=i,this.onRecoverableError=r,J&&(this.mutableSourceEagerHydrationData=null)}function ss(e,t,n,i,r,a,o,s,l){return e=new os(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Ko(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null},pn(a),e}function ls(e){if(!e)return ut;e:{if(T(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(pt(n))return gt(e,n,t)}return t}function us(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return null===(e=k(t))?null:e.stateNode}function cs(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function hs(e,t){cs(e,t),(e=e.alternate)&&cs(e,t)}function fs(e){return null===(e=k(e))?null:e.stateNode}function ds(){return null}return uo=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)Nr=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Nr=!1,function(e,t,n){switch(t.tag){case 3:Xr(t),$n();break;case 5:pi(t);break;case 1:pt(t.type)&&yt(t);break;case 4:fi(t,t.stateNode.containerInfo);break;case 10:sn(0,t.type._context,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(lt(vi,1&vi.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Jr(e,t,n):(lt(vi,1&vi.current),null!==(e=ra(e,t,n))?e.sibling:null);lt(vi,1&vi.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return ia(e,t,n);t.flags|=128}var r=t.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),lt(vi,vi.current),i)break;return null;case 22:case 23:return t.lanes=0,Hr(e,t,n)}return ra(e,t,n)}(e,t,n);Nr=0!==(131072&e.flags)}else Nr=!1,Vn&&0!==(1048576&t.flags)&&Fn(t,Ln,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var r=dt(t,ct.current);cn(t,n),r=Li(null,t,i,e,r,n);var a=Ii();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(i)?(a=!0,yt(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,pn(t),r.updater=Mn,t.stateNode=r,r._reactInternals=t,kn(t,i,e,n),t=Wr(null,t,i,!0,a,n)):(t.tag=0,Vn&&a&&Bn(t),zr(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return $o(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===m)return 11;if(e===y)return 14}return 2}(i),e=en(i,e),r){case 0:t=Gr(null,t,i,e,n);break e;case 1:t=Vr(null,t,i,e,n);break e;case 11:t=Ur(null,t,i,e,n);break e;case 14:t=Fr(null,t,i,en(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Gr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 1:return i=t.type,r=t.pendingProps,Vr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 3:e:{if(Xr(t),null===e)throw Error(o(387));i=t.pendingProps,r=(a=t.memoizedState).element,mn(e,t),xn(t,i,null,n);var s=t.memoizedState;if(i=s.element,J&&a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Zr(e,t,i,n,r=Error(o(423)));break e}if(i!==r){t=Zr(e,t,i,n,r=Error(o(424)));break e}for(J&&(Gn=He(t.stateNode.containerInfo),jn=t,Vn=!0,Xn=null,Wn=!1),n=oi(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),i===r){t=ra(e,t,n);break e}zr(e,t,i,n)}t=t.child}return t;case 5:return pi(t),null===e&&Jn(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,j(i,r)?s=null:null!==a&&j(i,a)&&(t.flags|=32),jr(e,t),zr(e,t,s,n),t.child;case 6:return null===e&&Jn(t),null;case 13:return Jr(e,t,n);case 4:return fi(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ai(t,null,i,n):zr(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ur(e,t,i,r=t.elementType===i?r:en(i,r),n);case 7:return zr(e,t,t.pendingProps,n),t.child;case 8:case 12:return zr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,sn(0,i,s=r.value),null!==a)if(Wt(a.value,s)){if(a.children===r.children&&!ht.current){t=ra(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var u=l.firstContext;null!==u;){if(u.context===i){if(1===a.tag){(u=vn(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}a.lanes|=n,null!==(u=a.alternate)&&(u.lanes|=n),un(a.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),un(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}zr(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,cn(t,n),i=i(r=hn(r)),t.flags|=1,zr(e,t,i,n),t.child;case 14:return r=en(i=t.type,t.pendingProps),Fr(e,t,i,r=en(i.type,r),n);case 15:return Br(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:en(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(i)?(e=!0,yt(t)):e=!1,cn(t,n),En(t,i,r),kn(t,i,r,n),Wr(null,t,i,!0,e,n);case 19:return ia(e,t,n);case 22:return Hr(e,t,n)}throw Error(o(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(So(e,134217728,bo()),hs(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=bo(),n=wo(e);So(e,n,t),hs(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Tt(t.pendingLanes);0!==n&&(Rt(t,1|n),To(t,Ut()),0===(6&Za)&&(lo(),Jt()))}break;case 13:var i=bo();Ro((function(){return So(e,1,i)})),hs(e,1)}},t.batchedUpdates=function(e,t){var n=Za;Za|=1;try{return e(t)}finally{0===(Za=n)&&(lo(),Zt&&Jt())}},t.createComponentSelector=function(e){return{$$typeof:La,value:e}},t.createContainer=function(e,t,n,i,r,a,o){return ss(e,t,!1,null,0,i,0,a,o)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Ia,value:e}},t.createHydrationContainer=function(e,t,n,i,r,a,o,s,l){return(e=ss(n,i,!0,e,0,a,0,s,l)).context=ls(null),n=e.current,(a=vn(i=bo(),r=wo(n))).callback=void 0!==t&&null!==t?t:null,gn(n,a),e.current.lanes=r,At(e,r,i),To(e,i),e},t.createPortal=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:u,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Oa,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Da,value:e}},t.createTextSelector=function(e){return{$$typeof:Na,value:e}},t.deferredUpdates=function(e){var t=Lt,n=Xa.transition;try{return Xa.transition=null,Lt=16,e()}finally{Lt=t,Xa.transition=n}},t.discreteUpdates=function(e,t,n,i,r){var a=Lt,o=Xa.transition;try{return Xa.transition=null,Lt=1,e(t,n,i,r)}finally{Lt=a,Xa.transition=o,0===Za&&lo()}},t.findAllNodes=ja,t.findBoundingRects=function(e,t){if(!ie)throw Error(o(363));t=ja(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ae(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,r=i+n.width,a=n.y,s=a+n.height,l=t-1;0<=l;l--)if(t!==l){var u=e[l],c=u.x,h=c+u.width,f=u.y,d=f+u.height;if(i>=c&&a>=f&&r<=h&&s<=d){e.splice(t,1);break}if(!(i!==c||n.width!==u.width||d<a||f>s)){f>a&&(u.height+=f-a,u.y=a),d<s&&(u.height=s-f),e.splice(t,1);break}if(!(a!==f||n.height!==u.height||h<i||c>r)){c>i&&(u.width+=c-i,u.x=i),h<r&&(u.width=r-c),e.splice(t,1);break}}return e},t.findHostInstance=us,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=C(e))?A(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return us(e)},t.flushControlled=function(e){var t=Za;Za|=1;var n=Xa.transition,i=Lt;try{Xa.transition=null,Lt=1,e()}finally{Lt=i,Xa.transition=n,0===(Za=t)&&(lo(),Jt())}},t.flushPassiveEffects=Go,t.flushSync=Ro,t.focusWithin=function(e,t){if(!ie)throw Error(o(363));for(t=Ha(e=Ua(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!se(n)){if(5===n.tag&&ue(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Lt},t.getFindAllNodesFailureDescription=function(e,t){if(!ie)throw Error(o(363));var n=0,i=[];e=[Ua(e),0];for(var r=0;r<e.length;){var a=e[r++],s=e[r++],l=t[s];if((5!==a.tag||!se(a))&&(Fa(a,l)&&(i.push(Ba(l)),++s>n&&(n=s)),s<t.length))for(a=a.child;null!==a;)e.push(a,s),a=a.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Ba(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?I(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:fs,findFiberByHostInstance:e.findFiberByHostInstance||ds,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Gt=t.inject(e),Vt=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,i){if(!ie)throw Error(o(363));e=ja(e,t);var r=ce(e,n,i).disconnect;return{disconnect:function(){r()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Lt;try{return Lt=e,t()}finally{Lt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,i){var r=t.current,a=bo(),o=wo(r);return n=ls(n),null===t.context?t.context=n:t.pendingContext=n,(t=vn(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),gn(r,t),null!==(e=So(r,o,a))&&yn(e,r,o),o},t}},585:function(e,t,n){"use strict";e.exports=n(976)},258:function(e,t,n){"use strict";e.exports=n(721)},783:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=e[s],u=s+1,c=e[u];if(0>a(l,n))u<r&&0>a(c,l)?(e[i]=c,e[u]=n,i=u):(e[i]=l,e[s]=n,i=s);else{if(!(u<r&&0>a(c,n)))break e;e[i]=c,e[u]=n,i=u}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var u=[],c=[],h=1,f=null,d=3,p=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(c);null!==t;){if(null===t.callback)r(c);else{if(!(t.startTime<=e))break;r(c),t.sortIndex=t.expirationTime,n(u,t)}t=i(c)}}function b(e){if(v=!1,x(e),!m)if(null!==i(u))m=!0,I(w);else{var t=i(c);null!==t&&O(b,t.startTime-e)}}function w(e,n){m=!1,v&&(v=!1,y(E),E=-1),p=!0;var a=d;try{for(x(n),f=i(u);null!==f&&(!(f.expirationTime>n)||e&&!P());){var o=f.callback;if("function"===typeof o){f.callback=null,d=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===i(u)&&r(u),x(n)}else r(u);f=i(u)}if(null!==f)var l=!0;else{var h=i(c);null!==h&&O(b,h.startTime-n),l=!1}return l}finally{f=null,d=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,E=-1,C=5,k=-1;function P(){return!(t.unstable_now()-k<C)}function A(){if(null!==T){var e=t.unstable_now();k=e;var n=!0;try{n=T(!0,e)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,L=R.port2;R.port1.onmessage=A,S=function(){L.postMessage(null)}}else S=function(){g(A,0)};function I(e){T=e,M||(M=!0,S())}function O(e,n){E=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,I(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(u)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===i(u)&&e===i(c)&&(v?(y(E),E=-1):v=!0,O(b,a-o))):(e.sortIndex=s,n(u,e),m||p||(m=!0,I(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},100:function(e,t,n){"use strict";e.exports=n(783)},374:function(e,t,n){"use strict";var i=n(791),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var i,a={},u=null,c=null;for(i in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:r,type:e,key:u,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=u,t.jsxs=u},117:function(e,t){"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),d=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}function y(){}function _(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=_.prototype=new y;x.constructor=_,m(x,g.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,i){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,r)&&!M.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(1===l)a.children=i;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];a.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:S.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=e),e=""===a?"."+k(l,0):a,b(o)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),P(o,t,r,"",(function(e){return e}))):null!=o&&(E(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(l=0,a=""===a?".":a+":",b(e))for(var u=0;u<e.length;u++){var c=a+k(s=e[u],u);l+=P(s,t,r,c,o)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),u=0;!(s=e.next()).done;)l+=P(s=s.value,t,r,c=a+k(s,u++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function A(e,t,n){if(null==e)return e;var i=[],r=0;return P(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},I={transition:null},O={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:I,ReactCurrentOwner:S};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=r,t.Profiler=o,t.PureComponent=_,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)w.call(t,u)&&!M.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=i;else if(1<u){l=Array(u);for(var c=0;c<u;c++)l[c]=arguments[c+2];r.children=l}return{$$typeof:n,type:e.type,key:a,ref:o,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=I.transition;I.transition={};try{e()}finally{I.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return L.current.useCallback(e,t)},t.useContext=function(e){return L.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},t.useEffect=function(e,t){return L.current.useEffect(e,t)},t.useId=function(){return L.current.useId()},t.useImperativeHandle=function(e,t,n){return L.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.current.useMemo(e,t)},t.useReducer=function(e,t,n){return L.current.useReducer(e,t,n)},t.useRef=function(e){return L.current.useRef(e)},t.useState=function(e){return L.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return L.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return L.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=e[s],u=s+1,c=e[u];if(0>a(l,n))u<r&&0>a(c,l)?(e[i]=c,e[u]=n,i=u):(e[i]=l,e[s]=n,i=s);else{if(!(u<r&&0>a(c,n)))break e;e[i]=c,e[u]=n,i=u}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var u=[],c=[],h=1,f=null,d=3,p=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(c);null!==t;){if(null===t.callback)r(c);else{if(!(t.startTime<=e))break;r(c),t.sortIndex=t.expirationTime,n(u,t)}t=i(c)}}function b(e){if(v=!1,x(e),!m)if(null!==i(u))m=!0,I(w);else{var t=i(c);null!==t&&O(b,t.startTime-e)}}function w(e,n){m=!1,v&&(v=!1,y(E),E=-1),p=!0;var a=d;try{for(x(n),f=i(u);null!==f&&(!(f.expirationTime>n)||e&&!P());){var o=f.callback;if("function"===typeof o){f.callback=null,d=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===i(u)&&r(u),x(n)}else r(u);f=i(u)}if(null!==f)var l=!0;else{var h=i(c);null!==h&&O(b,h.startTime-n),l=!1}return l}finally{f=null,d=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,E=-1,C=5,k=-1;function P(){return!(t.unstable_now()-k<C)}function A(){if(null!==T){var e=t.unstable_now();k=e;var n=!0;try{n=T(!0,e)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,L=R.port2;R.port1.onmessage=A,S=function(){L.postMessage(null)}}else S=function(){g(A,0)};function I(e){T=e,M||(M=!0,S())}function O(e,n){E=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,I(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(u)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===i(u)&&e===i(c)&&(v?(y(E),E=-1):v=!0,O(b,a-o))):(e.sortIndex=s,n(u,e),m||p||(m=!0,I(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},301:function(e,t,n){var i;!function(){"use strict";function r(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function a(e,t,n){var i=t.x,r=t.y,a=n.x-i,o=n.y-r;if(0!==a||0!==o){var s=((e.x-i)*a+(e.y-r)*o)/(a*a+o*o);s>1?(i=n.x,r=n.y):s>0&&(i+=a*s,r+=o*s)}return(a=e.x-i)*a+(o=e.y-r)*o}function o(e,t,n,i,r){for(var s,l=i,u=t+1;u<n;u++){var c=a(e[u],e[t],e[n]);c>l&&(s=u,l=c)}l>i&&(s-t>1&&o(e,t,s,i,r),r.push(e[s]),n-s>1&&o(e,s,n,i,r))}function s(e,t){var n=e.length-1,i=[e[0]];return o(e,0,n,t,i),i.push(e[n]),i}function l(e,t,n){if(e.length<=2)return e;var i=void 0!==t?t*t:1;return e=n?e:function(e,t){for(var n,i=e[0],a=[i],o=1,s=e.length;o<s;o++)r(n=e[o],i)>t&&(a.push(n),i=n);return i!==n&&a.push(n),a}(e,i),e=s(e,i)}void 0===(i=function(){return l}.call(t,n,t,e))||(e.exports=i)}()},266:function(e,t,n){!function(t){"use strict";var n,i,r="fulfilled",a="undefined",o=function(){var e=[],n=0;function r(){for(;e.length-n;){try{e[n]()}catch(r){t.console&&t.console.error(r)}e[n++]=i,1024==n&&(e.splice(0,1024),n=0)}}var o=function(){if(typeof MutationObserver===a)return typeof process!==a&&"function"==typeof process.nextTick?function(){process.nextTick(r)}:typeof setImmediate!==a?function(){setImmediate(r)}:function(){setTimeout(r,0)};var e=document.createElement("div");return new MutationObserver(r).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}();return function(t){e.push(t),e.length-n==1&&o()}}();function s(e){if(!(this instanceof s))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof e){var t=this;try{e((function(e){t.resolve(e)}),(function(e){t.reject(e)}))}catch(e){t.reject(e)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+e+" is not a function")}function l(e,t){if("function"==typeof e.y)try{var n=e.y.call(i,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function u(e,t){if("function"==typeof e.n)try{var n=e.n.call(i,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.reject(t)}s.prototype={resolve:function(e){if(this.state===n){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var i=!0,a=e.then;if("function"==typeof a)return void a.call(e,(function(e){i&&(i=!1,t.resolve(e))}),(function(e){i&&(i=!1,t.reject(e))}))}catch(a){return void(i&&this.reject(a))}this.state=r,this.v=e,t.c&&o((function(){for(var n=0,i=t.c.length;n<i;n++)l(t.c[n],e)}))}},reject:function(e){if(this.state===n){var i=this;this.state="rejected",this.v=e;var r=this.c;o(r?function(){for(var t=0,n=r.length;t<n;t++)u(r[t],e)}:function(){i.handled||!s.suppressUncaughtRejectionError&&t.console&&s.warn("You upset Zousan. Please catch rejections: ",e,e?e.stack:null)})}},then:function(e,t){var i=new s,a={y:e,n:t,p:i};if(this.state===n)this.c?this.c.push(a):this.c=[a];else{var c=this.state,h=this.v;this.handled=!0,o((function(){c===r?l(a,h):u(a,h)}))}return i},catch:function(e){return this.then(null,e)},finally:function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var n=this;return new s((function(i,r){setTimeout((function(){r(Error(t))}),e),n.then((function(e){i(e)}),(function(e){r(e)}))}))}},s.resolve=function(e){var t=new s;return t.resolve(e),t},s.reject=function(e){var t=new s;return t.c=[],t.reject(e),t},s.all=function(e){var t=[],n=0,i=new s;function r(r,a){r&&"function"==typeof r.then||(r=s.resolve(r)),r.then((function(r){t[a]=r,++n==e.length&&i.resolve(t)}),(function(e){i.reject(e)}))}for(var a=0;a<e.length;a++)r(e[a],a);return e.length||i.resolve(t),i},s.warn=console.warn,e.exports&&(e.exports=s),t.define&&t.define.amd&&t.define([],(function(){return s})),(t.Zousan=s).soon=o}("undefined"!=typeof n.g?n.g:this)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,i){return n.f[i](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".f87c2184.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="gcs:";n.l=function(i,r,a,o){if(e[i])e[i].push(r);else{var s,l;if(void 0!==a)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var h=u[c];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+a){s=h;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=i),e[i]=[r];var f=function(t,n){s.onerror=s.onload=null,clearTimeout(d);var r=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(e){return e(n)})),t)return t(n)},d=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",function(){var e={179:0};n.f.j=function(t,i){var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise((function(n,i){r=e[t]=[n,i]}));i.push(r[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,(function(i){if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,r[1](s)}}),"chunk-"+t,t)}};var t=function(t,i){var r,a,o=i[0],s=i[1],l=i[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)l(n)}for(t&&t(i);u<o.length;u++)a=o[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},i=self.webpackChunkgcs=self.webpackChunkgcs||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}(),function(){"use strict";var e={};n.r(e),n.d(e,{Decoder:function(){return We},Encoder:function(){return Ge},PacketType:function(){return Be},protocol:function(){return je}});var t={};n.r(t),n.d(t,{ACESFilmicToneMapping:function(){return hn},AddEquation:function(){return It},AddOperation:function(){return on},AdditiveAnimationBlendMode:function(){return ji},AdditiveBlending:function(){return Pt},AlphaFormat:function(){return Gn},AlwaysCompare:function(){return Er},AlwaysDepth:function(){return Jt},AlwaysStencilFunc:function(){return yr},AmbientLight:function(){return Xp},AmbientLightProbe:function(){return lm},AnimationAction:function(){return zm},AnimationClip:function(){return mp},AnimationLoader:function(){return Tp},AnimationMixer:function(){return Fm},AnimationObjectGroup:function(){return Nm},AnimationUtils:function(){return np},ArcCurve:function(){return _f},ArrayCamera:function(){return Hc},ArrowHelper:function(){return Av},Audio:function(){return xm},AudioAnalyser:function(){return Em},AudioContext:function(){return am},AudioListener:function(){return _m},AudioLoader:function(){return om},AxesHelper:function(){return Rv},BackSide:function(){return Mt},BasicDepthPacking:function(){return qi},BasicShadowMap:function(){return _t},Bone:function(){return Lh},BooleanKeyframeTrack:function(){return lp},Box2:function(){return Qm},Box3:function(){return Ua},Box3Helper:function(){return Cv},BoxGeometry:function(){return Js},BoxHelper:function(){return Ev},BufferAttribute:function(){return fs},BufferGeometry:function(){return As},BufferGeometryLoader:function(){return $p},ByteType:function(){return In},Cache:function(){return gp},Camera:function(){return nl},CameraHelper:function(){return bv},CanvasTexture:function(){return vf},CapsuleGeometry:function(){return Bf},CatmullRomCurve3:function(){return Tf},CineonToneMapping:function(){return cn},CircleGeometry:function(){return Hf},ClampToEdgeWrapping:function(){return xn},Clock:function(){return dm},Color:function(){return ns},ColorKeyframeTrack:function(){return up},ColorManagement:function(){return _a},CompressedArrayTexture:function(){return pf},CompressedCubeTexture:function(){return mf},CompressedTexture:function(){return df},CompressedTextureLoader:function(){return Ep},ConeGeometry:function(){return Gf},CubeCamera:function(){return al},CubeReflectionMapping:function(){return pn},CubeRefractionMapping:function(){return mn},CubeTexture:function(){return ol},CubeTextureLoader:function(){return kp},CubeUVReflectionMapping:function(){return yn},CubicBezierCurve:function(){return Pf},CubicBezierCurve3:function(){return Af},CubicInterpolant:function(){return rp},CullFaceBack:function(){return vt},CullFaceFront:function(){return gt},CullFaceFrontBack:function(){return yt},CullFaceNone:function(){return mt},Curve:function(){return gf},CurvePath:function(){return zf},CustomBlending:function(){return Lt},CustomToneMapping:function(){return fn},CylinderGeometry:function(){return jf},Cylindrical:function(){return Ym},Data3DTexture:function(){return Ra},DataArrayTexture:function(){return Pa},DataTexture:function(){return Ih},DataTextureLoader:function(){return Pp},DataUtils:function(){return us},DecrementStencilOp:function(){return sr},DecrementWrapStencilOp:function(){return ur},DefaultLoadingManager:function(){return _p},DepthFormat:function(){return Zn},DepthStencilFormat:function(){return qn},DepthTexture:function(){return Wc},DirectionalLight:function(){return Wp},DirectionalLightHelper:function(){return yv},DiscreteInterpolant:function(){return op},DisplayP3ColorSpace:function(){return tr},DodecahedronGeometry:function(){return Wf},DoubleSide:function(){return Tt},DstAlphaFactor:function(){return Vt},DstColorFactor:function(){return Xt},DynamicCopyUsage:function(){return Or},DynamicDrawUsage:function(){return kr},DynamicReadUsage:function(){return Rr},EdgesGeometry:function(){return Jf},EllipseCurve:function(){return yf},EqualCompare:function(){return br},EqualDepth:function(){return $t},EqualStencilFunc:function(){return dr},EquirectangularReflectionMapping:function(){return vn},EquirectangularRefractionMapping:function(){return gn},Euler:function(){return wo},EventDispatcher:function(){return Hr},ExtrudeGeometry:function(){return Ed},FileLoader:function(){return Mp},Float16BufferAttribute:function(){return xs},Float32BufferAttribute:function(){return bs},Float64BufferAttribute:function(){return ws},FloatType:function(){return Un},Fog:function(){return $c},FogExp2:function(){return Kc},FramebufferTexture:function(){return ff},FrontSide:function(){return St},Frustum:function(){return pl},GLBufferAttribute:function(){return Vm},GLSL1:function(){return Nr},GLSL3:function(){return zr},GreaterCompare:function(){return Sr},GreaterDepth:function(){return tn},GreaterEqualCompare:function(){return Tr},GreaterEqualDepth:function(){return en},GreaterEqualStencilFunc:function(){return gr},GreaterStencilFunc:function(){return mr},GridHelper:function(){return dv},Group:function(){return jc},HalfFloatType:function(){return Fn},HemisphereLight:function(){return Lp},HemisphereLightHelper:function(){return fv},HemisphereLightProbe:function(){return sm},IcosahedronGeometry:function(){return kd},ImageBitmapLoader:function(){return rm},ImageLoader:function(){return Cp},ImageUtils:function(){return xa},IncrementStencilOp:function(){return or},IncrementWrapStencilOp:function(){return lr},InstancedBufferAttribute:function(){return zh},InstancedBufferGeometry:function(){return Kp},InstancedInterleavedBuffer:function(){return Gm},InstancedMesh:function(){return Wh},Int16BufferAttribute:function(){return vs},Int32BufferAttribute:function(){return ys},Int8BufferAttribute:function(){return ds},IntType:function(){return Nn},InterleavedBuffer:function(){return th},InterleavedBufferAttribute:function(){return ih},Interpolant:function(){return ip},InterpolateDiscrete:function(){return Di},InterpolateLinear:function(){return Ni},InterpolateSmooth:function(){return zi},InvertStencilOp:function(){return cr},KeepStencilOp:function(){return rr},KeyframeTrack:function(){return sp},LOD:function(){return bh},LatheGeometry:function(){return Ff},Layers:function(){return So},LessCompare:function(){return xr},LessDepth:function(){return Qt},LessEqualCompare:function(){return wr},LessEqualDepth:function(){return Kt},LessEqualStencilFunc:function(){return pr},LessStencilFunc:function(){return fr},Light:function(){return Rp},LightProbe:function(){return Yp},Line:function(){return Kh},Line3:function(){return ev},LineBasicMaterial:function(){return Xh},LineCurve:function(){return Rf},LineCurve3:function(){return Lf},LineDashedMaterial:function(){return Yd},LineLoop:function(){return nf},LineSegments:function(){return tf},LinearDisplayP3ColorSpace:function(){return nr},LinearEncoding:function(){return Xi},LinearFilter:function(){return Cn},LinearInterpolant:function(){return ap},LinearMipMapLinearFilter:function(){return Rn},LinearMipMapNearestFilter:function(){return Pn},LinearMipmapLinearFilter:function(){return An},LinearMipmapNearestFilter:function(){return kn},LinearSRGBColorSpace:function(){return er},LinearToneMapping:function(){return ln},Loader:function(){return xp},LoaderUtils:function(){return Qp},LoadingManager:function(){return yp},LoopOnce:function(){return Li},LoopPingPong:function(){return Oi},LoopRepeat:function(){return Ii},LuminanceAlphaFormat:function(){return Xn},LuminanceFormat:function(){return Wn},MOUSE:function(){return dt},Material:function(){return Qo},MaterialLoader:function(){return Jp},MathUtils:function(){return ta},Matrix3:function(){return ia},Matrix4:function(){return ho},MaxEquation:function(){return zt},Mesh:function(){return qs},MeshBasicMaterial:function(){return rs},MeshDepthMaterial:function(){return Ic},MeshDistanceMaterial:function(){return Oc},MeshLambertMaterial:function(){return Zd},MeshMatcapMaterial:function(){return qd},MeshNormalMaterial:function(){return Xd},MeshPhongMaterial:function(){return Vd},MeshPhysicalMaterial:function(){return Gd},MeshStandardMaterial:function(){return jd},MeshToonMaterial:function(){return Wd},MinEquation:function(){return Nt},MirroredRepeatWrapping:function(){return bn},MixOperation:function(){return an},MultiplyBlending:function(){return Rt},MultiplyOperation:function(){return rn},NearestFilter:function(){return wn},NearestMipMapLinearFilter:function(){return En},NearestMipMapNearestFilter:function(){return Mn},NearestMipmapLinearFilter:function(){return Tn},NearestMipmapNearestFilter:function(){return Sn},NeverCompare:function(){return _r},NeverDepth:function(){return Yt},NeverStencilFunc:function(){return hr},NoBlending:function(){return Ct},NoColorSpace:function(){return Ki},NoToneMapping:function(){return sn},NormalAnimationBlendMode:function(){return Hi},NormalBlending:function(){return kt},NotEqualCompare:function(){return Mr},NotEqualDepth:function(){return nn},NotEqualStencilFunc:function(){return vr},NumberKeyframeTrack:function(){return cp},Object3D:function(){return zo},ObjectLoader:function(){return em},ObjectSpaceNormalMap:function(){return Qi},OctahedronGeometry:function(){return Pd},OneFactor:function(){return Ft},OneMinusDstAlphaFactor:function(){return Wt},OneMinusDstColorFactor:function(){return Zt},OneMinusSrcAlphaFactor:function(){return Gt},OneMinusSrcColorFactor:function(){return Ht},OrthographicCamera:function(){return kl},PCFShadowMap:function(){return xt},PCFSoftShadowMap:function(){return bt},PMREMGenerator:function(){return zl},Path:function(){return Uf},PerspectiveCamera:function(){return il},Plane:function(){return hl},PlaneGeometry:function(){return gl},PlaneHelper:function(){return kv},PointLight:function(){return Gp},PointLightHelper:function(){return lv},Points:function(){return uf},PointsMaterial:function(){return rf},PolarGridHelper:function(){return pv},PolyhedronGeometry:function(){return Vf},PositionalAudio:function(){return Tm},PropertyBinding:function(){return Dm},PropertyMixer:function(){return Cm},QuadraticBezierCurve:function(){return If},QuadraticBezierCurve3:function(){return Of},Quaternion:function(){return Oa},QuaternionKeyframeTrack:function(){return fp},QuaternionLinearInterpolant:function(){return hp},RED_GREEN_RGTC2_Format:function(){return Ai},RED_RGTC1_Format:function(){return ki},REVISION:function(){return ft},RGBADepthPacking:function(){return Yi},RGBAFormat:function(){return Vn},RGBAIntegerFormat:function(){return $n},RGBA_ASTC_10x10_Format:function(){return wi},RGBA_ASTC_10x5_Format:function(){return _i},RGBA_ASTC_10x6_Format:function(){return xi},RGBA_ASTC_10x8_Format:function(){return bi},RGBA_ASTC_12x10_Format:function(){return Si},RGBA_ASTC_12x12_Format:function(){return Mi},RGBA_ASTC_4x4_Format:function(){return hi},RGBA_ASTC_5x4_Format:function(){return fi},RGBA_ASTC_5x5_Format:function(){return di},RGBA_ASTC_6x5_Format:function(){return pi},RGBA_ASTC_6x6_Format:function(){return mi},RGBA_ASTC_8x5_Format:function(){return vi},RGBA_ASTC_8x6_Format:function(){return gi},RGBA_ASTC_8x8_Format:function(){return yi},RGBA_BPTC_Format:function(){return Ti},RGBA_ETC2_EAC_Format:function(){return ci},RGBA_PVRTC_2BPPV1_Format:function(){return si},RGBA_PVRTC_4BPPV1_Format:function(){return oi},RGBA_S3TC_DXT1_Format:function(){return ti},RGBA_S3TC_DXT3_Format:function(){return ni},RGBA_S3TC_DXT5_Format:function(){return ii},RGB_BPTC_SIGNED_Format:function(){return Ei},RGB_BPTC_UNSIGNED_Format:function(){return Ci},RGB_ETC1_Format:function(){return li},RGB_ETC2_Format:function(){return ui},RGB_PVRTC_2BPPV1_Format:function(){return ai},RGB_PVRTC_4BPPV1_Format:function(){return ri},RGB_S3TC_DXT1_Format:function(){return ei},RGFormat:function(){return Qn},RGIntegerFormat:function(){return Kn},RawShaderMaterial:function(){return Hd},Ray:function(){return co},Raycaster:function(){return Wm},RectAreaLight:function(){return Zp},RedFormat:function(){return Yn},RedIntegerFormat:function(){return Jn},ReinhardToneMapping:function(){return un},RenderTarget:function(){return Ca},RepeatWrapping:function(){return _n},ReplaceStencilOp:function(){return ar},ReverseSubtractEquation:function(){return Dt},RingGeometry:function(){return Ad},SIGNED_RED_GREEN_RGTC2_Format:function(){return Ri},SIGNED_RED_RGTC1_Format:function(){return Pi},SRGBColorSpace:function(){return $i},Scene:function(){return eh},ShaderChunk:function(){return yl},ShaderLib:function(){return xl},ShaderMaterial:function(){return tl},ShadowMaterial:function(){return Bd},Shape:function(){return Qf},ShapeGeometry:function(){return Rd},ShapePath:function(){return Lv},ShapeUtils:function(){return Sd},ShortType:function(){return On},Skeleton:function(){return Nh},SkeletonHelper:function(){return ov},SkinnedMesh:function(){return Rh},Source:function(){return wa},Sphere:function(){return no},SphereGeometry:function(){return Ld},Spherical:function(){return qm},SphericalHarmonics3:function(){return qp},SplineCurve:function(){return Df},SpotLight:function(){return Up},SpotLightHelper:function(){return nv},Sprite:function(){return gh},SpriteMaterial:function(){return rh},SrcAlphaFactor:function(){return jt},SrcAlphaSaturateFactor:function(){return qt},SrcColorFactor:function(){return Bt},StaticCopyUsage:function(){return Ir},StaticDrawUsage:function(){return Cr},StaticReadUsage:function(){return Ar},StereoCamera:function(){return fm},StreamCopyUsage:function(){return Dr},StreamDrawUsage:function(){return Pr},StreamReadUsage:function(){return Lr},StringKeyframeTrack:function(){return dp},SubtractEquation:function(){return Ot},SubtractiveBlending:function(){return At},TOUCH:function(){return pt},TangentSpaceNormalMap:function(){return Ji},TetrahedronGeometry:function(){return Id},Texture:function(){return Ta},TextureLoader:function(){return Ap},TorusGeometry:function(){return Od},TorusKnotGeometry:function(){return Dd},Triangle:function(){return Yo},TriangleFanDrawMode:function(){return Wi},TriangleStripDrawMode:function(){return Vi},TrianglesDrawMode:function(){return Gi},TubeGeometry:function(){return Nd},TwoPassDoubleSide:function(){return Et},UVMapping:function(){return dn},Uint16BufferAttribute:function(){return gs},Uint32BufferAttribute:function(){return _s},Uint8BufferAttribute:function(){return ps},Uint8ClampedBufferAttribute:function(){return ms},Uniform:function(){return Bm},UniformsGroup:function(){return jm},UniformsLib:function(){return _l},UniformsUtils:function(){return el},UnsignedByteType:function(){return Ln},UnsignedInt248Type:function(){return jn},UnsignedIntType:function(){return zn},UnsignedShort4444Type:function(){return Bn},UnsignedShort5551Type:function(){return Hn},UnsignedShortType:function(){return Dn},VSMShadowMap:function(){return wt},Vector2:function(){return na},Vector3:function(){return Da},Vector4:function(){return Ea},VectorKeyframeTrack:function(){return pp},VideoTexture:function(){return hf},WebGL1Renderer:function(){return Jc},WebGL3DRenderTarget:function(){return La},WebGLArrayRenderTarget:function(){return Aa},WebGLCoordinateSystem:function(){return Fr},WebGLCubeRenderTarget:function(){return sl},WebGLMultipleRenderTargets:function(){return Ia},WebGLRenderTarget:function(){return ka},WebGLRenderer:function(){return Yc},WebGLUtils:function(){return Bc},WebGPUCoordinateSystem:function(){return Br},WireframeGeometry:function(){return zd},WrapAroundEnding:function(){return Bi},ZeroCurvatureEnding:function(){return Ui},ZeroFactor:function(){return Ut},ZeroSlopeEnding:function(){return Fi},ZeroStencilOp:function(){return ir},_SRGBAFormat:function(){return Ur},createCanvasElement:function(){return ua},sRGBEncoding:function(){return Zi}});var i=n(791),r=n(250);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function s(e,t){if(e){if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function l(e){return function(e){if(Array.isArray(e))return a(e)}(e)||o(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e){if(Array.isArray(e))return e}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){return u(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}(e,t)||s(e,t)||c()}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function p(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function v(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function _(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function b(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function w(e){var t=b();return function(){var n,i=x(e);if(t){var r=x(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===d(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}(this,n)}}function S(){return S="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},S.apply(this,arguments)}function M(e,t,n){return M=b()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&y(r,n.prototype),r},M.apply(null,arguments)}function T(e){var t="function"===typeof Map?new Map:void 0;return T=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return M(e,arguments,x(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),y(i,e)},T(e)}var E=Object.create(null);E.open="0",E.close="1",E.ping="2",E.pong="3",E.message="4",E.upgrade="5",E.noop="6";var C=Object.create(null);Object.keys(E).forEach((function(e){C[E[e]]=e}));var k,P={type:"error",data:"parser error"},A="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),R="function"===typeof ArrayBuffer,L=function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},I=function(e,t,n){var i=e.type,r=e.data;return A&&r instanceof Blob?t?n(r):O(r,n):R&&(r instanceof ArrayBuffer||L(r))?t?n(r):O(new Blob([r]),n):n(E[i]+(r||""))},O=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function D(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",z="undefined"===typeof Uint8Array?[]:new Uint8Array(256),U=0;U<64;U++)z[N.charCodeAt(U)]=U;var F,B="function"===typeof ArrayBuffer,H=function(e,t){if("string"!==typeof e)return{type:"message",data:G(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:j(e.substring(1),t)}:C[n]?e.length>1?{type:C[n],data:e.substring(1)}:{type:C[n]}:P},j=function(e,t){if(B){var n=function(e){var t,n,i,r,a,o=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),c=new Uint8Array(u);for(t=0;t<s;t+=4)n=z[e.charCodeAt(t)],i=z[e.charCodeAt(t+1)],r=z[e.charCodeAt(t+2)],a=z[e.charCodeAt(t+3)],c[l++]=n<<2|i>>4,c[l++]=(15&i)<<4|r>>2,c[l++]=(3&r)<<6|63&a;return u}(e);return G(n,t)}return{base64:!0,data:e}},G=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},V=String.fromCharCode(30);function W(){return new TransformStream({transform:function(e,t){!function(e,t){A&&e.data instanceof Blob?e.data.arrayBuffer().then(D).then(t):R&&(e.data instanceof ArrayBuffer||L(e.data))?t(D(e.data)):I(e,!1,(function(e){k||(k=new TextEncoder),t(k.encode(e))}))}(e,(function(n){var i,r=n.length;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);var a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,r)}else{i=new Uint8Array(9);var o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(r))}e.data&&"string"!==typeof e.data&&(i[0]|=128),t.enqueue(i),t.enqueue(n)}))}})}function X(e){return e.reduce((function(e,t){return e+t.length}),0)}function Z(e,t){if(e[0].length===t)return e.shift();for(var n=new Uint8Array(t),i=0,r=0;r<t;r++)n[r]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function q(e){if(e)return function(e){for(var t in q.prototype)e[t]=q.prototype[t];return e}(e)}q.prototype.on=q.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},q.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},q.prototype.off=q.prototype.removeListener=q.prototype.removeAllListeners=q.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},q.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t)}return this},q.prototype.emitReserved=q.prototype.emit,q.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},q.prototype.hasListeners=function(e){return!!this.listeners(e).length};var Y="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function J(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var Q=Y.setTimeout,K=Y.clearTimeout;function $(e,t){t.useNativeTimers?(e.setTimeoutFn=Q.bind(Y),e.clearTimeoutFn=K.bind(Y)):(e.setTimeoutFn=Y.setTimeout.bind(Y),e.clearTimeoutFn=Y.clearTimeout.bind(Y))}var ee,te=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,e)).description=i,a.context=r,a.type="TransportError",a}return v(n)}(T(Error)),ne=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).writable=!1,$(g(i),e),i.opts=e,i.query=e.query,i.socket=e.socket,i}return v(n,[{key:"onError",value:function(e,t,i){return S(x(n.prototype),"emitReserved",this).call(this,"error",new te(e,t,i)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,S(x(n.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=H(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){S(x(n.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",S(x(n.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}]),n}(q),ie="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),re=64,ae={},oe=0,se=0;function le(e){var t="";do{t=ie[e%re]+t,e=Math.floor(e/re)}while(e>0);return t}function ue(){var e=le(+new Date);return e!==ee?(oe=0,ee=e):e+"."+le(oe++)}for(;se<re;se++)ae[ie[se]]=se;var ce=!1;try{ce="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(lA){}var he=ce;function fe(e){var t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||he))return new XMLHttpRequest}catch(n){}if(!t)try{return new(Y[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function de(){}var pe=null!=new fe({xdomain:!1}).responseType,me=function(e){_(n,e);var t=w(n);function n(e){var i;if(f(this,n),(i=t.call(this,e)).polling=!1,"undefined"!==typeof location){var r="https:"===location.protocol,a=location.port;a||(a=r?"443":"80"),i.xd="undefined"!==typeof location&&e.hostname!==location.hostname||a!==e.port}var o=e&&e.forceBase64;return i.supportsBinary=pe&&!o,i.opts.withCredentials&&(i.cookieJar=void 0),i}return v(n,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var i=0;this.polling&&(i++,this.once("pollComplete",(function(){--i||n()}))),this.writable||(i++,this.once("drain",(function(){--i||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(V),i=[],r=0;r<n.length;r++){var a=H(n[r],t);if(i.push(a),"error"===a.type)break}return i})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,i=new Array(n),r=0;e.forEach((function(e,a){I(e,!1,(function(e){i[a]=e,++r===n&&t(i.join(V))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emitReserved("drain")}))}))}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ue()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ve(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(function(e,t){n.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,n){e.onError("xhr poll error",t,n)})),this.pollXhr=t}}]),n}(ne),ve=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),$(g(r=t.call(this)),i),r.opts=i,r.method=i.method||"GET",r.uri=e,r.data=void 0!==i.data?i.data:null,r.create(),r}return v(n,[{key:"create",value:function(){var e,t=this,i=J(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;var r=this.xhr=new fe(i);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var a in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(a)&&r.setRequestHeader(a,this.opts.extraHeaders[a])}catch(o){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}try{r.setRequestHeader("Accept","*/*")}catch(o){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=function(){var e;3===r.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"===typeof r.status?r.status:0)}),0))},r.send(this.data)}catch(o){return void this.setTimeoutFn((function(){t.onError(o)}),0)}"undefined"!==typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=de,e)try{this.xhr.abort()}catch(t){}"undefined"!==typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),n}(q);if(ve.requestsCount=0,ve.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",ge);else if("function"===typeof addEventListener){addEventListener("onpagehide"in Y?"pagehide":"unload",ge,!1)}function ge(){for(var e in ve.requests)ve.requests.hasOwnProperty(e)&&ve.requests[e].abort()}var ye="function"===typeof Promise&&"function"===typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},_e=Y.WebSocket||Y.MozWebSocket,xe="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),be=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).supportsBinary=!e.forceBase64,i}return v(n,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=xe?{}:J(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=xe?new _e(e,t,n):t?new _e(e,t):new _e(e)}catch(lA){return this.emitReserved("error",lA)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=e[i],r=i===e.length-1;I(n,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(n){}r&&ye((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},i=0;i<e.length;i++)n()}},{key:"doClose",value:function(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ue()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!_e}}]),n}(ne),we=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"===typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var n=function(e,t){F||(F=new TextDecoder);var n=[],i=0,r=-1,a=!1;return new TransformStream({transform:function(o,s){for(n.push(o);;){if(0===i){if(X(n)<1)break;var l=Z(n,1);a=128===(128&l[0]),r=127&l[0],i=r<126?3:126===r?1:2}else if(1===i){if(X(n)<2)break;var u=Z(n,2);r=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),i=3}else if(2===i){if(X(n)<8)break;var c=Z(n,8),h=new DataView(c.buffer,c.byteOffset,c.length),f=h.getUint32(0);if(f>Math.pow(2,21)-1){s.enqueue(P);break}r=f*Math.pow(2,32)+h.getUint32(4),i=3}else{if(X(n)<r)break;var d=Z(n,r);s.enqueue(H(a?d:F.decode(d),t)),i=0}if(0===r||r>e){s.enqueue(P);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),i=t.readable.pipeThrough(n).getReader(),r=W();r.readable.pipeTo(t.writable),e.writer=r.writable.getWriter();!function t(){i.read().then((function(n){var i=n.done,r=n.value;i||(e.onPacket(r),t())})).catch((function(e){}))}();var a={type:"open"};e.query.sid&&(a.data='{"sid":"'.concat(e.query.sid,'"}')),e.writer.write(a).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=e[i],r=i===e.length-1;t.writer.write(n).then((function(){r&&ye((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},i=0;i<e.length;i++)n()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}]),n}(ne),Se={websocket:be,webtransport:we,polling:me},Me=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Te=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ee(e){var t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var r=Me.exec(e||""),a={},o=14;o--;)a[Te[o]]=r[o]||"";return-1!=n&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){var n=/\/{2,9}/g,i=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||i.splice(0,1);"/"==t.slice(-1)&&i.splice(i.length-1,1);return i}(0,a.path),a.queryKey=function(e,t){var n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}(0,a.query),a}var Ce=function(e){_(n,e);var t=w(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(this,n),(i=t.call(this)).binaryType="arraybuffer",i.writeBuffer=[],e&&"object"===typeof e&&(r=e,e=null),e?(e=Ee(e),r.hostname=e.host,r.secure="https"===e.protocol||"wss"===e.protocol,r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=Ee(r.host).host),$(g(i),r),i.secure=null!=r.secure?r.secure:"undefined"!==typeof location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=i.secure?"443":"80"),i.hostname=r.hostname||("undefined"!==typeof location?location.hostname:"localhost"),i.port=r.port||("undefined"!==typeof location&&location.port?location.port:i.secure?"443":"80"),i.transports=r.transports||["polling","websocket","webtransport"],i.writeBuffer=[],i.prevBufferLen=0,i.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),i.opts.path=i.opts.path.replace(/\/$/,"")+(i.opts.addTrailingSlash?"/":""),"string"===typeof i.opts.query&&(i.opts.query=function(e){for(var t={},n=e.split("&"),i=0,r=n.length;i<r;i++){var a=n[i].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}(i.opts.query)),i.id=null,i.upgrades=null,i.pingInterval=null,i.pingTimeout=null,i.pingTimeoutTimer=null,"function"===typeof addEventListener&&(i.opts.closeOnBeforeunload&&(i.beforeunloadEventListener=function(){i.transport&&(i.transport.removeAllListeners(),i.transport.close())},addEventListener("beforeunload",i.beforeunloadEventListener,!1)),"localhost"!==i.hostname&&(i.offlineEventListener=function(){i.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",i.offlineEventListener,!1))),i.open(),i}return v(n,[{key:"createTransport",value:function(e){var t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Se[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(i){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,i=this.createTransport(e),r=!1;n.priorWebsocketSuccess=!1;var a=function(){r||(i.send([{type:"ping",data:"probe"}]),i.once("packet",(function(e){if(!r)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",i),!i)return;n.priorWebsocketSuccess="websocket"===i.name,t.transport.pause((function(){r||"closed"!==t.readyState&&(h(),t.setTransport(i),i.send([{type:"upgrade"}]),t.emitReserved("upgrade",i),i=null,t.upgrading=!1,t.flush())}))}else{var a=new Error("probe error");a.transport=i.name,t.emitReserved("upgradeError",a)}})))};function o(){r||(r=!0,h(),i.close(),i=null)}var s=function(e){var n=new Error("probe error: "+e);n.transport=i.name,o(),t.emitReserved("upgradeError",n)};function l(){s("transport closed")}function u(){s("socket closed")}function c(e){i&&e.name!==i.name&&o()}var h=function(){i.removeListener("open",a),i.removeListener("error",s),i.removeListener("close",l),t.off("close",u),t.off("upgrading",c)};i.once("open",a),i.once("error",s),i.once("close",l),this.once("close",u),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){r||i.open()}),200):i.open()}},{key:"onOpen",value:function(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,n=0;n<this.writeBuffer.length;n++){var i=this.writeBuffer[n].data;if(i&&(t+="string"===typeof(e=i)?function(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,i){if("function"===typeof t&&(i=t,t=void 0),"function"===typeof n&&(i=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},i=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?i():t()})):this.upgrading?i():t()),this}},{key:"onError",value:function(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),n}(q);Ce.protocol=4;Ce.protocol;function ke(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}var Pe="function"===typeof ArrayBuffer,Ae=function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},Re=Object.prototype.toString,Le="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Re.call(Blob),Ie="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Re.call(File);function Oe(e){return Pe&&(e instanceof ArrayBuffer||Ae(e))||Le&&e instanceof Blob||Ie&&e instanceof File}function De(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(var n=0,i=e.length;n<i;n++)if(De(e[n]))return!0;return!1}if(Oe(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return De(e.toJSON(),!0);for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&De(e[r]))return!0;return!1}function Ne(e){var t=[],n=e.data,i=e;return i.data=ze(n,t),i.attachments=t.length,{packet:i,buffers:t}}function ze(e,t){if(!e)return e;if(Oe(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){for(var i=new Array(e.length),r=0;r<e.length;r++)i[r]=ze(e[r],t);return i}if("object"===typeof e&&!(e instanceof Date)){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(a[o]=ze(e[o],t));return a}return e}function Ue(e,t){return e.data=Fe(e.data,t),delete e.attachments,e}function Fe(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=Fe(e[n],t);else if("object"===typeof e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(e[i]=Fe(e[i],t));return e}var Be,He=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],je=5;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Be||(Be={}));var Ge=function(){function e(t){f(this,e),this.replacer=t}return v(e,[{key:"encode",value:function(e){return e.type!==Be.EVENT&&e.type!==Be.ACK||!De(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Be.EVENT?Be.BINARY_EVENT:Be.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==Be.BINARY_EVENT&&e.type!==Be.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=Ne(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}]),e}();function Ve(e){return"[object Object]"===Object.prototype.toString.call(e)}var We=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).reviver=e,i}return v(n,[{key:"add",value:function(e){var t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var i=(t=this.decodeString(e)).type===Be.BINARY_EVENT;i||t.type===Be.BINARY_ACK?(t.type=i?Be.EVENT:Be.ACK,this.reconstructor=new Xe(t),0===t.attachments&&S(x(n.prototype),"emitReserved",this).call(this,"decoded",t)):S(x(n.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!Oe(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,S(x(n.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,i={type:Number(e.charAt(0))};if(void 0===Be[i.type])throw new Error("unknown packet type "+i.type);if(i.type===Be.BINARY_EVENT||i.type===Be.BINARY_ACK){for(var r=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var a=e.substring(r,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(a)}if("/"===e.charAt(t+1)){for(var o=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}i.nsp=e.substring(o,t)}else i.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var l=t+1;++t;){var u=e.charAt(t);if(null==u||Number(u)!=u){--t;break}if(t===e.length)break}i.id=Number(e.substring(l,t+1))}if(e.charAt(++t)){var c=this.tryParse(e.substr(t));if(!n.isPayloadValid(i.type,c))throw new Error("invalid payload");i.data=c}return i}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case Be.CONNECT:return Ve(t);case Be.DISCONNECT:return void 0===t;case Be.CONNECT_ERROR:return"string"===typeof t||Ve(t);case Be.EVENT:case Be.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===He.indexOf(t[0]));case Be.ACK:case Be.BINARY_ACK:return Array.isArray(t)}}}]),n}(q),Xe=function(){function e(t){f(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return v(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Ue(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}();function Ze(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var qe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Ye=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this)).connected=!1,a.recovered=!1,a.receiveBuffer=[],a.sendBuffer=[],a._queue=[],a._queueSeq=0,a.ids=0,a.acks={},a.flags={},a.io=e,a.nsp=i,r&&r.auth&&(a.auth=r.auth),a._opts=Object.assign({},r),a.io._autoConnect&&a.open(),a}return v(n,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Ze(e,"open",this.onopen.bind(this)),Ze(e,"packet",this.onpacket.bind(this)),Ze(e,"error",this.onerror.bind(this)),Ze(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(qe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;var r={type:Be.EVENT,data:n,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"===typeof n[n.length-1]){var a=this.ids++,o=n.pop();this._registerAckCallback(a,o),r.id=a}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n,i=this,r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0!==r){var a=this.io.setTimeoutFn((function(){delete i.acks[e];for(var n=0;n<i.sendBuffer.length;n++)i.sendBuffer[n].id===e&&i.sendBuffer.splice(n,1);t.call(i,new Error("operation has timed out"))}),r);this.acks[e]=function(){i.io.clearTimeoutFn(a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(i,[null].concat(n))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var a=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(n,r){i.push((function(e,t){return a?e?r(e):n(t):n(e)})),t.emit.apply(t,[e].concat(i))}))}},{key:"_addToQueue",value:function(e){var t,n=this;"function"===typeof e[e.length-1]&&(t=e.pop());var i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(i===n._queue[0]){if(null!==e)i.tryCount>n._opts.retries&&(n._queue.shift(),t&&t(e));else if(n._queue.shift(),t){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];t.apply(void 0,[null].concat(a))}return i.pending=!1,n._drainQueue()}})),this._queue.push(i),this._drainQueue()}},{key:"_drainQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.connected&&0!==this._queue.length){var t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:Be.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case Be.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Be.EVENT:case Be.BINARY_EVENT:this.onevent(e);break;case Be.ACK:case Be.BINARY_ACK:this.onack(e);break;case Be.DISCONNECT:this.ondisconnect();break;case Be.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,i=ke(this._anyListeners.slice());try{for(i.s();!(t=i.n()).done;){t.value.apply(this,e)}}catch(lA){i.e(lA)}finally{i.f()}}S(x(n.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];t.packet({type:Be.ACK,id:e,data:r})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"===typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:Be.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,n=ke(this._anyOutgoingListeners.slice());try{for(n.s();!(t=n.n()).done;){t.value.apply(this,e.data)}}catch(lA){n.e(lA)}finally{n.f()}}}}]),n}(q);function Je(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Je.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Je.prototype.reset=function(){this.attempts=0},Je.prototype.setMin=function(e){this.ms=e},Je.prototype.setMax=function(e){this.max=e},Je.prototype.setJitter=function(e){this.jitter=e};var Qe=function(t){_(i,t);var n=w(i);function i(t,r){var a,o;f(this,i),(a=n.call(this)).nsps={},a.subs=[],t&&"object"===typeof t&&(r=t,t=void 0),(r=r||{}).path=r.path||"/socket.io",a.opts=r,$(g(a),r),a.reconnection(!1!==r.reconnection),a.reconnectionAttempts(r.reconnectionAttempts||1/0),a.reconnectionDelay(r.reconnectionDelay||1e3),a.reconnectionDelayMax(r.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(o=r.randomizationFactor)&&void 0!==o?o:.5),a.backoff=new Je({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==r.timeout?2e4:r.timeout),a._readyState="closed",a.uri=t;var s=r.parser||e;return a.encoder=new s.Encoder,a.decoder=new s.Decoder,a._autoConnect=!1!==r.autoConnect,a._autoConnect&&a.open(),a}return v(i,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new Ce(this.uri,this.opts);var n=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;var r=Ze(n,"open",(function(){i.onopen(),e&&e()})),a=function(n){t.cleanup(),t._readyState="closed",t.emitReserved("error",n),e?e(n):t.maybeReconnectOnOpen()},o=Ze(n,"error",a);if(!1!==this._timeout){var s=this._timeout,l=this.setTimeoutFn((function(){r(),a(new Error("timeout")),n.close()}),s);this.opts.autoUnref&&l.unref(),this.subs.push((function(){t.clearTimeoutFn(l)}))}return this.subs.push(r),this.subs.push(o),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Ze(e,"ping",this.onping.bind(this)),Ze(e,"data",this.ondata.bind(this)),Ze(e,"error",this.onerror.bind(this)),Ze(e,"close",this.onclose.bind(this)),Ze(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}},{key:"ondecoded",value:function(e){var t=this;ye((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Ye(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var i=n[t];if(this.nsps[i].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var i=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&i.unref(),this.subs.push((function(){e.clearTimeoutFn(i)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),i}(q),Ke={};function $e(e,t){"object"===typeof e&&(t=e,e=void 0);var n,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),i=Ee(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";var r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),r=i.source,a=i.id,o=i.path,s=Ke[a]&&o in Ke[a].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?n=new Qe(r,t):(Ke[a]||(Ke[a]=new Qe(r,t)),n=Ke[a]),i.query&&!t.query&&(t.query=i.queryKey),n.socket(i.path,t)}Object.assign($e,{Manager:Qe,Socket:Ye,io:$e,connect:$e});var et,tt,nt=$e(),it=!1;function rt(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function at(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){at(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lt(e){return u(e)||o(e)||s(e)||c()}function ut(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(i,r)}function ct(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){ut(a,i,r,o,s,"next",e)}function s(e){ut(a,i,r,o,s,"throw",e)}o(void 0)}))}}function ht(){ht=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var a=t&&t.prototype instanceof y?t:y,o=Object.create(a.prototype),s=new R(i||[]);return r(o,"_invoke",{value:C(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",g={};function y(){}function _(){}function x(){}var b={};u(b,o,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(L([])));S&&S!==n&&i.call(S,o)&&(b=S);var M=x.prototype=y.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(r,a,o,s){var l=h(e[r],e,a);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==d(c)&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var a;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}})}function C(t,n,i){var r=f;return function(a,o){if(r===m)throw new Error("Generator is already running");if(r===v){if("throw"===a)throw o;return{value:e,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var l=k(s,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var u=h(t,n,i);if("normal"===u.type){if(r=i.done?v:p,u.arg===g)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(r=v,i.method="throw",i.arg=u.arg)}}}function k(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var a=h(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function L(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(d(t)+" is not iterable")}return _.prototype=x,r(M,"constructor",{value:x,configurable:!0}),r(x,"constructor",{value:_,configurable:!0}),_.displayName=u(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u(e,l,"GeneratorFunction")),e.prototype=Object.create(M),e},t.awrap=function(e){return{__await:e}},T(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new E(c(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(M),u(M,l,"Generator"),u(M,o,(function(){return this})),u(M,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=L,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;A(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:L(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}var ft="156",dt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},pt={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},mt=0,vt=1,gt=2,yt=3,_t=0,xt=1,bt=2,wt=3,St=0,Mt=1,Tt=2,Et=2,Ct=0,kt=1,Pt=2,At=3,Rt=4,Lt=5,It=100,Ot=101,Dt=102,Nt=103,zt=104,Ut=200,Ft=201,Bt=202,Ht=203,jt=204,Gt=205,Vt=206,Wt=207,Xt=208,Zt=209,qt=210,Yt=0,Jt=1,Qt=2,Kt=3,$t=4,en=5,tn=6,nn=7,rn=0,an=1,on=2,sn=0,ln=1,un=2,cn=3,hn=4,fn=5,dn=300,pn=301,mn=302,vn=303,gn=304,yn=306,_n=1e3,xn=1001,bn=1002,wn=1003,Sn=1004,Mn=1004,Tn=1005,En=1005,Cn=1006,kn=1007,Pn=1007,An=1008,Rn=1008,Ln=1009,In=1010,On=1011,Dn=1012,Nn=1013,zn=1014,Un=1015,Fn=1016,Bn=1017,Hn=1018,jn=1020,Gn=1021,Vn=1023,Wn=1024,Xn=1025,Zn=1026,qn=1027,Yn=1028,Jn=1029,Qn=1030,Kn=1031,$n=1033,ei=33776,ti=33777,ni=33778,ii=33779,ri=35840,ai=35841,oi=35842,si=35843,li=36196,ui=37492,ci=37496,hi=37808,fi=37809,di=37810,pi=37811,mi=37812,vi=37813,gi=37814,yi=37815,_i=37816,xi=37817,bi=37818,wi=37819,Si=37820,Mi=37821,Ti=36492,Ei=36494,Ci=36495,ki=36283,Pi=36284,Ai=36285,Ri=36286,Li=2200,Ii=2201,Oi=2202,Di=2300,Ni=2301,zi=2302,Ui=2400,Fi=2401,Bi=2402,Hi=2500,ji=2501,Gi=0,Vi=1,Wi=2,Xi=3e3,Zi=3001,qi=3200,Yi=3201,Ji=0,Qi=1,Ki="",$i="srgb",er="srgb-linear",tr="display-p3",nr="display-p3-linear",ir=0,rr=7680,ar=7681,or=7682,sr=7683,lr=34055,ur=34056,cr=5386,hr=512,fr=513,dr=514,pr=515,mr=516,vr=517,gr=518,yr=519,_r=512,xr=513,br=514,wr=515,Sr=516,Mr=517,Tr=518,Er=519,Cr=35044,kr=35048,Pr=35040,Ar=35045,Rr=35049,Lr=35041,Ir=35046,Or=35050,Dr=35042,Nr="100",zr="300 es",Ur=1035,Fr=2e3,Br=2001,Hr=function(){function e(){f(this,e)}return v(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}}]),e}(),jr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Gr=1234567,Vr=Math.PI/180,Wr=180/Math.PI;function Xr(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(jr[255&e]+jr[e>>8&255]+jr[e>>16&255]+jr[e>>24&255]+"-"+jr[255&t]+jr[t>>8&255]+"-"+jr[t>>16&15|64]+jr[t>>24&255]+"-"+jr[63&n|128]+jr[n>>8&255]+"-"+jr[n>>16&255]+jr[n>>24&255]+jr[255&i]+jr[i>>8&255]+jr[i>>16&255]+jr[i>>24&255]).toLowerCase()}function Zr(e,t,n){return Math.max(t,Math.min(n,e))}function qr(e,t){return(e%t+t)%t}function Yr(e,t,n){return(1-n)*e+n*t}function Jr(e){return 0===(e&e-1)&&0!==e}function Qr(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Kr(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function $r(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function ea(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var ta={DEG2RAD:Vr,RAD2DEG:Wr,generateUUID:Xr,clamp:Zr,euclideanModulo:qr,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Yr,damp:function(e,t,n,i){return Yr(e,t,1-Math.exp(-n*i))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(qr(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Gr=e);var t=Gr+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Vr},radToDeg:function(e){return e*Wr},isPowerOfTwo:Jr,ceilPowerOfTwo:Qr,floorPowerOfTwo:Kr,setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),u=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),f=o((t-i)/2),d=a((i-t)/2),p=o((i-t)/2);switch(r){case"XYX":e.set(s*c,l*h,l*f,s*u);break;case"YZY":e.set(l*f,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*f,s*c,s*u);break;case"XZX":e.set(s*c,l*p,l*d,s*u);break;case"YXY":e.set(l*d,s*c,l*p,s*u);break;case"ZYZ":e.set(l*p,l*d,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:ea,denormalize:$r},na=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return v(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Zr(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(),ia=function(){function e(t,n,i,r,a,o,s,l,u){f(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,n,i,r,a,o,s,l,u)}return v(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=r,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],f=n[5],d=n[8],p=i[0],m=i[3],v=i[6],g=i[1],y=i[4],_=i[7],x=i[2],b=i[5],w=i[8];return r[0]=a*p+o*g+s*x,r[3]=a*m+o*y+s*b,r[6]=a*v+o*_+s*w,r[1]=l*p+u*g+c*x,r[4]=l*m+u*y+c*b,r[7]=l*v+u*_+c*w,r[2]=h*p+f*g+d*x,r[5]=h*m+f*y+d*b,r[8]=h*v+f*_+d*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-n*r*u+n*o*s+i*r*l-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*r,f=l*r-a*s,d=t*c+n*h+i*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var p=1/d;return e[0]=c*p,e[1]=(i*l-u*n)*p,e[2]=(o*n-i*a)*p,e[3]=h*p,e[4]=(u*t-i*s)*p,e[5]=(i*r-o*t)*p,e[6]=f*p,e[7]=(n*s-l*t)*p,e[8]=(a*t-n*r)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){return this.premultiply(ra.makeScale(e,t)),this}},{key:"rotate",value:function(e){return this.premultiply(ra.makeRotation(-e)),this}},{key:"translate",value:function(e,t){return this.premultiply(ra.makeTranslation(e,t)),this}},{key:"makeTranslation",value:function(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}},{key:"makeRotation",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}},{key:"makeScale",value:function(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}(),ra=new ia;function aa(e){for(var t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var oa={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function sa(e,t){return new oa[e](t)}function la(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ua(){var e=la("canvas");return e.style.display="block",e}var ca={};function ha(e){e in ca||(ca[e]=!0,console.warn(e))}function fa(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function da(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var pa=(new ia).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),ma=(new ia).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);var va,ga=(at(et={},er,(function(e){return e})),at(et,$i,(function(e){return e.convertSRGBToLinear()})),at(et,tr,(function(e){return e.convertSRGBToLinear().applyMatrix3(ma)})),et),ya=(at(tt={},er,(function(e){return e})),at(tt,$i,(function(e){return e.convertLinearToSRGB()})),at(tt,tr,(function(e){return e.applyMatrix3(pa).convertLinearToSRGB()})),tt),_a={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return er},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;var i=ga[t],r=ya[n];if(void 0===i||void 0===r)throw new Error('Unsupported color space conversion, "'.concat(t,'" to "').concat(n,'".'));return r(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},xa=function(){function e(){f(this,e)}return v(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===va&&(va=la("canvas")),va.width=e.width,va.height=e.height;var n=va.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=va}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=la("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var i=n.getImageData(0,0,e.width,e.height),r=i.data,a=0;a<r.length;a++)r[a]=255*fa(r[a]/255);return n.putImageData(i,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*fa(o[s]/255)):o[s]=fa(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),ba=0,wa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f(this,e),this.isSource=!0,Object.defineProperty(this,"id",{value:ba++}),this.uuid=Xr(),this.data=t,this.version=0}return v(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},i=this.data;if(null!==i){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(Sa(i[a].image)):r.push(Sa(i[a]))}else r=Sa(i);n.url=r}return t||(e.images[this.uuid]=n),n}}]),e}();function Sa(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?xa.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Ma=0,Ta=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xn,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Cn,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:An,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Vn,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Ln,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.DEFAULT_ANISOTROPY,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Ki;return f(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty(g(e),"id",{value:Ma++}),e.uuid=Xr(),e.name="",e.source=new wa(i),e.mipmaps=[],e.mapping=r,e.channel=0,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=l,e.anisotropy=h,e.format=u,e.internalFormat=null,e.type=c,e.offset=new na(0,0),e.repeat=new na(1,1),e.center=new na(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new ia,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,"string"===typeof d?e.colorSpace=d:(ha("THREE.Texture: Property .encoding has been replaced by .colorSpace."),e.colorSpace=d===Zi?$i:Ki),e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return v(n,[{key:"image",get:function(){return this.source.data},set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(this.mapping!==dn)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _n:e.x=e.x-Math.floor(e.x);break;case xn:e.x=e.x<0?0:1;break;case bn:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case _n:e.y=e.y-Math.floor(e.y);break;case xn:e.y=e.y<0?0:1;break;case bn:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}},{key:"encoding",get:function(){return ha("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===$i?Zi:Xi},set:function(e){ha("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Zi?$i:Ki}}]),n}(Hr);Ta.DEFAULT_IMAGE=null,Ta.DEFAULT_MAPPING=dn,Ta.DEFAULT_ANISOTROPY=1;var Ea=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;f(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}return v(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,l=s[0],u=s[4],c=s[8],h=s[1],f=s[5],d=s[9],p=s[2],m=s[6],v=s[10];if(Math.abs(u-h)<a&&Math.abs(c-p)<a&&Math.abs(d-m)<a){if(Math.abs(u+h)<o&&Math.abs(c+p)<o&&Math.abs(d+m)<o&&Math.abs(l+f+v-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(l+1)/2,y=(f+1)/2,_=(v+1)/2,x=(u+h)/4,b=(c+p)/4,w=(d+m)/4;return g>y&&g>_?g<a?(n=0,i=.707106781,r=.707106781):(i=x/(n=Math.sqrt(g)),r=b/n):y>_?y<a?(n=.707106781,i=0,r=.707106781):(n=x/(i=Math.sqrt(y)),r=w/i):_<a?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(_)),i=w/r),this.set(n,i,r,t),this}var S=Math.sqrt((m-d)*(m-d)+(c-p)*(c-p)+(h-u)*(h-u));return Math.abs(S)<.001&&(S=1),this.x=(m-d)/S,this.y=(c-p)/S,this.z=(h-u)/S,this.w=Math.acos((l+f+v-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(),Ca=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f(this,n),(e=t.call(this)).isRenderTarget=!0,e.width=i,e.height=r,e.depth=1,e.scissor=new Ea(0,0,i,r),e.scissorTest=!1,e.viewport=new Ea(0,0,i,r);var o={width:i,height:r,depth:1};return void 0!==a.encoding&&(ha("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),a.colorSpace=a.encoding===Zi?$i:Ki),e.texture=new Ta(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.flipY=!1,e.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,e.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,e.texture.minFilter=void 0!==a.minFilter?a.minFilter:Cn,e.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,e.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,e.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,e.samples=void 0!==a.samples?a.samples:0,e}return v(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new wa(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Hr),ka=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f(this,n),(e=t.call(this,i,r,a)).isWebGLRenderTarget=!0,e}return v(n)}(Ca),Pa=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return f(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:i,width:r,height:a,depth:o},e.magFilter=wn,e.minFilter=wn,e.wrapR=xn,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return v(n)}(Ta),Aa=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return f(this,n),(e=t.call(this,i,r)).isWebGLArrayRenderTarget=!0,e.depth=a,e.texture=new Pa(null,i,r,a),e.texture.isRenderTargetTexture=!0,e}return v(n)}(ka),Ra=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return f(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:i,width:r,height:a,depth:o},e.magFilter=wn,e.minFilter=wn,e.wrapR=xn,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return v(n)}(Ta),La=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return f(this,n),(e=t.call(this,i,r)).isWebGL3DRenderTarget=!0,e.depth=a,e.texture=new Ra(null,i,r,a),e.texture.isRenderTargetTexture=!0,e}return v(n)}(ka),Ia=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};f(this,n),(e=t.call(this,i,r,o)).isWebGLMultipleRenderTargets=!0;var s=e.texture;e.texture=[];for(var l=0;l<a;l++)e.texture[l]=s.clone(),e.texture[l].isRenderTargetTexture=!0;return e}return v(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}]),n}(ka),Oa=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;f(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}return v(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),u=o(i/2),c=o(r/2),h=s(n/2),f=s(i/2),d=s(r/2);switch(a){case"XYZ":this._x=h*u*c+l*f*d,this._y=l*f*c-h*u*d,this._z=l*u*d+h*f*c,this._w=l*u*c-h*f*d;break;case"YXZ":this._x=h*u*c+l*f*d,this._y=l*f*c-h*u*d,this._z=l*u*d-h*f*c,this._w=l*u*c+h*f*d;break;case"ZXY":this._x=h*u*c-l*f*d,this._y=l*f*c+h*u*d,this._z=l*u*d+h*f*c,this._w=l*u*c-h*f*d;break;case"ZYX":this._x=h*u*c-l*f*d,this._y=l*f*c+h*u*d,this._z=l*u*d-h*f*c,this._w=l*u*c+h*f*d;break;case"YZX":this._x=h*u*c+l*f*d,this._y=l*f*c+h*u*d,this._z=l*u*d-h*f*c,this._w=l*u*c-h*f*d;break;case"XZY":this._x=h*u*c-l*f*d,this._y=l*f*c-h*u*d,this._z=l*u*d+h*f*c,this._w=l*u*c+h*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+o+c;if(h>0){var f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-s)*f,this._y=(r-l)*f,this._z=(a-i)*f}else if(n>o&&n>c){var d=2*Math.sqrt(1+n-o-c);this._w=(u-s)/d,this._x=.25*d,this._y=(i+a)/d,this._z=(r+l)/d}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(r-l)/p,this._x=(i+a)/p,this._y=.25*p,this._z=(s+u)/p}else{var m=2*Math.sqrt(1+c-n-o);this._w=(a-i)/m,this._x=(r+l)/m,this._y=(s+u)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(Zr(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+a*o+i*l-r*s,this._y=i*u+a*s+r*o-n*l,this._z=r*u+a*l+n*s-i*o,this._w=a*u-n*o-i*s-r*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,f=Math.sin(t*c)/u;return this._w=a*h+this._w*f,this._x=n*h+this._x*f,this._y=i*h+this._y*f,this._z=r*h+this._z*f,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[a+0],f=r[a+1],d=r[a+2],p=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=f,e[t+2]=d,void(e[t+3]=p);if(c!==p||s!==h||l!==f||u!==d){var m=1-o,v=s*h+l*f+u*d+c*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),x=Math.atan2(_,v*g);m=Math.sin(m*x)/_,o=Math.sin(o*x)/_}var b=o*g;if(s=s*m+h*b,l=l*m+f*b,u=u*m+d*b,c=c*m+p*b,m===1-o){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],l=n[i+2],u=n[i+3],c=r[a],h=r[a+1],f=r[a+2],d=r[a+3];return e[t]=o*d+u*c+s*f-l*h,e[t+1]=s*d+u*h+l*c-o*f,e[t+2]=l*d+u*f+o*h-s*c,e[t+3]=u*d-o*c-s*h-l*f,e}}]),t}(),Da=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}return v(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(za.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(za.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,u=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=l*s+h*-r+u*-o-c*-a,this.y=u*s+h*-a+c*-r-l*-o,this.z=c*s+h*-o+l*-a-u*-r,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Na.copy(this).projectOnVector(e),this.sub(Na)}},{key:"reflect",value:function(e){return this.sub(Na.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Zr(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"setFromColor",value:function(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),Na=new Da,za=new Oa,Ua=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da(-1/0,-1/0,-1/0);f(this,e),this.isBox3=!0,this.min=t,this.max=n}return v(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t+=3)this.expandByPoint(Ba.fromArray(e,t));return this}},{key:"setFromBufferAttribute",value:function(e){this.makeEmpty();for(var t=0,n=e.count;t<n;t++)this.expandByPoint(Ba.fromBufferAttribute(e,t));return this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Ba.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Ha.copy(e.boundingBox),Ha.applyMatrix4(e.matrixWorld),this.union(Ha);else{var n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position)for(var i=n.attributes.position,r=0,a=i.count;r<a;r++)Ba.fromBufferAttribute(i,r).applyMatrix4(e.matrixWorld),this.expandByPoint(Ba);else null===n.boundingBox&&n.computeBoundingBox(),Ha.copy(n.boundingBox),Ha.applyMatrix4(e.matrixWorld),this.union(Ha)}for(var o=e.children,s=0,l=o.length;s<l;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Ba),Ba.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(qa),Ya.subVectors(this.max,qa),ja.subVectors(e.a,qa),Ga.subVectors(e.b,qa),Va.subVectors(e.c,qa),Wa.subVectors(Ga,ja),Xa.subVectors(Va,Ga),Za.subVectors(ja,Va);var t=[0,-Wa.z,Wa.y,0,-Xa.z,Xa.y,0,-Za.z,Za.y,Wa.z,0,-Wa.x,Xa.z,0,-Xa.x,Za.z,0,-Za.x,-Wa.y,Wa.x,0,-Xa.y,Xa.x,0,-Za.y,Za.x,0];return!!Ka(t,ja,Ga,Va,Ya)&&(!!Ka(t=[1,0,0,0,1,0,0,0,1],ja,Ga,Va,Ya)&&(Ja.crossVectors(Wa,Xa),Ka(t=[Ja.x,Ja.y,Ja.z],ja,Ga,Va,Ya)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return this.clampPoint(e,Ba).distanceTo(e)}},{key:"getBoundingSphere",value:function(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Ba).length()),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(Fa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fa)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Fa=[new Da,new Da,new Da,new Da,new Da,new Da,new Da,new Da],Ba=new Da,Ha=new Ua,ja=new Da,Ga=new Da,Va=new Da,Wa=new Da,Xa=new Da,Za=new Da,qa=new Da,Ya=new Da,Ja=new Da,Qa=new Da;function Ka(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){Qa.fromArray(e,a);var s=r.x*Math.abs(Qa.x)+r.y*Math.abs(Qa.y)+r.z*Math.abs(Qa.z),l=t.dot(Qa),u=n.dot(Qa),c=i.dot(Qa);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}var $a=new Ua,eo=new Da,to=new Da,no=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;f(this,e),this.center=t,this.radius=n}return v(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):$a.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;eo.subVectors(e,this.center);var t=eo.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=.5*(n-this.radius);this.center.addScaledVector(eo,i/n),this.radius+=i}return this}},{key:"union",value:function(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(to.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(eo.copy(e.center).add(to)),this.expandByPoint(eo.copy(e.center).sub(to))),this)}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),io=new Da,ro=new Da,ao=new Da,oo=new Da,so=new Da,lo=new Da,uo=new Da,co=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da(0,0,-1);f(this,e),this.origin=t,this.direction=n}return v(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,io)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=io.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(io.copy(this.origin).addScaledVector(this.direction,t),io.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){ro.copy(e).add(t).multiplyScalar(.5),ao.copy(t).sub(e).normalize(),oo.copy(this.origin).sub(ro);var r,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(ao),c=oo.dot(this.direction),h=-oo.dot(ao),f=oo.lengthSq(),d=Math.abs(1-u*u);if(d>0)if(a=u*c-h,s=l*d,(r=u*h-c)>=0)if(a>=-s)if(a<=s){var p=1/d;o=(r*=p)*(r+u*(a*=p)+2*c)+a*(u*r+a+2*h)+f}else a=l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+f;else a=-l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+f;else a<=-s?o=-(r=Math.max(0,-(-u*l+c)))*r+(a=r>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+f:a<=s?(r=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+f):o=-(r=Math.max(0,-(u*l+c)))*r+(a=r>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+f;else a=u>0?-l:l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+f;return n&&n.copy(this.origin).addScaledVector(this.direction,r),i&&i.copy(ro).addScaledVector(ao,a),o}},{key:"intersectSphere",value:function(e,t){io.subVectors(e.center,this.origin);var n=io.dot(this.direction),i=io.dot(io)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,io)}},{key:"intersectTriangle",value:function(e,t,n,i,r){so.subVectors(t,e),lo.subVectors(n,e),uo.crossVectors(so,lo);var a,o=this.direction.dot(uo);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}oo.subVectors(this.origin,e);var s=a*this.direction.dot(lo.crossVectors(oo,lo));if(s<0)return null;var l=a*this.direction.dot(so.cross(oo));if(l<0)return null;if(s+l>o)return null;var u=-a*oo.dot(uo);return u<0?null:this.at(u/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),ho=function(){function e(t,n,i,r,a,o,s,l,u,c,h,d,p,m,v,g){f(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,n,i,r,a,o,s,l,u,c,h,d,p,m,v,g)}return v(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,l,u,c,h,f,d,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=i,v[1]=r,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/fo.setFromMatrixColumn(e,0).length(),r=1/fo.setFromMatrixColumn(e,1).length(),a=1/fo.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*u,f=a*c,d=o*u,p=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=f+d*l,t[5]=h-p*l,t[9]=-o*s,t[2]=p-h*l,t[6]=d+f*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,v=s*c,g=l*u,y=l*c;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var _=s*u,x=s*c,b=l*u,w=l*c;t[0]=_-w*o,t[4]=-a*c,t[8]=b+x*o,t[1]=x+b*o,t[5]=a*u,t[9]=w-_*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var S=a*u,M=a*c,T=o*u,E=o*c;t[0]=s*u,t[4]=T*l-M,t[8]=S*l+E,t[1]=s*c,t[5]=E*l+S,t[9]=M*l-T,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var C=a*s,k=a*l,P=o*s,A=o*l;t[0]=s*u,t[4]=A-C*c,t[8]=P*c+k,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=k*c+P,t[10]=C-A*c}else if("XZY"===e.order){var R=a*s,L=a*l,I=o*s,O=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=R*c+O,t[5]=a*u,t[9]=L*c-I,t[2]=I*c-L,t[6]=o*u,t[10]=O*c+R}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(mo,e,vo)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return _o.subVectors(e,t),0===_o.lengthSq()&&(_o.z=1),_o.normalize(),go.crossVectors(n,_o),0===go.lengthSq()&&(1===Math.abs(n.z)?_o.x+=1e-4:_o.z+=1e-4,_o.normalize(),go.crossVectors(n,_o)),go.normalize(),yo.crossVectors(_o,go),i[0]=go.x,i[4]=yo.x,i[8]=_o.x,i[1]=go.y,i[5]=yo.y,i[9]=_o.y,i[2]=go.z,i[6]=yo.z,i[10]=_o.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],_=n[11],x=n[15],b=i[0],w=i[4],S=i[8],M=i[12],T=i[1],E=i[5],C=i[9],k=i[13],P=i[2],A=i[6],R=i[10],L=i[14],I=i[3],O=i[7],D=i[11],N=i[15];return r[0]=a*b+o*T+s*P+l*I,r[4]=a*w+o*E+s*A+l*O,r[8]=a*S+o*C+s*R+l*D,r[12]=a*M+o*k+s*L+l*N,r[1]=u*b+c*T+h*P+f*I,r[5]=u*w+c*E+h*A+f*O,r[9]=u*S+c*C+h*R+f*D,r[13]=u*M+c*k+h*L+f*N,r[2]=d*b+p*T+m*P+v*I,r[6]=d*w+p*E+m*A+v*O,r[10]=d*S+p*C+m*R+v*D,r[14]=d*M+p*k+m*L+v*N,r[3]=g*b+y*T+_*P+x*I,r[7]=g*w+y*E+_*A+x*O,r[11]=g*S+y*C+_*R+x*D,r[15]=g*M+y*k+_*L+x*N,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],f=e[14];return e[3]*(+r*s*c-i*l*c-r*o*h+n*l*h+i*o*f-n*s*f)+e[7]*(+t*s*f-t*l*h+r*a*h-i*a*f+i*l*u-r*s*u)+e[11]*(+t*l*c-t*o*f-r*a*c+n*a*f+r*o*u-n*l*u)+e[15]*(-i*o*u-t*s*c+t*o*h+i*a*c-n*a*h+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],v=e[15],g=c*m*l-p*h*l+p*s*f-o*m*f-c*s*v+o*h*v,y=d*h*l-u*m*l-d*s*f+a*m*f+u*s*v-a*h*v,_=u*p*l-d*c*l+d*o*f-a*p*f-u*o*v+a*c*v,x=d*c*s-u*p*s-d*o*h+a*p*h+u*o*m-a*c*m,b=t*g+n*y+i*_+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/b;return e[0]=g*w,e[1]=(p*h*r-c*m*r-p*i*f+n*m*f+c*i*v-n*h*v)*w,e[2]=(o*m*r-p*s*r+p*i*l-n*m*l-o*i*v+n*s*v)*w,e[3]=(c*s*r-o*h*r-c*i*l+n*h*l+o*i*f-n*s*f)*w,e[4]=y*w,e[5]=(u*m*r-d*h*r+d*i*f-t*m*f-u*i*v+t*h*v)*w,e[6]=(d*s*r-a*m*r-d*i*l+t*m*l+a*i*v-t*s*v)*w,e[7]=(a*h*r-u*s*r+u*i*l-t*h*l-a*i*f+t*s*f)*w,e[8]=_*w,e[9]=(d*c*r-u*p*r-d*n*f+t*p*f+u*n*v-t*c*v)*w,e[10]=(a*p*r-d*o*r+d*n*l-t*p*l-a*n*v+t*o*v)*w,e[11]=(u*o*r-a*c*r-u*n*l+t*c*l+a*n*f-t*o*f)*w,e[12]=x*w,e[13]=(u*p*i-d*c*i+d*n*h-t*p*h-u*n*m+t*c*m)*w,e[14]=(d*o*i-a*p*i-d*n*s+t*p*s+a*n*m-t*o*m)*w,e[15]=(a*c*i-u*o*i+u*n*s-t*c*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}},{key:"makeTranslation",value:function(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,u=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,u*o+n,u*s-i*a,0,l*s-i*o,u*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,u=a+a,c=o+o,h=r*l,f=r*u,d=r*c,p=a*u,m=a*c,v=o*c,g=s*l,y=s*u,_=s*c,x=n.x,b=n.y,w=n.z;return i[0]=(1-(p+v))*x,i[1]=(f+_)*x,i[2]=(d-y)*x,i[3]=0,i[4]=(f-_)*b,i[5]=(1-(h+v))*b,i[6]=(m+g)*b,i[7]=0,i[8]=(d+y)*w,i[9]=(m-g)*w,i[10]=(1-(h+p))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=fo.set(i[0],i[1],i[2]).length(),a=fo.set(i[4],i[5],i[6]).length(),o=fo.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],po.copy(this);var s=1/r,l=1/a,u=1/o;return po.elements[0]*=s,po.elements[1]*=s,po.elements[2]*=s,po.elements[4]*=l,po.elements[5]*=l,po.elements[6]*=l,po.elements[8]*=u,po.elements[9]*=u,po.elements[10]*=u,t.setFromRotationMatrix(po),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){var o,s,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Fr,u=this.elements,c=2*r/(t-e),h=2*r/(n-i),f=(t+e)/(t-e),d=(n+i)/(n-i);if(l===Fr)o=-(a+r)/(a-r),s=-2*a*r/(a-r);else{if(l!==Br)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);o=-a/(a-r),s=-a*r/(a-r)}return u[0]=c,u[4]=0,u[8]=f,u[12]=0,u[1]=0,u[5]=h,u[9]=d,u[13]=0,u[2]=0,u[6]=0,u[10]=o,u[14]=s,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o,s,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Fr,u=this.elements,c=1/(t-e),h=1/(n-i),f=1/(a-r),d=(t+e)*c,p=(n+i)*h;if(l===Fr)o=(a+r)*f,s=-2*f;else{if(l!==Br)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);o=r*f,s=-1*f}return u[0]=2*c,u[4]=0,u[8]=0,u[12]=-d,u[1]=0,u[5]=2*h,u[9]=0,u[13]=-p,u[2]=0,u[6]=0,u[10]=s,u[14]=-o,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),fo=new Da,po=new ho,mo=new Da(0,0,0),vo=new Da(1,1,1),go=new Da,yo=new Da,_o=new Da,xo=new ho,bo=new Oa,wo=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;f(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}return v(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],u=i[9],c=i[2],h=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(Zr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Zr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(Zr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Zr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Zr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Zr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return xo.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xo,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return bo.setFromEuler(this),this.setFromQuaternion(bo,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))}]),t}();wo.DEFAULT_ORDER="XYZ";var So=function(){function e(){f(this,e),this.mask=1}return v(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),Mo=0,To=new Da,Eo=new Oa,Co=new ho,ko=new Da,Po=new Da,Ao=new Da,Ro=new Oa,Lo=new Da(1,0,0),Io=new Da(0,1,0),Oo=new Da(0,0,1),Do={type:"added"},No={type:"removed"},zo=function(e){_(n,e);var t=w(n);function n(){var e;f(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty(g(e),"id",{value:Mo++}),e.uuid=Xr(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DEFAULT_UP.clone();var i=new Da,r=new wo,a=new Oa,o=new Da(1,1,1);return r._onChange((function(){a.setFromEuler(r,!1)})),a._onChange((function(){r.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(g(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new ho},normalMatrix:{value:new ia}}),e.matrix=new ho,e.matrixWorld=new ho,e.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,e.matrixWorldNeedsUpdate=!1,e.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,e.layers=new So,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return v(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Eo.setFromAxisAngle(e,t),this.quaternion.multiply(Eo),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Eo.setFromAxisAngle(e,t),this.quaternion.premultiply(Eo),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Lo,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(Io,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Oo,e)}},{key:"translateOnAxis",value:function(e,t){return To.copy(e).applyQuaternion(this.quaternion),this.position.add(To.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Lo,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(Io,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Oo,e)}},{key:"localToWorld",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Co.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?ko.copy(e):ko.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),Po.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Co.lookAt(Po,ko,this.up):Co.lookAt(ko,Po,this.up),this.quaternion.setFromRotationMatrix(Co),i&&(Co.extractRotation(i.matrixWorld),Eo.setFromRotationMatrix(Co),this.quaternion.premultiply(Eo.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Do)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(No)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){return this.remove.apply(this,l(this.children))}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Co.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Co.multiply(e.parent.matrixWorld)),e.applyMatrix4(Co),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getObjectsByProperty",value:function(e,t){var n=[];this[e]===t&&n.push(this);for(var i=0,r=this.children.length;i<r;i++){var a=this.children[i].getObjectsByProperty(e,t);a.length>0&&(n=n.concat(a))}return n}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Po,e,Ao),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Po,Ro,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++){var r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++){var o=i[r];!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!1,!0)}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];r(e.shapes,u)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,f=this.material.length;h<f;h++)c.push(r(e.materials,this.material[h]));i.material=c}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var d=0;d<this.children.length;d++)i.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var p=0;p<this.animations.length;p++){var m=this.animations[p];i.animations.push(r(e.animations,m))}}if(t){var v=M(e.geometries),g=M(e.materials),y=M(e.textures),_=M(e.images),x=M(e.shapes),b=M(e.skeletons),w=M(e.animations),S=M(e.nodes);v.length>0&&(n.geometries=v),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),_.length>0&&(n.images=_),x.length>0&&(n.shapes=x),b.length>0&&(n.skeletons=b),w.length>0&&(n.animations=w),S.length>0&&(n.nodes=S)}return n.object=i,n;function M(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}]),n}(Hr);zo.DEFAULT_UP=new Da(0,1,0),zo.DEFAULT_MATRIX_AUTO_UPDATE=!0,zo.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Uo=new Da,Fo=new Da,Bo=new Da,Ho=new Da,jo=new Da,Go=new Da,Vo=new Da,Wo=new Da,Xo=new Da,Zo=new Da,qo=!1,Yo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Da;f(this,e),this.a=t,this.b=n,this.c=i}return v(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Uo.subVectors(this.c,this.b),Fo.subVectors(this.a,this.b),.5*Uo.cross(Fo).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,i,r,a){return!1===qo&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qo=!0),e.getInterpolation(t,this.a,this.b,this.c,n,i,r,a)}},{key:"getInterpolation",value:function(t,n,i,r,a){return e.getInterpolation(t,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,i,r=this.a,a=this.b,o=this.c;jo.subVectors(a,r),Go.subVectors(o,r),Wo.subVectors(e,r);var s=jo.dot(Wo),l=Go.dot(Wo);if(s<=0&&l<=0)return t.copy(r);Xo.subVectors(e,a);var u=jo.dot(Xo),c=Go.dot(Xo);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(r).addScaledVector(jo,n);Zo.subVectors(e,o);var f=jo.dot(Zo),d=Go.dot(Zo);if(d>=0&&f<=d)return t.copy(o);var p=f*l-s*d;if(p<=0&&l>=0&&d<=0)return i=l/(l-d),t.copy(r).addScaledVector(Go,i);var m=u*d-f*c;if(m<=0&&c-u>=0&&f-d>=0)return Vo.subVectors(o,a),i=(c-u)/(c-u+(f-d)),t.copy(a).addScaledVector(Vo,i);var v=1/(m+p+h);return n=p*v,i=h*v,t.copy(r).addScaledVector(jo,n).addScaledVector(Go,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){i.subVectors(n,t),Uo.subVectors(e,t),i.cross(Uo);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){Uo.subVectors(i,t),Fo.subVectors(n,t),Bo.subVectors(e,t);var a=Uo.dot(Uo),o=Uo.dot(Fo),s=Uo.dot(Bo),l=Fo.dot(Fo),u=Fo.dot(Bo),c=a*l-o*o;if(0===c)return r.set(-2,-1,-1);var h=1/c,f=(l*s-o*u)*h,d=(a*u-o*s)*h;return r.set(1-f-d,d,f)}},{key:"containsPoint",value:function(e,t,n,i){return this.getBarycoord(e,t,n,i,Ho),Ho.x>=0&&Ho.y>=0&&Ho.x+Ho.y<=1}},{key:"getUV",value:function(e,t,n,i,r,a,o,s){return!1===qo&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qo=!0),this.getInterpolation(e,t,n,i,r,a,o,s)}},{key:"getInterpolation",value:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,Ho),s.setScalar(0),s.addScaledVector(r,Ho.x),s.addScaledVector(a,Ho.y),s.addScaledVector(o,Ho.z),s}},{key:"isFrontFacing",value:function(e,t,n,i){return Uo.subVectors(n,t),Fo.subVectors(e,t),Uo.cross(Fo).dot(i)<0}}]),e}(),Jo=0,Qo=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty(g(e),"id",{value:Jo++}),e.uuid=Xr(),e.name="",e.type="Material",e.blending=kt,e.side=St,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.alphaHash=!1,e.blendSrc=jt,e.blendDst=Gt,e.blendEquation=It,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=Kt,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=yr,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=rr,e.stencilZFail=rr,e.stencilZPass=rr,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.forceSinglePass=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return v(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}else console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."))}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==kt&&(n.blending=this.blending),this.side!==St&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(Hr),Ko={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$o={h:0,s:0,l:0},es={h:0,s:0,l:0};function ts(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}var ns=function(e){function t(e,n,i){return f(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}return v(t,[{key:"set",value:function(e,t,n){if(void 0===t&&void 0===n){var i=e;i&&i.isColor?this.copy(i):"number"===typeof i?this.setHex(i):"string"===typeof i&&this.setStyle(i)}else this.setRGB(e,t,n);return this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$i;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,_a.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_a.workingColorSpace;return this.r=e,this.g=t,this.b=n,_a.toWorkingColorSpace(this,i),this}},{key:"setHSL",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_a.workingColorSpace;if(e=qr(e,1),t=Zr(t,0,1),n=Zr(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=ts(a,r,e+1/3),this.g=ts(a,r,e),this.b=ts(a,r,e-1/3)}return _a.toWorkingColorSpace(this,i),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$i;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){var r,a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var s=t[1],l=s.length;if(3===l)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(6===l)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$i,n=Ko[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=fa(e.r),this.g=fa(e.g),this.b=fa(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=da(e.r),this.g=da(e.g),this.b=da(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$i;return _a.fromWorkingColorSpace(is.copy(this),e),65536*Math.round(Zr(255*is.r,0,255))+256*Math.round(Zr(255*is.g,0,255))+Math.round(Zr(255*is.b,0,255))}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$i;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_a.workingColorSpace;_a.fromWorkingColorSpace(is.copy(this),t);var n,i,r=is.r,a=is.g,o=is.b,s=Math.max(r,a,o),l=Math.min(r,a,o),u=(l+s)/2;if(l===s)n=0,i=0;else{var c=s-l;switch(i=u<=.5?c/(s+l):c/(2-s-l),s){case r:n=(a-o)/c+(a<o?6:0);break;case a:n=(o-r)/c+2;break;case o:n=(r-a)/c+4}n/=6}return e.h=n,e.s=i,e.l=u,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_a.workingColorSpace;return _a.fromWorkingColorSpace(is.copy(this),t),e.r=is.r,e.g=is.g,e.b=is.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$i;_a.fromWorkingColorSpace(is.copy(this),e);var t=is.r,n=is.g,i=is.b;return e!==$i?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*i),")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL($o),$o.h+=e,$o.s+=t,$o.l+=n,this.setHSL($o.h,$o.s,$o.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL($o),e.getHSL(es);var n=Yr($o.h,es.h,t),i=Yr($o.s,es.s,t),r=Yr($o.l,es.l,t);return this.setHSL(n,i,r),this}},{key:"setFromVector3",value:function(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}},{key:"applyMatrix3",value:function(e){var t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),is=new ns;ns.NAMES=Ko;var rs=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshBasicMaterial=!0,i.type="MeshBasicMaterial",i.color=new ns(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=rn,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(Qo),as=os();function os(){for(var e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512),a=0;a<256;++a){var o=a-127;o<-27?(i[a]=0,i[256|a]=32768,r[a]=24,r[256|a]=24):o<-14?(i[a]=1024>>-o-14,i[256|a]=1024>>-o-14|32768,r[a]=-o-1,r[256|a]=-o-1):o<=15?(i[a]=o+15<<10,i[256|a]=o+15<<10|32768,r[a]=13,r[256|a]=13):o<128?(i[a]=31744,i[256|a]=64512,r[a]=24,r[256|a]=24):(i[a]=31744,i[256|a]=64512,r[a]=13,r[256|a]=13)}for(var s=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64),c=1;c<1024;++c){for(var h=c<<13,f=0;0===(8388608&h);)h<<=1,f-=8388608;h&=-8388609,f+=947912704,s[c]=h|f}for(var d=1024;d<2048;++d)s[d]=939524096+(d-1024<<13);for(var p=1;p<31;++p)l[p]=p<<23;l[31]=1199570944,l[32]=2147483648;for(var m=33;m<63;++m)l[m]=2147483648+(m-32<<23);l[63]=3347054592;for(var v=1;v<64;++v)32!==v&&(u[v]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:l,offsetTable:u}}function ss(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Zr(e,-65504,65504),as.floatView[0]=e;var t=as.uint32View[0],n=t>>23&511;return as.baseTable[n]+((8388607&t)>>as.shiftTable[n])}function ls(e){var t=e>>10;return as.uint32View[0]=as.mantissaTable[as.offsetTable[t]+(1023&e)]+as.exponentTable[t],as.floatView[0]}var us={toHalfFloat:ss,fromHalfFloat:ls},cs=new Da,hs=new na,fs=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(f(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=i,this.usage=Cr,this.updateRange={offset:0,count:-1},this.gpuType=Un,this.version=0}return v(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)hs.fromBufferAttribute(this,t),hs.applyMatrix3(e),this.setXY(t,hs.x,hs.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)cs.fromBufferAttribute(this,i),cs.applyMatrix3(e),this.setXYZ(i,cs.x,cs.y,cs.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)cs.fromBufferAttribute(this,t),cs.applyMatrix4(e),this.setXYZ(t,cs.x,cs.y,cs.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)cs.fromBufferAttribute(this,t),cs.applyNormalMatrix(e),this.setXYZ(t,cs.x,cs.y,cs.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)cs.fromBufferAttribute(this,t),cs.transformDirection(e),this.setXYZ(t,cs.x,cs.y,cs.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getComponent",value:function(e,t){var n=this.array[e*this.itemSize+t];return this.normalized&&(n=$r(n,this.array)),n}},{key:"setComponent",value:function(e,t,n){return this.normalized&&(n=ea(n,this.array)),this.array[e*this.itemSize+t]=n,this}},{key:"getX",value:function(e){var t=this.array[e*this.itemSize];return this.normalized&&(t=$r(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){var t=this.array[e*this.itemSize+1];return this.normalized&&(t=$r(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){var t=this.array[e*this.itemSize+2];return this.normalized&&(t=$r(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){var t=this.array[e*this.itemSize+3];return this.normalized&&(t=$r(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array),i=ea(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array),i=ea(i,this.array),r=ea(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Cr&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}(),ds=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Int8Array(e),i,r)}return v(n)}(fs),ps=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Uint8Array(e),i,r)}return v(n)}(fs),ms=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Uint8ClampedArray(e),i,r)}return v(n)}(fs),vs=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Int16Array(e),i,r)}return v(n)}(fs),gs=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Uint16Array(e),i,r)}return v(n)}(fs),ys=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Int32Array(e),i,r)}return v(n)}(fs),_s=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Uint32Array(e),i,r)}return v(n)}(fs),xs=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,new Uint16Array(e),i,r)).isFloat16BufferAttribute=!0,a}return v(n,[{key:"getX",value:function(e){var t=ls(this.array[e*this.itemSize]);return this.normalized&&(t=$r(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize]=ss(t),this}},{key:"getY",value:function(e){var t=ls(this.array[e*this.itemSize+1]);return this.normalized&&(t=$r(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize+1]=ss(t),this}},{key:"getZ",value:function(e){var t=ls(this.array[e*this.itemSize+2]);return this.normalized&&(t=$r(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize+2]=ss(t),this}},{key:"getW",value:function(e){var t=ls(this.array[e*this.itemSize+3]);return this.normalized&&(t=$r(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.array[e*this.itemSize+3]=ss(t),this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array)),this.array[e+0]=ss(t),this.array[e+1]=ss(n),this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array),i=ea(i,this.array)),this.array[e+0]=ss(t),this.array[e+1]=ss(n),this.array[e+2]=ss(i),this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array),i=ea(i,this.array),r=ea(r,this.array)),this.array[e+0]=ss(t),this.array[e+1]=ss(n),this.array[e+2]=ss(i),this.array[e+3]=ss(r),this}}]),n}(fs),bs=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Float32Array(e),i,r)}return v(n)}(fs),ws=function(e){_(n,e);var t=w(n);function n(e,i,r){return f(this,n),t.call(this,new Float64Array(e),i,r)}return v(n)}(fs),Ss=0,Ms=new ho,Ts=new zo,Es=new Da,Cs=new Ua,ks=new Ua,Ps=new Da,As=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty(g(e),"id",{value:Ss++}),e.uuid=Xr(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return v(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(aa(e)?_s:gs)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new ia).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return Ms.makeRotationFromQuaternion(e),this.applyMatrix4(Ms),this}},{key:"rotateX",value:function(e){return Ms.makeRotationX(e),this.applyMatrix4(Ms),this}},{key:"rotateY",value:function(e){return Ms.makeRotationY(e),this.applyMatrix4(Ms),this}},{key:"rotateZ",value:function(e){return Ms.makeRotationZ(e),this.applyMatrix4(Ms),this}},{key:"translate",value:function(e,t,n){return Ms.makeTranslation(e,t,n),this.applyMatrix4(Ms),this}},{key:"scale",value:function(e,t,n){return Ms.makeScale(e,t,n),this.applyMatrix4(Ms),this}},{key:"lookAt",value:function(e){return Ts.lookAt(e),Ts.updateMatrix(),this.applyMatrix4(Ts.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Es).negate(),this.translate(Es.x,Es.y,Es.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new bs(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Ua);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Da(-1/0,-1/0,-1/0),new Da(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];Cs.setFromBufferAttribute(r),this.morphTargetsRelative?(Ps.addVectors(this.boundingBox.min,Cs.min),this.boundingBox.expandByPoint(Ps),Ps.addVectors(this.boundingBox.max,Cs.max),this.boundingBox.expandByPoint(Ps)):(this.boundingBox.expandByPoint(Cs.min),this.boundingBox.expandByPoint(Cs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new no);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Da,1/0);if(e){var n=this.boundingSphere.center;if(Cs.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];ks.setFromBufferAttribute(a),this.morphTargetsRelative?(Ps.addVectors(Cs.min,ks.min),Cs.expandByPoint(Ps),Ps.addVectors(Cs.max,ks.max),Cs.expandByPoint(Ps)):(Cs.expandByPoint(ks.min),Cs.expandByPoint(ks.max))}Cs.getCenter(n);for(var o=0,s=0,l=e.count;s<l;s++)Ps.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(Ps));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],f=this.morphTargetsRelative,d=0,p=h.count;d<p;d++)Ps.fromBufferAttribute(h,d),f&&(Es.fromBufferAttribute(e,d),Ps.add(Es)),o=Math.max(o,n.distanceToSquared(Ps));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new fs(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,l=[],u=[],c=0;c<o;c++)l[c]=new Da,u[c]=new Da;var h=new Da,f=new Da,d=new Da,p=new na,m=new na,v=new na,g=new Da,y=new Da,_=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(var x=0,b=_.length;x<b;++x)for(var w=_[x],S=w.start,M=S,T=S+w.count;M<T;M+=3)N(n[M+0],n[M+1],n[M+2]);for(var E=new Da,C=new Da,k=new Da,P=new Da,A=0,R=_.length;A<R;++A)for(var L=_[A],I=L.start,O=I,D=I+L.count;O<D;O+=3)z(n[O+0]),z(n[O+1]),z(n[O+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function N(e,t,n){h.fromArray(i,3*e),f.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(a,2*e),m.fromArray(a,2*t),v.fromArray(a,2*n),f.sub(h),d.sub(h),m.sub(p),v.sub(p);var r=1/(m.x*v.y-v.x*m.y);isFinite(r)&&(g.copy(f).multiplyScalar(v.y).addScaledVector(d,-m.y).multiplyScalar(r),y.copy(d).multiplyScalar(m.x).addScaledVector(f,-v.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),u[e].add(y),u[t].add(y),u[n].add(y))}function z(e){k.fromArray(r,3*e),P.copy(k);var t=l[e];E.copy(t),E.sub(k.multiplyScalar(k.dot(t))).normalize(),C.crossVectors(P,t);var n=C.dot(u[e])<0?-1:1;s[4*e]=E.x,s[4*e+1]=E.y,s[4*e+2]=E.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new fs(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new Da,o=new Da,s=new Da,l=new Da,u=new Da,c=new Da,h=new Da,f=new Da;if(e)for(var d=0,p=e.count;d<p;d+=3){var m=e.getX(d+0),v=e.getX(d+1),g=e.getX(d+2);a.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),h.subVectors(s,o),f.subVectors(a,o),h.cross(f),l.fromBufferAttribute(n,m),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,g),l.add(h),u.add(h),c.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var y=0,_=t.count;y<_;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),f.subVectors(a,o),h.cross(f),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Ps.fromBufferAttribute(e,t),Ps.normalize(),e.setXYZ(t,Ps.x,Ps.y,Ps.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,l=0,u=t.length;l<u;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(var c=0;c<i;c++)a[s++]=n[o++]}return new fs(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,i=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],i);t.setAttribute(a,o)}var s=this.morphAttributes;for(var l in s){for(var u=[],c=s[l],h=0,f=c.length;h<f;h++){var d=e(c[h],i);u.push(d)}t.morphAttributes[l]=u}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,m=0,v=p.length;m<v;m++){var g=p[m];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},l=!1;for(var u in this.morphAttributes){for(var c=this.morphAttributes[u],h=[],f=0,d=c.length;f<d;f++){var p=c[f];h.push(p.toJSON(e.data))}h.length>0&&(s[u]=h,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var m=this.groups;m.length>0&&(e.data.groups=JSON.parse(JSON.stringify(m)));var v=this.boundingSphere;return null!==v&&(e.data.boundingSphere={center:v.center.toArray(),radius:v.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var f=e.groups,d=0,p=f.length;d<p;d++){var m=f[d];this.addGroup(m.start,m.count,m.materialIndex)}var v=e.boundingBox;null!==v&&(this.boundingBox=v.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Hr),Rs=new ho,Ls=new co,Is=new no,Os=new Da,Ds=new Da,Ns=new Da,zs=new Da,Us=new Da,Fs=new Da,Bs=new na,Hs=new na,js=new na,Gs=new Da,Vs=new Da,Ws=new Da,Xs=new Da,Zs=new Da,qs=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new As,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rs;return f(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}},{key:"getVertexPosition",value:function(e,t){var n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);var o=this.morphTargetInfluences;if(r&&o){Fs.set(0,0,0);for(var s=0,l=r.length;s<l;s++){var u=o[s],c=r[s];0!==u&&(Us.fromBufferAttribute(c,e),a?Fs.addScaledVector(Us,u):Fs.addScaledVector(Us.sub(t),u))}t.add(Fs)}return t}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Is.copy(n.boundingSphere),Is.applyMatrix4(r),Ls.copy(e.ray).recast(e.near),!1===Is.containsPoint(Ls.origin)){if(null===Ls.intersectSphere(Is,Os))return;if(Ls.origin.distanceToSquared(Os)>Math.pow(e.far-e.near,2))return}Rs.copy(r).invert(),Ls.copy(e.ray).applyMatrix4(Rs),null!==n.boundingBox&&!1===Ls.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Ls)}}},{key:"_computeIntersections",value:function(e,t,n){var i,r=this.geometry,a=this.material,o=r.index,s=r.attributes.position,l=r.attributes.uv,u=r.attributes.uv1,c=r.attributes.normal,h=r.groups,f=r.drawRange;if(null!==o)if(Array.isArray(a))for(var d=0,p=h.length;d<p;d++)for(var m=h[d],v=a[m.materialIndex],g=Math.max(m.start,f.start),y=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));g<y;g+=3){(i=Ys(this,v,e,n,l,u,c,o.getX(g),o.getX(g+1),o.getX(g+2)))&&(i.faceIndex=Math.floor(g/3),i.face.materialIndex=m.materialIndex,t.push(i))}else for(var _=Math.max(0,f.start),x=Math.min(o.count,f.start+f.count);_<x;_+=3){(i=Ys(this,a,e,n,l,u,c,o.getX(_),o.getX(_+1),o.getX(_+2)))&&(i.faceIndex=Math.floor(_/3),t.push(i))}else if(void 0!==s)if(Array.isArray(a))for(var b=0,w=h.length;b<w;b++)for(var S=h[b],M=a[S.materialIndex],T=Math.max(S.start,f.start),E=Math.min(s.count,Math.min(S.start+S.count,f.start+f.count));T<E;T+=3){(i=Ys(this,M,e,n,l,u,c,T,T+1,T+2))&&(i.faceIndex=Math.floor(T/3),i.face.materialIndex=S.materialIndex,t.push(i))}else for(var C=Math.max(0,f.start),k=Math.min(s.count,f.start+f.count);C<k;C+=3){(i=Ys(this,a,e,n,l,u,c,C,C+1,C+2))&&(i.faceIndex=Math.floor(C/3),t.push(i))}}}]),n}(zo);function Ys(e,t,n,i,r,a,o,s,l,u){e.getVertexPosition(s,Ds),e.getVertexPosition(l,Ns),e.getVertexPosition(u,zs);var c=function(e,t,n,i,r,a,o,s){if(null===(t.side===Mt?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,t.side===St,s)))return null;Zs.copy(s),Zs.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Zs);return l<n.near||l>n.far?null:{distance:l,point:Zs.clone(),object:e}}(e,t,n,i,Ds,Ns,zs,Xs);if(c){r&&(Bs.fromBufferAttribute(r,s),Hs.fromBufferAttribute(r,l),js.fromBufferAttribute(r,u),c.uv=Yo.getInterpolation(Xs,Ds,Ns,zs,Bs,Hs,js,new na)),a&&(Bs.fromBufferAttribute(a,s),Hs.fromBufferAttribute(a,l),js.fromBufferAttribute(a,u),c.uv1=Yo.getInterpolation(Xs,Ds,Ns,zs,Bs,Hs,js,new na),c.uv2=c.uv1),o&&(Gs.fromBufferAttribute(o,s),Vs.fromBufferAttribute(o,l),Ws.fromBufferAttribute(o,u),c.normal=Yo.getInterpolation(Xs,Ds,Ns,zs,Gs,Vs,Ws,new Da),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));var h={a:s,b:l,c:u,normal:new Da,materialIndex:0};Yo.getNormal(Ds,Ns,zs,h.normal),c.face=h}return c}var Js=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;f(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:l};var u=g(e);o=Math.floor(o),s=Math.floor(s),l=Math.floor(l);var c=[],h=[],d=[],p=[],m=0,v=0;function y(e,t,n,i,r,a,o,s,l,f,g){for(var y=a/l,_=o/f,x=a/2,b=o/2,w=s/2,S=l+1,M=f+1,T=0,E=0,C=new Da,k=0;k<M;k++)for(var P=k*_-b,A=0;A<S;A++){var R=A*y-x;C[e]=R*i,C[t]=P*r,C[n]=w,h.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=s>0?1:-1,d.push(C.x,C.y,C.z),p.push(A/l),p.push(1-k/f),T+=1}for(var L=0;L<f;L++)for(var I=0;I<l;I++){var O=m+I+S*L,D=m+I+S*(L+1),N=m+(I+1)+S*(L+1),z=m+(I+1)+S*L;c.push(O,D,z),c.push(D,N,z),E+=6}u.addGroup(v,E,g),v+=E,m+=T}return y("z","y","x",-1,-1,a,r,i,l,s,0),y("z","y","x",1,-1,a,r,-i,l,s,1),y("x","z","y",1,1,i,a,r,o,l,2),y("x","z","y",1,-1,i,a,-r,o,l,3),y("x","y","z",1,-1,i,r,a,o,s,4),y("x","y","z",-1,-1,i,r,-a,o,s,5),e.setIndex(c),e.setAttribute("position",new bs(h,3)),e.setAttribute("normal",new bs(d,3)),e.setAttribute("uv",new bs(p,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(As);function Qs(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function Ks(e){for(var t={},n=0;n<e.length;n++){var i=Qs(e[n]);for(var r in i)t[r]=i[r]}return t}function $s(e){return null===e.getRenderTarget()?e.outputColorSpace:er}var el={clone:Qs,merge:Ks},tl=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isShaderMaterial=!0,i.type="ShaderMaterial",i.defines={},i.uniforms={},i.uniformsGroups=[],i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.forceSinglePass=!0,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qs(e.uniforms),this.uniformsGroups=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(Qo),nl=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new ho,e.projectionMatrix=new ho,e.projectionMatrixInverse=new ho,e.coordinateSystem=Fr,e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){S(x(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){S(x(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(zo),il=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return f(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=r,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Wr*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*Vr*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*Wr*Math.atan(Math.tan(.5*Vr*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*Vr*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(nl),rl=-90,al=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;f(this,n),(a=t.call(this)).type="CubeCamera",a.renderTarget=r,a.coordinateSystem=null;var o=new il(rl,1,e,i);o.layers=a.layers,a.add(o);var s=new il(rl,1,e,i);s.layers=a.layers,a.add(s);var l=new il(rl,1,e,i);l.layers=a.layers,a.add(l);var u=new il(rl,1,e,i);u.layers=a.layers,a.add(u);var c=new il(rl,1,e,i);c.layers=a.layers,a.add(c);var h=new il(rl,1,e,i);return h.layers=a.layers,a.add(h),a}return v(n,[{key:"updateCoordinateSystem",value:function(){var e,t=this.coordinateSystem,n=this.children.concat(),i=h(n,6),r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],u=i[5],c=ke(n);try{for(c.s();!(e=c.n()).done;){var f=e.value;this.remove(f)}}catch(lA){c.e(lA)}finally{c.f()}if(t===Fr)r.up.set(0,1,0),r.lookAt(1,0,0),a.up.set(0,1,0),a.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else{if(t!==Br)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);r.up.set(0,-1,0),r.lookAt(-1,0,0),a.up.set(0,-1,0),a.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1)}var d,p=ke(n);try{for(p.s();!(d=p.n()).done;){var m=d.value;this.add(m),m.updateMatrixWorld()}}catch(lA){p.e(lA)}finally{p.f()}}},{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());var i=h(this.children,6),r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],u=i[5],c=e.getRenderTarget(),f=e.xr.enabled;e.xr.enabled=!1;var d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(c),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}]),n}(zo),ol=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s,l,u,c,h){var d;return f(this,n),e=void 0!==e?e:[],i=void 0!==i?i:pn,(d=t.call(this,e,i,r,a,o,s,l,u,c,h)).isCubeTexture=!0,d.flipY=!1,d}return v(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Ta),sl=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,n),(e=t.call(this,i,i,r)).isWebGLCubeRenderTarget=!0;var a={width:i,height:i,depth:1},o=[a,a,a,a,a,a];return void 0!==r.encoding&&(ha("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===Zi?$i:Ki),e.texture=new ol(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,e.texture.minFilter=void 0!==r.minFilter?r.minFilter:Cn,e}return v(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Js(5,5,5),o=new tl({name:"CubemapFromEquirect",uniforms:Qs(n),vertexShader:i,fragmentShader:r,side:Mt,blending:Ct});o.uniforms.tEquirect.value=t;var s=new qs(a,o),l=t.minFilter;return t.minFilter===An&&(t.minFilter=Cn),new al(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),n}(ka),ll=new Da,ul=new Da,cl=new ia,hl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return v(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=ll.subVectors(n,t).cross(ul.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}},{key:"intersectLine",value:function(e,t){var n=e.delta(ll),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||cl.getNormalMatrix(e),i=this.coplanarPoint(ll).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),fl=new no,dl=new Da,pl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hl,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hl,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new hl,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new hl,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new hl,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new hl;f(this,e),this.planes=[t,n,i,r,a,o]}return v(e,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fr,n=this.planes,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],f=i[8],d=i[9],p=i[10],m=i[11],v=i[12],g=i[13],y=i[14],_=i[15];if(n[0].setComponents(s-r,h-l,m-f,_-v).normalize(),n[1].setComponents(s+r,h+l,m+f,_+v).normalize(),n[2].setComponents(s+a,h+u,m+d,_+g).normalize(),n[3].setComponents(s-a,h-u,m-d,_-g).normalize(),n[4].setComponents(s-o,h-c,m-p,_-y).normalize(),t===Fr)n[5].setComponents(s+o,h+c,m+p,_+y).normalize();else{if(t!==Br)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,c,p,y).normalize()}return this}},{key:"intersectsObject",value:function(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),fl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),fl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(fl)}},{key:"intersectsSprite",value:function(e){return fl.center.set(0,0,0),fl.radius=.7071067811865476,fl.applyMatrix4(e.matrixWorld),this.intersectsSphere(fl)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(dl.x=i.normal.x>0?e.max.x:e.min.x,dl.y=i.normal.y>0?e.max.y:e.min.y,dl.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(dl)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function ml(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function vl(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var a=i.get(t);(!a||a.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=i.get(t);void 0===o?i.set(t,function(t,i){var r,a=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(i,s),e.bufferData(i,a,o),t.onUploadCallback(),a instanceof Float32Array)r=e.FLOAT;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=e.HALF_FLOAT}else r=e.UNSIGNED_SHORT;else if(a instanceof Int16Array)r=e.SHORT;else if(a instanceof Uint32Array)r=e.UNSIGNED_INT;else if(a instanceof Int32Array)r=e.INT;else if(a instanceof Int8Array)r=e.BYTE;else if(a instanceof Uint8Array)r=e.UNSIGNED_BYTE;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);r=e.UNSIGNED_BYTE}return{buffer:s,type:r,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(!function(t,i,r){var a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(o.buffer,t,r),o.version=t.version)}}}}var gl=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;f(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,l=r/2,u=Math.floor(a),c=Math.floor(o),h=u+1,d=c+1,p=i/u,m=r/c,v=[],g=[],y=[],_=[],x=0;x<d;x++)for(var b=x*m-l,w=0;w<h;w++){var S=w*p-s;g.push(S,-b,0),y.push(0,0,1),_.push(w/u),_.push(1-x/c)}for(var M=0;M<c;M++)for(var T=0;T<u;T++){var E=T+h*M,C=T+h*(M+1),k=T+1+h*(M+1),P=T+1+h*M;v.push(E,C,P),v.push(C,k,P)}return e.setIndex(v),e.setAttribute("position",new bs(g,3)),e.setAttribute("normal",new bs(y,3)),e.setAttribute("uv",new bs(_,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(As),yl={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},_l={common:{diffuse:{value:new ns(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ia},alphaMap:{value:null},alphaMapTransform:{value:new ia},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ia}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ia}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ia}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ia},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ia},normalScale:{value:new na(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ia},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ia}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ia}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ia}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ns(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ns(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ia},alphaTest:{value:0},uvTransform:{value:new ia}},sprite:{diffuse:{value:new ns(16777215)},opacity:{value:1},center:{value:new na(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ia},alphaMap:{value:null},alphaMapTransform:{value:new ia},alphaTest:{value:0}}},xl={basic:{uniforms:Ks([_l.common,_l.specularmap,_l.envmap,_l.aomap,_l.lightmap,_l.fog]),vertexShader:yl.meshbasic_vert,fragmentShader:yl.meshbasic_frag},lambert:{uniforms:Ks([_l.common,_l.specularmap,_l.envmap,_l.aomap,_l.lightmap,_l.emissivemap,_l.bumpmap,_l.normalmap,_l.displacementmap,_l.fog,_l.lights,{emissive:{value:new ns(0)}}]),vertexShader:yl.meshlambert_vert,fragmentShader:yl.meshlambert_frag},phong:{uniforms:Ks([_l.common,_l.specularmap,_l.envmap,_l.aomap,_l.lightmap,_l.emissivemap,_l.bumpmap,_l.normalmap,_l.displacementmap,_l.fog,_l.lights,{emissive:{value:new ns(0)},specular:{value:new ns(1118481)},shininess:{value:30}}]),vertexShader:yl.meshphong_vert,fragmentShader:yl.meshphong_frag},standard:{uniforms:Ks([_l.common,_l.envmap,_l.aomap,_l.lightmap,_l.emissivemap,_l.bumpmap,_l.normalmap,_l.displacementmap,_l.roughnessmap,_l.metalnessmap,_l.fog,_l.lights,{emissive:{value:new ns(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yl.meshphysical_vert,fragmentShader:yl.meshphysical_frag},toon:{uniforms:Ks([_l.common,_l.aomap,_l.lightmap,_l.emissivemap,_l.bumpmap,_l.normalmap,_l.displacementmap,_l.gradientmap,_l.fog,_l.lights,{emissive:{value:new ns(0)}}]),vertexShader:yl.meshtoon_vert,fragmentShader:yl.meshtoon_frag},matcap:{uniforms:Ks([_l.common,_l.bumpmap,_l.normalmap,_l.displacementmap,_l.fog,{matcap:{value:null}}]),vertexShader:yl.meshmatcap_vert,fragmentShader:yl.meshmatcap_frag},points:{uniforms:Ks([_l.points,_l.fog]),vertexShader:yl.points_vert,fragmentShader:yl.points_frag},dashed:{uniforms:Ks([_l.common,_l.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yl.linedashed_vert,fragmentShader:yl.linedashed_frag},depth:{uniforms:Ks([_l.common,_l.displacementmap]),vertexShader:yl.depth_vert,fragmentShader:yl.depth_frag},normal:{uniforms:Ks([_l.common,_l.bumpmap,_l.normalmap,_l.displacementmap,{opacity:{value:1}}]),vertexShader:yl.meshnormal_vert,fragmentShader:yl.meshnormal_frag},sprite:{uniforms:Ks([_l.sprite,_l.fog]),vertexShader:yl.sprite_vert,fragmentShader:yl.sprite_frag},background:{uniforms:{uvTransform:{value:new ia},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yl.background_vert,fragmentShader:yl.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:yl.backgroundCube_vert,fragmentShader:yl.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yl.cube_vert,fragmentShader:yl.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yl.equirect_vert,fragmentShader:yl.equirect_frag},distanceRGBA:{uniforms:Ks([_l.common,_l.displacementmap,{referencePosition:{value:new Da},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yl.distanceRGBA_vert,fragmentShader:yl.distanceRGBA_frag},shadow:{uniforms:Ks([_l.lights,_l.fog,{color:{value:new ns(0)},opacity:{value:1}}]),vertexShader:yl.shadow_vert,fragmentShader:yl.shadow_frag}};xl.physical={uniforms:Ks([xl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ia},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ia},clearcoatNormalScale:{value:new na(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ia},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ia},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ia},sheen:{value:0},sheenColor:{value:new ns(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ia},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ia},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ia},transmissionSamplerSize:{value:new na},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ia},attenuationDistance:{value:0},attenuationColor:{value:new ns(0)},specularColor:{value:new ns(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ia},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ia},anisotropyVector:{value:new na},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ia}}]),vertexShader:yl.meshphysical_vert,fragmentShader:yl.meshphysical_frag};var bl={r:0,b:0,g:0};function wl(e,t,n,i,r,a,o){var s,l,u=new ns(0),c=!0===a?0:1,h=null,f=0,d=null;function p(t,n){t.getRGB(bl,$s(e)),i.buffers.color.setClear(bl.r,bl.g,bl.b,n,o)}return{getClearColor:function(){return u},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u.set(e),p(u,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){p(u,c=e)},render:function(a,m){var v=!1,g=!0===m.isScene?m.background:null;g&&g.isTexture&&(g=(m.backgroundBlurriness>0?n:t).get(g)),null===g?p(u,c):g&&g.isColor&&(p(g,1),v=!0);var y=e.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,o),(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===yn)?(void 0===l&&((l=new qs(new Js(1,1,1),new tl({name:"BackgroundCubeMaterial",uniforms:Qs(xl.backgroundCube.uniforms),vertexShader:xl.backgroundCube.vertexShader,fragmentShader:xl.backgroundCube.fragmentShader,side:Mt,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=g,l.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=g.colorSpace!==$i,h===g&&f===g.version&&d===e.toneMapping||(l.material.needsUpdate=!0,h=g,f=g.version,d=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null)):g&&g.isTexture&&(void 0===s&&((s=new qs(new gl(2,2),new tl({name:"BackgroundMaterial",uniforms:Qs(xl.background.uniforms),vertexShader:xl.background.vertexShader,fragmentShader:xl.background.fragmentShader,side:St,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=g,s.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,s.material.toneMapped=g.colorSpace!==$i,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),h===g&&f===g.version&&d===e.toneMapping||(s.material.needsUpdate=!0,h=g,f=g.version,d=e.toneMapping),s.layers.enableAll(),a.unshift(s,s.geometry,s.material,0,0,null))}}}function Sl(e,t,n,i){var r=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},l=d(null),u=l,c=!1;function h(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function f(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],i=[],a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function m(e){v(e,0)}function v(n,r){var a=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function g(){for(var t=u.newAttributes,n=u.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function y(t,n,i,r,a,o,s){!0===s?e.vertexAttribIPointer(t,n,i,a,o):e.vertexAttribPointer(t,n,i,r,a,o)}function _(){x(),c=!0,u!==l&&h((u=l).object)}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,f,_,x){var b=!1;if(o){var w=function(t,n,r){var o=!0===r.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var u=l[n.id];void 0===u&&(u={},l[n.id]=u);var c=u[o];void 0===c&&(c=d(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[o]=c);return c}(_,f,l);u!==w&&h((u=w).object),b=function(e,t,n,i){var r=u.attributes,a=t.attributes,o=0,s=n.getAttributes();for(var l in s){if(s[l].location>=0){var c=r[l],h=a[l];if(void 0===h&&("instanceMatrix"===l&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(h=e.instanceColor)),void 0===c)return!0;if(c.attribute!==h)return!0;if(h&&c.data!==h.data)return!0;o++}}return u.attributesNum!==o||u.index!==i}(r,_,f,x),b&&function(e,t,n,i){var r={},a=t.attributes,o=0,s=n.getAttributes();for(var l in s){if(s[l].location>=0){var c=a[l];void 0===c&&("instanceMatrix"===l&&e.instanceMatrix&&(c=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(c=e.instanceColor));var h={};h.attribute=c,c&&c.data&&(h.data=c.data),r[l]=h,o++}}u.attributes=r,u.attributesNum=o,u.index=i}(r,_,f,x)}else{var S=!0===l.wireframe;u.geometry===_.id&&u.program===f.id&&u.wireframe===S||(u.geometry=_.id,u.program=f.id,u.wireframe=S,b=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(b||c)&&(c=!1,function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(var h in u){var f=u[h];if(f.location>=0){var d=l[h];if(void 0===d&&("instanceMatrix"===h&&r.instanceMatrix&&(d=r.instanceMatrix),"instanceColor"===h&&r.instanceColor&&(d=r.instanceColor)),void 0!==d){var _=d.normalized,x=d.itemSize,b=n.get(d);if(void 0===b)continue;var w=b.buffer,S=b.type,M=b.bytesPerElement,T=!0===i.isWebGL2&&(S===e.INT||S===e.UNSIGNED_INT||d.gpuType===Nn);if(d.isInterleavedBufferAttribute){var E=d.data,C=E.stride,k=d.offset;if(E.isInstancedInterleavedBuffer){for(var P=0;P<f.locationSize;P++)v(f.location+P,E.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=E.meshPerAttribute*E.count)}else for(var A=0;A<f.locationSize;A++)m(f.location+A);e.bindBuffer(e.ARRAY_BUFFER,w);for(var R=0;R<f.locationSize;R++)y(f.location+R,x/f.locationSize,S,_,C*M,(k+x/f.locationSize*R)*M,T)}else{if(d.isInstancedBufferAttribute){for(var L=0;L<f.locationSize;L++)v(f.location+L,d.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=d.meshPerAttribute*d.count)}else for(var I=0;I<f.locationSize;I++)m(f.location+I);e.bindBuffer(e.ARRAY_BUFFER,w);for(var O=0;O<f.locationSize;O++)y(f.location+O,x/f.locationSize,S,_,x*M,x/f.locationSize*O*M,T)}}else if(void 0!==c){var D=c[h];if(void 0!==D)switch(D.length){case 2:e.vertexAttrib2fv(f.location,D);break;case 3:e.vertexAttrib3fv(f.location,D);break;case 4:e.vertexAttrib4fv(f.location,D);break;default:e.vertexAttrib1fv(f.location,D)}}}}g()}(r,l,f,_),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:_,resetDefaultState:x,dispose:function(){for(var e in _(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)f(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)f(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)f(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:g}}function Ml(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var l,u;if(a)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](r,i,o,s),n.update(o,r,s)}}}function Tl(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=a||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),v=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=h>0,_=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function El(e){var t=this,n=null,i=0,r=!1,a=!1,o=new hl,s=new ia,l={value:null,needsUpdate:!1};function u(e,n,i,r){var a=null!==e?e.length:0,u=null;if(0!==a){if(u=l.value,!0!==r||null===u){var c=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var f=0,d=i;f!==a;++f,d+=4)o.copy(e[f]).applyMatrix4(h,s),o.normal.toArray(u,d),u[d+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(o,s,c){var h=o.clippingPlanes,f=o.clipIntersection,d=o.clipShadows,p=e.get(o);if(!r||null===h||0===h.length||a&&!d)a?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{var m=a?0:i,v=4*m,g=p.clippingState||null;l.value=g,g=u(h,s,v,c);for(var y=0;y!==v;++y)g[y]=n[y];p.clippingState=g,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=m}}}function Cl(e){var t=new WeakMap;function n(e,t){return t===vn?e.mapping=pn:t===gn&&(e.mapping=mn),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping;if(a===vn||a===gn){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=new sl(o.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}var kl=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return f(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=r,e.top=a,e.bottom=o,e.near=s,e.far=l,e.updateProjectionMatrix(),e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=l*this.view.offsetX)+l*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(nl),Pl=[.125,.215,.35,.446,.526,.582],Al=20,Rl=new kl,Ll=new ns,Il=null,Ol=(1+Math.sqrt(5))/2,Dl=1/Ol,Nl=[new Da(1,1,1),new Da(-1,1,1),new Da(1,1,-1),new Da(-1,1,-1),new Da(0,Ol,Dl),new Da(0,Ol,-Dl),new Da(Dl,0,Ol),new Da(-Dl,0,Ol),new Da(Ol,Dl,0),new Da(-Ol,Dl,0)],zl=function(){function e(t){f(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return v(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Il=this._renderer.getRenderTarget(),this._setSize(256);var r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=Hl(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=Bl(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(Il),e.scissorTest=!1,Fl(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===pn||e.mapping===mn?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Il=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Cn,minFilter:Cn,generateMipmaps:!1,type:Fn,format:Vn,colorSpace:er,depthBuffer:!1},i=Ul(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ul(e,t,n);var r=this._lodMax,a=function(e){for(var t=[],n=[],i=[],r=e,a=e-4+1+Pl.length,o=0;o<a;o++){var s=Math.pow(2,r);n.push(s);var l=1/s;o>e-4?l=Pl[o-e+4-1]:0===o&&(l=0),i.push(l);for(var u=1/(s-2),c=-u,h=1+u,f=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,m=3,v=2,g=1,y=new Float32Array(m*p*d),_=new Float32Array(v*p*d),x=new Float32Array(g*p*d),b=0;b<d;b++){var w=b%3*2/3-1,S=b>2?0:-1,M=[w,S,0,w+2/3,S,0,w+2/3,S+1,0,w,S,0,w+2/3,S+1,0,w,S+1,0];y.set(M,m*p*b),_.set(f,v*p*b);var T=[b,b,b,b,b,b];x.set(T,g*p*b)}var E=new As;E.setAttribute("position",new fs(y,m)),E.setAttribute("uv",new fs(_,v)),E.setAttribute("faceIndex",new fs(x,g)),t.push(E),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(r);this._sizeLods=a.sizeLods,this._lodPlanes=a.lodPlanes,this._sigmas=a.sigmas,this._blurMaterial=function(e,t,n){var i=new Float32Array(Al),r=new Da(0,1,0),a=new tl({name:"SphericalGaussianBlur",defines:{n:Al,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Ct,depthTest:!1,depthWrite:!1});return a}(r,e,t)}return i}},{key:"_compileMaterial",value:function(e){var t=new qs(this._lodPlanes[0],e);this._renderer.compile(t,Rl)}},{key:"_sceneToCubeUV",value:function(e,t,n,i){var r=new il(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,u=s.toneMapping;s.getClearColor(Ll),s.toneMapping=sn,s.autoClear=!1;var c=new rs({name:"PMREM.Background",side:Mt,depthWrite:!1,depthTest:!1}),h=new qs(new Js,c),f=!1,d=e.background;d?d.isColor&&(c.color.copy(d),e.background=null,f=!0):(c.color.copy(Ll),f=!0);for(var p=0;p<6;p++){var m=p%3;0===m?(r.up.set(0,a[p],0),r.lookAt(o[p],0,0)):1===m?(r.up.set(0,0,a[p]),r.lookAt(0,o[p],0)):(r.up.set(0,a[p],0),r.lookAt(0,0,o[p]));var v=this._cubeSize;Fl(i,m*v,p>2?v:0,v,v),s.setRenderTarget(i),f&&s.render(h,r),s.render(e,r)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=u,s.autoClear=l,e.background=d}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,i=e.mapping===pn||e.mapping===mn;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Hl()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Bl());var r=i?this._cubemapMaterial:this._equirectMaterial,a=new qs(this._lodPlanes[0],r);r.uniforms.envMap.value=e;var o=this._cubeSize;Fl(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,Rl)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=1;i<this._lodPlanes.length;i++){var r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),a=Nl[(i-1)%Nl.length];this._blur(e,i-1,i,r,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}},{key:"_halfBlur",value:function(e,t,n,i,r,a,o){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var u=new qs(this._lodPlanes[i],l),c=l.uniforms,h=this._sizeLods[n]-1,f=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,d=r/f,p=isFinite(r)?1+Math.floor(3*d):Al;p>Al&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(Al));for(var m=[],v=0,g=0;g<Al;++g){var y=g/d,_=Math.exp(-y*y/2);m.push(_),0===g?v+=_:g<p&&(v+=2*_)}for(var x=0;x<m.length;x++)m[x]=m[x]/v;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);var b=this._lodMax;c.dTheta.value=f,c.mipInt.value=b-n;var w=this._sizeLods[i];Fl(t,3*w*(i>b-4?i-b+4:0),4*(this._cubeSize-w),3*w,2*w),s.setRenderTarget(t),s.render(u,Rl)}}]),e}();function Ul(e,t,n){var i=new ka(e,t,n);return i.texture.mapping=yn,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Fl(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Bl(){return new tl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Ct,depthTest:!1,depthWrite:!1})}function Hl(){return new tl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Ct,depthTest:!1,depthWrite:!1})}function jl(e){var t=new WeakMap,n=null;function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping,o=a===vn||a===gn,s=a===pn||a===mn;if(o||s){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;var l=t.get(r);return null===n&&(n=new zl(e)),l=o?n.fromEquirectangular(r,l):n.fromCubemap(r,l),t.set(r,l),l.texture}if(t.has(r))return t.get(r).texture;var u=r.image;if(o&&u&&u.height>0||s&&u&&function(e){for(var t=0,n=6,i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(u)){null===n&&(n=new zl(e));var c=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,c),r.addEventListener("dispose",i),c.texture}return null}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Gl(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Vl(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);for(var u in s.morphAttributes)for(var c=s.morphAttributes[u],h=0,f=c.length;h<f;h++)t.remove(c[h]);s.removeEventListener("dispose",o),delete r[s.id];var d=a.get(s);d&&(t.remove(d),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],f=s[l+2];n.push(c,h,h,f,f,c)}}else{if(void 0===r)return;var d=r.array;o=r.version;for(var p=0,m=d.length/3-1;p<m;p+=3){var v=p+0,g=p+1,y=p+2;n.push(v,g,g,y,y,v)}}var _=new(aa(n)?_s:gs)(n,1);_.version=o;var x=a.get(e);x&&t.remove(x),a.set(e,_)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(n){var i=n.attributes;for(var r in i)t.update(i[r],e.ARRAY_BUFFER);var a=n.morphAttributes;for(var o in a)for(var s=a[o],l=0,u=s.length;l<u;l++)t.update(s[l],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Wl(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,l,u){if(0!==u){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,l,a,i*o,u),n.update(l,r,u)}}}function Xl(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Zl(e,t){return e[0]-t[0]}function ql(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Yl(e,t,n){for(var i={},r=new Float32Array(8),a=new WeakMap,o=new Ea,s=[],l=0;l<8;l++)s[l]=[l,0];return{update:function(l,u,c){var h=l.morphTargetInfluences;if(!0===t.isWebGL2){var f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,d=void 0!==f?f.length:0,p=a.get(u);if(void 0===p||p.count!==d){void 0!==p&&p.texture.dispose();var m=void 0!==u.morphAttributes.position,v=void 0!==u.morphAttributes.normal,g=void 0!==u.morphAttributes.color,y=u.morphAttributes.position||[],_=u.morphAttributes.normal||[],x=u.morphAttributes.color||[],b=0;!0===m&&(b=1),!0===v&&(b=2),!0===g&&(b=3);var w=u.attributes.position.count*b,S=1;w>t.maxTextureSize&&(S=Math.ceil(w/t.maxTextureSize),w=t.maxTextureSize);var M=new Float32Array(w*S*4*d),T=new Pa(M,w,S,d);T.type=Un,T.needsUpdate=!0;for(var E=4*b,C=0;C<d;C++)for(var k=y[C],P=_[C],A=x[C],R=w*S*4*C,L=0;L<k.count;L++){var I=L*E;!0===m&&(o.fromBufferAttribute(k,L),M[R+I+0]=o.x,M[R+I+1]=o.y,M[R+I+2]=o.z,M[R+I+3]=0),!0===v&&(o.fromBufferAttribute(P,L),M[R+I+4]=o.x,M[R+I+5]=o.y,M[R+I+6]=o.z,M[R+I+7]=0),!0===g&&(o.fromBufferAttribute(A,L),M[R+I+8]=o.x,M[R+I+9]=o.y,M[R+I+10]=o.z,M[R+I+11]=4===A.itemSize?o.w:1)}p={count:d,texture:T,size:new na(w,S)},a.set(u,p),u.addEventListener("dispose",(function e(){T.dispose(),a.delete(u),u.removeEventListener("dispose",e)}))}for(var O=0,D=0;D<h.length;D++)O+=h[D];var N=u.morphTargetsRelative?1:1-O;c.getUniforms().setValue(e,"morphTargetBaseInfluence",N),c.getUniforms().setValue(e,"morphTargetInfluences",h),c.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),c.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{var z=void 0===h?0:h.length,U=i[u.id];if(void 0===U||U.length!==z){U=[];for(var F=0;F<z;F++)U[F]=[F,0];i[u.id]=U}for(var B=0;B<z;B++){var H=U[B];H[0]=B,H[1]=h[B]}U.sort(ql);for(var j=0;j<8;j++)j<z&&U[j][1]?(s[j][0]=U[j][0],s[j][1]=U[j][1]):(s[j][0]=Number.MAX_SAFE_INTEGER,s[j][1]=0);s.sort(Zl);for(var G=u.morphAttributes.position,V=u.morphAttributes.normal,W=0,X=0;X<8;X++){var Z=s[X],q=Z[0],Y=Z[1];q!==Number.MAX_SAFE_INTEGER&&Y?(G&&u.getAttribute("morphTarget"+X)!==G[q]&&u.setAttribute("morphTarget"+X,G[q]),V&&u.getAttribute("morphNormal"+X)!==V[q]&&u.setAttribute("morphNormal"+X,V[q]),r[X]=Y,W+=Y):(G&&!0===u.hasAttribute("morphTarget"+X)&&u.deleteAttribute("morphTarget"+X),V&&!0===u.hasAttribute("morphNormal"+X)&&u.deleteAttribute("morphNormal"+X),r[X]=0)}var J=u.morphTargetsRelative?1:1-W;c.getUniforms().setValue(e,"morphTargetBaseInfluence",J),c.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Jl(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){var s=i.render.frame,l=o.geometry,u=t.get(o,l);if(r.get(u)!==s&&(t.update(u),r.set(u,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),r.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),r.set(o,s))),o.isSkinnedMesh){var c=o.skeleton;r.get(c)!==s&&(c.update(),r.set(c,s))}return u},dispose:function(){r=new WeakMap}}}var Ql=new Ta,Kl=new Pa,$l=new Ra,eu=new ol,tu=[],nu=[],iu=new Float32Array(16),ru=new Float32Array(9),au=new Float32Array(4);function ou(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=tu[r];if(void 0===a&&(a=new Float32Array(r),tu[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function su(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function lu(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function uu(e,t){var n=nu[t];void 0===n&&(n=new Int32Array(t),nu[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function cu(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function hu(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(su(n,t))return;e.uniform2fv(this.addr,t),lu(n,t)}}function fu(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(su(n,t))return;e.uniform3fv(this.addr,t),lu(n,t)}}function du(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(su(n,t))return;e.uniform4fv(this.addr,t),lu(n,t)}}function pu(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(su(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),lu(n,t)}else{if(su(n,i))return;au.set(i),e.uniformMatrix2fv(this.addr,!1,au),lu(n,i)}}function mu(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(su(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),lu(n,t)}else{if(su(n,i))return;ru.set(i),e.uniformMatrix3fv(this.addr,!1,ru),lu(n,i)}}function vu(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(su(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),lu(n,t)}else{if(su(n,i))return;iu.set(i),e.uniformMatrix4fv(this.addr,!1,iu),lu(n,i)}}function gu(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function yu(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(su(n,t))return;e.uniform2iv(this.addr,t),lu(n,t)}}function _u(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(su(n,t))return;e.uniform3iv(this.addr,t),lu(n,t)}}function xu(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(su(n,t))return;e.uniform4iv(this.addr,t),lu(n,t)}}function bu(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function wu(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(su(n,t))return;e.uniform2uiv(this.addr,t),lu(n,t)}}function Su(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(su(n,t))return;e.uniform3uiv(this.addr,t),lu(n,t)}}function Mu(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(su(n,t))return;e.uniform4uiv(this.addr,t),lu(n,t)}}function Tu(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||Ql,r)}function Eu(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||$l,r)}function Cu(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||eu,r)}function ku(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Kl,r)}function Pu(e,t){e.uniform1fv(this.addr,t)}function Au(e,t){var n=ou(t,this.size,2);e.uniform2fv(this.addr,n)}function Ru(e,t){var n=ou(t,this.size,3);e.uniform3fv(this.addr,n)}function Lu(e,t){var n=ou(t,this.size,4);e.uniform4fv(this.addr,n)}function Iu(e,t){var n=ou(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ou(e,t){var n=ou(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Du(e,t){var n=ou(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Nu(e,t){e.uniform1iv(this.addr,t)}function zu(e,t){e.uniform2iv(this.addr,t)}function Uu(e,t){e.uniform3iv(this.addr,t)}function Fu(e,t){e.uniform4iv(this.addr,t)}function Bu(e,t){e.uniform1uiv(this.addr,t)}function Hu(e,t){e.uniform2uiv(this.addr,t)}function ju(e,t){e.uniform3uiv(this.addr,t)}function Gu(e,t){e.uniform4uiv(this.addr,t)}function Vu(e,t,n){var i=this.cache,r=t.length,a=uu(n,r);su(i,a)||(e.uniform1iv(this.addr,a),lu(i,a));for(var o=0;o!==r;++o)n.setTexture2D(t[o]||Ql,a[o])}function Wu(e,t,n){var i=this.cache,r=t.length,a=uu(n,r);su(i,a)||(e.uniform1iv(this.addr,a),lu(i,a));for(var o=0;o!==r;++o)n.setTexture3D(t[o]||$l,a[o])}function Xu(e,t,n){var i=this.cache,r=t.length,a=uu(n,r);su(i,a)||(e.uniform1iv(this.addr,a),lu(i,a));for(var o=0;o!==r;++o)n.setTextureCube(t[o]||eu,a[o])}function Zu(e,t,n){var i=this.cache,r=t.length,a=uu(n,r);su(i,a)||(e.uniform1iv(this.addr,a),lu(i,a));for(var o=0;o!==r;++o)n.setTexture2DArray(t[o]||Kl,a[o])}var qu=v((function e(t,n,i){f(this,e),this.id=t,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return cu;case 35664:return hu;case 35665:return fu;case 35666:return du;case 35674:return pu;case 35675:return mu;case 35676:return vu;case 5124:case 35670:return gu;case 35667:case 35671:return yu;case 35668:case 35672:return _u;case 35669:case 35673:return xu;case 5125:return bu;case 36294:return wu;case 36295:return Su;case 36296:return Mu;case 35678:case 36198:case 36298:case 36306:case 35682:return Tu;case 35679:case 36299:case 36307:return Eu;case 35680:case 36300:case 36308:case 36293:return Cu;case 36289:case 36303:case 36311:case 36292:return ku}}(n.type)})),Yu=v((function e(t,n,i){f(this,e),this.id=t,this.addr=i,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return Pu;case 35664:return Au;case 35665:return Ru;case 35666:return Lu;case 35674:return Iu;case 35675:return Ou;case 35676:return Du;case 5124:case 35670:return Nu;case 35667:case 35671:return zu;case 35668:case 35672:return Uu;case 35669:case 35673:return Fu;case 5125:return Bu;case 36294:return Hu;case 36295:return ju;case 36296:return Gu;case 35678:case 36198:case 36298:case 36306:case 35682:return Vu;case 35679:case 36299:case 36307:return Wu;case 35680:case 36300:case 36308:case 36293:return Xu;case 36289:case 36303:case 36311:case 36292:return Zu}}(n.type)})),Ju=function(){function e(t){f(this,e),this.id=t,this.seq=[],this.map={}}return v(e,[{key:"setValue",value:function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}}}]),e}(),Qu=/(\w+)(\])?(\[|\.)?/g;function Ku(e,t){e.seq.push(t),e.map[t.id]=t}function $u(e,t,n){var i=e.name,r=i.length;for(Qu.lastIndex=0;;){var a=Qu.exec(i),o=Qu.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===r){Ku(n,void 0===u?new qu(s,e,t):new Yu(s,e,t));break}var c=n.map[s];void 0===c&&Ku(n,c=new Ju(s)),n=c}}var ec=function(){function e(t,n){f(this,e),this.seq=[],this.map={};for(var i=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),r=0;r<i;++r){var a=t.getActiveUniform(n,r);$u(a,t.getUniformLocation(n,a.name),this)}}return v(e,[{key:"setValue",value:function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)}},{key:"setOptional",value:function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)}}],[{key:"upload",value:function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n}}]),e}();function tc(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}var nc=0;function ic(e,t,n){var i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";var a=/ERROR: 0:(\d+)/.exec(r);if(a){var o=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){for(var n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length),o=r;o<a;o++){var s=o+1;i.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return i.join("\n")}(e.getShaderSource(t),o)}return r}function rc(e,t){var n=function(e){switch(e){case er:return["Linear","( value )"];case $i:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ac(e,t){var n;switch(t){case ln:n="Linear";break;case un:n="Reinhard";break;case cn:n="OptimizedCineon";break;case hn:n="ACESFilmic";break;case fn:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function oc(e){return""!==e}function sc(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function lc(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var uc=/^[ \t]*#include +<([\w\d./]+)>/gm;function cc(e){return e.replace(uc,fc)}var hc=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function fc(e,t){var n=yl[t];if(void 0===n){var i=hc.get(t);if(void 0===i)throw new Error("Can not resolve #include <"+t+">");n=yl[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,i)}return cc(n)}var dc=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function pc(e){return e.replace(dc,mc)}function mc(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function vc(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function gc(e,t,n,i){var r,a,o=e.getContext(),s=n.defines,l=n.vertexShader,u=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===xt?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===bt?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===wt&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case pn:case mn:t="ENVMAP_TYPE_CUBE";break;case yn:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),f=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===mn&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case rn:t="ENVMAP_BLENDING_MULTIPLY";break;case an:t="ENVMAP_BLENDING_MIX";break;case on:t="ENVMAP_BLENDING_ADD"}return t}(n),p=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(oc).join("\n")}(n),v=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(oc).join("\n")).length>0&&(r+="\n"),(a=[m,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(oc).join("\n")).length>0&&(a+="\n")):(r=[vc(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(oc).join("\n"),a=[m,vc(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.envMap?"#define "+d:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==sn?"#define TONE_MAPPING":"",n.toneMapping!==sn?yl.tonemapping_pars_fragment:"",n.toneMapping!==sn?ac("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",yl.colorspace_pars_fragment,rc("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(oc).join("\n")),l=lc(l=sc(l=cc(l),n),n),u=lc(u=sc(u=cc(u),n),n),l=pc(l),u=pc(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",n.glslVersion===zr?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===zr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var _,x,b=y+r+l,w=y+a+u,S=tc(o,o.VERTEX_SHADER,b),M=tc(o,o.FRAGMENT_SHADER,w);if(o.attachShader(g,S),o.attachShader(g,M),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var T=o.getProgramInfoLog(g).trim(),E=o.getShaderInfoLog(S).trim(),C=o.getShaderInfoLog(M).trim(),k=!0,P=!0;if(!1===o.getProgramParameter(g,o.LINK_STATUS))if(k=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(o,g,S,M);else{var A=ic(o,S,"vertex"),R=ic(o,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,o.VALIDATE_STATUS)+"\n\nProgram Info Log: "+T+"\n"+A+"\n"+R)}else""!==T?console.warn("THREE.WebGLProgram: Program Info Log:",T):""!==E&&""!==C||(P=!1);P&&(this.diagnostics={runnable:k,programLog:T,vertexShader:{log:E,prefix:r},fragmentShader:{log:C,prefix:a}})}return o.deleteShader(S),o.deleteShader(M),this.getUniforms=function(){return void 0===_&&(_=new ec(o,g)),_},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=1;a.type===e.FLOAT_MAT2&&(s=2),a.type===e.FLOAT_MAT3&&(s=3),a.type===e.FLOAT_MAT4&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),x},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=nc++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=M,this}var yc=0,_c=function(){function e(){f(this,e),this.shaderCache=new Map,this.materialCache=new Map}return v(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}},{key:"remove",value:function(e){var t,n=ke(this.materialCache.get(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code)}}catch(lA){n.e(lA)}finally{n.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new xc(e),t.set(e,n)),n}}]),e}(),xc=v((function e(t){f(this,e),this.id=yc++,this.code=t,this.usedTimes=0}));function bc(e,t,n,i,r,a,o){var s=new So,l=new _c,u=[],c=r.isWebGL2,h=r.logarithmicDepthBuffer,f=r.vertexTextures,d=r.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":"uv".concat(e)}return{getParameters:function(a,s,u,v,g){var y=v.fog,_=g.geometry,x=a.isMeshStandardMaterial?v.environment:null,b=(a.isMeshStandardMaterial?n:t).get(a.envMap||x),w=b&&b.mapping===yn?b.image.height:null,S=p[a.type];null!==a.precision&&(d=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",d,"instead.");var M,T,E,C,k=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,P=void 0!==k?k.length:0,A=0;if(void 0!==_.morphAttributes.position&&(A=1),void 0!==_.morphAttributes.normal&&(A=2),void 0!==_.morphAttributes.color&&(A=3),S){var R=xl[S];M=R.vertexShader,T=R.fragmentShader}else M=a.vertexShader,T=a.fragmentShader,l.update(a),E=l.getVertexShaderID(a),C=l.getFragmentShaderID(a);var L=e.getRenderTarget(),I=!0===g.isInstancedMesh,O=!!a.map,D=!!a.matcap,N=!!b,z=!!a.aoMap,U=!!a.lightMap,F=!!a.bumpMap,B=!!a.normalMap,H=!!a.displacementMap,j=!!a.emissiveMap,G=!!a.metalnessMap,V=!!a.roughnessMap,W=a.anisotropy>0,X=a.clearcoat>0,Z=a.iridescence>0,q=a.sheen>0,Y=a.transmission>0,J=W&&!!a.anisotropyMap,Q=X&&!!a.clearcoatMap,K=X&&!!a.clearcoatNormalMap,$=X&&!!a.clearcoatRoughnessMap,ee=Z&&!!a.iridescenceMap,te=Z&&!!a.iridescenceThicknessMap,ne=q&&!!a.sheenColorMap,ie=q&&!!a.sheenRoughnessMap,re=!!a.specularMap,ae=!!a.specularColorMap,oe=!!a.specularIntensityMap,se=Y&&!!a.transmissionMap,le=Y&&!!a.thicknessMap,ue=!!a.gradientMap,ce=!!a.alphaMap,he=a.alphaTest>0,fe=!!a.alphaHash,de=!!a.extensions,pe=!!_.attributes.uv1,me=!!_.attributes.uv2,ve=!!_.attributes.uv3,ge=sn;return a.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(ge=e.toneMapping)),{isWebGL2:c,shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:M,fragmentShader:T,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:C,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:d,instancing:I,instancingColor:I&&null!==g.instanceColor,supportsVertexTextures:f,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:er,map:O,matcap:D,envMap:N,envMapMode:N&&b.mapping,envMapCubeUVHeight:w,aoMap:z,lightMap:U,bumpMap:F,normalMap:B,displacementMap:f&&H,emissiveMap:j,normalMapObjectSpace:B&&a.normalMapType===Qi,normalMapTangentSpace:B&&a.normalMapType===Ji,metalnessMap:G,roughnessMap:V,anisotropy:W,anisotropyMap:J,clearcoat:X,clearcoatMap:Q,clearcoatNormalMap:K,clearcoatRoughnessMap:$,iridescence:Z,iridescenceMap:ee,iridescenceThicknessMap:te,sheen:q,sheenColorMap:ne,sheenRoughnessMap:ie,specularMap:re,specularColorMap:ae,specularIntensityMap:oe,transmission:Y,transmissionMap:se,thicknessMap:le,gradientMap:ue,opaque:!1===a.transparent&&a.blending===kt,alphaMap:ce,alphaTest:he,alphaHash:fe,combine:a.combine,mapUv:O&&m(a.map.channel),aoMapUv:z&&m(a.aoMap.channel),lightMapUv:U&&m(a.lightMap.channel),bumpMapUv:F&&m(a.bumpMap.channel),normalMapUv:B&&m(a.normalMap.channel),displacementMapUv:H&&m(a.displacementMap.channel),emissiveMapUv:j&&m(a.emissiveMap.channel),metalnessMapUv:G&&m(a.metalnessMap.channel),roughnessMapUv:V&&m(a.roughnessMap.channel),anisotropyMapUv:J&&m(a.anisotropyMap.channel),clearcoatMapUv:Q&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:K&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:$&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:te&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(a.sheenRoughnessMap.channel),specularMapUv:re&&m(a.specularMap.channel),specularColorMapUv:ae&&m(a.specularColorMap.channel),specularIntensityMapUv:oe&&m(a.specularIntensityMap.channel),transmissionMapUv:se&&m(a.transmissionMap.channel),thicknessMapUv:le&&m(a.thicknessMap.channel),alphaMapUv:ce&&m(a.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(B||W),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,vertexUv1s:pe,vertexUv2s:me,vertexUv3s:ve,pointsUvs:!0===g.isPoints&&!!_.attributes.uv&&(O||ce),fog:!!y,useFog:!0===a.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:P,morphTextureStride:A,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,useLegacyLights:e._useLegacyLights,decodeVideoTexture:O&&!0===a.map.isVideoTexture&&a.map.colorSpace===$i,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===Tt,flipSided:a.side===Mt,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:de&&!0===a.extensions.derivatives,extensionFragDepth:de&&!0===a.extensions.fragDepth,extensionDrawBuffers:de&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:de&&!0===a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.matcap&&s.enable(4);t.envMap&&s.enable(5);t.normalMapObjectSpace&&s.enable(6);t.normalMapTangentSpace&&s.enable(7);t.clearcoat&&s.enable(8);t.iridescence&&s.enable(9);t.alphaTest&&s.enable(10);t.vertexColors&&s.enable(11);t.vertexAlphas&&s.enable(12);t.vertexUv1s&&s.enable(13);t.vertexUv2s&&s.enable(14);t.vertexUv3s&&s.enable(15);t.vertexTangents&&s.enable(16);t.anisotropy&&s.enable(17);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);t.decodeVideoTexture&&s.enable(19);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var i=xl[n];t=el.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,r=0,o=u.length;r<o;r++){var s=u[r];if(s.cacheKey===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new gc(e,n,t,a),u.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){var t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function wc(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Sc(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Mc(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Tc(){var e=[],t=0,n=[],i=[],r=[];function a(n,i,r,a,o,s){var l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);o.transmission>0?i.push(c):!0===o.transparent?r.push(c):n.push(c)},unshift:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);o.transmission>0?i.unshift(c):!0===o.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(var n=t,i=e.length;n<i;n++){var r=e[n];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Sc),i.length>1&&i.sort(t||Mc),r.length>1&&r.sort(t||Mc)}}}function Ec(){var e=new WeakMap;return{get:function(t,n){var i,r=e.get(t);return void 0===r?(i=new Tc,e.set(t,[i])):n>=r.length?(i=new Tc,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function Cc(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Da,color:new ns};break;case"SpotLight":n={position:new Da,direction:new Da,color:new ns,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Da,color:new ns,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Da,skyColor:new ns,groundColor:new ns};break;case"RectAreaLight":n={color:new ns,position:new Da,halfWidth:new Da,halfHeight:new Da}}return e[t.id]=n,n}}}var kc=0;function Pc(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ac(e,t){for(var n=new Cc,i=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new na};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new na,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0},a=0;a<9;a++)r.probe.push(new Da);var o=new Da,s=new ho,l=new ho;return{setup:function(a,o){for(var s=0,l=0,u=0,c=0;c<9;c++)r.probe[c].set(0,0,0);var h=0,f=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,x=0;a.sort(Pc);for(var b=!0===o?Math.PI:1,w=0,S=a.length;w<S;w++){var M=a[w],T=M.color,E=M.intensity,C=M.distance,k=M.shadow&&M.shadow.map?M.shadow.map.texture:null;if(M.isAmbientLight)s+=T.r*E*b,l+=T.g*E*b,u+=T.b*E*b;else if(M.isLightProbe)for(var P=0;P<9;P++)r.probe[P].addScaledVector(M.sh.coefficients[P],E);else if(M.isDirectionalLight){var A=n.get(M);if(A.color.copy(M.color).multiplyScalar(M.intensity*b),M.castShadow){var R=M.shadow,L=i.get(M);L.shadowBias=R.bias,L.shadowNormalBias=R.normalBias,L.shadowRadius=R.radius,L.shadowMapSize=R.mapSize,r.directionalShadow[h]=L,r.directionalShadowMap[h]=k,r.directionalShadowMatrix[h]=M.shadow.matrix,v++}r.directional[h]=A,h++}else if(M.isSpotLight){var I=n.get(M);I.position.setFromMatrixPosition(M.matrixWorld),I.color.copy(T).multiplyScalar(E*b),I.distance=C,I.coneCos=Math.cos(M.angle),I.penumbraCos=Math.cos(M.angle*(1-M.penumbra)),I.decay=M.decay,r.spot[d]=I;var O=M.shadow;if(M.map&&(r.spotLightMap[_]=M.map,_++,O.updateMatrices(M),M.castShadow&&x++),r.spotLightMatrix[d]=O.matrix,M.castShadow){var D=i.get(M);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,r.spotShadow[d]=D,r.spotShadowMap[d]=k,y++}d++}else if(M.isRectAreaLight){var N=n.get(M);N.color.copy(T).multiplyScalar(E),N.halfWidth.set(.5*M.width,0,0),N.halfHeight.set(0,.5*M.height,0),r.rectArea[p]=N,p++}else if(M.isPointLight){var z=n.get(M);if(z.color.copy(M.color).multiplyScalar(M.intensity*b),z.distance=M.distance,z.decay=M.decay,M.castShadow){var U=M.shadow,F=i.get(M);F.shadowBias=U.bias,F.shadowNormalBias=U.normalBias,F.shadowRadius=U.radius,F.shadowMapSize=U.mapSize,F.shadowCameraNear=U.camera.near,F.shadowCameraFar=U.camera.far,r.pointShadow[f]=F,r.pointShadowMap[f]=k,r.pointShadowMatrix[f]=M.shadow.matrix,g++}r.point[f]=z,f++}else if(M.isHemisphereLight){var B=n.get(M);B.skyColor.copy(M.color).multiplyScalar(E*b),B.groundColor.copy(M.groundColor).multiplyScalar(E*b),r.hemi[m]=B,m++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=_l.LTC_FLOAT_1,r.rectAreaLTC2=_l.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=_l.LTC_HALF_1,r.rectAreaLTC2=_l.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=u;var H=r.hash;H.directionalLength===h&&H.pointLength===f&&H.spotLength===d&&H.rectAreaLength===p&&H.hemiLength===m&&H.numDirectionalShadows===v&&H.numPointShadows===g&&H.numSpotShadows===y&&H.numSpotMaps===_||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=f,r.hemi.length=m,r.directionalShadow.length=v,r.directionalShadowMap.length=v,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=y,r.spotShadowMap.length=y,r.directionalShadowMatrix.length=v,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=y+_-x,r.spotLightMap.length=_,r.numSpotLightShadowsWithMaps=x,H.directionalLength=h,H.pointLength=f,H.spotLength=d,H.rectAreaLength=p,H.hemiLength=m,H.numDirectionalShadows=v,H.numPointShadows=g,H.numSpotShadows=y,H.numSpotMaps=_,r.version=kc++)},setupView:function(e,t){for(var n=0,i=0,a=0,u=0,c=0,h=t.matrixWorldInverse,f=0,d=e.length;f<d;f++){var p=e[f];if(p.isDirectionalLight){var m=r.directional[n];m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),n++}else if(p.isSpotLight){var v=r.spot[a];v.position.setFromMatrixPosition(p.matrixWorld),v.position.applyMatrix4(h),v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),a++}else if(p.isRectAreaLight){var g=r.rectArea[u];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),l.identity(),s.copy(p.matrixWorld),s.premultiply(h),l.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(l),g.halfHeight.applyMatrix4(l),u++}else if(p.isPointLight){var y=r.point[i];y.position.setFromMatrixPosition(p.matrixWorld),y.position.applyMatrix4(h),i++}else if(p.isHemisphereLight){var _=r.hemi[c];_.direction.setFromMatrixPosition(p.matrixWorld),_.direction.transformDirection(h),c++}}},state:r}}function Rc(e,t){var n=new Ac(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Lc(e,t){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=n.get(i);return void 0===o?(r=new Rc(e,t),n.set(i,[r])):a>=o.length?(r=new Rc(e,t),o.push(r)):r=o[a],r},dispose:function(){n=new WeakMap}}}var Ic=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshDepthMaterial=!0,i.type="MeshDepthMaterial",i.depthPacking=qi,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(Qo),Oc=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshDistanceMaterial=!0,i.type="MeshDistanceMaterial",i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(Qo);function Dc(e,t,n){var i,r=new pl,a=new na,o=new na,s=new Ea,l=new Ic({depthPacking:Yi}),u=new Oc,c={},h=n.maxTextureSize,f=(at(i={},St,Mt),at(i,Mt,St),at(i,Tt,Tt),i),d=new tl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new na},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;var m=new As;m.setAttribute("position",new fs(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new qs(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=xt;var y=this.type;function _(n,i){var r=t.update(v);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new ka(a.x,a.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,d,v,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,p,v,null)}function x(t,n,i,r){var a=null,o=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?u:l,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){var s=a.uuid,h=n.uuid,d=c[s];void 0===d&&(d={},c[s]=d);var p=d[h];void 0===p&&(p=a.clone(),d[h]=p),a=p}(a.visible=n.visible,a.wireframe=n.wireframe,a.side=r===wt?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:f[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial)&&(e.properties.get(a).light=i);return a}function b(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===wt)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,f=c.length;h<f;h++){var d=c[h],p=u[d.materialIndex];if(p&&p.visible){var m=x(n,p,o,s);e.renderBufferDirect(a,null,l,m,n,d)}}else if(u.visible){var v=x(n,u,o,s);e.renderBufferDirect(a,null,l,v,n,null)}}for(var g=n.children,y=0,_=g.length;y<_;y++)b(g[y],i,a,o,s)}}this.render=function(t,n,i){if(!1!==g.enabled&&(!1!==g.autoUpdate||!1!==g.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),u=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),f=e.state;f.setBlending(Ct),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var d=y!==wt&&this.type===wt,p=y===wt&&this.type!==wt,m=0,v=t.length;m<v;m++){var x=t[m],w=x.shadow;if(void 0!==w){if(!1!==w.autoUpdate||!1!==w.needsUpdate){a.copy(w.mapSize);var S=w.getFrameExtents();if(a.multiply(S),o.copy(w.mapSize),(a.x>h||a.y>h)&&(a.x>h&&(o.x=Math.floor(h/S.x),a.x=o.x*S.x,w.mapSize.x=o.x),a.y>h&&(o.y=Math.floor(h/S.y),a.y=o.y*S.y,w.mapSize.y=o.y)),null===w.map||!0===d||!0===p){var M=this.type!==wt?{minFilter:wn,magFilter:wn}:{};null!==w.map&&w.map.dispose(),w.map=new ka(a.x,a.y,M),w.map.texture.name=x.name+".shadowMap",w.camera.updateProjectionMatrix()}e.setRenderTarget(w.map),e.clear();for(var T=w.getViewportCount(),E=0;E<T;E++){var C=w.getViewport(E);s.set(o.x*C.x,o.y*C.y,o.x*C.z,o.y*C.w),f.viewport(s),w.updateMatrices(x,E),r=w.getFrustum(),b(n,i,w.camera,x,this.type)}!0!==w.isPointLightShadow&&this.type===wt&&_(w,i),w.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",x,"has no shadow.")}y=this.type,g.needsUpdate=!1,e.setRenderTarget(l,u,c)}}}function Nc(e,t,n){var i,r,a=n.isWebGL2;var o=new function(){var t=!1,n=new Ea,i=null,r=new Ea(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(t){t?j(e.DEPTH_TEST):G(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case Yt:e.depthFunc(e.NEVER);break;case Jt:e.depthFunc(e.ALWAYS);break;case Qt:e.depthFunc(e.LESS);break;case Kt:e.depthFunc(e.LEQUAL);break;case $t:e.depthFunc(e.EQUAL);break;case en:e.depthFunc(e.GEQUAL);break;case tn:e.depthFunc(e.GREATER);break;case nn:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},l=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(n){t||(n?j(e.STENCIL_TEST):G(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&l===i||(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null}}},u=new WeakMap,c=new WeakMap,h={},f={},d=new WeakMap,p=[],m=null,v=!1,g=null,y=null,_=null,x=null,b=null,w=null,S=null,M=!1,T=null,E=null,C=null,k=null,P=null,A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),R=!1,L=0,I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(I)[1]),R=L>=1):-1!==I.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),R=L>=2);var O=null,D={},N=e.getParameter(e.SCISSOR_BOX),z=e.getParameter(e.VIEWPORT),U=(new Ea).fromArray(N),F=(new Ea).fromArray(z);function B(t,n,i,r){var o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var l=0;l<i;l++)!a||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+l,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}var H={};function j(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function G(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}H[e.TEXTURE_2D]=B(e.TEXTURE_2D,e.TEXTURE_2D,1),H[e.TEXTURE_CUBE_MAP]=B(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),a&&(H[e.TEXTURE_2D_ARRAY]=B(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),H[e.TEXTURE_3D]=B(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),s.setClear(1),l.setClear(0),j(e.DEPTH_TEST),s.setFunc(Kt),q(!1),Y(vt),j(e.CULL_FACE),Z(Ct);var V=(at(i={},It,e.FUNC_ADD),at(i,Ot,e.FUNC_SUBTRACT),at(i,Dt,e.FUNC_REVERSE_SUBTRACT),i);if(a)V[Nt]=e.MIN,V[zt]=e.MAX;else{var W=t.get("EXT_blend_minmax");null!==W&&(V[Nt]=W.MIN_EXT,V[zt]=W.MAX_EXT)}var X=(at(r={},Ut,e.ZERO),at(r,Ft,e.ONE),at(r,Bt,e.SRC_COLOR),at(r,jt,e.SRC_ALPHA),at(r,qt,e.SRC_ALPHA_SATURATE),at(r,Xt,e.DST_COLOR),at(r,Vt,e.DST_ALPHA),at(r,Ht,e.ONE_MINUS_SRC_COLOR),at(r,Gt,e.ONE_MINUS_SRC_ALPHA),at(r,Zt,e.ONE_MINUS_DST_COLOR),at(r,Wt,e.ONE_MINUS_DST_ALPHA),r);function Z(t,n,i,r,a,o,s,l){if(t!==Ct){if(!1===v&&(j(e.BLEND),v=!0),t===Lt)a=a||n,o=o||i,s=s||r,n===y&&a===b||(e.blendEquationSeparate(V[n],V[a]),y=n,b=a),i===_&&r===x&&o===w&&s===S||(e.blendFuncSeparate(X[i],X[r],X[o],X[s]),_=i,x=r,w=o,S=s),g=t,M=!1;else if(t!==g||l!==M){if(y===It&&b===It||(e.blendEquation(e.FUNC_ADD),y=It,b=It),l)switch(t){case kt:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Pt:e.blendFunc(e.ONE,e.ONE);break;case At:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Rt:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case kt:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Pt:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case At:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Rt:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}_=null,x=null,w=null,S=null,g=t,M=l}}else!0===v&&(G(e.BLEND),v=!1)}function q(t){T!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),T=t)}function Y(t){t!==mt?(j(e.CULL_FACE),t!==E&&(t===vt?e.cullFace(e.BACK):t===gt?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):G(e.CULL_FACE),E=t}function J(t,n,i){t?(j(e.POLYGON_OFFSET_FILL),k===n&&P===i||(e.polygonOffset(n,i),k=n,P=i)):G(e.POLYGON_OFFSET_FILL)}return{buffers:{color:o,depth:s,stencil:l},enable:j,disable:G,bindFramebuffer:function(t,n){return f[t]!==n&&(e.bindFramebuffer(t,n),f[t]=n,a&&(t===e.DRAW_FRAMEBUFFER&&(f[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(f[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){var a=p,o=!1;if(i)if(void 0===(a=d.get(r))&&(a=[],d.set(r,a)),i.isWebGLMultipleRenderTargets){var s=i.texture;if(a.length!==s.length||a[0]!==e.COLOR_ATTACHMENT0){for(var l=0,u=s.length;l<u;l++)a[l]=e.COLOR_ATTACHMENT0+l;a.length=s.length,o=!0}}else a[0]!==e.COLOR_ATTACHMENT0&&(a[0]=e.COLOR_ATTACHMENT0,o=!0);else a[0]!==e.BACK&&(a[0]=e.BACK,o=!0);o&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:Z,setMaterial:function(t,n){t.side===Tt?G(e.CULL_FACE):j(e.CULL_FACE);var i=t.side===Mt;n&&(i=!i),q(i),t.blending===kt&&!1===t.transparent?Z(Ct):Z(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),o.setMask(t.colorWrite);var r=t.stencilWrite;l.setTest(r),r&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),J(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?j(e.SAMPLE_ALPHA_TO_COVERAGE):G(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:q,setCullFace:Y,setLineWidth:function(t){t!==C&&(R&&e.lineWidth(t),C=t)},setPolygonOffset:J,setScissorTest:function(t){t?j(e.SCISSOR_TEST):G(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),O!==t&&(e.activeTexture(t),O=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===O?e.TEXTURE0+A-1:O);var r=D[i];void 0===r&&(r={type:void 0,texture:void 0},D[i]=r),r.type===t&&r.texture===n||(O!==i&&(e.activeTexture(i),O=i),e.bindTexture(t,n||H[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=D[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){var i=c.get(n);void 0===i&&(i=new WeakMap,c.set(n,i));var r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){var i=c.get(n).get(t);u.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),u.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===a&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},O=null,D={},f={},d=new WeakMap,p=[],m=null,v=!1,g=null,y=null,_=null,x=null,b=null,w=null,S=null,M=!1,T=null,E=null,C=null,k=null,P=null,U.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),l.reset()}}}function zc(e,t,n,i,r,a,o){var s,l,u,c,h=r.isWebGL2,f=r.maxTextures,d=r.maxCubemapSize,p=r.maxTextureSize,m=r.maxSamples,v=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,g="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),y=new WeakMap,_=new WeakMap,x=!1;try{x="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(lA){}function b(e,t){return x?new OffscreenCanvas(e,t):la("canvas")}function w(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Kr:Math.floor,o=a(r*e.width),s=a(r*e.height);void 0===c&&(c=b(o,s));var l=n?b(o,s):c;return l.width=o,l.height=s,l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function S(e){return Jr(e.width)&&Jr(e.height)}function M(e,t){return e.generateMipmaps&&t&&e.minFilter!==wn&&e.minFilter!==Cn}function T(t){e.generateMipmap(t)}function E(n,i,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===h)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=i;return i===e.RED&&(r===e.FLOAT&&(s=e.R32F),r===e.HALF_FLOAT&&(s=e.R16F),r===e.UNSIGNED_BYTE&&(s=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(s=e.R8UI),r===e.UNSIGNED_SHORT&&(s=e.R16UI),r===e.UNSIGNED_INT&&(s=e.R32UI),r===e.BYTE&&(s=e.R8I),r===e.SHORT&&(s=e.R16I),r===e.INT&&(s=e.R32I)),i===e.RG&&(r===e.FLOAT&&(s=e.RG32F),r===e.HALF_FLOAT&&(s=e.RG16F),r===e.UNSIGNED_BYTE&&(s=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(s=e.RGBA32F),r===e.HALF_FLOAT&&(s=e.RGBA16F),r===e.UNSIGNED_BYTE&&(s=a===$i&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)),s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function C(e,t,n){return!0===M(e,n)||e.isFramebufferTexture&&e.minFilter!==wn&&e.minFilter!==Cn?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function k(t){return t===wn||t===Sn||t===Tn?e.NEAREST:e.LINEAR}function P(e){var t=e.target;t.removeEventListener("dispose",P),function(e){var t=i.get(e);if(void 0===t.__webglInit)return;var n=e.source,r=_.get(n);if(r){var a=r[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&R(e),0===Object.keys(r).length&&_.delete(n)}i.remove(e)}(t),t.isVideoTexture&&y.delete(t)}function A(t){var n=t.target;n.removeEventListener("dispose",A),function(t){var n=t.texture,r=i.get(t),a=i.get(n);void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++){if(Array.isArray(r.__webglFramebuffer[s]))for(var l=0;l<r.__webglFramebuffer[s].length;l++)e.deleteFramebuffer(r.__webglFramebuffer[s][l]);else e.deleteFramebuffer(r.__webglFramebuffer[s]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[s])}else{if(Array.isArray(r.__webglFramebuffer))for(var u=0;u<r.__webglFramebuffer.length;u++)e.deleteFramebuffer(r.__webglFramebuffer[u]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(var c=0;c<r.__webglColorRenderbuffer.length;c++)r.__webglColorRenderbuffer[c]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[c]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var h=0,f=n.length;h<f;h++){var d=i.get(n[h]);d.__webglTexture&&(e.deleteTexture(d.__webglTexture),o.memory.textures--),i.remove(n[h])}i.remove(n),i.remove(t)}(n)}function R(t){var n=i.get(t);e.deleteTexture(n.__webglTexture);var r=t.source;delete _.get(r)[n.__cacheKey],o.memory.textures--}var L=0;function I(t,r){var a=i.get(t);if(t.isVideoTexture&&function(e){var t=o.render.frame;y.get(e)!==t&&(y.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){var s=t.image;if(null===s)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==s.complete)return void F(a,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+r)}var O=(at(s={},_n,e.REPEAT),at(s,xn,e.CLAMP_TO_EDGE),at(s,bn,e.MIRRORED_REPEAT),s),D=(at(l={},wn,e.NEAREST),at(l,Sn,e.NEAREST_MIPMAP_NEAREST),at(l,Tn,e.NEAREST_MIPMAP_LINEAR),at(l,Cn,e.LINEAR),at(l,kn,e.LINEAR_MIPMAP_NEAREST),at(l,An,e.LINEAR_MIPMAP_LINEAR),l),N=(at(u={},_r,e.NEVER),at(u,Er,e.ALWAYS),at(u,xr,e.LESS),at(u,wr,e.LEQUAL),at(u,br,e.EQUAL),at(u,Tr,e.GEQUAL),at(u,Sr,e.GREATER),at(u,Mr,e.NOTEQUAL),u);function z(n,a,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,O[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,O[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,O[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,D[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,D[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===xn&&a.wrapT===xn||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,k(a.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,k(a.minFilter)),a.minFilter!==wn&&a.minFilter!==Cn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,N[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===wn)return;if(a.minFilter!==Tn&&a.minFilter!==An)return;if(a.type===Un&&!1===t.has("OES_texture_float_linear"))return;if(!1===h&&a.type===Fn&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function U(t,n){var i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",P));var r=n.source,a=_.get(r);void 0===a&&(a={},_.set(r,a));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),a[s].usedTimes++;var l=a[t.__cacheKey];void 0!==l&&(a[t.__cacheKey].usedTimes--,0===l.usedTimes&&R(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return i}function F(t,r,o){var s=e.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(s=e.TEXTURE_2D_ARRAY),r.isData3DTexture&&(s=e.TEXTURE_3D);var l=U(t,r),u=r.source;n.bindTexture(s,t.__webglTexture,e.TEXTURE0+o);var c=i.get(u);if(u.version!==c.__version||!0===l){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);var f,d=function(e){return!h&&(e.wrapS!==xn||e.wrapT!==xn||e.minFilter!==wn&&e.minFilter!==Cn)}(r)&&!1===S(r.image),m=w(r.image,d,!1,p),v=S(m=W(r,m))||h,g=a.convert(r.format,r.colorSpace),y=a.convert(r.type),_=E(r.internalFormat,g,y,r.colorSpace,r.isVideoTexture);z(s,r,v);var x=r.mipmaps,b=h&&!0!==r.isVideoTexture,k=void 0===c.__version||!0===l,P=C(r,m,v);if(r.isDepthTexture)_=e.DEPTH_COMPONENT,h?_=r.type===Un?e.DEPTH_COMPONENT32F:r.type===zn?e.DEPTH_COMPONENT24:r.type===jn?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===Un&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Zn&&_===e.DEPTH_COMPONENT&&r.type!==Dn&&r.type!==zn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=zn,y=a.convert(r.type)),r.format===qn&&_===e.DEPTH_COMPONENT&&(_=e.DEPTH_STENCIL,r.type!==jn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=jn,y=a.convert(r.type))),k&&(b?n.texStorage2D(e.TEXTURE_2D,1,_,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,_,m.width,m.height,0,g,y,null));else if(r.isDataTexture)if(x.length>0&&v){b&&k&&n.texStorage2D(e.TEXTURE_2D,P,_,x[0].width,x[0].height);for(var A=0,R=x.length;A<R;A++)f=x[A],b?n.texSubImage2D(e.TEXTURE_2D,A,0,0,f.width,f.height,g,y,f.data):n.texImage2D(e.TEXTURE_2D,A,_,f.width,f.height,0,g,y,f.data);r.generateMipmaps=!1}else b?(k&&n.texStorage2D(e.TEXTURE_2D,P,_,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,g,y,m.data)):n.texImage2D(e.TEXTURE_2D,0,_,m.width,m.height,0,g,y,m.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){b&&k&&n.texStorage3D(e.TEXTURE_2D_ARRAY,P,_,x[0].width,x[0].height,m.depth);for(var L=0,I=x.length;L<I;L++)f=x[L],r.format!==Vn?null!==g?b?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,L,0,0,0,f.width,f.height,m.depth,g,f.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,L,_,f.width,f.height,m.depth,0,f.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage3D(e.TEXTURE_2D_ARRAY,L,0,0,0,f.width,f.height,m.depth,g,y,f.data):n.texImage3D(e.TEXTURE_2D_ARRAY,L,_,f.width,f.height,m.depth,0,g,y,f.data)}else{b&&k&&n.texStorage2D(e.TEXTURE_2D,P,_,x[0].width,x[0].height);for(var O=0,D=x.length;O<D;O++)f=x[O],r.format!==Vn?null!==g?b?n.compressedTexSubImage2D(e.TEXTURE_2D,O,0,0,f.width,f.height,g,f.data):n.compressedTexImage2D(e.TEXTURE_2D,O,_,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage2D(e.TEXTURE_2D,O,0,0,f.width,f.height,g,y,f.data):n.texImage2D(e.TEXTURE_2D,O,_,f.width,f.height,0,g,y,f.data)}else if(r.isDataArrayTexture)b?(k&&n.texStorage3D(e.TEXTURE_2D_ARRAY,P,_,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,g,y,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,m.width,m.height,m.depth,0,g,y,m.data);else if(r.isData3DTexture)b?(k&&n.texStorage3D(e.TEXTURE_3D,P,_,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,g,y,m.data)):n.texImage3D(e.TEXTURE_3D,0,_,m.width,m.height,m.depth,0,g,y,m.data);else if(r.isFramebufferTexture){if(k)if(b)n.texStorage2D(e.TEXTURE_2D,P,_,m.width,m.height);else for(var N=m.width,F=m.height,B=0;B<P;B++)n.texImage2D(e.TEXTURE_2D,B,_,N,F,0,g,y,null),N>>=1,F>>=1}else if(x.length>0&&v){b&&k&&n.texStorage2D(e.TEXTURE_2D,P,_,x[0].width,x[0].height);for(var H=0,j=x.length;H<j;H++)f=x[H],b?n.texSubImage2D(e.TEXTURE_2D,H,0,0,g,y,f):n.texImage2D(e.TEXTURE_2D,H,_,g,y,f);r.generateMipmaps=!1}else b?(k&&n.texStorage2D(e.TEXTURE_2D,P,_,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,g,y,m)):n.texImage2D(e.TEXTURE_2D,0,_,g,y,m);M(r,v)&&T(s),c.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function B(t,r,o,s,l,u){var c=a.convert(o.format,o.colorSpace),h=a.convert(o.type),f=E(o.internalFormat,c,h,o.colorSpace);if(!i.get(r).__hasExternalTextures){var d=Math.max(1,r.width>>u),p=Math.max(1,r.height>>u);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,u,f,d,p,r.depth,0,c,h,null):n.texImage2D(l,u,f,d,p,0,c,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),V(r)?v.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,l,i.get(o).__webglTexture,0,G(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,l,i.get(o).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function H(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){var r=e.DEPTH_COMPONENT16;if(i||V(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===Un?r=e.DEPTH_COMPONENT32F:o.type===zn&&(r=e.DEPTH_COMPONENT24));var s=G(n);V(n)?v.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,s,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,s,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){var l=G(n);i&&!1===V(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,l,e.DEPTH24_STENCIL8,n.width,n.height):V(n)?v.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,l,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else for(var u=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],c=0;c<u.length;c++){var h=u[c],f=a.convert(h.format,h.colorSpace),d=a.convert(h.type),p=E(h.internalFormat,f,d,h.colorSpace),m=G(n);i&&!1===V(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,m,p,n.width,n.height):V(n)?v.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,m,p,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,p,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function j(t){var r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),I(r.depthTexture,0);var a=i.get(r.depthTexture).__webglTexture,o=G(r);if(r.depthTexture.format===Zn)V(r)?v.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(r.depthTexture.format!==qn)throw new Error("Unknown depthTexture format");V(r)?v.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),H(r.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),H(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function G(e){return Math.min(m,e.samples)}function V(e){var n=i.get(e);return h&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function W(e,n){var i=e.colorSpace,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Ur||i!==er&&i!==Ki&&(i===$i||i===tr?!1===h?!0===t.has("EXT_sRGB")&&r===Vn?(e.format=Ur,e.minFilter=Cn,e.generateMipmaps=!1):n=xa.sRGBToLinear(n):r===Vn&&a===Ln||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){var e=L;return e>=f&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+f),L+=1,e},this.resetTextureUnits=function(){L=0},this.setTexture2D=I,this.setTexture2DArray=function(t,r){var a=i.get(t);t.version>0&&a.__version!==t.version?F(a,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){var a=i.get(t);t.version>0&&a.__version!==t.version?F(a,t,r):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,r){var o=i.get(t);t.version>0&&o.__version!==t.version?function(t,r,o){if(6!==r.image.length)return;var s=U(t,r),l=r.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);var u=i.get(l);if(l.version!==u.__version||!0===s){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);for(var c=r.isCompressedTexture||r.image[0].isCompressedTexture,f=r.image[0]&&r.image[0].isDataTexture,p=[],m=0;m<6;m++)p[m]=c||f?f?r.image[m].image:r.image[m]:w(r.image[m],!1,!0,d),p[m]=W(r,p[m]);var v,g=p[0],y=S(g)||h,_=a.convert(r.format,r.colorSpace),x=a.convert(r.type),b=E(r.internalFormat,_,x,r.colorSpace),k=h&&!0!==r.isVideoTexture,P=void 0===u.__version||!0===s,A=C(r,g,y);if(z(e.TEXTURE_CUBE_MAP,r,y),c){k&&P&&n.texStorage2D(e.TEXTURE_CUBE_MAP,A,b,g.width,g.height);for(var R=0;R<6;R++){v=p[R].mipmaps;for(var L=0;L<v.length;L++){var I=v[L];r.format!==Vn?null!==_?k?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,0,0,I.width,I.height,_,I.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,b,I.width,I.height,0,I.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):k?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,0,0,I.width,I.height,_,x,I.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,b,I.width,I.height,0,_,x,I.data)}}}else{v=r.mipmaps,k&&P&&(v.length>0&&A++,n.texStorage2D(e.TEXTURE_CUBE_MAP,A,b,p[0].width,p[0].height));for(var O=0;O<6;O++)if(f){k?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,0,0,0,p[O].width,p[O].height,_,x,p[O].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,0,b,p[O].width,p[O].height,0,_,x,p[O].data);for(var D=0;D<v.length;D++){var N=v[D].image[O].image;k?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,D+1,0,0,N.width,N.height,_,x,N.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,D+1,b,N.width,N.height,0,_,x,N.data)}}else{k?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,0,0,0,_,x,p[O]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,0,b,_,x,p[O]);for(var F=0;F<v.length;F++){var B=v[F];k?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,F+1,0,0,_,x,B.image[O]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+O,F+1,b,_,x,B.image[O])}}}M(r,y)&&T(e.TEXTURE_CUBE_MAP),u.__version=l.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,r):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+r)},this.rebindTextures=function(t,n,r){var a=i.get(t);void 0!==n&&B(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&j(t)},this.setupRenderTarget=function(t){var s=t.texture,l=i.get(t),u=i.get(s);t.addEventListener("dispose",A),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=s.version,o.memory.textures++);var c=!0===t.isWebGLCubeRenderTarget,f=!0===t.isWebGLMultipleRenderTargets,d=S(t)||h;if(c){l.__webglFramebuffer=[];for(var p=0;p<6;p++)if(h&&s.mipmaps&&s.mipmaps.length>0){l.__webglFramebuffer[p]=[];for(var m=0;m<s.mipmaps.length;m++)l.__webglFramebuffer[p][m]=e.createFramebuffer()}else l.__webglFramebuffer[p]=e.createFramebuffer()}else{if(h&&s.mipmaps&&s.mipmaps.length>0){l.__webglFramebuffer=[];for(var v=0;v<s.mipmaps.length;v++)l.__webglFramebuffer[v]=e.createFramebuffer()}else l.__webglFramebuffer=e.createFramebuffer();if(f)if(r.drawBuffers)for(var g=t.texture,y=0,_=g.length;y<_;y++){var x=i.get(g[y]);void 0===x.__webglTexture&&(x.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(h&&t.samples>0&&!1===V(t)){var b=f?s:[s];l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer);for(var w=0;w<b.length;w++){var C=b[w];l.__webglColorRenderbuffer[w]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,l.__webglColorRenderbuffer[w]);var k=a.convert(C.format,C.colorSpace),P=a.convert(C.type),R=E(C.internalFormat,k,P,C.colorSpace,!0===t.isXRRenderTarget),L=G(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,L,R,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+w,e.RENDERBUFFER,l.__webglColorRenderbuffer[w])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),H(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),z(e.TEXTURE_CUBE_MAP,s,d);for(var I=0;I<6;I++)if(h&&s.mipmaps&&s.mipmaps.length>0)for(var O=0;O<s.mipmaps.length;O++)B(l.__webglFramebuffer[I][O],t,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+I,O);else B(l.__webglFramebuffer[I],t,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+I,0);M(s,d)&&T(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(f){for(var D=t.texture,N=0,U=D.length;N<U;N++){var F=D[N],W=i.get(F);n.bindTexture(e.TEXTURE_2D,W.__webglTexture),z(e.TEXTURE_2D,F,d),B(l.__webglFramebuffer,t,F,e.COLOR_ATTACHMENT0+N,e.TEXTURE_2D,0),M(F,d)&&T(e.TEXTURE_2D)}n.unbindTexture()}else{var X=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(h?X=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(X,u.__webglTexture),z(X,s,d),h&&s.mipmaps&&s.mipmaps.length>0)for(var Z=0;Z<s.mipmaps.length;Z++)B(l.__webglFramebuffer[Z],t,s,e.COLOR_ATTACHMENT0,X,Z);else B(l.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0,X,0);M(s,d)&&T(X),n.unbindTexture()}t.depthBuffer&&j(t)},this.updateRenderTargetMipmap=function(t){for(var r=S(t)||h,a=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=0,s=a.length;o<s;o++){var l=a[o];if(M(l,r)){var u=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,c=i.get(l).__webglTexture;n.bindTexture(u,c),T(u),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(h&&t.samples>0&&!1===V(t)){var r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height,s=e.COLOR_BUFFER_BIT,l=[],u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=i.get(t),f=!0===t.isWebGLMultipleRenderTargets;if(f)for(var d=0;d<r.length;d++)n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+d,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+d,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(var p=0;p<r.length;p++){l.push(e.COLOR_ATTACHMENT0+p),t.depthBuffer&&l.push(u);var m=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===m&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),f&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[p]),!0===m&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[u]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[u])),f){var v=i.get(r[p]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,v,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),g&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),f)for(var y=0;y<r.length;y++){n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+y,e.RENDERBUFFER,c.__webglColorRenderbuffer[y]);var _=i.get(r[y]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+y,e.TEXTURE_2D,_,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=j,this.setupFrameBufferTexture=B,this.useMultisampledRTT=V}var Uc=0,Fc=1;function Bc(e,t,n){var i=n.isWebGL2;return{convert:function(n){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ki,o=a===$i||a===tr?Fc:Uc;if(n===Ln)return e.UNSIGNED_BYTE;if(n===Bn)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Hn)return e.UNSIGNED_SHORT_5_5_5_1;if(n===In)return e.BYTE;if(n===On)return e.SHORT;if(n===Dn)return e.UNSIGNED_SHORT;if(n===Nn)return e.INT;if(n===zn)return e.UNSIGNED_INT;if(n===Un)return e.FLOAT;if(n===Fn)return i?e.HALF_FLOAT:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(n===Gn)return e.ALPHA;if(n===Vn)return e.RGBA;if(n===Wn)return e.LUMINANCE;if(n===Xn)return e.LUMINANCE_ALPHA;if(n===Zn)return e.DEPTH_COMPONENT;if(n===qn)return e.DEPTH_STENCIL;if(n===Ur)return null!==(r=t.get("EXT_sRGB"))?r.SRGB_ALPHA_EXT:null;if(n===Yn)return e.RED;if(n===Jn)return e.RED_INTEGER;if(n===Qn)return e.RG;if(n===Kn)return e.RG_INTEGER;if(n===$n)return e.RGBA_INTEGER;if(n===ei||n===ti||n===ni||n===ii)if(o===Fc){if(null===(r=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===ei)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===ti)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===ni)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ii)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===ei)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===ti)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===ni)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ii)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===ri||n===ai||n===oi||n===si){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===ri)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===ai)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===oi)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===si)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===li)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===ui||n===ci){if(null===(r=t.get("WEBGL_compressed_texture_etc")))return null;if(n===ui)return o===Fc?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===ci)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===hi||n===fi||n===di||n===pi||n===mi||n===vi||n===gi||n===yi||n===_i||n===xi||n===bi||n===wi||n===Si||n===Mi){if(null===(r=t.get("WEBGL_compressed_texture_astc")))return null;if(n===hi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===fi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===di)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===pi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===mi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===vi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===gi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===yi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===_i)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===xi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===bi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===wi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Si)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Mi)return o===Fc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Ti||n===Ei||n===Ci){if(null===(r=t.get("EXT_texture_compression_bptc")))return null;if(n===Ti)return o===Fc?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Ei)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Ci)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===ki||n===Pi||n===Ai||n===Ri){if(null===(r=t.get("EXT_texture_compression_rgtc")))return null;if(n===Ti)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Pi)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Ai)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Ri)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===jn?i?e.UNSIGNED_INT_24_8:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var Hc=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return f(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=i,e}return v(n)}(il),jc=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return v(n)}(zo),Gc={type:"move"},Vc=function(){function e(){f(this,e),this._targetRay=null,this._grip=null,this._hand=null}return v(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new jc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new jc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Da,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Da),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new jc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Da,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Da),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"connect",value:function(e){if(e&&e.hand){var t=this._hand;if(t){var n,i=ke(e.hand.values());try{for(i.s();!(n=i.n()).done;){var r=n.value;this._getHandJoint(t,r)}}catch(lA){i.e(lA)}finally{i.f()}}}return this.dispatchEvent({type:"connected",data:e}),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;var u,c=ke(e.hand.values());try{for(c.s();!(u=c.n()).done;){var h=u.value,f=t.getJointPose(h,n),d=this._getHandJoint(l,h);null!==f&&(d.matrix.fromArray(f.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,d.jointRadius=f.radius),d.visible=null!==f}}catch(lA){c.e(lA)}finally{c.f()}var p=l.joints["index-finger-tip"],m=l.joints["thumb-tip"],v=p.position.distanceTo(m.position);l.inputState.pinching&&v>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&v<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(i=t.getPose(e.targetRaySpace,n))&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Gc)))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}},{key:"_getHandJoint",value:function(e,t){if(void 0===e.joints[t.jointName]){var n=new jc;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}]),e}(),Wc=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s,l,u,c,h){var d;if(f(this,n),(h=void 0!==h?h:Zn)!==Zn&&h!==qn)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&h===Zn&&(r=zn),void 0===r&&h===qn&&(r=jn),(d=t.call(this,null,a,o,s,l,u,h,r,c)).isDepthTexture=!0,d.image={width:e,height:i},d.magFilter=void 0!==l?l:wn,d.minFilter=void 0!==u?u:wn,d.flipY=!1,d.generateMipmaps=!1,d.compareFunction=null,d}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.compareFunction=e.compareFunction,this}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}]),n}(Ta),Xc=function(e){_(n,e);var t=w(n);function n(e,i){var r;f(this,n);var a=g(r=t.call(this)),o=null,s=1,l=null,u="local-floor",c=1,h=null,d=null,p=null,m=null,v=null,y=null,_=i.getContextAttributes(),x=null,b=null,w=[],S=[],M=new il;M.layers.enable(1),M.viewport=new Ea;var T=new il;T.layers.enable(2),T.viewport=new Ea;var E=[M,T],C=new Hc;C.layers.enable(1),C.layers.enable(2);var k=null,P=null;function A(e){var t=S.indexOf(e.inputSource);if(-1!==t){var n=w[t];void 0!==n&&(n.update(e.inputSource,e.frame,h||l),n.dispatchEvent({type:e.type,data:e.inputSource}))}}function R(){o.removeEventListener("select",A),o.removeEventListener("selectstart",A),o.removeEventListener("selectend",A),o.removeEventListener("squeeze",A),o.removeEventListener("squeezestart",A),o.removeEventListener("squeezeend",A),o.removeEventListener("end",R),o.removeEventListener("inputsourceschange",L);for(var t=0;t<w.length;t++){var n=S[t];null!==n&&(S[t]=null,w[t].disconnect(n))}k=null,P=null,e.setRenderTarget(x),v=null,m=null,p=null,o=null,b=null,z.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function L(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],i=S.indexOf(n);i>=0&&(S[i]=null,w[i].disconnect(n))}for(var r=0;r<e.added.length;r++){var a=e.added[r],o=S.indexOf(a);if(-1===o){for(var s=0;s<w.length;s++){if(s>=S.length){S.push(a),o=s;break}if(null===S[s]){S[s]=a,o=s;break}}if(-1===o)break}var l=w[o];l&&l.connect(a)}}r.cameraAutoUpdate=!0,r.enabled=!1,r.isPresenting=!1,r.getController=function(e){var t=w[e];return void 0===t&&(t=new Vc,w[e]=t),t.getTargetRaySpace()},r.getControllerGrip=function(e){var t=w[e];return void 0===t&&(t=new Vc,w[e]=t),t.getGripSpace()},r.getHand=function(e){var t=w[e];return void 0===t&&(t=new Vc,w[e]=t),t.getHandSpace()},r.setFramebufferScaleFactor=function(e){s=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},r.setReferenceSpaceType=function(e){u=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},r.getReferenceSpace=function(){return h||l},r.setReferenceSpace=function(e){h=e},r.getBaseLayer=function(){return null!==m?m:v},r.getBinding=function(){return p},r.getFrame=function(){return y},r.getSession=function(){return o},r.setSession=function(){var t=ct(ht().mark((function t(n){var r,f,d,g,y;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(o=n)){t.next=25;break}if(x=e.getRenderTarget(),o.addEventListener("select",A),o.addEventListener("selectstart",A),o.addEventListener("selectend",A),o.addEventListener("squeeze",A),o.addEventListener("squeezestart",A),o.addEventListener("squeezeend",A),o.addEventListener("end",R),o.addEventListener("inputsourceschange",L),!0===_.xrCompatible){t.next=14;break}return t.next=14,i.makeXRCompatible();case 14:return void 0===o.renderState.layers||!1===e.capabilities.isWebGL2?(r={antialias:void 0!==o.renderState.layers||_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s},v=new XRWebGLLayer(o,i,r),o.updateRenderState({baseLayer:v}),b=new ka(v.framebufferWidth,v.framebufferHeight,{format:Vn,type:Ln,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})):(f=null,d=null,g=null,_.depth&&(g=_.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,f=_.stencil?qn:Zn,d=_.stencil?jn:zn),y={colorFormat:i.RGBA8,depthFormat:g,scaleFactor:s},p=new XRWebGLBinding(o,i),m=p.createProjectionLayer(y),o.updateRenderState({layers:[m]}),b=new ka(m.textureWidth,m.textureHeight,{format:Vn,type:Ln,depthTexture:new Wc(m.textureWidth,m.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,f),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0}),e.properties.get(b).__ignoreDepthValues=m.ignoreDepthValues),b.isXRRenderTarget=!0,this.setFoveation(c),h=null,t.next=20,o.requestReferenceSpace(u);case 20:l=t.sent,z.setContext(o),z.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.getEnvironmentBlendMode=function(){if(null!==o)return o.environmentBlendMode};var I=new Da,O=new Da;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}r.updateCamera=function(e){if(null!==o){C.near=T.near=M.near=e.near,C.far=T.far=M.far=e.far,k===C.near&&P===C.far||(o.updateRenderState({depthNear:C.near,depthFar:C.far}),k=C.near,P=C.far);var t=e.parent,n=C.cameras;D(C,t);for(var i=0;i<n.length;i++)D(n[i],t);2===n.length?function(e,t,n){I.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);var i=I.distanceTo(O),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],f=o*c,d=o*h,p=i/(-c+h),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var v=o+p,g=s+p,y=f-m,_=d+(i-m),x=l*s/g*v,b=u*s/g*v;e.projectionMatrix.makePerspective(y,_,x,b,v,g),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(C,M,T):C.projectionMatrix.copy(M.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Wr*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,C,t)}},r.getCamera=function(){return C},r.getFoveation=function(){if(null!==m||null!==v)return c},r.setFoveation=function(e){c=e,null!==m&&(m.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)};var N=null;var z=new ml;return z.setAnimationLoop((function(t,n){if(d=n.getViewerPose(h||l),y=n,null!==d){var i=d.views;null!==v&&(e.setRenderTargetFramebuffer(b,v.framebuffer),e.setRenderTarget(b));var r=!1;i.length!==C.cameras.length&&(C.cameras.length=0,r=!0);for(var o=0;o<i.length;o++){var s=i[o],u=null;if(null!==v)u=v.getViewport(s);else{var c=p.getViewSubImage(m,s);u=c.viewport,0===o&&(e.setRenderTargetTextures(b,c.colorTexture,m.ignoreDepthValues?void 0:c.depthStencilTexture),e.setRenderTarget(b))}var f=E[o];void 0===f&&((f=new il).layers.enable(o),f.viewport=new Ea,E[o]=f),f.matrix.fromArray(s.transform.matrix),f.matrix.decompose(f.position,f.quaternion,f.scale),f.projectionMatrix.fromArray(s.projectionMatrix),f.projectionMatrixInverse.copy(f.projectionMatrix).invert(),f.viewport.set(u.x,u.y,u.width,u.height),0===o&&(C.matrix.copy(f.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),!0===r&&C.cameras.push(f)}}for(var g=0;g<w.length;g++){var _=S[g],x=w[g];null!==_&&void 0!==x&&x.update(_,n,h||l)}N&&N(t,n),n.detectedPlanes&&a.dispatchEvent({type:"planesdetected",data:n}),y=null})),r.setAnimationLoop=function(e){N=e},r.dispose=function(){},r}return v(n)}(Hr);function Zc(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===Mt&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===Mt&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);var a=t.get(r).envMap;if(a&&(i.envMap.value=a,i.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;var o=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*o,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,$s(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,a,o,s){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform));e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));var r=t.get(i).envMap;r&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===Mt&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,s)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){var i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,a,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function qc(e,t,n,i){var r={},a={},o=[],s=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){var i=e.value;if(void 0===n[t]){if("number"===typeof i)n[t]=i;else{for(var r=Array.isArray(i)?i:[i],a=[],o=0;o<r.length;o++)a.push(r[o].clone());n[t]=a}return!0}if("number"===typeof i){if(n[t]!==i)return n[t]=i,!0}else for(var s=Array.isArray(n[t])?n[t]:[n[t]],l=Array.isArray(i)?i:[i],u=0;u<s.length;u++){var c=s[u];if(!1===c.equals(l[u]))return c.copy(l[u]),!0}return!1}function u(e){var t={boundary:0,storage:0};return"number"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){var n=t.target;n.removeEventListener("dispose",c);var i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(e,t){var n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){var f=r[n.id];void 0===f&&(!function(e){for(var t=e.uniforms,n=0,i=16,r=0,a=0,o=t.length;a<o;a++){for(var s=t[a],l={boundary:0,storage:0},c=Array.isArray(s.value)?s.value:[s.value],h=0,f=c.length;h<f;h++){var d=u(c[h]);l.boundary+=d.boundary,l.storage+=d.storage}if(s.__data=new Float32Array(l.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,a>0)0!==(r=n%i)&&i-r-l.boundary<0&&(n+=i-r,s.__offset=n);n+=l.storage}(r=n%i)>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),f=function(t){var n=function(){for(var e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;var i=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=f,n.addEventListener("dispose",c));var d=h.program;i.updateUBOMapping(n,d);var p=t.render.frame;a[n.id]!==p&&(!function(t){var n=r[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(var o=0,s=i.length;o<s;o++){var c=i[o];if(!0===l(c,o,a)){for(var h=c.__offset,f=Array.isArray(c.value)?c.value:[c.value],d=0,p=0;p<f.length;p++){var m=f[p],v=u(m);"number"===typeof m?(c.__data[0]=m,e.bufferSubData(e.UNIFORM_BUFFER,h+d,c.__data)):m.isMatrix3?(c.__data[0]=m.elements[0],c.__data[1]=m.elements[1],c.__data[2]=m.elements[2],c.__data[3]=m.elements[0],c.__data[4]=m.elements[3],c.__data[5]=m.elements[4],c.__data[6]=m.elements[5],c.__data[7]=m.elements[0],c.__data[8]=m.elements[6],c.__data[9]=m.elements[7],c.__data[10]=m.elements[8],c.__data[11]=m.elements[0]):(m.toArray(c.__data,d),d+=v.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,h,c.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=p)},dispose:function(){for(var t in r)e.deleteBuffer(r[t]);o=[],r={},a={}}}}var Yc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,e);var n,i=t.canvas,r=void 0===i?ua():i,a=t.context,o=void 0===a?null:a,s=t.depth,l=void 0===s||s,u=t.stencil,c=void 0===u||u,h=t.alpha,d=void 0!==h&&h,p=t.antialias,m=void 0!==p&&p,v=t.premultipliedAlpha,g=void 0===v||v,y=t.preserveDrawingBuffer,_=void 0!==y&&y,x=t.powerPreference,b=void 0===x?"default":x,w=t.failIfMajorPerformanceCaveat,S=void 0!==w&&w;this.isWebGLRenderer=!0,n=null!==o?o.getContextAttributes().alpha:d;var M=new Uint32Array(4),T=new Int32Array(4),E=null,C=null,k=[],P=[];this.domElement=r,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=$i,this._useLegacyLights=!1,this.toneMapping=sn,this.toneMappingExposure=1;var A=this,R=!1,L=0,I=0,O=null,D=-1,N=null,z=new Ea,U=new Ea,F=null,B=new ns(0),H=0,j=r.width,G=r.height,V=1,W=null,X=null,Z=new Ea(0,0,j,G),q=new Ea(0,0,j,G),Y=!1,J=new pl,Q=!1,K=!1,$=null,ee=new ho,te=new na,ne=new Da,ie={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function re(){return null===O?V:1}var ae,oe,se,le,ue,ce,he,fe,de,pe,me,ve,ge,ye,_e,xe,be,we,Se,Me,Te,Ee,Ce,ke,Pe=o;function Ae(e,t){for(var n=0;n<e.length;n++){var i=e[n],a=r.getContext(i,t);if(null!==a)return a}return null}try{var Re={alpha:!0,depth:l,stencil:c,antialias:m,premultipliedAlpha:g,preserveDrawingBuffer:_,powerPreference:b,failIfMajorPerformanceCaveat:S};if("setAttribute"in r&&r.setAttribute("data-engine","three.js r".concat(ft)),r.addEventListener("webglcontextlost",De,!1),r.addEventListener("webglcontextrestored",Ne,!1),r.addEventListener("webglcontextcreationerror",ze,!1),null===Pe){var Le=["webgl2","webgl","experimental-webgl"];if(!0===A.isWebGL1Renderer&&Le.shift(),null===(Pe=Ae(Le,Re)))throw Ae(Le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!==typeof WebGLRenderingContext&&Pe instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Pe.getShaderPrecisionFormat&&(Pe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ye){throw console.error("THREE.WebGLRenderer: "+Ye.message),Ye}function Ie(){ae=new Gl(Pe),oe=new Tl(Pe,ae,t),ae.init(oe),Ee=new Bc(Pe,ae,oe),se=new Nc(Pe,ae,oe),le=new Xl(Pe),ue=new wc,ce=new zc(Pe,ae,se,ue,oe,Ee,le),he=new Cl(A),fe=new jl(A),de=new vl(Pe,oe),Ce=new Sl(Pe,ae,de,oe),pe=new Vl(Pe,de,le,Ce),me=new Jl(Pe,pe,de,le),Se=new Yl(Pe,oe,ce),xe=new El(ue),ve=new bc(A,he,fe,ae,oe,Ce,xe),ge=new Zc(A,ue),ye=new Ec,_e=new Lc(ae,oe),we=new wl(A,he,fe,se,me,n,g),be=new Dc(A,me,oe),ke=new qc(Pe,le,oe,se),Me=new Ml(Pe,ae,le,oe),Te=new Wl(Pe,ae,le,oe),le.programs=ve.programs,A.capabilities=oe,A.extensions=ae,A.properties=ue,A.renderLists=ye,A.shadowMap=be,A.state=se,A.info=le}Ie();var Oe=new Xc(A,Pe);function De(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Ne(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;var e=le.autoReset,t=be.enabled,n=be.autoUpdate,i=be.needsUpdate,r=be.type;Ie(),le.autoReset=e,be.enabled=t,be.autoUpdate=n,be.needsUpdate=i,be.type=r}function ze(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ue(e){var t=e.target;t.removeEventListener("dispose",Ue),function(e){(function(e){var t=ue.get(e).programs;void 0!==t&&(t.forEach((function(e){ve.releaseProgram(e)})),e.isShaderMaterial&&ve.releaseShaderCache(e))})(e),ue.remove(e)}(t)}this.xr=Oe,this.getContext=function(){return Pe},this.getContextAttributes=function(){return Pe.getContextAttributes()},this.forceContextLoss=function(){var e=ae.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=ae.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(e){void 0!==e&&(V=e,this.setSize(j,G,!1))},this.getSize=function(e){return e.set(j,G)},this.setSize=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Oe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(j=e,G=t,r.width=Math.floor(e*V),r.height=Math.floor(t*V),!0===n&&(r.style.width=e+"px",r.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(j*V,G*V).floor()},this.setDrawingBufferSize=function(e,t,n){j=e,G=t,V=n,r.width=Math.floor(e*n),r.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(z)},this.getViewport=function(e){return e.copy(Z)},this.setViewport=function(e,t,n,i){e.isVector4?Z.set(e.x,e.y,e.z,e.w):Z.set(e,t,n,i),se.viewport(z.copy(Z).multiplyScalar(V).floor())},this.getScissor=function(e){return e.copy(q)},this.setScissor=function(e,t,n,i){e.isVector4?q.set(e.x,e.y,e.z,e.w):q.set(e,t,n,i),se.scissor(U.copy(q).multiplyScalar(V).floor())},this.getScissorTest=function(){return Y},this.setScissorTest=function(e){se.setScissorTest(Y=e)},this.setOpaqueSort=function(e){W=e},this.setTransparentSort=function(e){X=e},this.getClearColor=function(e){return e.copy(we.getClearColor())},this.setClearColor=function(){we.setClearColor.apply(we,arguments)},this.getClearAlpha=function(){return we.getClearAlpha()},this.setClearAlpha=function(){we.setClearAlpha.apply(we,arguments)},this.clear=function(){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var i=!1;if(null!==O){var r=O.texture.format;i=r===$n||r===Kn||r===Jn}if(i){var a=O.texture.type,o=a===Ln||a===zn||a===Dn||a===jn||a===Bn||a===Hn,s=we.getClearColor(),l=we.getClearAlpha(),u=s.r,c=s.g,h=s.b;o?(M[0]=u,M[1]=c,M[2]=h,M[3]=l,Pe.clearBufferuiv(Pe.COLOR,0,M)):(T[0]=u,T[1]=c,T[2]=h,T[3]=l,Pe.clearBufferiv(Pe.COLOR,0,T))}else n|=Pe.COLOR_BUFFER_BIT}e&&(n|=Pe.DEPTH_BUFFER_BIT),t&&(n|=Pe.STENCIL_BUFFER_BIT),Pe.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",De,!1),r.removeEventListener("webglcontextrestored",Ne,!1),r.removeEventListener("webglcontextcreationerror",ze,!1),ye.dispose(),_e.dispose(),ue.dispose(),he.dispose(),fe.dispose(),me.dispose(),Ce.dispose(),ke.dispose(),ve.dispose(),Oe.dispose(),Oe.removeEventListener("sessionstart",Be),Oe.removeEventListener("sessionend",He),$&&($.dispose(),$=null),je.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=ie);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(e,t,n,i,r){!0!==t.isScene&&(t=ie);ce.resetTextureUnits();var a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===O?A.outputColorSpace:!0===O.isXRRenderTarget?O.texture.colorSpace:er,l=(i.isMeshStandardMaterial?fe:he).get(i.envMap||o),u=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,d=!!n.morphAttributes.color,p=sn;i.toneMapped&&(null!==O&&!0!==O.isXRRenderTarget||(p=A.toneMapping));var m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,g=ue.get(i),y=C.state.lights;if(!0===Q&&(!0===K||e!==N)){var _=e===N&&i.id===D;xe.setState(i,e,_)}var x=!1;i.version===g.__version?g.needsLights&&g.lightsStateVersion!==y.state.version||g.outputColorSpace!==s||r.isInstancedMesh&&!1===g.instancing?x=!0:r.isInstancedMesh||!0!==g.instancing?r.isSkinnedMesh&&!1===g.skinning?x=!0:r.isSkinnedMesh||!0!==g.skinning?r.isInstancedMesh&&!0===g.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===g.instancingColor&&null!==r.instanceColor||g.envMap!==l||!0===i.fog&&g.fog!==a?x=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===xe.numPlanes&&g.numIntersection===xe.numIntersection?(g.vertexAlphas!==u||g.vertexTangents!==c||g.morphTargets!==h||g.morphNormals!==f||g.morphColors!==d||g.toneMapping!==p||!0===oe.isWebGL2&&g.morphTargetsCount!==v)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,g.__version=i.version);var b=g.currentProgram;!0===x&&(b=Ze(i,t,r));var w=!1,S=!1,M=!1,T=b.getUniforms(),E=g.uniforms;se.useProgram(b.program)&&(w=!0,S=!0,M=!0);i.id!==D&&(D=i.id,S=!0);if(w||N!==e){T.setValue(Pe,"projectionMatrix",e.projectionMatrix),T.setValue(Pe,"viewMatrix",e.matrixWorldInverse);var k=T.map.cameraPosition;void 0!==k&&k.setValue(Pe,ne.setFromMatrixPosition(e.matrixWorld)),oe.logarithmicDepthBuffer&&T.setValue(Pe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&T.setValue(Pe,"isOrthographic",!0===e.isOrthographicCamera),N!==e&&(N=e,S=!0,M=!0)}if(r.isSkinnedMesh){T.setOptional(Pe,r,"bindMatrix"),T.setOptional(Pe,r,"bindMatrixInverse");var P=r.skeleton;P&&(oe.floatVertexTextures?(null===P.boneTexture&&P.computeBoneTexture(),T.setValue(Pe,"boneTexture",P.boneTexture,ce),T.setValue(Pe,"boneTextureSize",P.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var R=n.morphAttributes;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===oe.isWebGL2)&&Se.update(r,n,b);(S||g.receiveShadow!==r.receiveShadow)&&(g.receiveShadow=r.receiveShadow,T.setValue(Pe,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(E.envMap.value=l,E.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);S&&(T.setValue(Pe,"toneMappingExposure",A.toneMappingExposure),g.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(E,M),a&&!0===i.fog&&ge.refreshFogUniforms(E,a),ge.refreshMaterialUniforms(E,i,V,G,$),ec.upload(Pe,g.uniformsList,E,ce));i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ec.upload(Pe,g.uniformsList,E,ce),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&T.setValue(Pe,"center",r.center);if(T.setValue(Pe,"modelViewMatrix",r.modelViewMatrix),T.setValue(Pe,"normalMatrix",r.normalMatrix),T.setValue(Pe,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial)for(var L=i.uniformsGroups,I=0,z=L.length;I<z;I++)if(oe.isWebGL2){var U=L[I];ke.update(U,b),ke.bind(U,b)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");return b}(e,t,n,i,r);se.setMaterial(i,o);var l=n.index,u=1;if(!0===i.wireframe){if(void 0===(l=pe.getWireframeAttribute(n)))return;u=2}var c=n.drawRange,h=n.attributes.position,f=c.start*u,d=(c.start+c.count)*u;null!==a&&(f=Math.max(f,a.start*u),d=Math.min(d,(a.start+a.count)*u)),null!==l?(f=Math.max(f,0),d=Math.min(d,l.count)):void 0!==h&&null!==h&&(f=Math.max(f,0),d=Math.min(d,h.count));var p=d-f;if(!(p<0||p===1/0)){var m;Ce.setup(r,i,s,n,l);var v=Me;if(null!==l&&(m=de.get(l),(v=Te).setIndex(m)),r.isMesh)!0===i.wireframe?(se.setLineWidth(i.wireframeLinewidth*re()),v.setMode(Pe.LINES)):v.setMode(Pe.TRIANGLES);else if(r.isLine){var g=i.linewidth;void 0===g&&(g=1),se.setLineWidth(g*re()),r.isLineSegments?v.setMode(Pe.LINES):r.isLineLoop?v.setMode(Pe.LINE_LOOP):v.setMode(Pe.LINE_STRIP)}else r.isPoints?v.setMode(Pe.POINTS):r.isSprite&&v.setMode(Pe.TRIANGLES);if(r.isInstancedMesh)v.renderInstances(f,p,r.count);else if(n.isInstancedBufferGeometry){var y=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,_=Math.min(n.instanceCount,y);v.renderInstances(f,p,_)}else v.render(f,p)}},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===Tt&&!1===e.forceSinglePass?(e.side=Mt,e.needsUpdate=!0,Ze(e,t,n),e.side=St,e.needsUpdate=!0,Ze(e,t,n),e.side=Tt):Ze(e,t,n)}(C=_e.get(e)).init(),P.push(C),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(C.pushLight(e),e.castShadow&&C.pushShadow(e))})),C.setupLights(A._useLegacyLights),e.traverse((function(t){var i=t.material;if(i)if(Array.isArray(i))for(var r=0;r<i.length;r++){n(i[r],e,t)}else n(i,e,t)})),P.pop(),C=null};var Fe=null;function Be(){je.stop()}function He(){je.start()}var je=new ml;function Ge(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)C.pushLight(e),e.castShadow&&C.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||J.intersectsSprite(e)){i&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ee);var r=me.update(e),a=e.material;a.visible&&E.push(e,r,a,n,ne.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||J.intersectsObject(e))){var o=me.update(e),s=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),ne.copy(e.boundingSphere.center)):(null===o.boundingSphere&&o.computeBoundingSphere(),ne.copy(o.boundingSphere.center)),ne.applyMatrix4(e.matrixWorld).applyMatrix4(ee)),Array.isArray(s))for(var l=o.groups,u=0,c=l.length;u<c;u++){var h=l[u],f=s[h.materialIndex];f&&f.visible&&E.push(e,o,f,n,ne.z,h)}else s.visible&&E.push(e,o,s,n,ne.z,null)}for(var d=e.children,p=0,m=d.length;p<m;p++)Ge(d[p],t,n,i)}}function Ve(e,t,n,i){var r=e.opaque,a=e.transmissive,o=e.transparent;C.setupLightsView(n),!0===Q&&xe.setGlobalState(A.clippingPlanes,n),a.length>0&&function(e,t,n,i){var r=oe.isWebGL2;null===$&&($=new ka(1,1,{generateMipmaps:!0,type:ae.has("EXT_color_buffer_half_float")?Fn:Ln,minFilter:An,samples:r?4:0}));A.getDrawingBufferSize(te),r?$.setSize(te.x,te.y):$.setSize(Kr(te.x),Kr(te.y));var a=A.getRenderTarget();A.setRenderTarget($),A.getClearColor(B),(H=A.getClearAlpha())<1&&A.setClearColor(16777215,.5);A.clear();var o=A.toneMapping;A.toneMapping=sn,We(e,n,i),ce.updateMultisampleRenderTarget($),ce.updateRenderTargetMipmap($);for(var s=!1,l=0,u=t.length;l<u;l++){var c=t[l],h=c.object,f=c.geometry,d=c.material,p=c.group;if(d.side===Tt&&h.layers.test(i.layers)){var m=d.side;d.side=Mt,d.needsUpdate=!0,Xe(h,n,i,f,d,p),d.side=m,d.needsUpdate=!0,s=!0}}!0===s&&(ce.updateMultisampleRenderTarget($),ce.updateRenderTargetMipmap($));A.setRenderTarget(a),A.setClearColor(B,H),A.toneMapping=o}(r,a,t,n),i&&se.viewport(z.copy(i)),r.length>0&&We(r,t,n),a.length>0&&We(a,t,n),o.length>0&&We(o,t,n),se.buffers.depth.setTest(!0),se.buffers.depth.setMask(!0),se.buffers.color.setMask(!0),se.setPolygonOffset(!1)}function We(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,l=o.geometry,u=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&Xe(s,t,n,l,u,c)}}function Xe(e,t,n,i,r,a){e.onBeforeRender(A,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(A,t,n,i,e,a),!0===r.transparent&&r.side===Tt&&!1===r.forceSinglePass?(r.side=Mt,r.needsUpdate=!0,A.renderBufferDirect(n,t,i,r,e,a),r.side=St,r.needsUpdate=!0,A.renderBufferDirect(n,t,i,r,e,a),r.side=Tt):A.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(A,t,n,i,r,a)}function Ze(e,t,n){!0!==t.isScene&&(t=ie);var i=ue.get(e),r=C.state.lights,a=C.state.shadowsArray,o=r.state.version,s=ve.getParameters(e,r.state,a,t,n),l=ve.getProgramCacheKey(s),u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?fe:he).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",Ue),u=new Map,i.programs=u);var c=u.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===o)return qe(e,s),c}else s.uniforms=ve.getUniforms(e),e.onBuild(n,s,A),e.onBeforeCompile(s,A),c=ve.acquireProgram(s,l),u.set(l,c),i.uniforms=s.uniforms;var h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=xe.uniform),qe(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);var f=c.getUniforms(),d=ec.seqWithValue(f.seq,h);return i.currentProgram=c,i.uniformsList=d,c}function qe(e,t){var n=ue.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}je.setAnimationLoop((function(e){Fe&&Fe(e)})),"undefined"!==typeof self&&je.setContext(self),this.setAnimationLoop=function(e){Fe=e,Oe.setAnimationLoop(e),null===e?je.stop():je.start()},Oe.addEventListener("sessionstart",Be),Oe.addEventListener("sessionend",He),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==R){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Oe.enabled&&!0===Oe.isPresenting&&(!0===Oe.cameraAutoUpdate&&Oe.updateCamera(t),t=Oe.getCamera()),!0===e.isScene&&e.onBeforeRender(A,e,t,O),(C=_e.get(e,P.length)).init(),P.push(C),ee.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromProjectionMatrix(ee),K=this.localClippingEnabled,Q=xe.init(this.clippingPlanes,K),(E=ye.get(e,k.length)).init(),k.push(E),Ge(e,t,0,A.sortObjects),E.finish(),!0===A.sortObjects&&E.sort(W,X),this.info.render.frame++,!0===Q&&xe.beginShadows();var n=C.state.shadowsArray;if(be.render(n,e,t),!0===Q&&xe.endShadows(),!0===this.info.autoReset&&this.info.reset(),we.render(E,e),C.setupLights(A._useLegacyLights),t.isArrayCamera)for(var i=t.cameras,r=0,a=i.length;r<a;r++){var o=i[r];Ve(E,e,o,o.viewport)}else Ve(E,e,t);null!==O&&(ce.updateMultisampleRenderTarget(O),ce.updateRenderTargetMipmap(O)),!0===e.isScene&&e.onAfterRender(A,e,t),Ce.resetDefaultState(),D=-1,N=null,P.pop(),C=P.length>0?P[P.length-1]:null,k.pop(),E=k.length>0?k[k.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return O},this.setRenderTargetTextures=function(e,t,n){ue.get(e.texture).__webglTexture=t,ue.get(e.depthTexture).__webglTexture=n;var i=ue.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===ae.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=ue.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;O=e,L=t,I=n;var i=!0,r=null,a=!1,o=!1;if(e){var s=ue.get(e);void 0!==s.__useDefaultFramebuffer?(se.bindFramebuffer(Pe.FRAMEBUFFER,null),i=!1):void 0===s.__webglFramebuffer?ce.setupRenderTarget(e):s.__hasExternalTextures&&ce.rebindTextures(e,ue.get(e.texture).__webglTexture,ue.get(e.depthTexture).__webglTexture);var l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);var u=ue.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(u[t])?u[t][n]:u[t],a=!0):r=oe.isWebGL2&&e.samples>0&&!1===ce.useMultisampledRTT(e)?ue.get(e).__webglMultisampledFramebuffer:Array.isArray(u)?u[n]:u,z.copy(e.viewport),U.copy(e.scissor),F=e.scissorTest}else z.copy(Z).multiplyScalar(V).floor(),U.copy(q).multiplyScalar(V).floor(),F=Y;if(se.bindFramebuffer(Pe.FRAMEBUFFER,r)&&oe.drawBuffers&&i&&se.drawBuffers(e,r),se.viewport(z),se.scissor(U),se.setScissorTest(F),a){var c=ue.get(e.texture);Pe.framebufferTexture2D(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,Pe.TEXTURE_CUBE_MAP_POSITIVE_X+t,c.__webglTexture,n)}else if(o){var h=ue.get(e.texture),f=t||0;Pe.framebufferTextureLayer(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,h.__webglTexture,n||0,f)}D=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=ue.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){se.bindFramebuffer(Pe.FRAMEBUFFER,s);try{var l=e.texture,u=l.format,c=l.type;if(u!==Vn&&Ee.convert(u)!==Pe.getParameter(Pe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=c===Fn&&(ae.has("EXT_color_buffer_half_float")||oe.isWebGL2&&ae.has("EXT_color_buffer_float"));if(c!==Ln&&Ee.convert(c)!==Pe.getParameter(Pe.IMPLEMENTATION_COLOR_READ_TYPE)&&(c!==Un||!(oe.isWebGL2||ae.has("OES_texture_float")||ae.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&Pe.readPixels(t,n,i,r,Ee.convert(u),Ee.convert(c),a)}finally{var f=null!==O?ue.get(O).__webglFramebuffer:null;se.bindFramebuffer(Pe.FRAMEBUFFER,f)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);ce.setTexture2D(t,0),Pe.copyTexSubImage2D(Pe.TEXTURE_2D,n,0,0,e.x,e.y,r,a),se.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,o=Ee.convert(n.format),s=Ee.convert(n.type);ce.setTexture2D(n,0),Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,n.flipY),Pe.pixelStorei(Pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Pe.pixelStorei(Pe.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Pe.texSubImage2D(Pe.TEXTURE_2D,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?Pe.compressedTexSubImage2D(Pe.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Pe.texSubImage2D(Pe.TEXTURE_2D,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&Pe.generateMipmap(Pe.TEXTURE_2D),se.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(A.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,u=Ee.convert(i.format),c=Ee.convert(i.type);if(i.isData3DTexture)ce.setTexture3D(i,0),a=Pe.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ce.setTexture2DArray(i,0),a=Pe.TEXTURE_2D_ARRAY}Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,i.flipY),Pe.pixelStorei(Pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Pe.pixelStorei(Pe.UNPACK_ALIGNMENT,i.unpackAlignment);var h=Pe.getParameter(Pe.UNPACK_ROW_LENGTH),f=Pe.getParameter(Pe.UNPACK_IMAGE_HEIGHT),d=Pe.getParameter(Pe.UNPACK_SKIP_PIXELS),p=Pe.getParameter(Pe.UNPACK_SKIP_ROWS),m=Pe.getParameter(Pe.UNPACK_SKIP_IMAGES),v=n.isCompressedTexture?n.mipmaps[0]:n.image;Pe.pixelStorei(Pe.UNPACK_ROW_LENGTH,v.width),Pe.pixelStorei(Pe.UNPACK_IMAGE_HEIGHT,v.height),Pe.pixelStorei(Pe.UNPACK_SKIP_PIXELS,e.min.x),Pe.pixelStorei(Pe.UNPACK_SKIP_ROWS,e.min.y),Pe.pixelStorei(Pe.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Pe.texSubImage3D(a,r,t.x,t.y,t.z,o,s,l,u,c,v.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Pe.compressedTexSubImage3D(a,r,t.x,t.y,t.z,o,s,l,u,v.data)):Pe.texSubImage3D(a,r,t.x,t.y,t.z,o,s,l,u,c,v),Pe.pixelStorei(Pe.UNPACK_ROW_LENGTH,h),Pe.pixelStorei(Pe.UNPACK_IMAGE_HEIGHT,f),Pe.pixelStorei(Pe.UNPACK_SKIP_PIXELS,d),Pe.pixelStorei(Pe.UNPACK_SKIP_ROWS,p),Pe.pixelStorei(Pe.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&Pe.generateMipmap(a),se.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?ce.setTextureCube(e,0):e.isData3DTexture?ce.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ce.setTexture2DArray(e,0):ce.setTexture2D(e,0),se.unbindTexture()},this.resetState=function(){L=0,I=0,O=null,se.reset(),Ce.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return v(e,[{key:"coordinateSystem",get:function(){return Fr}},{key:"physicallyCorrectLights",get:function(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}},{key:"outputEncoding",get:function(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===$i?Zi:Xi},set:function(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Zi?$i:er}},{key:"useLegacyLights",get:function(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}]),e}(),Jc=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n)}(Yc);Jc.prototype.isWebGL1Renderer=!0;var Qc,Kc=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;f(this,e),this.isFogExp2=!0,this.name="",this.color=new ns(t),this.density=n}return v(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}(),$c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;f(this,e),this.isFog=!0,this.name="",this.color=new ns(t),this.near=n,this.far=i}return v(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),eh=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.backgroundBlurriness=0,e.backgroundIntensity=1,e.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:g(e)})),e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}]),n}(zo),th=function(){function e(t,n){f(this,e),this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=Cr,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Xr()}return v(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}(),nh=new Da,ih=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];f(this,e),this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=r}return v(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)nh.fromBufferAttribute(this,t),nh.applyMatrix4(e),this.setXYZ(t,nh.x,nh.y,nh.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)nh.fromBufferAttribute(this,t),nh.applyNormalMatrix(e),this.setXYZ(t,nh.x,nh.y,nh.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)nh.fromBufferAttribute(this,t),nh.transformDirection(e),this.setXYZ(t,nh.x,nh.y,nh.z);return this}},{key:"setX",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.normalized&&(t=ea(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){var t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=$r(t,this.array)),t}},{key:"getY",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=$r(t,this.array)),t}},{key:"getZ",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=$r(t,this.array)),t}},{key:"getW",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=$r(t,this.array)),t}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array),i=ea(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ea(t,this.array),n=ea(n,this.array),i=ea(i,this.array),r=ea(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");for(var n=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[r+a]);return new fs(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}(),rh=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isSpriteMaterial=!0,i.type="SpriteMaterial",i.color=new ns(16777215),i.map=null,i.alphaMap=null,i.rotation=0,i.sizeAttenuation=!0,i.transparent=!0,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(Qo),ah=new Da,oh=new Da,sh=new Da,lh=new na,uh=new na,ch=new ho,hh=new Da,fh=new Da,dh=new Da,ph=new na,mh=new na,vh=new na,gh=function(e){_(n,e);var t=w(n);function n(e){var i;if(f(this,n),(i=t.call(this)).isSprite=!0,i.type="Sprite",void 0===Qc){Qc=new As;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new th(r,5);Qc.setIndex([0,1,2,0,2,3]),Qc.setAttribute("position",new ih(a,3,0,!1)),Qc.setAttribute("uv",new ih(a,2,3,!1))}return i.geometry=Qc,i.material=void 0!==e?e:new rh,i.center=new na(.5,.5),i}return v(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),oh.setFromMatrixScale(this.matrixWorld),ch.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),sh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&oh.multiplyScalar(-sh.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;yh(hh.set(-.5,-.5,0),sh,a,oh,n,i),yh(fh.set(.5,-.5,0),sh,a,oh,n,i),yh(dh.set(.5,.5,0),sh,a,oh,n,i),ph.set(0,0),mh.set(1,0),vh.set(1,1);var o=e.ray.intersectTriangle(hh,fh,dh,!1,ah);if(null!==o||(yh(fh.set(-.5,.5,0),sh,a,oh,n,i),mh.set(0,1),null!==(o=e.ray.intersectTriangle(hh,dh,fh,!1,ah)))){var s=e.ray.origin.distanceTo(ah);s<e.near||s>e.far||t.push({distance:s,point:ah.clone(),uv:Yo.getInterpolation(ah,hh,fh,dh,ph,mh,vh,new na),face:null,object:this})}}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(zo);function yh(e,t,n,i,r,a){lh.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(uh.x=a*lh.x-r*lh.y,uh.y=r*lh.x+a*lh.y):uh.copy(lh),e.copy(t),e.x+=uh.x,e.y+=uh.y,e.applyMatrix4(ch)}var _h=new Da,xh=new Da,bh=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this))._currentLevel=0,e.type="LOD",Object.defineProperties(g(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}return v(n,[{key:"copy",value:function(e){S(x(n.prototype),"copy",this).call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var a=t[i];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}},{key:"addLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);var i,r=this.levels;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}},{key:"getCurrentLevel",value:function(){return this._currentLevel}},{key:"getObjectForDistance",value:function(e){var t=this.levels;if(t.length>0){var n,i;for(n=1,i=t.length;n<i;n++){var r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}},{key:"raycast",value:function(e,t){if(this.levels.length>0){_h.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(_h);this.getObjectForDistance(n).raycast(e,t)}}},{key:"update",value:function(e){var t=this.levels;if(t.length>1){_h.setFromMatrixPosition(e.matrixWorld),xh.setFromMatrixPosition(this.matrixWorld);var n,i,r=_h.distanceTo(xh)/e.zoom;for(t[0].object.visible=!0,n=1,i=t.length;n<i;n++){var a=t[n].distance;if(t[n].object.visible&&(a-=a*t[n].hysteresis),!(r>=a))break;t[n-1].object.visible=!1,t[n].object.visible=!0}for(this._currentLevel=n-1;n<i;n++)t[n].object.visible=!1}}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,r=0,a=i.length;r<a;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}]),n}(zo),wh=new Da,Sh=new Ea,Mh=new Ea,Th=new Da,Eh=new ho,Ch=new Da,kh=new no,Ph=new ho,Ah=new co,Rh=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e,i)).isSkinnedMesh=!0,r.type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new ho,r.bindMatrixInverse=new ho,r.boundingBox=null,r.boundingSphere=null,r}return v(n,[{key:"computeBoundingBox",value:function(){var e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Ua),this.boundingBox.makeEmpty();for(var t=e.getAttribute("position"),n=0;n<t.count;n++)Ch.fromBufferAttribute(t,n),this.applyBoneTransform(n,Ch),this.boundingBox.expandByPoint(Ch)}},{key:"computeBoundingSphere",value:function(){var e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new no),this.boundingSphere.makeEmpty();for(var t=e.getAttribute("position"),n=0;n<t.count;n++)Ch.fromBufferAttribute(t,n),this.applyBoneTransform(n,Ch),this.boundingSphere.expandByPoint(Ch)}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}},{key:"raycast",value:function(e,t){var n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),kh.copy(this.boundingSphere),kh.applyMatrix4(i),!1!==e.ray.intersectsSphere(kh)&&(Ph.copy(i).invert(),Ah.copy(e.ray).applyMatrix4(Ph),null!==this.boundingBox&&!1===Ah.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Ah)))}},{key:"getVertexPosition",value:function(e,t){return S(x(n.prototype),"getVertexPosition",this).call(this,e,t),this.applyBoneTransform(e,t),t}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Ea,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){S(x(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"applyBoneTransform",value:function(e,t){var n=this.skeleton,i=this.geometry;Sh.fromBufferAttribute(i.attributes.skinIndex,e),Mh.fromBufferAttribute(i.attributes.skinWeight,e),wh.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var a=Mh.getComponent(r);if(0!==a){var o=Sh.getComponent(r);Eh.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(Th.copy(wh).applyMatrix4(Eh),a)}}return t.applyMatrix4(this.bindMatrixInverse)}},{key:"boneTransform",value:function(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}]),n}(qs),Lh=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isBone=!0,e.type="Bone",e}return v(n)}(zo),Ih=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:wn,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:wn,p=arguments.length>10?arguments[10]:void 0,m=arguments.length>11?arguments[11]:void 0;return f(this,n),(e=t.call(this,null,l,u,c,h,d,o,s,p,m)).isDataTexture=!0,e.image={data:i,width:r,height:a},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return v(n)}(Ta),Oh=new ho,Dh=new ho,Nh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];f(this,e),this.uuid=Xr(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}return v(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new ho)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new ho;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var i=0,r=this.bones.length;i<r;i++){var a=this.bones[i];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=e.length;r<a;r++){var o=e[r]?e[r].matrixWorld:Dh;Oh.multiplyMatrices(o,t[r]),Oh.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=Qr(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new Ih(t,e,e,Vn,Un);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,i=e.bones.length;n<i;n++){var r=e.bones[n],a=t[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new Lh),this.bones.push(a),this.boneInverses.push((new ho).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,i=0,r=t.length;i<r;i++){var a=t[i];e.bones.push(a.uuid);var o=n[i];e.boneInverses.push(o.toArray())}return e}}]),e}(),zh=function(e){_(n,e);var t=w(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return f(this,n),(a=t.call(this,e,i,r)).isInstancedBufferAttribute=!0,a.meshPerAttribute=o,a}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(fs),Uh=new ho,Fh=new ho,Bh=[],Hh=new Ua,jh=new ho,Gh=new qs,Vh=new no,Wh=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;f(this,n),(a=t.call(this,e,i)).isInstancedMesh=!0,a.instanceMatrix=new zh(new Float32Array(16*r),16),a.instanceColor=null,a.count=r,a.boundingBox=null,a.boundingSphere=null;for(var o=0;o<r;o++)a.setMatrixAt(o,jh);return a}return v(n,[{key:"computeBoundingBox",value:function(){var e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Ua),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(var n=0;n<t;n++)this.getMatrixAt(n,Uh),Hh.copy(e.boundingBox).applyMatrix4(Uh),this.boundingBox.union(Hh)}},{key:"computeBoundingSphere",value:function(){var e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new no),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(var n=0;n<t;n++)this.getMatrixAt(n,Uh),Vh.copy(e.boundingSphere).applyMatrix4(Uh),this.boundingSphere.union(Vh)}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,i=this.count;if(Gh.geometry=this.geometry,Gh.material=this.material,void 0!==Gh.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Vh.copy(this.boundingSphere),Vh.applyMatrix4(n),!1!==e.ray.intersectsSphere(Vh)))for(var r=0;r<i;r++){this.getMatrixAt(r,Uh),Fh.multiplyMatrices(n,Uh),Gh.matrixWorld=Fh,Gh.raycast(e,Bh);for(var a=0,o=Bh.length;a<o;a++){var s=Bh[a];s.instanceId=r,s.object=this,t.push(s)}Bh.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new zh(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(qs),Xh=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isLineBasicMaterial=!0,i.type="LineBasicMaterial",i.color=new ns(16777215),i.map=null,i.linewidth=1,i.linecap="round",i.linejoin="round",i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),n}(Qo),Zh=new Da,qh=new Da,Yh=new ho,Jh=new co,Qh=new no,Kh=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new As,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Xh;return f(this,n),(e=t.call(this)).isLine=!0,e.type="Line",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)Zh.fromBufferAttribute(t,i-1),qh.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Zh.distanceTo(qh);e.setAttribute("lineDistance",new bs(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qh.copy(n.boundingSphere),Qh.applyMatrix4(i),Qh.radius+=r,!1!==e.ray.intersectsSphere(Qh)){Yh.copy(i).invert(),Jh.copy(e.ray).applyMatrix4(Yh);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new Da,u=new Da,c=new Da,h=new Da,f=this.isLineSegments?2:1,d=n.index,p=n.attributes.position;if(null!==d)for(var m=Math.max(0,a.start),v=Math.min(d.count,a.start+a.count)-1;m<v;m+=f){var g=d.getX(m),y=d.getX(m+1);if(l.fromBufferAttribute(p,g),u.fromBufferAttribute(p,y),!(Jh.distanceSqToSegment(l,u,h,c)>s)){h.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(h);_<e.near||_>e.far||t.push({distance:_,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var x=Math.max(0,a.start),b=Math.min(p.count,a.start+a.count)-1;x<b;x+=f){if(l.fromBufferAttribute(p,x),u.fromBufferAttribute(p,x+1),!(Jh.distanceSqToSegment(l,u,h,c)>s)){h.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),n}(zo),$h=new Da,ef=new Da,tf=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e,i)).isLineSegments=!0,r.type="LineSegments",r}return v(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)$h.fromBufferAttribute(t,i),ef.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+$h.distanceTo(ef);e.setAttribute("lineDistance",new bs(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),n}(Kh),nf=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e,i)).isLineLoop=!0,r.type="LineLoop",r}return v(n)}(Kh),rf=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isPointsMaterial=!0,i.type="PointsMaterial",i.color=new ns(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(Qo),af=new ho,of=new co,sf=new no,lf=new Da,uf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new As,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rf;return f(this,n),(e=t.call(this)).isPoints=!0,e.type="Points",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),sf.copy(n.boundingSphere),sf.applyMatrix4(i),sf.radius+=r,!1!==e.ray.intersectsSphere(sf)){af.copy(i).invert(),of.copy(e.ray).applyMatrix4(af);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=n.index,u=n.attributes.position;if(null!==l)for(var c=Math.max(0,a.start),h=Math.min(l.count,a.start+a.count);c<h;c++){var f=l.getX(c);lf.fromBufferAttribute(u,f),cf(lf,f,s,i,e,t,this)}else for(var d=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);d<p;d++)lf.fromBufferAttribute(u,d),cf(lf,d,s,i,e,t,this)}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),n}(zo);function cf(e,t,n,i,r,a,o){var s=of.distanceSqToPoint(e);if(s<n){var l=new Da;of.closestPointToPoint(e,l),l.applyMatrix4(i);var u=r.ray.origin.distanceTo(l);if(u<r.near||u>r.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}var hf=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s,l,u,c){var h;f(this,n),(h=t.call(this,e,i,r,a,o,s,l,u,c)).isVideoTexture=!0,h.minFilter=void 0!==s?s:Cn,h.magFilter=void 0!==o?o:Cn,h.generateMipmaps=!1;var d=g(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){d.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return v(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(Ta),ff=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,{width:e,height:i})).isFramebufferTexture=!0,r.magFilter=wn,r.minFilter=wn,r.generateMipmaps=!1,r.needsUpdate=!0,r}return v(n)}(Ta),df=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s,l,u,c,h,d,p){var m;return f(this,n),(m=t.call(this,null,s,l,u,c,h,a,o,d,p)).isCompressedTexture=!0,m.image={width:i,height:r},m.mipmaps=e,m.flipY=!1,m.generateMipmaps=!1,m}return v(n)}(Ta),pf=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s){var l;return f(this,n),(l=t.call(this,e,i,r,o,s)).isCompressedArrayTexture=!0,l.image.depth=a,l.wrapR=xn,l}return v(n)}(df),mf=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,void 0,e[0].width,e[0].height,i,r,pn)).isCompressedCubeTexture=!0,a.isCubeTexture=!0,a.image=e,a}return v(n)}(df),vf=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s,l,u,c){var h;return f(this,n),(h=t.call(this,e,i,r,a,o,s,l,u,c)).isCanvasTexture=!0,h.needsUpdate=!0,h}return v(n)}(Ta),gf=function(){function e(){f(this,e),this.type="Curve",this.arcLengthDivisions=200}return v(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)r+=(t=this.getPoint(a/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(i[r=l]===n)return r/(a-1);var u=i[r];return(r+(n-u)/(i[r+1]-u))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new na:new Da);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Da,i=[],r=[],a=[],o=new Da,s=new ho,l=0;l<=e;l++){var u=l/e;i[l]=this.getTangentAt(u,new Da)}r[0]=new Da,a[0]=new Da;var c=Number.MAX_VALUE,h=Math.abs(i[0].x),f=Math.abs(i[0].y),d=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),f<=c&&(c=f,n.set(0,1,0)),d<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var p=1;p<=e;p++){if(r[p]=r[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(i[p-1],i[p]),o.length()>Number.EPSILON){o.normalize();var m=Math.acos(Zr(i[p-1].dot(i[p]),-1,1));r[p].applyMatrix4(s.makeRotationAxis(o,m))}a[p].crossVectors(i[p],r[p])}if(!0===t){var v=Math.acos(Zr(r[0].dot(r[e]),-1,1));v/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(v=-v);for(var g=1;g<=e;g++)r[g].applyMatrix4(s.makeRotationAxis(i[g],v*g)),a[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),yf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return f(this,n),(e=t.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=i,e.aY=r,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=l,e.aClockwise=u,e.aRotation=c,e}return v(n,[{key:"getPoint",value:function(e,t){for(var n=t||new na,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,f=l-this.aY;s=h*u-f*c+this.aX,l=h*c+f*u+this.aY}return n.set(s,l)}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(gf),_f=function(e){_(n,e);var t=w(n);function n(e,i,r,a,o,s){var l;return f(this,n),(l=t.call(this,e,i,r,r,a,o,s)).isArcCurve=!0,l.type="ArcCurve",l}return v(n)}(yf);function xf(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,l*=o,u*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}var bf=new Da,wf=new xf,Sf=new xf,Mf=new xf,Tf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return f(this,n),(e=t.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=i,e.closed=r,e.curveType=a,e.tension=o,e}return v(n,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da,r=this.points,a=r.length,o=(a-(this.closed?0:1))*e,s=Math.floor(o),l=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:0===l&&s===a-1&&(s=a-2,l=1),this.closed||s>0?t=r[(s-1)%a]:(bf.subVectors(r[0],r[1]).add(r[0]),t=bf);var u=r[s%a],c=r[(s+1)%a];if(this.closed||s+2<a?n=r[(s+2)%a]:(bf.subVectors(r[a-1],r[a-2]).add(r[a-1]),n=bf),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,f=Math.pow(t.distanceToSquared(u),h),d=Math.pow(u.distanceToSquared(c),h),p=Math.pow(c.distanceToSquared(n),h);d<1e-4&&(d=1),f<1e-4&&(f=d),p<1e-4&&(p=d),wf.initNonuniformCatmullRom(t.x,u.x,c.x,n.x,f,d,p),Sf.initNonuniformCatmullRom(t.y,u.y,c.y,n.y,f,d,p),Mf.initNonuniformCatmullRom(t.z,u.z,c.z,n.z,f,d,p)}else"catmullrom"===this.curveType&&(wf.initCatmullRom(t.x,u.x,c.x,n.x,this.tension),Sf.initCatmullRom(t.y,u.y,c.y,n.y,this.tension),Mf.initCatmullRom(t.z,u.z,c.z,n.z,this.tension));return i.set(wf.calc(l),Sf.calc(l),Mf.calc(l)),i}},{key:"copy",value:function(e){S(x(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){S(x(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Da).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(gf);function Ef(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function Cf(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function kf(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}var Pf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new na,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new na,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new na;return f(this,n),(e=t.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(kf(e,n.x,i.x,r.x,a.x),kf(e,n.y,i.y,r.y,a.y)),t}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(gf),Af=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Da,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Da;return f(this,n),(e=t.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(kf(e,n.x,i.x,r.x,a.x),kf(e,n.y,i.y,r.y,a.y),kf(e,n.z,i.z,r.z,a.z)),t}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(gf),Rf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new na,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na;return f(this,n),(e=t.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=i,e.v2=r,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(e,t){return this.getTangent(e,t)}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gf),Lf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da;return f(this,n),(e=t.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=i,e.v2=r,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(e,t){return this.getTangent(e,t)}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gf),If=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new na,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new na;return f(this,n),(e=t.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=i,e.v1=r,e.v2=a,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na,n=this.v0,i=this.v1,r=this.v2;return t.set(Cf(e,n.x,i.x,r.x),Cf(e,n.y,i.y,r.y)),t}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gf),Of=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Da;return f(this,n),(e=t.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da,n=this.v0,i=this.v1,r=this.v2;return t.set(Cf(e,n.x,i.x,r.x),Cf(e,n.y,i.y,r.y),Cf(e,n.z,i.z,r.z)),t}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gf),Df=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return f(this,n),(e=t.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=i,e}return v(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na,n=this.points,i=(n.length-1)*e,r=Math.floor(i),a=i-r,o=n[0===r?r:r-1],s=n[r],l=n[r>n.length-2?n.length-1:r+1],u=n[r>n.length-3?n.length-1:r+2];return t.set(Ef(a,o.x,s.x,l.x,u.x),Ef(a,o.y,s.y,l.y,u.y)),t}},{key:"copy",value:function(e){S(x(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e}},{key:"fromJSON",value:function(e){S(x(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new na).fromArray(r))}return this}}]),n}(gf),Nf=Object.freeze({__proto__:null,ArcCurve:_f,CatmullRomCurve3:Tf,CubicBezierCurve:Pf,CubicBezierCurve3:Af,EllipseCurve:yf,LineCurve:Rf,LineCurve3:Lf,QuadraticBezierCurve:If,QuadraticBezierCurve3:Of,SplineCurve:Df}),zf=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return v(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Rf(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var a=i[r]-n,o=this.curves[r],s=o.getLength(),l=0===s?0:1-a/s;return o.getPointAt(l,t)}r++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){S(x(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){S(x(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Nf[r.type]).fromJSON(r))}return this}}]),n}(gf),Uf=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).type="Path",i.currentPoint=new na,e&&i.setFromPoints(e),i}return v(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Rf(this.currentPoint.clone(),new na(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new If(this.currentPoint.clone(),new na(e,t),new na(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new Pf(this.currentPoint.clone(),new na(e,t),new na(n,i),new na(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new Df(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var l=new yf(e,t,n,i,r,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return S(x(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(zf),Ff=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new na(0,-.5),new na(.5,0),new na(0,.5)],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;f(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:i,segments:r,phiStart:a,phiLength:o},r=Math.floor(r),o=Zr(o,0,2*Math.PI);for(var s=[],l=[],u=[],c=[],h=[],d=1/r,p=new Da,m=new na,v=new Da,g=new Da,y=new Da,_=0,x=0,b=0;b<=i.length-1;b++)switch(b){case 0:_=i[b+1].x-i[b].x,x=i[b+1].y-i[b].y,v.x=1*x,v.y=-_,v.z=0*x,y.copy(v),v.normalize(),c.push(v.x,v.y,v.z);break;case i.length-1:c.push(y.x,y.y,y.z);break;default:_=i[b+1].x-i[b].x,x=i[b+1].y-i[b].y,v.x=1*x,v.y=-_,v.z=0*x,g.copy(v),v.x+=y.x,v.y+=y.y,v.z+=y.z,v.normalize(),c.push(v.x,v.y,v.z),y.copy(g)}for(var w=0;w<=r;w++)for(var S=a+w*d*o,M=Math.sin(S),T=Math.cos(S),E=0;E<=i.length-1;E++){p.x=i[E].x*M,p.y=i[E].y,p.z=i[E].x*T,l.push(p.x,p.y,p.z),m.x=w/r,m.y=E/(i.length-1),u.push(m.x,m.y);var C=c[3*E+0]*M,k=c[3*E+1],P=c[3*E+0]*T;h.push(C,k,P)}for(var A=0;A<r;A++)for(var R=0;R<i.length-1;R++){var L=R+A*i.length,I=L,O=L+i.length,D=L+i.length+1,N=L+1;s.push(I,O,N),s.push(D,N,O)}return e.setIndex(s),e.setAttribute("position",new bs(l,3)),e.setAttribute("uv",new bs(u,2)),e.setAttribute("normal",new bs(h,3)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(As),Bf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;f(this,n);var s=new Uf;return s.absarc(0,-r/2,i,1.5*Math.PI,0),s.absarc(0,r/2,i,0,.5*Math.PI),(e=t.call(this,s.getPoints(a),o)).type="CapsuleGeometry",e.parameters={radius:i,length:r,capSegments:a,radialSegments:o},e}return v(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.length,e.capSegments,e.radialSegments)}}]),n}(Ff),Hf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;f(this,n),(e=t.call(this)).type="CircleGeometry",e.parameters={radius:i,segments:r,thetaStart:a,thetaLength:o},r=Math.max(3,r);var s=[],l=[],u=[],c=[],h=new Da,d=new na;l.push(0,0,0),u.push(0,0,1),c.push(.5,.5);for(var p=0,m=3;p<=r;p++,m+=3){var v=a+p/r*o;h.x=i*Math.cos(v),h.y=i*Math.sin(v),l.push(h.x,h.y,h.z),u.push(0,0,1),d.x=(l[m]/i+1)/2,d.y=(l[m+1]/i+1)/2,c.push(d.x,d.y)}for(var g=1;g<=r;g++)s.push(g,g+1,0);return e.setIndex(s),e.setAttribute("position",new bs(l,3)),e.setAttribute("normal",new bs(u,3)),e.setAttribute("uv",new bs(c,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]),n}(As),jf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;f(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:i,radiusBottom:r,height:a,radialSegments:o,heightSegments:s,openEnded:l,thetaStart:u,thetaLength:c};var h=g(e);o=Math.floor(o),s=Math.floor(s);var d=[],p=[],m=[],v=[],y=0,_=[],x=a/2,b=0;function w(e){for(var t=y,n=new na,a=new Da,s=0,l=!0===e?i:r,f=!0===e?1:-1,g=1;g<=o;g++)p.push(0,x*f,0),m.push(0,f,0),v.push(.5,.5),y++;for(var _=y,w=0;w<=o;w++){var S=w/o*c+u,M=Math.cos(S),T=Math.sin(S);a.x=l*T,a.y=x*f,a.z=l*M,p.push(a.x,a.y,a.z),m.push(0,f,0),n.x=.5*M+.5,n.y=.5*T*f+.5,v.push(n.x,n.y),y++}for(var E=0;E<o;E++){var C=t+E,k=_+E;!0===e?d.push(k,k+1,C):d.push(k+1,k,C),s+=3}h.addGroup(b,s,!0===e?1:2),b+=s}return function(){for(var e=new Da,t=new Da,n=0,l=(r-i)/a,f=0;f<=s;f++){for(var g=[],w=f/s,S=w*(r-i)+i,M=0;M<=o;M++){var T=M/o,E=T*c+u,C=Math.sin(E),k=Math.cos(E);t.x=S*C,t.y=-w*a+x,t.z=S*k,p.push(t.x,t.y,t.z),e.set(C,l,k).normalize(),m.push(e.x,e.y,e.z),v.push(T,1-w),g.push(y++)}_.push(g)}for(var P=0;P<o;P++)for(var A=0;A<s;A++){var R=_[A][P],L=_[A+1][P],I=_[A+1][P+1],O=_[A][P+1];d.push(R,L,O),d.push(L,I,O),n+=6}h.addGroup(b,n,0),b+=n}(),!1===l&&(i>0&&w(!0),r>0&&w(!1)),e.setIndex(d),e.setAttribute("position",new bs(p,3)),e.setAttribute("normal",new bs(m,3)),e.setAttribute("uv",new bs(v,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(As),Gf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return f(this,n),(e=t.call(this,0,i,r,a,o,s,l,u)).type="ConeGeometry",e.parameters={radius:i,height:r,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:u},e}return v(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(jf),Vf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;f(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:i,indices:r,radius:a,detail:o};var s=[],l=[];function u(e,t,n,i){for(var r=i+1,a=[],o=0;o<=r;o++){a[o]=[];for(var s=e.clone().lerp(n,o/r),l=t.clone().lerp(n,o/r),u=r-o,h=0;h<=u;h++)a[o][h]=0===h&&o===r?s:s.clone().lerp(l,h/u)}for(var f=0;f<r;f++)for(var d=0;d<2*(r-f)-1;d++){var p=Math.floor(d/2);d%2===0?(c(a[f][p+1]),c(a[f+1][p]),c(a[f][p])):(c(a[f][p+1]),c(a[f+1][p+1]),c(a[f+1][p]))}}function c(e){s.push(e.x,e.y,e.z)}function h(e,t){var n=3*e;t.x=i[n+0],t.y=i[n+1],t.z=i[n+2]}function d(e,t,n,i){i<0&&1===e.x&&(l[t]=e.x-1),0===n.x&&0===n.z&&(l[t]=i/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new Da,n=new Da,i=new Da,a=0;a<r.length;a+=3)h(r[a+0],t),h(r[a+1],n),h(r[a+2],i),u(t,n,i,e)}(o),function(e){for(var t=new Da,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}(a),function(){for(var e=new Da,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=p(e)/2/Math.PI+.5,i=(r=e,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);l.push(n,1-i)}var r;(function(){for(var e=new Da,t=new Da,n=new Da,i=new Da,r=new na,a=new na,o=new na,u=0,c=0;u<s.length;u+=9,c+=6){e.set(s[u+0],s[u+1],s[u+2]),t.set(s[u+3],s[u+4],s[u+5]),n.set(s[u+6],s[u+7],s[u+8]),r.set(l[c+0],l[c+1]),a.set(l[c+2],l[c+3]),o.set(l[c+4],l[c+5]),i.copy(e).add(t).add(n).divideScalar(3);var h=p(i);d(r,c+0,e,h),d(a,c+2,t,h),d(o,c+4,n,h)}})(),function(){for(var e=0;e<l.length;e+=6){var t=l[e+0],n=l[e+2],i=l[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(l[e+0]+=1),n<.2&&(l[e+2]+=1),i<.2&&(l[e+4]+=1))}}()}(),e.setAttribute("position",new bs(s,3)),e.setAttribute("normal",new bs(s.slice(),3)),e.setAttribute("uv",new bs(l,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(As),Wf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,n);var a=(1+Math.sqrt(5))/2,o=1/a,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-a,0,-o,a,0,o,-a,0,o,a,-o,-a,0,-o,a,0,o,-a,0,o,a,0,-a,0,-o,a,0,-o,-a,0,o,a,0,o];return(e=t.call(this,s,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],i,r)).type="DodecahedronGeometry",e.parameters={radius:i,detail:r},e}return v(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Vf),Xf=new Da,Zf=new Da,qf=new Da,Yf=new Yo,Jf=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(f(this,n),(e=t.call(this)).type="EdgesGeometry",e.parameters={geometry:i,thresholdAngle:r},null!==i){for(var a=Math.pow(10,4),o=Math.cos(Vr*r),s=i.getIndex(),l=i.getAttribute("position"),u=s?s.count:l.count,c=[0,0,0],h=["a","b","c"],d=new Array(3),p={},m=[],v=0;v<u;v+=3){s?(c[0]=s.getX(v),c[1]=s.getX(v+1),c[2]=s.getX(v+2)):(c[0]=v,c[1]=v+1,c[2]=v+2);var g=Yf.a,y=Yf.b,_=Yf.c;if(g.fromBufferAttribute(l,c[0]),y.fromBufferAttribute(l,c[1]),_.fromBufferAttribute(l,c[2]),Yf.getNormal(qf),d[0]="".concat(Math.round(g.x*a),",").concat(Math.round(g.y*a),",").concat(Math.round(g.z*a)),d[1]="".concat(Math.round(y.x*a),",").concat(Math.round(y.y*a),",").concat(Math.round(y.z*a)),d[2]="".concat(Math.round(_.x*a),",").concat(Math.round(_.y*a),",").concat(Math.round(_.z*a)),d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(var x=0;x<3;x++){var b=(x+1)%3,w=d[x],S=d[b],M=Yf[h[x]],T=Yf[h[b]],E="".concat(w,"_").concat(S),C="".concat(S,"_").concat(w);C in p&&p[C]?(qf.dot(p[C].normal)<=o&&(m.push(M.x,M.y,M.z),m.push(T.x,T.y,T.z)),p[C]=null):E in p||(p[E]={index0:c[x],index1:c[b],normal:qf.clone()})}}for(var k in p)if(p[k]){var P=p[k],A=P.index0,R=P.index1;Xf.fromBufferAttribute(l,A),Zf.fromBufferAttribute(l,R),m.push(Xf.x,Xf.y,Xf.z),m.push(Zf.x,Zf.y,Zf.z)}e.setAttribute("position",new bs(m,3))}return e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}]),n}(As),Qf=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).uuid=Xr(),i.type="Shape",i.holes=[],i}return v(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){S(x(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){S(x(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Uf).fromJSON(r))}return this}}]),n}(Uf),Kf=function(e,t){var n,i,r,a,o,s,l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*u:e.length,f=$f(e,0,h,u,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=$f(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(cd(o));for(s.sort(od),r=0;r<s.length;r++)n=sd(s[r],n);return n}(e,t,f,u)),e.length>80*u){n=r=e[0],i=a=e[1];for(var p=u;p<h;p+=u)(o=e[p])<n&&(n=o),(s=e[p+1])<i&&(i=s),o>r&&(r=o),s>a&&(a=s);l=0!==(l=Math.max(r-n,a-i))?32767/l:0}return td(f,d,u,n,i,l,0),d};function $f(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=xd(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=xd(a,e[a],e[a+1],o);return o&&pd(o,o.next)&&(bd(o),o=o.next),o}function ed(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!pd(i,i.next)&&0!==dd(i.prev,i,i.next))i=i.next;else{if(bd(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function td(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=ud(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(o>1)}(r)}(e,i,r,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?id(e,i,r,a):nd(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),bd(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?td(e=rd(ed(e),t,n),t,n,i,r,a,2):2===o&&ad(e,t,n,i,r,a):td(ed(e),t,n,i,r,a,1);break}}}function nd(e){var t=e.prev,n=e,i=e.next;if(dd(t,n,i)>=0)return!1;for(var r=t.x,a=n.x,o=i.x,s=t.y,l=n.y,u=i.y,c=r<a?r<o?r:o:a<o?a:o,h=s<l?s<u?s:u:l<u?l:u,f=r>a?r>o?r:o:a>o?a:o,d=s>l?s>u?s:u:l>u?l:u,p=i.next;p!==t;){if(p.x>=c&&p.x<=f&&p.y>=h&&p.y<=d&&hd(r,s,a,l,o,u,p.x,p.y)&&dd(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function id(e,t,n,i){var r=e.prev,a=e,o=e.next;if(dd(r,a,o)>=0)return!1;for(var s=r.x,l=a.x,u=o.x,c=r.y,h=a.y,f=o.y,d=s<l?s<u?s:u:l<u?l:u,p=c<h?c<f?c:f:h<f?h:f,m=s>l?s>u?s:u:l>u?l:u,v=c>h?c>f?c:f:h>f?h:f,g=ud(d,p,t,n,i),y=ud(m,v,t,n,i),_=e.prevZ,x=e.nextZ;_&&_.z>=g&&x&&x.z<=y;){if(_.x>=d&&_.x<=m&&_.y>=p&&_.y<=v&&_!==r&&_!==o&&hd(s,c,l,h,u,f,_.x,_.y)&&dd(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=d&&x.x<=m&&x.y>=p&&x.y<=v&&x!==r&&x!==o&&hd(s,c,l,h,u,f,x.x,x.y)&&dd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=g;){if(_.x>=d&&_.x<=m&&_.y>=p&&_.y<=v&&_!==r&&_!==o&&hd(s,c,l,h,u,f,_.x,_.y)&&dd(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=y;){if(x.x>=d&&x.x<=m&&x.y>=p&&x.y<=v&&x!==r&&x!==o&&hd(s,c,l,h,u,f,x.x,x.y)&&dd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function rd(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!pd(r,a)&&md(r,i,i.next,a)&&yd(r,a)&&yd(a,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),bd(i),bd(i.next),i=e=a),i=i.next}while(i!==e);return ed(i)}function ad(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&fd(o,s)){var l=_d(o,s);return o=ed(o,o.next),l=ed(l,l.next),td(o,t,n,i,r,a,0),void td(l,t,n,i,r,a,0)}s=s.next}o=o.next}while(o!==e)}function od(e,t){return e.x-t.x}function sd(e,t){var n=function(e,t){var n,i=t,r=-1/0,a=e.x,o=e.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=a&&s>r&&(r=s,n=i.x<i.next.x?i:i.next,s===a))return n}i=i.next}while(i!==t);if(!n)return null;var l,u=n,c=n.x,h=n.y,f=1/0;i=n;do{a>=i.x&&i.x>=c&&a!==i.x&&hd(o<h?a:r,o,c,h,o<h?r:a,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(a-i.x),yd(i,e)&&(l<f||l===f&&(i.x>n.x||i.x===n.x&&ld(n,i)))&&(n=i,f=l)),i=i.next}while(i!==u);return n}(e,t);if(!n)return t;var i=_d(n,e);return ed(i,i.next),ed(n,n.next)}function ld(e,t){return dd(e.prev,e,t.prev)<0&&dd(t.next,e,e.next)<0}function ud(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cd(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function hd(e,t,n,i,r,a,o,s){return(r-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(i-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function fd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&md(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(yd(e,t)&&yd(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(dd(e.prev,e,t.prev)||dd(e,t.prev,t))||pd(e,t)&&dd(e.prev,e,e.next)>0&&dd(t.prev,t,t.next)>0)}function dd(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function pd(e,t){return e.x===t.x&&e.y===t.y}function md(e,t,n,i){var r=gd(dd(e,t,n)),a=gd(dd(e,t,i)),o=gd(dd(n,i,e)),s=gd(dd(n,i,t));return r!==a&&o!==s||(!(0!==r||!vd(e,n,t))||(!(0!==a||!vd(e,i,t))||(!(0!==o||!vd(n,e,i))||!(0!==s||!vd(n,t,i)))))}function vd(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function gd(e){return e>0?1:e<0?-1:0}function yd(e,t){return dd(e.prev,e,e.next)<0?dd(e,t,e.next)>=0&&dd(e,e.prev,t)>=0:dd(e,t,e.prev)<0||dd(e,e.next,t)<0}function _d(e,t){var n=new wd(e.i,e.x,e.y),i=new wd(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function xd(e,t,n,i){var r=new wd(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function bd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wd(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Sd=function(){function e(){f(this,e)}return v(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];Md(e),Td(n,e);var a=e.length;t.forEach(Md);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,Td(n,t[o]);for(var s=Kf(n,i),l=0;l<s.length;l+=3)r.push(s.slice(l,l+3));return r}}]),e}();function Md(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Td(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Ed=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qf([new na(.5,.5),new na(-.5,.5),new na(-.5,-.5),new na(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:i,options:r},i=Array.isArray(i)?i:[i];for(var a=g(e),o=[],s=[],l=0,u=i.length;l<u;l++){c(i[l])}function c(e){var t,n,i,l,u,c=[],h=void 0!==r.curveSegments?r.curveSegments:12,f=void 0!==r.steps?r.steps:1,d=void 0!==r.depth?r.depth:1,p=void 0===r.bevelEnabled||r.bevelEnabled,m=void 0!==r.bevelThickness?r.bevelThickness:.2,v=void 0!==r.bevelSize?r.bevelSize:m-.1,g=void 0!==r.bevelOffset?r.bevelOffset:0,y=void 0!==r.bevelSegments?r.bevelSegments:3,_=r.extrudePath,x=void 0!==r.UVGenerator?r.UVGenerator:Cd,b=!1;_&&(t=_.getSpacedPoints(f),b=!0,p=!1,n=_.computeFrenetFrames(f,!1),i=new Da,l=new Da,u=new Da),p||(y=0,m=0,v=0,g=0);var w=e.extractPoints(h),S=w.shape,M=w.holes;if(!Sd.isClockWise(S)){S=S.reverse();for(var T=0,E=M.length;T<E;T++){var C=M[T];Sd.isClockWise(C)&&(M[T]=C.reverse())}}for(var k=Sd.triangulateShape(S,M),P=S,A=0,R=M.length;A<R;A++){var L=M[A];S=S.concat(L)}function I(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}var O=S.length,D=k.length;function N(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){var f=Math.sqrt(c),d=Math.sqrt(l*l+u*u),p=t.x-s/f,m=t.y+o/f,v=((n.x-u/d-p)*u-(n.y+l/d-m)*l)/(o*u-s*l),g=(i=p+o*v-e.x)*i+(r=m+s*v-e.y)*r;if(g<=2)return new na(i,r);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?l>Number.EPSILON&&(y=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new na(i/a,r/a)}for(var z=[],U=0,F=P.length,B=F-1,H=U+1;U<F;U++,B++,H++)B===F&&(B=0),H===F&&(H=0),z[U]=N(P[U],P[B],P[H]);for(var j,G=[],V=z.concat(),W=0,X=M.length;W<X;W++){var Z=M[W];j=[];for(var q=0,Y=Z.length,J=Y-1,Q=q+1;q<Y;q++,J++,Q++)J===Y&&(J=0),Q===Y&&(Q=0),j[q]=N(Z[q],Z[J],Z[Q]);G.push(j),V=V.concat(j)}for(var K=0;K<y;K++){for(var $=K/y,ee=m*Math.cos($*Math.PI/2),te=v*Math.sin($*Math.PI/2)+g,ne=0,ie=P.length;ne<ie;ne++){var re=I(P[ne],z[ne],te);Re(re.x,re.y,-ee)}for(var ae=0,oe=M.length;ae<oe;ae++){var se=M[ae];j=G[ae];for(var le=0,ue=se.length;le<ue;le++){var ce=I(se[le],j[le],te);Re(ce.x,ce.y,-ee)}}}for(var he=v+g,fe=0;fe<O;fe++){var de=p?I(S[fe],V[fe],he):S[fe];b?(l.copy(n.normals[0]).multiplyScalar(de.x),i.copy(n.binormals[0]).multiplyScalar(de.y),u.copy(t[0]).add(l).add(i),Re(u.x,u.y,u.z)):Re(de.x,de.y,0)}for(var pe=1;pe<=f;pe++)for(var me=0;me<O;me++){var ve=p?I(S[me],V[me],he):S[me];b?(l.copy(n.normals[pe]).multiplyScalar(ve.x),i.copy(n.binormals[pe]).multiplyScalar(ve.y),u.copy(t[pe]).add(l).add(i),Re(u.x,u.y,u.z)):Re(ve.x,ve.y,d/f*pe)}for(var ge=y-1;ge>=0;ge--){for(var ye=ge/y,_e=m*Math.cos(ye*Math.PI/2),xe=v*Math.sin(ye*Math.PI/2)+g,be=0,we=P.length;be<we;be++){var Se=I(P[be],z[be],xe);Re(Se.x,Se.y,d+_e)}for(var Me=0,Te=M.length;Me<Te;Me++){var Ee=M[Me];j=G[Me];for(var Ce=0,ke=Ee.length;Ce<ke;Ce++){var Pe=I(Ee[Ce],j[Ce],xe);b?Re(Pe.x,Pe.y+t[f-1].y,t[f-1].x+_e):Re(Pe.x,Pe.y,d+_e)}}}function Ae(e,t){for(var n=e.length;--n>=0;){var i=n,r=n-1;r<0&&(r=e.length-1);for(var a=0,o=f+2*y;a<o;a++){var s=O*a,l=O*(a+1);Ie(t+i+s,t+r+s,t+r+l,t+i+l)}}}function Re(e,t,n){c.push(e),c.push(t),c.push(n)}function Le(e,t,n){Oe(e),Oe(t),Oe(n);var i=o.length/3,r=x.generateTopUV(a,o,i-3,i-2,i-1);De(r[0]),De(r[1]),De(r[2])}function Ie(e,t,n,i){Oe(e),Oe(t),Oe(i),Oe(t),Oe(n),Oe(i);var r=o.length/3,s=x.generateSideWallUV(a,o,r-6,r-3,r-2,r-1);De(s[0]),De(s[1]),De(s[3]),De(s[1]),De(s[2]),De(s[3])}function Oe(e){o.push(c[3*e+0]),o.push(c[3*e+1]),o.push(c[3*e+2])}function De(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(p){for(var t=0,n=O*t,i=0;i<D;i++){var r=k[i];Le(r[2]+n,r[1]+n,r[0]+n)}n=O*(t=f+2*y);for(var s=0;s<D;s++){var l=k[s];Le(l[0]+n,l[1]+n,l[2]+n)}}else{for(var u=0;u<D;u++){var c=k[u];Le(c[2],c[1],c[0])}for(var h=0;h<D;h++){var d=k[h];Le(d[0]+O*f,d[1]+O*f,d[2]+O*f)}}a.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Ae(P,t),t+=P.length;for(var n=0,i=M.length;n<i;n++){var r=M[n];Ae(r,t),t+=r.length}a.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new bs(o,3)),e.setAttribute("uv",new bs(s,2)),e.computeVertexNormals(),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new Nf[s.type]).fromJSON(s)),new n(i,e.options)}}]),n}(As),Cd={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],l=t[3*i+1],u=t[3*r],c=t[3*r+1];return[new na(a,o),new na(s,l),new na(u,c)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*i],c=t[3*i+1],h=t[3*i+2],f=t[3*r],d=t[3*r+1],p=t[3*r+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<Math.abs(o-u)?[new na(o,1-l),new na(u,1-h),new na(f,1-p),new na(m,1-g)]:[new na(s,1-l),new na(c,1-h),new na(d,1-p),new na(v,1-g)]}};var kd=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,n);var a=(1+Math.sqrt(5))/2,o=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1];return(e=t.call(this,o,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,r)).type="IcosahedronGeometry",e.parameters={radius:i,detail:r},e}return v(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Vf),Pd=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,n);return(e=t.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],i,r)).type="OctahedronGeometry",e.parameters={radius:i,detail:r},e}return v(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Vf),Ad=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;f(this,n),(e=t.call(this)).type="RingGeometry",e.parameters={innerRadius:i,outerRadius:r,thetaSegments:a,phiSegments:o,thetaStart:s,thetaLength:l},a=Math.max(3,a);for(var u=[],c=[],h=[],d=[],p=i,m=(r-i)/(o=Math.max(1,o)),v=new Da,g=new na,y=0;y<=o;y++){for(var _=0;_<=a;_++){var x=s+_/a*l;v.x=p*Math.cos(x),v.y=p*Math.sin(x),c.push(v.x,v.y,v.z),h.push(0,0,1),g.x=(v.x/r+1)/2,g.y=(v.y/r+1)/2,d.push(g.x,g.y)}p+=m}for(var b=0;b<o;b++)for(var w=b*(a+1),S=0;S<a;S++){var M=S+w,T=M,E=M+a+1,C=M+a+2,k=M+1;u.push(T,E,k),u.push(E,C,k)}return e.setIndex(u),e.setAttribute("position",new bs(c,3)),e.setAttribute("normal",new bs(h,3)),e.setAttribute("uv",new bs(d,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]),n}(As),Rd=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qf([new na(0,.5),new na(-.5,-.5),new na(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;f(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:i,curveSegments:r};var a=[],o=[],s=[],l=[],u=0,c=0;if(!1===Array.isArray(i))d(i);else for(var h=0;h<i.length;h++)d(i[h]),e.addGroup(u,c,h),u+=c,c=0;function d(e){var t=o.length/3,n=e.extractPoints(r),i=n.shape,u=n.holes;!1===Sd.isClockWise(i)&&(i=i.reverse());for(var h=0,f=u.length;h<f;h++){var d=u[h];!0===Sd.isClockWise(d)&&(u[h]=d.reverse())}for(var p=Sd.triangulateShape(i,u),m=0,v=u.length;m<v;m++){var g=u[m];i=i.concat(g)}for(var y=0,_=i.length;y<_;y++){var x=i[y];o.push(x.x,x.y,0),s.push(0,0,1),l.push(x.x,x.y)}for(var b=0,w=p.length;b<w;b++){var S=p[b],M=S[0]+t,T=S[1]+t,E=S[2]+t;a.push(M,T,E),c+=3}}return e.setIndex(a),e.setAttribute("position",new bs(o,3)),e.setAttribute("normal",new bs(s,3)),e.setAttribute("uv",new bs(l,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}return new n(i,e.curveSegments)}}]),n}(As);var Ld=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;f(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:i,widthSegments:r,heightSegments:a,phiStart:o,phiLength:s,thetaStart:l,thetaLength:u},r=Math.max(3,Math.floor(r)),a=Math.max(2,Math.floor(a));for(var c=Math.min(l+u,Math.PI),h=0,d=[],p=new Da,m=new Da,v=[],g=[],y=[],_=[],x=0;x<=a;x++){var b=[],w=x/a,S=0;0===x&&0===l?S=.5/r:x===a&&c===Math.PI&&(S=-.5/r);for(var M=0;M<=r;M++){var T=M/r;p.x=-i*Math.cos(o+T*s)*Math.sin(l+w*u),p.y=i*Math.cos(l+w*u),p.z=i*Math.sin(o+T*s)*Math.sin(l+w*u),g.push(p.x,p.y,p.z),m.copy(p).normalize(),y.push(m.x,m.y,m.z),_.push(T+S,1-w),b.push(h++)}d.push(b)}for(var E=0;E<a;E++)for(var C=0;C<r;C++){var k=d[E][C+1],P=d[E][C],A=d[E+1][C],R=d[E+1][C+1];(0!==E||l>0)&&v.push(k,P,R),(E!==a-1||c<Math.PI)&&v.push(P,A,R)}return e.setIndex(v),e.setAttribute("position",new bs(g,3)),e.setAttribute("normal",new bs(y,3)),e.setAttribute("uv",new bs(_,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(As),Id=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,n);return(e=t.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],i,r)).type="TetrahedronGeometry",e.parameters={radius:i,detail:r},e}return v(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Vf),Od=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;f(this,n),(e=t.call(this)).type="TorusGeometry",e.parameters={radius:i,tube:r,radialSegments:a,tubularSegments:o,arc:s},a=Math.floor(a),o=Math.floor(o);for(var l=[],u=[],c=[],h=[],d=new Da,p=new Da,m=new Da,v=0;v<=a;v++)for(var g=0;g<=o;g++){var y=g/o*s,_=v/a*Math.PI*2;p.x=(i+r*Math.cos(_))*Math.cos(y),p.y=(i+r*Math.cos(_))*Math.sin(y),p.z=r*Math.sin(_),u.push(p.x,p.y,p.z),d.x=i*Math.cos(y),d.y=i*Math.sin(y),m.subVectors(p,d).normalize(),c.push(m.x,m.y,m.z),h.push(g/o),h.push(v/a)}for(var x=1;x<=a;x++)for(var b=1;b<=o;b++){var w=(o+1)*x+b-1,S=(o+1)*(x-1)+b-1,M=(o+1)*(x-1)+b,T=(o+1)*x+b;l.push(w,S,T),l.push(S,M,T)}return e.setIndex(l),e.setAttribute("position",new bs(u,3)),e.setAttribute("normal",new bs(c,3)),e.setAttribute("uv",new bs(h,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]),n}(As),Dd=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;f(this,n),(e=t.call(this)).type="TorusKnotGeometry",e.parameters={radius:i,tube:r,tubularSegments:a,radialSegments:o,p:s,q:l},a=Math.floor(a),o=Math.floor(o);for(var u=[],c=[],h=[],d=[],p=new Da,m=new Da,v=new Da,g=new Da,y=new Da,_=new Da,x=new Da,b=0;b<=a;++b){var w=b/a*s*Math.PI*2;I(w,s,l,i,v),I(w+.01,s,l,i,g),_.subVectors(g,v),x.addVectors(g,v),y.crossVectors(_,x),x.crossVectors(y,_),y.normalize(),x.normalize();for(var S=0;S<=o;++S){var M=S/o*Math.PI*2,T=-r*Math.cos(M),E=r*Math.sin(M);p.x=v.x+(T*x.x+E*y.x),p.y=v.y+(T*x.y+E*y.y),p.z=v.z+(T*x.z+E*y.z),c.push(p.x,p.y,p.z),m.subVectors(p,v).normalize(),h.push(m.x,m.y,m.z),d.push(b/a),d.push(S/o)}}for(var C=1;C<=a;C++)for(var k=1;k<=o;k++){var P=(o+1)*(C-1)+(k-1),A=(o+1)*C+(k-1),R=(o+1)*C+k,L=(o+1)*(C-1)+k;u.push(P,A,L),u.push(A,R,L)}function I(e,t,n,i,r){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);r.x=i*(2+l)*.5*a,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(s)*.5}return e.setIndex(u),e.setAttribute("position",new bs(c,3)),e.setAttribute("normal",new bs(h,3)),e.setAttribute("uv",new bs(d,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]),n}(As),Nd=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Of(new Da(-1,-1,0),new Da(-1,1,0),new Da(1,1,0)),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f(this,n),(e=t.call(this)).type="TubeGeometry",e.parameters={path:i,tubularSegments:r,radius:a,radialSegments:o,closed:s};var l=i.computeFrenetFrames(r,s);e.tangents=l.tangents,e.normals=l.normals,e.binormals=l.binormals;var u=new Da,c=new Da,h=new na,d=new Da,p=[],m=[],v=[],g=[];function y(e){d=i.getPointAt(e/r,d);for(var t=l.normals[e],n=l.binormals[e],s=0;s<=o;s++){var h=s/o*Math.PI*2,f=Math.sin(h),v=-Math.cos(h);c.x=v*t.x+f*n.x,c.y=v*t.y+f*n.y,c.z=v*t.z+f*n.z,c.normalize(),m.push(c.x,c.y,c.z),u.x=d.x+a*c.x,u.y=d.y+a*c.y,u.z=d.z+a*c.z,p.push(u.x,u.y,u.z)}}return function(){for(var e=0;e<r;e++)y(e);y(!1===s?r:0),function(){for(var e=0;e<=r;e++)for(var t=0;t<=o;t++)h.x=e/r,h.y=t/o,v.push(h.x,h.y)}(),function(){for(var e=1;e<=r;e++)for(var t=1;t<=o;t++){var n=(o+1)*(e-1)+(t-1),i=(o+1)*e+(t-1),a=(o+1)*e+t,s=(o+1)*(e-1)+t;g.push(n,i,s),g.push(i,a,s)}}()}(),e.setIndex(g),e.setAttribute("position",new bs(p,3)),e.setAttribute("normal",new bs(m,3)),e.setAttribute("uv",new bs(v,2)),e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.path=this.parameters.path.toJSON(),e}}],[{key:"fromJSON",value:function(e){return new n((new Nf[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]),n}(As),zd=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(f(this,n),(e=t.call(this)).type="WireframeGeometry",e.parameters={geometry:i},null!==i){var r=[],a=new Set,o=new Da,s=new Da;if(null!==i.index){var l=i.attributes.position,u=i.index,c=i.groups;0===c.length&&(c=[{start:0,count:u.count,materialIndex:0}]);for(var h=0,d=c.length;h<d;++h)for(var p=c[h],m=p.start,v=m,g=m+p.count;v<g;v+=3)for(var y=0;y<3;y++){var _=u.getX(v+y),x=u.getX(v+(y+1)%3);o.fromBufferAttribute(l,_),s.fromBufferAttribute(l,x),!0===Ud(o,s,a)&&(r.push(o.x,o.y,o.z),r.push(s.x,s.y,s.z))}}else for(var b=i.attributes.position,w=0,S=b.count/3;w<S;w++)for(var M=0;M<3;M++){var T=3*w+M,E=3*w+(M+1)%3;o.fromBufferAttribute(b,T),s.fromBufferAttribute(b,E),!0===Ud(o,s,a)&&(r.push(o.x,o.y,o.z),r.push(s.x,s.y,s.z))}e.setAttribute("position",new bs(r,3))}return e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}]),n}(As);function Ud(e,t,n){var i="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),r="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Fd=Object.freeze({__proto__:null,BoxGeometry:Js,CapsuleGeometry:Bf,CircleGeometry:Hf,ConeGeometry:Gf,CylinderGeometry:jf,DodecahedronGeometry:Wf,EdgesGeometry:Jf,ExtrudeGeometry:Ed,IcosahedronGeometry:kd,LatheGeometry:Ff,OctahedronGeometry:Pd,PlaneGeometry:gl,PolyhedronGeometry:Vf,RingGeometry:Ad,ShapeGeometry:Rd,SphereGeometry:Ld,TetrahedronGeometry:Id,TorusGeometry:Od,TorusKnotGeometry:Dd,TubeGeometry:Nd,WireframeGeometry:zd}),Bd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isShadowMaterial=!0,i.type="ShadowMaterial",i.color=new ns(0),i.transparent=!0,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.fog=e.fog,this}}]),n}(Qo),Hd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).isRawShaderMaterial=!0,i.type="RawShaderMaterial",i}return v(n)}(tl),jd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshStandardMaterial=!0,i.defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new ns(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new ns(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=Ji,i.normalScale=new na(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(Qo),Gd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshPhysicalMaterial=!0,i.defines={STANDARD:"",PHYSICAL:""},i.type="MeshPhysicalMaterial",i.anisotropyRotation=0,i.anisotropyMap=null,i.clearcoatMap=null,i.clearcoatRoughness=0,i.clearcoatRoughnessMap=null,i.clearcoatNormalScale=new na(1,1),i.clearcoatNormalMap=null,i.ior=1.5,Object.defineProperty(g(i),"reflectivity",{get:function(){return Zr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),i.iridescenceMap=null,i.iridescenceIOR=1.3,i.iridescenceThicknessRange=[100,400],i.iridescenceThicknessMap=null,i.sheenColor=new ns(0),i.sheenColorMap=null,i.sheenRoughness=1,i.sheenRoughnessMap=null,i.transmissionMap=null,i.thickness=0,i.thicknessMap=null,i.attenuationDistance=1/0,i.attenuationColor=new ns(1,1,1),i.specularIntensity=1,i.specularIntensityMap=null,i.specularColor=new ns(1,1,1),i.specularColorMap=null,i._anisotropy=0,i._clearcoat=0,i._iridescence=0,i._sheen=0,i._transmission=0,i.setValues(e),i}return v(n,[{key:"anisotropy",get:function(){return this._anisotropy},set:function(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"iridescence",get:function(){return this._iridescence},set:function(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}},{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=l(e.iridescenceThicknessRange),this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(jd),Vd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshPhongMaterial=!0,i.type="MeshPhongMaterial",i.color=new ns(16777215),i.specular=new ns(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new ns(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=Ji,i.normalScale=new na(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=rn,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(Qo),Wd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshToonMaterial=!0,i.defines={TOON:""},i.type="MeshToonMaterial",i.color=new ns(16777215),i.map=null,i.gradientMap=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new ns(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=Ji,i.normalScale=new na(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(Qo),Xd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshNormalMaterial=!0,i.type="MeshNormalMaterial",i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=Ji,i.normalScale=new na(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.flatShading=!1,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(Qo),Zd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshLambertMaterial=!0,i.type="MeshLambertMaterial",i.color=new ns(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new ns(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=Ji,i.normalScale=new na(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=rn,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(Qo),qd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isMeshMatcapMaterial=!0,i.defines={MATCAP:""},i.type="MeshMatcapMaterial",i.color=new ns(16777215),i.matcap=null,i.map=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=Ji,i.normalScale=new na(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.flatShading=!1,i.fog=!0,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(Qo),Yd=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).isLineDashedMaterial=!0,i.type="LineDashedMaterial",i.scale=1,i.dashSize=3,i.gapSize=1,i.setValues(e),i}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(Xh);function Jd(e,t,n){return Kd(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function Qd(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Kd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function $d(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function ep(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,l=0;l!==t;++l)r[o++]=e[s+l];return r}function tp(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}}var np={arraySlice:Jd,convertArray:Qd,isTypedArray:Kd,getKeyframeOrder:$d,sortedArray:ep,flattenJSON:tp,subclip:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],u=l.getValueSize(),c=[],h=[],f=0;f<l.times.length;++f){var d=l.times[f]*r;if(!(d<n||d>=i)){c.push(l.times[f]);for(var p=0;p<u;++p)h.push(l.values[f*u+p])}}0!==c.length&&(l.times=Qd(c,l.times.constructor),l.values=Qd(h,l.values.constructor),o.push(l))}a.tracks=o;for(var m=1/0,v=0;v<a.tracks.length;++v)m>a.tracks[v].times[0]&&(m=a.tracks[v].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*m);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);for(var r=n.tracks.length,a=t/i,o=function(){var t=n.tracks[s],i=t.ValueTypeName;if("bool"===i||"string"===i)return 0;var r=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===r)return 0;var o=0,l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);var u=0,c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);var h,f=t.times.length-1;if(a<=t.times[0]){var d=o,p=l-o;h=Jd(t.values,d,p)}else if(a>=t.times[f]){var m=f*l+o,v=m+l-o;h=Jd(t.values,m,v)}else{var g=t.createInterpolant(),y=o,_=l-o;g.evaluate(a),h=Jd(g.resultBuffer,y,_)}"quaternion"===i&&(new Oa).fromArray(h).normalize().conjugate().toArray(h);for(var x=r.times.length,b=0;b<x;++b){var w=b*c+u;if("quaternion"===i)Oa.multiplyQuaternionsFlat(r.values,w,h,0,r.values,w);else for(var S=c-2*u,M=0;M<S;++M)r.values[w+M]-=h[M]}},s=0;s<r;++s)o();return e.blendMode=ji,e}},ip=function(){function e(t,n,i,r){f(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return v(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var l=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var u=n+a>>>1;e<t[u]?a=u:n=u+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),rp=function(e){_(n,e);var t=w(n);function n(e,i,r,a){var o;return f(this,n),(o=t.call(this,e,i,r,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:Ui,endingEnd:Ui},o}return v(n,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case Fi:r=e,o=2*t-n;break;case Bi:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Fi:a=e,s=2*n-t;break;case Bi:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*u,this._offsetNext=a*u}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-t)/(i-t),p=d*d,m=p*d,v=-h*m+2*h*p-h*d,g=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*m+(1.5+f)*p+.5*d,_=f*m-f*p,x=0;x!==o;++x)r[x]=v*a[u+x]+g*a[l+x]+y*a[s+x]+_*a[c+x];return r}}]),n}(ip),ap=function(e){_(n,e);var t=w(n);function n(e,i,r,a){return f(this,n),t.call(this,e,i,r,a)}return v(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(i-t),c=1-u,h=0;h!==o;++h)r[h]=a[l+h]*c+a[s+h]*u;return r}}]),n}(ip),op=function(e){_(n,e);var t=w(n);function n(e,i,r,a){return f(this,n),t.call(this,e,i,r,a)}return v(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(ip),sp=function(){function e(t,n,i,r){if(f(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Qd(n,this.TimeBufferType),this.values=Qd(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}return v(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new op(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new ap(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new rp(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case Di:t=this.InterpolantFactoryMethodDiscrete;break;case Ni:t=this.InterpolantFactoryMethodLinear;break;case zi:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Di;case this.InterpolantFactoryMethodLinear:return Ni;case this.InterpolantFactoryMethodSmooth:return zi}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Jd(n,r,a),this.values=Jd(this.values,r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&Kd(i))for(var l=0,u=i.length;l!==u;++l){var c=i[l];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Jd(this.times),t=Jd(this.values),n=this.getValueSize(),i=this.getInterpolation()===zi,r=e.length-1,a=1,o=1;o<r;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0]))if(i)s=!0;else for(var u=o*n,c=u-n,h=u+n,f=0;f!==n;++f){var d=t[u+f];if(d!==t[c+f]||d!==t[h+f]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,m=a*n,v=0;v!==n;++v)t[m+v]=t[p+v]}++a}}if(r>0){e[a]=e[r];for(var g=r*n,y=a*n,_=0;_!==n;++_)t[y+_]=t[g+_];++a}return a!==e.length?(this.times=Jd(e,0,a),this.values=Jd(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Jd(this.times,0),t=Jd(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Qd(e.times,Array),values:Qd(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();sp.prototype.TimeBufferType=Float32Array,sp.prototype.ValueBufferType=Float32Array,sp.prototype.DefaultInterpolation=Ni;var lp=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n)}(sp);lp.prototype.ValueTypeName="bool",lp.prototype.ValueBufferType=Array,lp.prototype.DefaultInterpolation=Di,lp.prototype.InterpolantFactoryMethodLinear=void 0,lp.prototype.InterpolantFactoryMethodSmooth=void 0;var up=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n)}(sp);up.prototype.ValueTypeName="color";var cp=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n)}(sp);cp.prototype.ValueTypeName="number";var hp=function(e){_(n,e);var t=w(n);function n(e,i,r,a){return f(this,n),t.call(this,e,i,r,a)}return v(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),l=e*o,u=l+o;l!==u;l+=4)Oa.slerpFlat(r,0,a,l-o,a,l,s);return r}}]),n}(ip),fp=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new hp(this.times,this.values,this.getValueSize(),e)}}]),n}(sp);fp.prototype.ValueTypeName="quaternion",fp.prototype.DefaultInterpolation=Ni,fp.prototype.InterpolantFactoryMethodSmooth=void 0;var dp=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n)}(sp);dp.prototype.ValueTypeName="string",dp.prototype.ValueBufferType=Array,dp.prototype.DefaultInterpolation=Di,dp.prototype.InterpolantFactoryMethodLinear=void 0,dp.prototype.InterpolantFactoryMethodSmooth=void 0;var pp=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n)}(sp);pp.prototype.ValueTypeName="vector";var mp=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Hi;f(this,e),this.name=t,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=Xr(),this.duration<0&&this.resetDuration()}return v(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(vp(n[r]).scale(i));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,a=n.length;r!==a;++r)t.push(sp.toJSON(n[r]));return i}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],l=[];s.push((o+r-1)%r,o,(o+1)%r),l.push(0,1,0);var u=$d(s);s=ep(s,1,u),l=ep(l,1,u),i||0!==s[0]||(s.push(r),l.push(l[0])),a.push(new cp(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(r);if(l&&l.length>1){var u=l[1],c=i[u];c||(i[u]=c=[]),c.push(s)}}var h=[];for(var f in i)h.push(this.CreateFromMorphTargetSequence(f,i[f],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];tp(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},f=void 0;for(f=0;f<c.length;f++)if(c[f].morphTargets)for(var d=0;d<c[f].morphTargets.length;d++)h[c[f].morphTargets[d]]=-1;for(var p in h){for(var m=[],v=[],g=0;g!==c[f].morphTargets.length;++g){var y=c[f];m.push(y.time),v.push(y.morphTarget===p?1:0)}i.push(new cp(".morphTargetInfluence["+p+"]",m,v))}s=h.length*a}else{var _=".bones["+t[u].name+"]";n(pp,_+".position",c,"pos",i),n(fp,_+".quaternion",c,"rot",i),n(pp,_+".scale",c,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}}]),e}();function vp(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cp;case"vector":case"vector2":case"vector3":case"vector4":return pp;case"color":return up;case"quaternion":return fp;case"bool":case"boolean":return lp;case"string":return dp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];tp(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var gp={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},yp=v((function e(t,n,i){f(this,e);var r=this,a=!1,o=0,s=0,l=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return l?l(e):e},this.setURLModifier=function(e){return l=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){var t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=u.length;t<n;t+=2){var i=u[t],r=u[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}})),_p=new yp,xp=function(){function e(t){f(this,e),this.manager=void 0!==t?t:_p,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return v(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}();xp.DEFAULT_MATERIAL_NAME="__DEFAULT";var bp,wp={},Sp=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e)).response=i,r}return v(n)}(T(Error)),Mp=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=gp.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;if(void 0===wp[e]){wp[e]=[],wp[e].push({onLoad:t,onProgress:n,onError:i});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,l=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=wp[e],i=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=r?parseInt(r):0,o=0!==a,s=0,l=new ReadableStream({start:function(e){!function t(){i.read().then((function(i){var r=i.done,l=i.value;if(r)e.close();else{s+=l.byteLength;for(var u=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),c=0,h=n.length;c<h;c++){var f=n[c];f.onProgress&&f.onProgress(u)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new Sp('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((function(e){switch(l){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((function(e){return i.decode(e)}))}})).then((function(t){gp.add(e,t);var n=wp[e];delete wp[e];for(var i=0,r=n.length;i<r;i++){var a=n[i];a.onLoad&&a.onLoad(t)}})).catch((function(t){var n=wp[e];if(void 0===n)throw r.manager.itemError(e),t;delete wp[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e)})).finally((function(){r.manager.itemEnd(e)})),this.manager.itemStart(e)}else wp[e].push({onLoad:t,onProgress:n,onError:i})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(xp),Tp=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Mp(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=mp.parse(e[n]);t.push(i)}return t}}]),n}(xp),Ep=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=[],o=new df,s=new Mp(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials);var l=0;function u(u){s.load(e[u],(function(e){var n=r.parse(e,!0);a[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(o.minFilter=Cn),o.image=a,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,i)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)u(c);else s.load(e,(function(e){var n=r.parse(e,!0);if(n.isCubemap){for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Cn),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,i);return o}}]),n}(xp),Cp=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=gp.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o=la("img");function s(){u(),gp.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){u(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),n}(xp),kp=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=new ol;r.colorSpace=$i;var a=new Cp(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(var l=0;l<e.length;++l)s(l);return r}}]),n}(xp),Pp=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Ih,o=new Mp(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){var n;try{n=r.parse(e)}catch(o){if(void 0===i)return void console.error(o);i(o)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:xn,a.wrapT=void 0!==n.wrapT?n.wrapT:xn,a.magFilter=void 0!==n.magFilter?n.magFilter:Cn,a.minFilter=void 0!==n.minFilter?n.minFilter:Cn,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?a.colorSpace=n.colorSpace:void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=An),1===n.mipmapCount&&(a.minFilter=Cn),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n)}),n,i),a}}]),n}(xp),Ap=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=new Ta,a=new Cp(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}]),n}(xp),Rp=function(e){_(n,e);var t=w(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return f(this,n),(i=t.call(this)).isLight=!0,i.type="Light",i.color=new ns(e),i.intensity=r,i}return v(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(zo),Lp=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,e,r)).isHemisphereLight=!0,a.type="HemisphereLight",a.position.copy(zo.DEFAULT_UP),a.updateMatrix(),a.groundColor=new ns(i),a}return v(n,[{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.groundColor.copy(e.groundColor),this}}]),n}(Rp),Ip=new ho,Op=new Da,Dp=new Da,Np=function(){function e(t){f(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new na(512,512),this.map=null,this.mapPass=null,this.matrix=new ho,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pl,this._frameExtents=new na(1,1),this._viewportCount=1,this._viewports=[new Ea(0,0,1,1)]}return v(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;Op.setFromMatrixPosition(e.matrixWorld),t.position.copy(Op),Dp.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Dp),t.updateMatrixWorld(),Ip.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ip),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ip)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),zp=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this,new il(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return v(n,[{key:"updateMatrices",value:function(e){var t=this.camera,i=2*Wr*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;i===t.fov&&r===t.aspect&&a===t.far||(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),S(x(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(Np),Up=function(e){_(n,e);var t=w(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;return f(this,n),(r=t.call(this,e,i)).isSpotLight=!0,r.type="SpotLight",r.position.copy(zo.DEFAULT_UP),r.updateMatrix(),r.target=new zo,r.distance=a,r.angle=o,r.penumbra=s,r.decay=l,r.map=null,r.shadow=new zp,r}return v(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Rp),Fp=new ho,Bp=new Da,Hp=new Da,jp=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this,new il(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new na(4,2),e._viewportCount=6,e._viewports=[new Ea(2,1,1,1),new Ea(0,1,1,1),new Ea(3,1,1,1),new Ea(1,1,1,1),new Ea(3,0,1,1),new Ea(1,0,1,1)],e._cubeDirections=[new Da(1,0,0),new Da(-1,0,0),new Da(0,0,1),new Da(0,0,-1),new Da(0,1,0),new Da(0,-1,0)],e._cubeUps=[new Da(0,1,0),new Da(0,1,0),new Da(0,1,0),new Da(0,1,0),new Da(0,0,1),new Da(0,0,-1)],e}return v(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Bp.setFromMatrixPosition(e.matrixWorld),n.position.copy(Bp),Hp.copy(n.position),Hp.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Hp),n.updateMatrixWorld(),i.makeTranslation(-Bp.x,-Bp.y,-Bp.z),Fp.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Fp)}}]),n}(Np),Gp=function(e){_(n,e);var t=w(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return f(this,n),(r=t.call(this,e,i)).isPointLight=!0,r.type="PointLight",r.distance=a,r.decay=o,r.shadow=new jp,r}return v(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(Rp),Vp=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this,new kl(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return v(n)}(Np),Wp=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e,i)).isDirectionalLight=!0,r.type="DirectionalLight",r.position.copy(zo.DEFAULT_UP),r.updateMatrix(),r.target=new zo,r.shadow=new Vp,r}return v(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Rp),Xp=function(e){_(n,e);var t=w(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e,i)).isAmbientLight=!0,r.type="AmbientLight",r}return v(n)}(Rp),Zp=function(e){_(n,e);var t=w(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return f(this,n),(r=t.call(this,e,i)).isRectAreaLight=!0,r.type="RectAreaLight",r.width=a,r.height=o,r}return v(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(Rp),qp=function(){function e(){f(this,e),this.isSphericalHarmonics3=!0,this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Da)}return v(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}]),e}(),Yp=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new qp,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return f(this,n),(e=t.call(this,void 0,r)).isLightProbe=!0,e.sh=i,e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(Rp),Jp=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).textures={},i}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Mp(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=n.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new ns).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var a in e.uniforms){var o=e.uniforms[a];switch(r.uniforms[a]={},o.type){case"t":r.uniforms[a].value=i(o.value);break;case"c":r.uniforms[a].value=(new ns).setHex(o.value);break;case"v2":r.uniforms[a].value=(new na).fromArray(o.value);break;case"v3":r.uniforms[a].value=(new Da).fromArray(o.value);break;case"v4":r.uniforms[a].value=(new Ea).fromArray(o.value);break;case"m3":r.uniforms[a].value=(new ia).fromArray(o.value);break;case"m4":r.uniforms[a].value=(new ho).fromArray(o.value);break;default:r.uniforms[a].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(var s in e.extensions)r.extensions[s]=e.extensions[s];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var l=e.normalScale;!1===Array.isArray(l)&&(l=[l,l]),r.normalScale=(new na).fromArray(l)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new na).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=i(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=i(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}},{key:"setTextures",value:function(e){return this.textures=e,this}}],[{key:"createMaterialFromType",value:function(e){return new{ShadowMaterial:Bd,SpriteMaterial:rh,RawShaderMaterial:Hd,ShaderMaterial:tl,PointsMaterial:rf,MeshPhysicalMaterial:Gd,MeshStandardMaterial:jd,MeshPhongMaterial:Vd,MeshToonMaterial:Wd,MeshNormalMaterial:Xd,MeshLambertMaterial:Zd,MeshDepthMaterial:Ic,MeshDistanceMaterial:Oc,MeshBasicMaterial:rs,MeshMatcapMaterial:qd,LineDashedMaterial:Yd,LineBasicMaterial:Xh,Material:Qo}[e]}}]),n}(xp),Qp=function(){function e(){f(this,e)}return v(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(r){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),Kp=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isInstancedBufferGeometry=!0,e.type="InstancedBufferGeometry",e.instanceCount=1/0,e}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"toJSON",value:function(){var e=S(x(n.prototype),"toJSON",this).call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(As),$p=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Mp(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){var t={},n={};function i(e,i){if(void 0!==t[i])return t[i];var r=e.interleavedBuffers[i],a=function(e,t){if(void 0!==n[t])return n[t];var i=e.arrayBuffers,r=i[t],a=new Uint32Array(r).buffer;return n[t]=a,a}(e,r.buffer),o=sa(r.type,a),s=new th(o,r.stride);return s.uuid=r.uuid,t[i]=s,s}var r=e.isInstancedBufferGeometry?new Kp:new As,a=e.data.index;if(void 0!==a){var o=sa(a.type,a.array);r.setIndex(new fs(o,1))}var s=e.data.attributes;for(var l in s){var u=s[l],c=void 0;if(u.isInterleavedBufferAttribute){var h=i(e.data,u.data);c=new ih(h,u.itemSize,u.offset,u.normalized)}else{var f=sa(u.type,u.array);c=new(u.isInstancedBufferAttribute?zh:fs)(f,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),void 0!==u.usage&&c.setUsage(u.usage),void 0!==u.updateRange&&(c.updateRange.offset=u.updateRange.offset,c.updateRange.count=u.updateRange.count),r.setAttribute(l,c)}var d=e.data.morphAttributes;if(d)for(var p in d){for(var m=d[p],v=[],g=0,y=m.length;g<y;g++){var _=m[g],x=void 0;if(_.isInterleavedBufferAttribute){var b=i(e.data,_.data);x=new ih(b,_.itemSize,_.offset,_.normalized)}else{var w=sa(_.type,_.array);x=new fs(w,_.itemSize,_.normalized)}void 0!==_.name&&(x.name=_.name),v.push(x)}r.morphAttributes[p]=v}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var S=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==S)for(var M=0,T=S.length;M!==T;++M){var E=S[M];r.addGroup(E.start,E.count,E.materialIndex)}var C=e.data.boundingSphere;if(void 0!==C){var k=new Da;void 0!==C.center&&k.fromArray(C.center),r.boundingSphere=new no(k,C.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}]),n}(xp),em=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=""===this.path?Qp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new Mp(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){var a=null;try{a=JSON.parse(n)}catch(s){return void 0!==i&&i(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);r.parse(a,t)}),n,i)}},{key:"loadAsync",value:function(){var e=ct(ht().mark((function e(t,n){var i,r,a,o,s,l;return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,r=""===this.path?Qp.extractUrlBase(t):this.path,this.resourcePath=this.resourcePath||r,(a=new Mp(this.manager)).setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),e.next=9,a.loadAsync(t,n);case 9:if(o=e.sent,s=JSON.parse(o),void 0!==(l=s.metadata)&&void 0!==l.type&&"geometry"!==l.type.toLowerCase()){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:return e.next=16,i.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(e,t){var n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,s,o,n),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),void 0!==t){var c=!1;for(var h in a)if(a[h].data instanceof HTMLImageElement){c=!0;break}!1===c&&t(l)}return l}},{key:"parseAsync",value:function(){var e=ct(ht().mark((function e(t){var n,i,r,a,o,s,l,u;return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),e.next=5,this.parseImagesAsync(t.images);case 5:return a=e.sent,o=this.parseTextures(t.textures,a),s=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,r,s,o,n),u=this.parseSkeletons(t.skeletons,l),this.bindSkeletons(l,u),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function(e){var t={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=(new Qf).fromJSON(e[n]);t[r.uuid]=r}return t}},{key:"parseSkeletons",value:function(e,t){var n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(var r=0,a=e.length;r<a;r++){var o=(new Nh).fromJSON(e[r],i);n[o.uuid]=o}return n}},{key:"parseGeometries",value:function(e,t){var n={};if(void 0!==e)for(var i=new $p,r=0,a=e.length;r<a;r++){var o=void 0,s=e[r];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;default:s.type in Fd?o=Fd[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n}},{key:"parseMaterials",value:function(e,t){var n={},i={};if(void 0!==e){var r=new Jp;r.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}},{key:"parseAnimations",value:function(e){var t={};if(void 0!==e)for(var n=0;n<e.length;n++){var i=e[n],r=mp.parse(i);t[r.uuid]=r}return t}},{key:"parseImages",value:function(e,t){var n,i=this,r={};function a(e){if("string"===typeof e){var t=e;return function(e){return i.manager.itemStart(e),n.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:sa(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new yp(t);(n=new Cp(o)).setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var u=e[s],c=u.url;if(Array.isArray(c)){for(var h=[],f=0,d=c.length;f<d;f++){var p=a(c[f]);null!==p&&(p instanceof HTMLImageElement?h.push(p):h.push(new Ih(p.data,p.width,p.height)))}r[u.uuid]=new wa(h)}else{var m=a(u.url);r[u.uuid]=new wa(m)}}}return r}},{key:"parseImagesAsync",value:function(){var e=ct(ht().mark((function e(t){var n,i,r,a,o,s,l,u,c,h,f,d,p,m,v;return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(){return o=ct(ht().mark((function e(t){var i,a;return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=8;break}return a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i=t)?i:n.resourcePath+i,e.next=5,r.loadAsync(a);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:sa(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)},a=function(e){return o.apply(this,arguments)},n=this,i={},!(void 0!==t&&t.length>0)){e.next=33;break}(r=new Cp(this.manager)).setCrossOrigin(this.crossOrigin),s=0,l=t.length;case 8:if(!(s<l)){e.next=33;break}if(u=t[s],c=u.url,!Array.isArray(c)){e.next=26;break}h=[],f=0,d=c.length;case 14:if(!(f<d)){e.next=23;break}return p=c[f],e.next=18,a(p);case 18:null!==(m=e.sent)&&(m instanceof HTMLImageElement?h.push(m):h.push(new Ih(m.data,m.width,m.height)));case 20:f++,e.next=14;break;case 23:i[u.uuid]=new wa(h),e.next=30;break;case 26:return e.next=28,a(u.url);case 28:v=e.sent,i[u.uuid]=new wa(v);case 30:s++,e.next=8;break;case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,a=e.length;r<a;r++){var o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=t[o.image],l=s.data,u=void 0;Array.isArray(l)?(u=new ol,6===l.length&&(u.needsUpdate=!0)):(u=l&&l.data?new Ih:new Ta,l&&(u.needsUpdate=!0)),u.source=s,u.uuid=o.uuid,void 0!==o.name&&(u.name=o.name),void 0!==o.mapping&&(u.mapping=n(o.mapping,tm)),void 0!==o.channel&&(u.channel=o.channel),void 0!==o.offset&&u.offset.fromArray(o.offset),void 0!==o.repeat&&u.repeat.fromArray(o.repeat),void 0!==o.center&&u.center.fromArray(o.center),void 0!==o.rotation&&(u.rotation=o.rotation),void 0!==o.wrap&&(u.wrapS=n(o.wrap[0],nm),u.wrapT=n(o.wrap[1],nm)),void 0!==o.format&&(u.format=o.format),void 0!==o.internalFormat&&(u.internalFormat=o.internalFormat),void 0!==o.type&&(u.type=o.type),void 0!==o.colorSpace&&(u.colorSpace=o.colorSpace),void 0!==o.encoding&&(u.encoding=o.encoding),void 0!==o.minFilter&&(u.minFilter=n(o.minFilter,im)),void 0!==o.magFilter&&(u.magFilter=n(o.magFilter,im)),void 0!==o.anisotropy&&(u.anisotropy=o.anisotropy),void 0!==o.flipY&&(u.flipY=o.flipY),void 0!==o.generateMipmaps&&(u.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(u.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(u.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(u.compareFunction=o.compareFunction),void 0!==o.userData&&(u.userData=o.userData),i[o.uuid]=u}return i}},{key:"parseObject",value:function(e,t,n,i,r){var a,o,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var a=e[i];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":a=new eh,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new ns(e.background):a.background=c(e.background)),void 0!==e.environment&&(a.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new $c(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new Kc(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":a=new il(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new kl(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Xp(e.color,e.intensity);break;case"DirectionalLight":a=new Wp(e.color,e.intensity);break;case"PointLight":a=new Gp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Zp(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Up(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new Lp(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new Yp).fromJSON(e);break;case"SkinnedMesh":o=l(e.geometry),s=u(e.material),a=new Rh(o,s),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":o=l(e.geometry),s=u(e.material),a=new qs(o,s);break;case"InstancedMesh":o=l(e.geometry),s=u(e.material);var h=e.count,f=e.instanceMatrix,d=e.instanceColor;(a=new Wh(o,s,h)).instanceMatrix=new zh(new Float32Array(f.array),16),void 0!==d&&(a.instanceColor=new zh(new Float32Array(d.array),d.itemSize));break;case"LOD":a=new bh;break;case"Line":a=new Kh(l(e.geometry),u(e.material));break;case"LineLoop":a=new nf(l(e.geometry),u(e.material));break;case"LineSegments":a=new tf(l(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new uf(l(e.geometry),u(e.material));break;case"Sprite":a=new gh(u(e.material));break;case"Group":a=new jc;break;case"Bone":a=new Lh;break;default:a=new zo}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children)for(var p=e.children,m=0;m<p.length;m++)a.add(this.parseObject(p[m],t,n,i,r));if(void 0!==e.animations)for(var v=e.animations,g=0;g<v.length;g++){var y=v[g];a.animations.push(r[y])}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);for(var _=e.levels,x=0;x<_.length;x++){var b=_[x],w=a.getObjectByProperty("uuid",b.object);void 0!==w&&a.addLevel(w,b.distance,b.hysteresis)}}return a}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}]),n}(xp),tm={UVMapping:dn,CubeReflectionMapping:pn,CubeRefractionMapping:mn,EquirectangularReflectionMapping:vn,EquirectangularRefractionMapping:gn,CubeUVReflectionMapping:yn},nm={RepeatWrapping:_n,ClampToEdgeWrapping:xn,MirroredRepeatWrapping:bn},im={NearestFilter:wn,NearestMipmapNearestFilter:Sn,NearestMipmapLinearFilter:Tn,LinearFilter:Cn,LinearMipmapNearestFilter:kn,LinearMipmapLinearFilter:An},rm=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.options={premultiplyAlpha:"none"},i}return v(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=gp.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){gp.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}]),n}(xp),am=function(){function e(){f(this,e)}return v(e,null,[{key:"getContext",value:function(){return void 0===bp&&(bp=new(window.AudioContext||window.webkitAudioContext)),bp}},{key:"setContext",value:function(e){bp=e}}]),e}(),om=function(e){_(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return v(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Mp(this.manager);function o(t){i?i(t):console.error(t),r.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){try{var n=e.slice(0);am.getContext().decodeAudioData(n,(function(e){t(e)}),o)}catch(i){o(i)}}),n,i)}}]),n}(xp),sm=function(e){_(n,e);var t=w(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;f(this,n),(r=t.call(this,void 0,a)).isHemisphereLightProbe=!0;var o=(new ns).set(e),s=(new ns).set(i),l=new Da(o.r,o.g,o.b),u=new Da(s.r,s.g,s.b),c=Math.sqrt(Math.PI),h=c*Math.sqrt(.75);return r.sh.coefficients[0].copy(l).add(u).multiplyScalar(c),r.sh.coefficients[1].copy(l).sub(u).multiplyScalar(h),r}return v(n)}(Yp),lm=function(e){_(n,e);var t=w(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;f(this,n),(i=t.call(this,void 0,r)).isAmbientLightProbe=!0;var a=(new ns).set(e);return i.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),i}return v(n)}(Yp),um=new ho,cm=new ho,hm=new ho,fm=function(){function e(){f(this,e),this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new il,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new il,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return v(e,[{key:"update",value:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,hm.copy(e.projectionMatrix);var n,i,r=t.eyeSep/2,a=r*t.near/t.focus,o=t.near*Math.tan(Vr*t.fov*.5)/t.zoom;cm.elements[12]=-r,um.elements[12]=r,n=-o*t.aspect+a,i=o*t.aspect+a,hm.elements[0]=2*t.near/(i-n),hm.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(hm),n=-o*t.aspect-a,i=o*t.aspect-a,hm.elements[0]=2*t.near/(i-n),hm.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(hm)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(cm),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(um)}}]),e}(),dm=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];f(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return v(e,[{key:"start",value:function(){this.startTime=pm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=pm();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function pm(){return("undefined"===typeof performance?Date:performance).now()}var mm=new Da,vm=new Oa,gm=new Da,ym=new Da,_m=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).type="AudioListener",e.context=am.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new dm,e}return v(n,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){S(x(n.prototype),"updateMatrixWorld",this).call(this,e);var t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(mm,vm,gm),ym.set(0,0,-1).applyQuaternion(vm),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(mm.x,r),t.positionY.linearRampToValueAtTime(mm.y,r),t.positionZ.linearRampToValueAtTime(mm.z,r),t.forwardX.linearRampToValueAtTime(ym.x,r),t.forwardY.linearRampToValueAtTime(ym.y,r),t.forwardZ.linearRampToValueAtTime(ym.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(mm.x,mm.y,mm.z),t.setOrientation(ym.x,ym.y,ym.z,i.x,i.y,i.z)}}]),n}(zo),xm=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this)).type="Audio",i.listener=e,i.context=e.context,i.gain=i.context.createGain(),i.gain.connect(e.getInput()),i.autoplay=!1,i.buffer=null,i.detune=0,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.offset=0,i.duration=void 0,i.playbackRate=1,i.isPlaying=!1,i.hasPlaybackControl=!0,i.source=null,i.sourceType="empty",i._startedAt=0,i._progress=0,i._connected=!1,i.filters=[],i}return v(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(zo),bm=new Da,wm=new Oa,Sm=new Da,Mm=new Da,Tm=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).panner=i.context.createPanner(),i.panner.panningModel="HRTF",i.panner.connect(i.gain),i}return v(n,[{key:"connect",value:function(){S(x(n.prototype),"connect",this).call(this),this.panner.connect(this.gain)}},{key:"disconnect",value:function(){S(x(n.prototype),"disconnect",this).call(this),this.panner.disconnect(this.gain)}},{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}},{key:"updateMatrixWorld",value:function(e){if(S(x(n.prototype),"updateMatrixWorld",this).call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(bm,wm,Sm),Mm.set(0,0,1).applyQuaternion(wm);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(bm.x,i),t.positionY.linearRampToValueAtTime(bm.y,i),t.positionZ.linearRampToValueAtTime(bm.z,i),t.orientationX.linearRampToValueAtTime(Mm.x,i),t.orientationY.linearRampToValueAtTime(Mm.y,i),t.orientationZ.linearRampToValueAtTime(Mm.z,i)}else t.setPosition(bm.x,bm.y,bm.z),t.setOrientation(Mm.x,Mm.y,Mm.z)}}}]),n}(xm),Em=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;f(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return v(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}(),Cm=function(){function e(t,n,i){var r,a,o;switch(f(this,e),this.binding=t,this.valueSize=i,n){case"quaternion":r=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return v(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=t*this._origIndex;this._mixBufferRegion(n,i,s,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){o.setValue(n,i);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,i){Oa.slerpFlat(e,t,e,t,e,n,i)}},{key:"_slerpAdditive",value:function(e,t,n,i,r){var a=this._workIndex*r;Oa.multiplyQuaternionsFlat(e,a,e,t,e,n),Oa.slerpFlat(e,t,e,t,e,a,i)}},{key:"_lerp",value:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}},{key:"_lerpAdditive",value:function(e,t,n,i,r){for(var a=0;a!==r;++a){var o=t+a;e[o]=e[o]+e[n+a]*i}}}]),e}(),km="\\[\\]\\.:\\/",Pm=new RegExp("["+km+"]","g"),Am="[^"+km+"]",Rm="[^"+km.replace("\\.","")+"]",Lm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Am)+/(WCOD+)?/.source.replace("WCOD",Rm)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Am)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Am)+"$"),Im=["material","materials","bones","map"],Om=function(){function e(t,n,i){f(this,e);var r=i||Dm.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,r)}return v(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),Dm=function(){function e(t,n,i){f(this,e),this.path=n,this.parsedPath=i||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return v(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var l=t[r];if(void 0!==l){var u=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",t)}}else console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,i):new e(t,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Pm,"")}},{key:"parseTrackName",value:function(e){var t=Lm.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==Im.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();Dm.Composite=Om,Dm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Dm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Dm.prototype.GetterByBindingType=[Dm.prototype._getValue_direct,Dm.prototype._getValue_array,Dm.prototype._getValue_arrayElement,Dm.prototype._getValue_toArray],Dm.prototype.SetterByBindingTypeAndVersioning=[[Dm.prototype._setValue_direct,Dm.prototype._setValue_direct_setNeedsUpdate,Dm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Dm.prototype._setValue_array,Dm.prototype._setValue_array_setNeedsUpdate,Dm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Dm.prototype._setValue_arrayElement,Dm.prototype._setValue_arrayElement_setNeedsUpdate,Dm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Dm.prototype._setValue_fromArray,Dm.prototype._setValue_fromArray_setNeedsUpdate,Dm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Nm=function(){function e(){f(this,e),this.isAnimationObjectGroup=!0,this.uuid=Xr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}return v(e,[{key:"add",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length,o=void 0,s=e.length,l=this.nCachedObjects_,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],f=h.uuid,d=t[f];if(void 0===d){d=s++,t[f]=d,e.push(h);for(var p=0,m=a;p!==m;++p)r[p].push(new Dm(h,n[p],i[p]))}else if(d<l){o=e[d];var v=--l,g=e[v];t[g.uuid]=d,e[d]=g,t[f]=v,e[v]=h;for(var y=0,_=a;y!==_;++y){var x=r[y],b=x[v],w=x[d];x[d]=b,void 0===w&&(w=new Dm(h,n[y],i[y])),x[v]=w}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}},{key:"remove",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=t[l];if(void 0!==u&&u>=r){var c=r++,h=e[c];t[h.uuid]=u,e[u]=h,t[l]=c,e[c]=s;for(var f=0,d=i;f!==d;++f){var p=n[f],m=p[c],v=p[u];p[u]=m,p[c]=v}}}this.nCachedObjects_=r}},{key:"uncache",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=e.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,u=t[l];if(void 0!==u)if(delete t[l],u<r){var c=--r,h=e[c],f=--a,d=e[f];t[h.uuid]=u,e[u]=h,t[d.uuid]=c,e[c]=d,e.pop();for(var p=0,m=i;p!==m;++p){var v=n[p],g=v[c],y=v[f];v[u]=g,v[c]=y,v.pop()}}else{var _=--a,x=e[_];_>0&&(t[x.uuid]=u),e[u]=x,e.pop();for(var b=0,w=i;b!==w;++b){var S=n[b];S[u]=S[_],S.pop()}}}this.nCachedObjects_=r}},{key:"subscribe_",value:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(c);for(var h=u,f=s.length;h!==f;++h){var d=s[h];c[h]=new Dm(d,e,t)}return c}},{key:"unsubscribe_",value:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}]),e}(),zm=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;f(this,e),this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),l={endingStart:Ui,endingEnd:Ui},u=0;u!==o;++u){var c=a[u].createInterpolant(null);s[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ii,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return v(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/a,l[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;a<0||0===n?t=0:(this._startTime=null,t=n*a)}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,u=this._propertyBindings;if(this.blendMode===ji)for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulateAdditive(s);else for(var f=0,d=l.length;f!==d;++f)l[f].evaluate(o),u[f].accumulate(i,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,a=n===Oi;if(0===e)return-1===r?i:a&&1===(1&r)?t-i:i;if(n===Li){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){var o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1===(1&r))return t-i}return i}},{key:"_setEndings",value:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=Fi,i.endingEnd=Fi):(i.endingStart=e?this.zeroSlopeAtStart?Fi:Ui:Bi,i.endingEnd=t?this.zeroSlopeAtEnd?Fi:Ui:Bi)}},{key:"_scheduleFading",value:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}]),e}(),Um=new Float32Array(1),Fm=function(e){_(n,e);var t=w(n);function n(e){var i;return f(this,n),(i=t.call(this))._root=e,i._initMemoryManager(),i._accuIndex=0,i.time=0,i.timeScale=1,i}return v(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==r;++c){var h=i[c],f=h.name,d=u[f];if(void 0!==d)++d.referenceCount,a[c]=d;else{if(void 0!==(d=a[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,f));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(d=new Cm(Dm.create(n,f,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,f),a[c]=d}o[c].resultBuffer=d.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_addInactiveBinding",value:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new ap(new Float32Array(2),new Float32Array(2),1,Um)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}},{key:"clipAction",value:function(e,t,n){var i=t||this._root,r=i.uuid,a="string"===typeof e?mp.findByName(i,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==a?a.blendMode:Hi),void 0!==s){var u=s.actionByRoot[r];if(void 0!==u&&u.blendMode===n)return u;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var c=new zm(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}},{key:"existingAction",value:function(e,t){var n=t||this._root,i=n.uuid,r="string"===typeof e?mp.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}for(var s=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)s[u].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(Hr),Bm=function(){function e(t){f(this,e),this.value=t}return v(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}(),Hm=0,jm=function(e){_(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).isUniformsGroup=!0,Object.defineProperty(g(e),"id",{value:Hm++}),e.name="",e.usage=Cr,e.uniforms=[],e}return v(n,[{key:"add",value:function(e){return this.uniforms.push(e),this}},{key:"remove",value:function(e){var t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}},{key:"setName",value:function(e){return this.name=e,this}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"dispose",value:function(){return this.dispatchEvent({type:"dispose"}),this}},{key:"copy",value:function(e){this.name=e.name,this.usage=e.usage;var t=e.uniforms;this.uniforms.length=0;for(var n=0,i=t.length;n<i;n++)this.uniforms.push(t[n].clone());return this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Hr),Gm=function(e){_(n,e);var t=w(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return f(this,n),(r=t.call(this,e,i)).isInstancedInterleavedBuffer=!0,r.meshPerAttribute=a,r}return v(n,[{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=S(x(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=S(x(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(th),Vm=function(){function e(t,n,i,r,a){f(this,e),this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=n,this.itemSize=i,this.elementSize=r,this.count=a,this.version=0}return v(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setBuffer",value:function(e){return this.buffer=e,this}},{key:"setType",value:function(e,t){return this.type=e,this.elementSize=t,this}},{key:"setItemSize",value:function(e){return this.itemSize=e,this}},{key:"setCount",value:function(e){return this.count=e,this}}]),e}(),Wm=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;f(this,e),this.ray=new co(t,n),this.near=i,this.far=r,this.camera=null,this.layers=new So,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return v(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Zm(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(Xm),t}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=0,r=e.length;i<r;i++)Zm(e[i],this,n,t);return n.sort(Xm),n}}]),e}();function Xm(e,t){return e.distance-t.distance}function Zm(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i)for(var r=e.children,a=0,o=r.length;a<o;a++)Zm(r[a],t,n,!0)}var qm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return f(this,e),this.radius=t,this.phi=n,this.theta=i,this}return v(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Zr(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Ym=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return f(this,e),this.radius=t,this.theta=n,this.y=i,this}return v(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Jm=new na,Qm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new na(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new na(-1/0,-1/0);f(this,e),this.isBox2=!0,this.min=t,this.max=n}return v(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Jm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return this.clampPoint(e,Jm).distanceTo(e)}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Km=new Da,$m=new Da,ev=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da;f(this,e),this.start=t,this.end=n}return v(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){Km.subVectors(e,this.start),$m.subVectors(this.end,this.start);var n=$m.dot($m),i=$m.dot(Km)/n;return t&&(i=Zr(i,0,1)),i}},{key:"closestPointToPoint",value:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),tv=new Da,nv=function(e){_(n,e);var t=w(n);function n(e,i){var r;f(this,n),(r=t.call(this)).light=e,r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.color=i,r.type="SpotLightHelper";for(var a=new As,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,l=1;s<32;s++,l++){var u=s/32*Math.PI*2,c=l/32*Math.PI*2;o.push(Math.cos(u),Math.sin(u),1,Math.cos(c),Math.sin(c),1)}a.setAttribute("position",new bs(o,3));var h=new Xh({fog:!1,toneMapped:!1});return r.cone=new tf(a,h),r.add(r.cone),r.update(),r}return v(n,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),tv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(tv),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),n}(zo),iv=new Da,rv=new ho,av=new ho,ov=function(e){_(n,e);var t=w(n);function n(e){var i;f(this,n);for(var r=sv(e),a=new As,o=[],s=[],l=new ns(0,0,1),u=new ns(0,1,0),c=0;c<r.length;c++){var h=r[c];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(l.r,l.g,l.b),s.push(u.r,u.g,u.b))}a.setAttribute("position",new bs(o,3)),a.setAttribute("color",new bs(s,3));var d=new Xh({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(i=t.call(this,a,d)).isSkeletonHelper=!0,i.type="SkeletonHelper",i.root=e,i.bones=r,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i}return v(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");av.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(rv.multiplyMatrices(av,s.matrixWorld),iv.setFromMatrixPosition(rv),r.setXYZ(o,iv.x,iv.y,iv.z),rv.multiplyMatrices(av,s.parent.matrixWorld),iv.setFromMatrixPosition(rv),r.setXYZ(o+1,iv.x,iv.y,iv.z),o+=2)}i.getAttribute("position").needsUpdate=!0,S(x(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf);function sv(e){var t=[];!0===e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,sv(e.children[n]));return t}var lv=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;f(this,n);var o=new Ld(i,4,2),s=new rs({wireframe:!0,fog:!1,toneMapped:!1});return(a=t.call(this,o,s)).light=e,a.color=r,a.type="PointLightHelper",a.matrix=a.light.matrixWorld,a.matrixAutoUpdate=!1,a.update(),a}return v(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),n}(qs),uv=new Da,cv=new ns,hv=new ns,fv=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;f(this,n),(a=t.call(this)).light=e,a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r,a.type="HemisphereLightHelper";var o=new Pd(i);o.rotateY(.5*Math.PI),a.material=new rs({wireframe:!0,fog:!1,toneMapped:!1}),void 0===a.color&&(a.material.vertexColors=!0);var s=o.getAttribute("position"),l=new Float32Array(3*s.count);return o.setAttribute("color",new fs(l,3)),a.add(new qs(o,a.material)),a.update(),a}return v(n,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");cv.copy(this.light.color),hv.copy(this.light.groundColor);for(var n=0,i=t.count;n<i;n++){var r=n<i/2?cv:hv;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(uv.setFromMatrixPosition(this.light.matrixWorld).negate())}}]),n}(zo),dv=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;f(this,n),a=new ns(a),o=new ns(o);for(var s=r/2,l=i/r,u=i/2,c=[],h=[],d=0,p=0,m=-u;d<=r;d++,m+=l){c.push(-u,0,m,u,0,m),c.push(m,0,-u,m,0,u);var v=d===s?a:o;v.toArray(h,p),p+=3,v.toArray(h,p),p+=3,v.toArray(h,p),p+=3,v.toArray(h,p),p+=3}var g=new As;g.setAttribute("position",new bs(c,3)),g.setAttribute("color",new bs(h,3));var y=new Xh({vertexColors:!0,toneMapped:!1});return(e=t.call(this,g,y)).type="GridHelper",e}return v(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf),pv=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;f(this,n),s=new ns(s),l=new ns(l);var u=[],c=[];if(r>1)for(var h=0;h<r;h++){var d=h/r*(2*Math.PI),p=Math.sin(d)*i,m=Math.cos(d)*i;u.push(0,0,0),u.push(p,0,m);var v=1&h?s:l;c.push(v.r,v.g,v.b),c.push(v.r,v.g,v.b)}for(var g=0;g<a;g++)for(var y=1&g?s:l,_=i-i/a*g,x=0;x<o;x++){var b=x/o*(2*Math.PI),w=Math.sin(b)*_,S=Math.cos(b)*_;u.push(w,0,S),c.push(y.r,y.g,y.b),b=(x+1)/o*(2*Math.PI),w=Math.sin(b)*_,S=Math.cos(b)*_,u.push(w,0,S),c.push(y.r,y.g,y.b)}var M=new As;M.setAttribute("position",new bs(u,3)),M.setAttribute("color",new bs(c,3));var T=new Xh({vertexColors:!0,toneMapped:!1});return(e=t.call(this,M,T)).type="PolarGridHelper",e}return v(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf),mv=new Da,vv=new Da,gv=new Da,yv=function(e){_(n,e);var t=w(n);function n(e,i,r){var a;f(this,n),(a=t.call(this)).light=e,a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r,a.type="DirectionalLightHelper",void 0===i&&(i=1);var o=new As;o.setAttribute("position",new bs([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));var s=new Xh({fog:!1,toneMapped:!1});return a.lightPlane=new Kh(o,s),a.add(a.lightPlane),(o=new As).setAttribute("position",new bs([0,0,0,0,0,1],3)),a.targetLine=new Kh(o,s),a.add(a.targetLine),a.update(),a}return v(n,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),mv.setFromMatrixPosition(this.light.matrixWorld),vv.setFromMatrixPosition(this.light.target.matrixWorld),gv.subVectors(vv,mv),this.lightPlane.lookAt(vv),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vv),this.targetLine.scale.z=gv.length()}}]),n}(zo),_v=new Da,xv=new nl,bv=function(e){_(n,e);var t=w(n);function n(e){var i;f(this,n);var r=new As,a=new Xh({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],l={};function u(e,t){c(e),c(t)}function c(e){o.push(0,0,0),s.push(0,0,0),void 0===l[e]&&(l[e]=[]),l[e].push(o.length/3-1)}u("n1","n2"),u("n2","n4"),u("n4","n3"),u("n3","n1"),u("f1","f2"),u("f2","f4"),u("f4","f3"),u("f3","f1"),u("n1","f1"),u("n2","f2"),u("n3","f3"),u("n4","f4"),u("p","n1"),u("p","n2"),u("p","n3"),u("p","n4"),u("u1","u2"),u("u2","u3"),u("u3","u1"),u("c","t"),u("p","c"),u("cn1","cn2"),u("cn3","cn4"),u("cf1","cf2"),u("cf3","cf4"),r.setAttribute("position",new bs(o,3)),r.setAttribute("color",new bs(s,3)),(i=t.call(this,r,a)).type="CameraHelper",i.camera=e,i.camera.updateProjectionMatrix&&i.camera.updateProjectionMatrix(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.pointMap=l,i.update();var h=new ns(16755200),d=new ns(16711680),p=new ns(43775),m=new ns(16777215),v=new ns(3355443);return i.setColors(h,d,p,m,v),i}return v(n,[{key:"setColors",value:function(e,t,n,i,r){var a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}},{key:"update",value:function(){var e=this.geometry,t=this.pointMap;xv.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),wv("c",t,e,xv,0,0,-1),wv("t",t,e,xv,0,0,1),wv("n1",t,e,xv,-1,-1,-1),wv("n2",t,e,xv,1,-1,-1),wv("n3",t,e,xv,-1,1,-1),wv("n4",t,e,xv,1,1,-1),wv("f1",t,e,xv,-1,-1,1),wv("f2",t,e,xv,1,-1,1),wv("f3",t,e,xv,-1,1,1),wv("f4",t,e,xv,1,1,1),wv("u1",t,e,xv,.7,1.1,-1),wv("u2",t,e,xv,-.7,1.1,-1),wv("u3",t,e,xv,0,2,-1),wv("cf1",t,e,xv,-1,0,1),wv("cf2",t,e,xv,1,0,1),wv("cf3",t,e,xv,0,-1,1),wv("cf4",t,e,xv,0,1,1),wv("cn1",t,e,xv,-1,0,-1),wv("cn2",t,e,xv,1,0,-1),wv("cn3",t,e,xv,0,-1,-1),wv("cn4",t,e,xv,0,1,-1),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf);function wv(e,t,n,i,r,a,o){_v.set(r,a,o).unproject(i);var s=t[e];if(void 0!==s)for(var l=n.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],_v.x,_v.y,_v.z)}var Sv,Mv,Tv=new Ua,Ev=function(e){_(n,e);var t=w(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;f(this,n);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new As;return s.setIndex(new fs(a,1)),s.setAttribute("position",new fs(o,3)),(i=t.call(this,s,new Xh({color:r,toneMapped:!1}))).object=e,i.type="BoxHelper",i.matrixAutoUpdate=!1,i.update(),i}return v(n,[{key:"update",value:function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Tv.setFromObject(this.object),!Tv.isEmpty()){var t=Tv.min,n=Tv.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e,t){return S(x(n.prototype),"copy",this).call(this,e,t),this.object=e.object,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf),Cv=function(e){_(n,e);var t=w(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;f(this,n);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new As;return o.setIndex(new fs(a,1)),o.setAttribute("position",new bs([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(i=t.call(this,o,new Xh({color:r,toneMapped:!1}))).box=e,i.type="Box3Helper",i.geometry.computeBoundingSphere(),i}return v(n,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),S(x(n.prototype),"updateMatrixWorld",this).call(this,e))}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf),kv=function(e){_(n,e);var t=w(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960;f(this,n);var o=a,s=new As;s.setAttribute("position",new bs([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),s.computeBoundingSphere(),(i=t.call(this,s,new Xh({color:o,toneMapped:!1}))).type="PlaneHelper",i.plane=e,i.size=r;var l=new As;return l.setAttribute("position",new bs([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),l.computeBoundingSphere(),i.add(new qs(l,new rs({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),i}return v(n,[{key:"updateMatrixWorld",value:function(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),S(x(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}]),n}(Kh),Pv=new Da,Av=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da(0,0,1),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Da(0,0,0),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*a,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*s;return f(this,n),(e=t.call(this)).type="ArrowHelper",void 0===Sv&&((Sv=new As).setAttribute("position",new bs([0,0,0,0,1,0],3)),(Mv=new jf(0,.5,1,5,1)).translate(0,-.5,0)),e.position.copy(r),e.line=new Kh(Sv,new Xh({color:o,toneMapped:!1})),e.line.matrixAutoUpdate=!1,e.add(e.line),e.cone=new qs(Mv,new rs({color:o,toneMapped:!1})),e.cone.matrixAutoUpdate=!1,e.add(e.cone),e.setDirection(i),e.setLength(a,s,l),e}return v(n,[{key:"setDirection",value:function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Pv.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Pv,t)}}},{key:"setLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return S(x(n.prototype),"copy",this).call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},{key:"dispose",value:function(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}]),n}(zo),Rv=function(e){_(n,e);var t=w(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;f(this,n);var r=[0,0,0,i,0,0,0,0,0,0,i,0,0,0,0,0,0,i],a=new As;a.setAttribute("position",new bs(r,3)),a.setAttribute("color",new bs([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var o=new Xh({vertexColors:!0,toneMapped:!1});return(e=t.call(this,a,o)).type="AxesHelper",e}return v(n,[{key:"setColors",value:function(e,t,n){var i=new ns,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(tf),Lv=function(){function e(){f(this,e),this.type="ShapePath",this.color=new ns,this.subPaths=[],this.currentPath=null}return v(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new Uf,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e){function t(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[r],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=u*(e.x-o.x)-l*(e.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var n,i,r,a=Sd.isClockWise,o=this.subPaths;if(0===o.length)return[];var s=[];if(1===o.length)return i=o[0],(r=new Qf).curves=i.curves,s.push(r),s;var l=!a(o[0].getPoints());l=e?!l:l;var u,c,h=[],f=[],d=[],p=0;f[p]=void 0,d[p]=[];for(var m=0,v=o.length;m<v;m++)n=a(u=(i=o[m]).getPoints()),(n=e?!n:n)?(!l&&f[p]&&p++,f[p]={s:new Qf,p:u},f[p].s.curves=i.curves,l&&p++,d[p]=[]):d[p].push({h:i,p:u[0]});if(!f[0])return function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new Qf;a.curves=r.curves,t.push(a)}return t}(o);if(f.length>1){for(var g=!1,y=0,_=0,x=f.length;_<x;_++)h[_]=[];for(var b=0,w=f.length;b<w;b++)for(var S=d[b],M=0;M<S.length;M++){for(var T=S[M],E=!0,C=0;C<f.length;C++)t(T.p,f[C].p)&&(b!==C&&y++,E?(E=!1,h[C].push(T)):g=!0);E&&h[b].push(T)}y>0&&!1===g&&(d=h)}for(var k=0,P=f.length;k<P;k++){r=f[k].s,s.push(r);for(var A=0,R=(c=d[k]).length;A<R;A++)r.holes.push(c[A].h)}return s}}]),e}();"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ft}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ft);var Iv=n(585);function Ov(e){var t,n=new Set,i=function(e,i){var r="function"===typeof e?e(t):e;if(r!==t){var a=t;t=i?r:Object.assign({},t,r),n.forEach((function(e){return e(t,a)}))}},r=function(){return t},a={setState:i,getState:r,subscribe:function(e,i,a){return i||a?function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=i(t);function s(){var n=i(t);if(!a(o,n)){var r=o;e(o=n,r)}}return n.add(s),function(){return n.delete(s)}}(e,i,a):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(i,r,a),a}var Dv="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function Nv(e){var t="function"===typeof e?Ov(e):e,n=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,a=h((0,i.useReducer)((function(e){return e+1}),0),2)[1],o=t.getState(),s=(0,i.useRef)(o),l=(0,i.useRef)(n),u=(0,i.useRef)(r),c=(0,i.useRef)(!1),f=(0,i.useRef)();void 0===f.current&&(f.current=n(o));var d=!1;(s.current!==o||l.current!==n||u.current!==r||c.current)&&(e=n(o),d=!r(f.current,e)),Dv((function(){d&&(f.current=e),s.current=o,l.current=n,u.current=r,c.current=!1}));var p=(0,i.useRef)(o);Dv((function(){var e=function(){try{var e=t.getState(),n=l.current(e);u.current(f.current,n)||(s.current=e,f.current=n,a())}catch(i){c.current=!0,a()}},n=t.subscribe(e);return t.getState()!==p.current&&e(),n}),[]);var m=d?e:f.current;return(0,i.useDebugValue)(m),m};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}var zv=n(258),Uv=n.n(zv),Fv=n(545),Bv=function(e){return"object"===typeof e&&"function"===typeof e.then},Hv=[];function jv(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e===t)return!0;if(!e||!t)return!1;var i=e.length;if(t.length!==i)return!1;for(var r=0;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}function Gv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===t&&(t=[e]);for(var r=0,a=Hv;r<a.length;r++){var o=a[r];if(jv(t,o.keys,o.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return i.lifespan&&i.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,i.lifespan)),o.response;if(!n)throw o.promise}}var s={keys:t,equal:i.equal,remove:function(){var e=Hv.indexOf(s);-1!==e&&Hv.splice(e,1)},promise:(Bv(e)?e:e.apply(void 0,l(t))).then((function(e){s.response=e,i.lifespan&&i.lifespan>0&&(s.timeout=setTimeout(s.remove,i.lifespan))})).catch((function(e){return s.error=e}))};if(Hv.push(s),!n)throw s.promise}var Vv,Wv,Xv=function(e,t,n){return Gv(e,t,!1,n)},Zv=["args","attach"],qv=["args","children"],Yv=["args","children"],Jv=["children","key","ref"],Qv=["children","key","ref"],Kv=["params"],$v={};var eg=function(e){return"colorSpace"in e||"outputColorSpace"in e},tg=function(){var e;return null!=(e=$v.ColorManagement)?e:null},ng=function(e){return e&&e.isOrthographicCamera},ig="undefined"!==typeof window&&(null!=(Vv=window.document)&&Vv.createElement||"ReactNative"===(null==(Wv=window.navigator)?void 0:Wv.product))?i.useLayoutEffect:i.useEffect;function rg(e){var t=i.useRef(e);return ig((function(){t.current=e}),[e]),t}function ag(e){var t=e.set;return ig((function(){return t(new Promise((function(){return null}))),function(){return t(!1)}}),[t]),null}var og=function(e){_(n,e);var t=w(n);function n(){var e;f(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={error:!1},e}return v(n,[{key:"componentDidCatch",value:function(e){this.props.set(e)}},{key:"render",value:function(){return this.state.error?null:this.props.children}}]),n}(i.Component);og.getDerivedStateFromError=function(){return{error:!0}};var sg="__default",lg=new Map,ug=function(e){return e&&!!e.memoized&&!!e.changes};function cg(e){var t,n="undefined"!==typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}var hg=function(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()},fg={obj:function(e){return e===Object(e)&&!fg.arr(e)&&"function"!==typeof e},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},boo:function(e){return"boolean"===typeof e},und:function(e){return void 0===e},arr:function(e){return Array.isArray(e)},equ:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.arrays,r=void 0===i?"shallow":i,a=n.objects,o=void 0===a?"reference":a,s=n.strict,l=void 0===s||s;if(typeof e!==typeof t||!!e!==!!t)return!1;if(fg.str(e)||fg.num(e))return e===t;var u=fg.obj(e);if(u&&"reference"===o)return e===t;var c,h=fg.arr(e);if(h&&"reference"===r)return e===t;if((h||u)&&e===t)return!0;for(c in e)if(!(c in t))return!1;if(u&&"shallow"===r&&"shallow"===o){for(c in l?t:e)if(!fg.equ(e[c],t[c],{strict:l,objects:"reference"}))return!1}else for(c in l?t:e)if(e[c]!==t[c])return!1;if(fg.und(c)){if(h&&0===e.length&&0===t.length)return!0;if(u&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function dg(e){var t={nodes:{},materials:{}};return e&&e.traverse((function(e){e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function pg(e,t){return e.__r3f=st({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t),e}function mg(e,t){var n=e;if(t.includes("-")){var i=t.split("-"),r=i.pop();return n=i.reduce((function(e,t){return e[t]}),e),{target:n,key:r}}return{target:n,key:t}}var vg=/-\d+$/;function gg(e,t,n){if(fg.str(n)){if(vg.test(n)){var i=mg(e,n.replace(vg,"")),r=i.target,a=i.key;Array.isArray(r[a])||(r[a]=[])}var o=mg(e,n),s=o.target,l=o.key;t.__r3f.previousAttach=s[l],s[l]=t}else t.__r3f.previousAttach=n(e,t)}function yg(e,t,n){var i,r;if(fg.str(n)){var a=mg(e,n),o=a.target,s=a.key,l=t.__r3f.previousAttach;void 0===l?delete o[s]:o[s]=l}else null==(i=t.__r3f)||null==i.previousAttach||i.previousAttach(e,t);null==(r=t.__r3f)||delete r.previousAttach}function _g(e,t){t.children,t.key,t.ref;var n,i=rt(t,Jv),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(r.children,r.key,r.ref,rt(r,Qv)),o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null!=(n=null==e?void 0:e.__r3f)?n:{},l=Object.entries(i),u=[];if(o)for(var c=Object.keys(a),f=0;f<c.length;f++)i.hasOwnProperty(c[f])||l.unshift([c[f],sg+"remove"]);l.forEach((function(t){var n,r=h(t,2),o=r[0],s=r[1];if((null==(n=e.__r3f)||!n.primitive||"object"!==o)&&!fg.equ(s,a[o])){if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(o))return u.push([o,s,!0,[]]);var l=[];for(var c in o.includes("-")&&(l=o.split("-")),u.push([o,s,!1,l]),i){var f=i[c];c.startsWith("".concat(o,"-"))&&u.push([c,f,!1,c.split("-")])}}}));var d=st({},i);return s.memoizedProps&&s.memoizedProps.args&&(d.args=s.memoizedProps.args),s.memoizedProps&&s.memoizedProps.attach&&(d.attach=s.memoizedProps.attach),{memoized:d,changes:u}}function xg(e,t){var n,i,r,a=null!=(n=e.__r3f)?n:{},o=a.root,s=null!=(i=null==o||null==o.getState?void 0:o.getState())?i:{},u=ug(t)?t:_g(e,t),c=u.memoized,f=u.changes,d=a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=c);for(var p=0;p<f.length;p++){var m=h(f[p],4),v=m[0],g=m[1],y=m[2],_=m[3];if(eg(e)){var x="srgb",b="srgb-linear";"encoding"===v?(v="colorSpace",g=3001===g?x:b):"outputEncoding"===v&&(v="outputColorSpace",g=3001===g?x:b)}var w=e,S=w[v];if(_.length&&(S=_.reduce((function(e,t){return e[t]}),e),!S||!S.set)){var M=lt(_.reverse()),T=M[0];w=M.slice(1).reverse().reduce((function(e,t){return e[t]}),e),v=T}if(g===sg+"remove")if(w.constructor){var E=lg.get(w.constructor);E||(E=new w.constructor,lg.set(w.constructor,E)),g=E[v]}else g=0;if(y)g?a.handlers[v]=g:delete a.handlers[v],a.eventCount=Object.keys(a.handlers).length;else if(S&&S.set&&(S.copy||S instanceof So)){var C;if(Array.isArray(g))S.fromArray?S.fromArray(g):(C=S).set.apply(C,l(g));else if(S.copy&&g&&g.constructor&&S.constructor===g.constructor)S.copy(g);else if(void 0!==g){var k=S instanceof ns;!k&&S.setScalar?S.setScalar(g):S instanceof So&&g instanceof So?S.mask=g.mask:S.set(g),tg()||s.linear||!k||S.convertSRGBToLinear()}}else if(w[v]=g,w[v]instanceof Ta&&w[v].format===Vn&&w[v].type===Ln){var P=w[v];eg(P)&&eg(s.gl)?P.colorSpace=s.gl.outputColorSpace:P.encoding=s.gl.outputEncoding}bg(e)}if(a.parent&&s.internal&&e.raycast&&d!==a.eventCount){var A=s.internal.interaction.indexOf(e);A>-1&&s.internal.interaction.splice(A,1),a.eventCount&&s.internal.interaction.push(e)}return!(1===f.length&&"onUpdate"===f[0][0])&&f.length&&null!=(r=e.__r3f)&&r.parent&&wg(e),e}function bg(e){var t,n,i=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function wg(e){null==e.onUpdate||e.onUpdate(e)}function Sg(e,t){e.manual||(ng(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Mg(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Tg(e,t,n,i){var r=n.get(t);r&&(n.delete(t),0===n.size&&(e.delete(i),r.target.releasePointerCapture(i)))}function Eg(e){function t(e){return e.filter((function(e){return["Move","Over","Enter","Out","Leave"].some((function(t){var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}))}function n(t){var n,i=e.getState().internal,r=ke(i.hovered.values());try{var a=function(){var e=n.value;if(!t.length||!t.find((function(t){return t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId}))){var r=e.eventObject.__r3f,a=null==r?void 0:r.handlers;if(i.hovered.delete(Mg(e)),null!=r&&r.eventCount){var o=st(st({},e),{},{intersections:t});null==a.onPointerOut||a.onPointerOut(o),null==a.onPointerLeave||a.onPointerLeave(o)}}};for(r.s();!(n=r.n()).done;)a()}catch(lA){r.e(lA)}finally{r.f()}}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n].__r3f;null==i||null==i.handlers.onPointerMissed||i.handlers.onPointerMissed(e)}}return{handlePointer:function(r){switch(r){case"onPointerLeave":case"onPointerCancel":return function(){return n([])};case"onLostPointerCapture":return function(t){var i=e.getState().internal;"pointerId"in t&&i.capturedMap.has(t.pointerId)&&requestAnimationFrame((function(){i.capturedMap.has(t.pointerId)&&(i.capturedMap.delete(t.pointerId),n([]))}))}}return function(a){var o=e.getState(),s=o.onPointerMissed,u=o.internal;u.lastEvent.current=a;var c="onPointerMove"===r,h="onClick"===r||"onContextMenu"===r||"onDoubleClick"===r,f=function(t,n){for(var i=e.getState(),r=new Set,a=[],o=n?n(i.internal.interaction):i.internal.interaction,s=0;s<o.length;s++){var l=hg(o[s]);l&&(l.raycaster.camera=void 0)}i.previousRoot||null==i.events.compute||i.events.compute(t,i);var u=o.flatMap((function(e){var n,i=hg(e);return i&&i.events.enabled&&null!==i.raycaster.camera?(void 0===i.raycaster.camera&&(null==i.events.compute||i.events.compute(t,i,null==(n=i.previousRoot)?void 0:n.getState()),void 0===i.raycaster.camera&&(i.raycaster.camera=null)),i.raycaster.camera?i.raycaster.intersectObject(e,!0):[]):[]})).sort((function(e,t){var n=hg(e.object),i=hg(t.object);return n&&i&&i.events.priority-n.events.priority||e.distance-t.distance})).filter((function(e){var t=Mg(e);return!r.has(t)&&(r.add(t),!0)}));i.events.filter&&(u=i.events.filter(u,i));var c,h=ke(u);try{for(h.s();!(c=h.n()).done;)for(var f=c.value,d=f.object;d;){var p;null!=(p=d.__r3f)&&p.eventCount&&a.push(st(st({},f),{},{eventObject:d})),d=d.parent}}catch(lA){h.e(lA)}finally{h.f()}if("pointerId"in t&&i.internal.capturedMap.has(t.pointerId)){var m,v=ke(i.internal.capturedMap.get(t.pointerId).values());try{for(v.s();!(m=v.n()).done;){var g=m.value;r.has(Mg(g.intersection))||a.push(g.intersection)}}catch(lA){v.e(lA)}finally{v.f()}}return a}(a,c?t:void 0),d=h?function(t){var n=e.getState().internal,i=t.offsetX-n.initialClick[0],r=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(a):0;"onPointerDown"===r&&(u.initialClick=[a.offsetX,a.offsetY],u.initialHits=f.map((function(e){return e.eventObject}))),h&&!f.length&&d<=2&&(i(a,u.interaction),s&&s(a)),c&&n(f),function(t,i,r,a){var o=e.getState();if(t.length){var s,u={stopped:!1},c=ke(t);try{var h=function(){var e=s.value,c=hg(e.object)||o,h=c.raycaster,f=c.pointer,d=c.camera,p=c.internal,m=new Da(f.x,f.y,0).unproject(d),v=function(t){var n,i;return null!=(n=null==(i=p.capturedMap.get(t))?void 0:i.has(e.eventObject))&&n},g=function(t){var n={intersection:e,target:i.target};p.capturedMap.has(t)?p.capturedMap.get(t).set(e.eventObject,n):p.capturedMap.set(t,new Map([[e.eventObject,n]])),i.target.setPointerCapture(t)},y=function(t){var n=p.capturedMap.get(t);n&&Tg(p.capturedMap,e.eventObject,n,t)},_={};for(var x in i){var b=i[x];"function"!==typeof b&&(_[x]=b)}var w=st(st(st({},e),_),{},{pointer:f,intersections:t,stopped:u.stopped,delta:r,unprojectedPoint:m,ray:h.ray,camera:d,stopPropagation:function(){var r="pointerId"in i&&p.capturedMap.get(i.pointerId);if((!r||r.has(e.eventObject))&&(w.stopped=u.stopped=!0,p.hovered.size&&Array.from(p.hovered.values()).find((function(t){return t.eventObject===e.eventObject})))){var a=t.slice(0,t.indexOf(e));n([].concat(l(a),[e]))}},target:{hasPointerCapture:v,setPointerCapture:g,releasePointerCapture:y},currentTarget:{hasPointerCapture:v,setPointerCapture:g,releasePointerCapture:y},nativeEvent:i});if(a(w),!0===u.stopped)return 1};for(c.s();!(s=c.n()).done&&!h(););}catch(lA){c.e(lA)}finally{c.f()}}}(f,a,d,(function(e){var t=e.eventObject,n=t.__r3f,o=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(c){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){var s=Mg(e),l=u.hovered.get(s);l?l.stopped&&e.stopPropagation():(u.hovered.set(s,e),null==o.onPointerOver||o.onPointerOver(e),null==o.onPointerEnter||o.onPointerEnter(e))}null==o.onPointerMove||o.onPointerMove(e)}else{var f=o[r];f?h&&!u.initialHits.includes(t)||(i(a,u.interaction.filter((function(e){return!u.initialHits.includes(e)}))),f(e)):h&&u.initialHits.includes(t)&&i(a,u.interaction.filter((function(e){return!u.initialHits.includes(e)})))}}))}}}}var Cg,kg=function(e){return!(null==e||!e.render)},Pg=i.createContext(null),Ag=function(e,t){var n=Nv((function(n,r){var a=new Da,o=new Da,s=new Da;function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size,i=n.width,u=n.height,c=n.top,h=n.left,f=i/u;t instanceof Da?s.copy(t):s.set.apply(s,l(t));var d=e.getWorldPosition(a).distanceTo(s);if(ng(e))return{width:i/e.zoom,height:u/e.zoom,top:c,left:h,factor:1,distance:d,aspect:f};var p=e.fov*Math.PI/180,m=2*Math.tan(p/2)*d,v=m*(i/u);return{width:v,height:m,top:c,left:h,factor:i/v,distance:d,aspect:f}}var c=void 0,h=function(e){return n((function(t){return{performance:st(st({},t.performance),{},{current:e})}}))},f=new na,d={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:function(e,n){return t(e,n,r())},legacy:!1,linear:!1,flat:!1,controls:null,clock:new dm,pointer:f,mouse:f,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:function(){var e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&h(e.performance.min),c=setTimeout((function(){return h(r().performance.max)}),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:function(e){return n((function(t){return st(st({},t),{},{events:st(st({},t.events),e)})}))},setSize:function(e,t,i,a,s){var l=r().camera,c={width:e,height:t,top:a||0,left:s||0,updateStyle:i};n((function(e){return{size:c,viewport:st(st({},e.viewport),u(l,o,c))}}))},setDpr:function(e){return n((function(t){var n=cg(e);return{viewport:st(st({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}))},setFrameloop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always",t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n((function(){return{frameloop:e}}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:function(e,t,n){var i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((function(e,t){return e.priority-t.priority})),function(){var n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((function(t){return t.ref!==e})))}}}};return d})),r=n.getState(),a=r.size,o=r.viewport.dpr,s=r.camera;return n.subscribe((function(){var e=n.getState(),t=e.camera,i=e.size,r=e.viewport,l=e.gl,u=e.set;if(i!==a||r.dpr!==o){var c;a=i,o=r.dpr,Sg(t,i),l.setPixelRatio(r.dpr);var h=null!=(c=i.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&l.domElement instanceof HTMLCanvasElement;l.setSize(i.width,i.height,h)}t!==s&&(s=t,u((function(e){return{viewport:st(st({},e.viewport),e.viewport.getCurrentViewport(t))}})))})),n.subscribe((function(t){return e(t)})),n};var Rg,Lg,Ig=new Set,Og=new Set,Dg=new Set;function Ng(e,t){if(e.size){var n,i=ke(e.values());try{for(i.s();!(n=i.n()).done;){(0,n.value.callback)(t)}}catch(lA){i.e(lA)}finally{i.f()}}}function zg(e,t){switch(e){case"before":return Ng(Ig,t);case"after":return Ng(Og,t);case"tail":return Ng(Dg,t)}}function Ug(e,t,n){var i=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Rg=t.internal.subscribers,Cg=0;Cg<Rg.length;Cg++)(Lg=Rg[Cg]).ref.current(Lg.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}var Fg=new WeakMap;function Bg(e,t){return function(n){var i=Fg.get(n);i||(i=new n,Fg.set(n,i)),e&&e(i);for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return Promise.all(a.map((function(e){return new Promise((function(n,r){return i.load(e,(function(e){e.scene&&Object.assign(e,dg(e.scene)),n(e)}),t,(function(t){return r(new Error("Could not load ".concat(e,": ").concat(null==t?void 0:t.message)))}))}))}))).finally((function(){return null==i.dispose?void 0:i.dispose()}))}}function Hg(e,t,n,i){var r=Array.isArray(t)?t:[t],a=Xv(Bg(n,i),[e].concat(l(r)),{equal:fg.equ});return Array.isArray(t)?a:a[0]}Hg.preload=function(e,t,n){var i=Array.isArray(t)?t:[t];return function(e,t,n){Gv(e,t,!0,n)}(Bg(n),[e].concat(l(i)))},Hg.clear=function(e,t){var n=Array.isArray(t)?t:[t];return function(e){if(void 0===e||0===e.length)Hv.splice(0,Hv.length);else{var t=Hv.find((function(t){return jv(e,t.keys,t.equal)}));t&&t.remove()}}([e].concat(l(n)))};var jg=new Map,Gg=function(e){var t,n,i,r=!1;function a(o){n=requestAnimationFrame(a),r=!0,t=0,zg("before",o);var s,l=ke(e.values());try{for(l.s();!(s=l.n()).done;){var u,c=s.value;!(i=c.store.getState()).internal.active||!("always"===i.frameloop||i.internal.frames>0)||null!=(u=i.gl.xr)&&u.isPresenting||(t+=Ug(o,i))}}catch(lA){l.e(lA)}finally{l.f()}if(zg("after",o),0===t)return zg("tail",o),r=!1,cancelAnimationFrame(n)}return{loop:a,invalidate:function t(n){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!n)return e.forEach((function(e){return t(e.store.getState())}),o);null!=(i=n.gl.xr)&&i.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=Math.min(60,n.internal.frames+o),r||(r=!0,requestAnimationFrame(a)))},advance:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n&&zg("before",t),i)Ug(t,i,r);else{var a,o=ke(e.values());try{for(o.s();!(a=o.n()).done;){Ug(t,a.value.store.getState())}}catch(lA){o.e(lA)}finally{o.f()}}n&&zg("after",t)}}}(jg),Vg=Gg.invalidate,Wg=Gg.advance,Xg=function(e,t){function n(e,t,n){var i,r=t.args,a=void 0===r?[]:r,o=t.attach,s=rt(t,Zv),u="".concat(e[0].toUpperCase()).concat(e.slice(1));if("primitive"===e){if(void 0===s.object)throw new Error("R3F: Primitives without 'object' are invalid!");i=pg(s.object,{type:e,root:n,attach:o,primitive:!0})}else{var c=$v[u];if(!c)throw new Error("R3F: ".concat(u," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(a))throw new Error("R3F: The args prop must be an array!");i=pg(M(c,l(a)),{type:e,root:n,attach:o,memoizedProps:{args:a}})}return void 0===i.__r3f.attach&&(i instanceof As?i.__r3f.attach="geometry":i instanceof Qo&&(i.__r3f.attach="material")),"inject"!==u&&xg(i,s),i}function i(e,t){var n,i,r=!1;t&&(null!=(n=t.__r3f)&&n.attach?gg(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),r=!0),r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||pg(t,{}),t.__r3f.parent=e,wg(t),bg(t))}function r(e,t,n){var i=!1;if(t){var r,a;if(null!=(r=t.__r3f)&&r.attach)gg(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});var o=e.children.filter((function(e){return e!==t})),s=o.indexOf(n);e.children=[].concat(l(o.slice(0,s)),[t],l(o.slice(s))),i=!0}i||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||pg(t,{}),t.__r3f.parent=e,wg(t),bg(t)}}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&l(e).forEach((function(e){return o(t,e,n)}))}function o(e,t,n){if(t){var i,r,o;if(t.__r3f&&(t.__r3f.parent=null),null!=(i=e.__r3f)&&i.objects&&(e.__r3f.objects=e.__r3f.objects.filter((function(e){return e!==t}))),null!=(r=t.__r3f)&&r.attach)yg(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){var n=e.getState().internal;n.interaction=n.interaction.filter((function(e){return e!==t})),n.initialHits=n.initialHits.filter((function(e){return e!==t})),n.hovered.forEach((function(e,i){e.eventObject!==t&&e.object!==t||n.hovered.delete(i)})),n.capturedMap.forEach((function(e,i){Tg(n.capturedMap,t,e,i)}))}(t.__r3f.root,t)}var l,u=null==(o=t.__r3f)?void 0:o.primitive,c=void 0===n?null!==t.dispose&&!u:n;if(!u)a(null==(l=t.__r3f)?void 0:l.objects,t,c),a(t.children,t,c);delete t.__r3f,c&&t.dispose&&"Scene"!==t.type&&(0,Fv.unstable_scheduleCallback)(Fv.unstable_IdlePriority,(function(){try{t.dispose()}catch(e){}})),bg(e)}}var s=function(){return console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.")},u=Uv()({createInstance:n,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:function(e,t){if(t){var n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,i(n,t))}},removeChildFromContainer:function(e,t){t&&o(e.getState().scene,t)},insertInContainerBefore:function(e,t,n){if(t&&n){var i=e.getState().scene;i.__r3f&&r(i,t,n)}},getRootHostContext:function(){return null},getChildHostContext:function(e){return e},finalizeInitialChildren:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate:function(e,t,n,i){var r;if((null!=(r=null==e?void 0:e.__r3f)?r:{}).primitive&&i.object&&i.object!==e)return[!0];var a=i.args,o=void 0===a?[]:a,s=(i.children,rt(i,qv)),l=n.args,u=void 0===l?[]:l,c=(n.children,rt(n,Yv));if(!Array.isArray(o))throw new Error("R3F: the args prop must be an array!");if(o.some((function(e,t){return e!==u[t]})))return[!0];var h=_g(e,s,c,!0);return h.changes.length?[!1,h]:null},commitUpdate:function(e,t,r,a,s,l){var u=h(t,2),c=u[0],f=u[1];c?function(e,t,r,a){var s,l=null==(s=e.__r3f)?void 0:s.parent;if(l){var u=n(t,r,e.__r3f.root);if(e.children){var c,h=ke(e.children);try{for(h.s();!(c=h.n()).done;){var f=c.value;f.__r3f&&i(u,f)}}catch(lA){h.e(lA)}finally{h.f()}e.children=e.children.filter((function(e){return!e.__r3f}))}e.__r3f.objects.forEach((function(e){return i(u,e)})),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||o(l,e),u.parent&&(u.__r3f.autoRemovedBeforeAppend=!0),i(l,u),u.raycast&&u.__r3f.eventCount&&u.__r3f.root.getState().internal.interaction.push(u),[a,a.alternate].forEach((function(e){null!==e&&(e.stateNode=u,e.ref&&("function"===typeof e.ref?e.ref(u):e.ref.current=u))}))}}(e,r,s,l):xg(e,f)},commitMount:function(e,t,n,i){var r,a=null!=(r=e.__r3f)?r:{};e.raycast&&a.handlers&&a.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},getPublicInstance:function(e){return e},prepareForCommit:function(){return null},preparePortalMount:function(e){return pg(e.getState().scene)},resetAfterCommit:function(){},shouldSetTextContent:function(){return!1},clearContainer:function(){return!1},hideInstance:function(e){var t,n=null!=(t=e.__r3f)?t:{},i=n.attach,r=n.parent;i&&r&&yg(r,e,i),e.isObject3D&&(e.visible=!1),bg(e)},unhideInstance:function(e,t){var n,i=null!=(n=e.__r3f)?n:{},r=i.attach,a=i.parent;r&&a&&gg(a,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),bg(e)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:function(){return t?t():Iv.DefaultEventPriority},beforeActiveInstanceBlur:function(){},afterActiveInstanceBlur:function(){},detachDeletedInstance:function(){},now:"undefined"!==typeof performance&&fg.fun(performance.now)?performance.now:fg.fun(Date.now)?Date.now:function(){return 0},scheduleTimeout:fg.fun(setTimeout)?setTimeout:void 0,cancelTimeout:fg.fun(clearTimeout)?clearTimeout:void 0});return{reconciler:u,applyProps:xg}}(0,(function(){var e,t="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!t)return Iv.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Iv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Iv.ContinuousEventPriority;default:return Iv.DefaultEventPriority}})),Zg=Xg.reconciler,qg=Xg.applyProps,Yg={objects:"shallow",strict:!1},Jg=function(e,t){var n="function"===typeof e?e(t):e;return kg(n)?n:new Yc(st({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function Qg(e){var t=jg.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");var a,o="function"===typeof reportError?reportError:console.error,s=r||Ag(Vg,Wg),l=n||Zg.createContainer(s,Iv.ConcurrentRoot,null,!1,null,"",o,null);t||jg.set(e,{fiber:l,store:s});var u,c=!1;return{configure:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.gl,i=t.size,r=t.scene,o=t.events,l=t.onCreated,h=t.shadows,f=void 0!==h&&h,d=t.linear,p=void 0!==d&&d,m=t.flat,v=void 0!==m&&m,g=t.legacy,y=void 0!==g&&g,_=t.orthographic,x=void 0!==_&&_,b=t.frameloop,w=void 0===b?"always":b,S=t.dpr,M=void 0===S?[1,2]:S,T=t.performance,E=t.raycaster,C=t.camera,k=t.onPointerMissed,P=s.getState(),A=P.gl;P.gl||P.set({gl:A=Jg(n,e)});var R=P.raycaster;R||P.set({raycaster:R=new Wm});var L,I=E||{},O=I.params,D=rt(I,Kv);if(fg.equ(D,R,Yg)||qg(R,st({},D)),fg.equ(O,R.params,Yg)||qg(R,{params:st(st({},R.params),O)}),!P.camera||P.camera===u&&!fg.equ(u,C,Yg)){u=C;var N=C instanceof nl,z=N?C:x?new kl(0,0,0,0,.1,1e3):new il(75,0,.1,1e3);N||(z.position.z=5,C&&qg(z,C),P.camera||null!=C&&C.rotation||z.lookAt(0,0,0)),P.set({camera:z})}P.scene||(r instanceof eh?L=r:(L=new eh,r&&qg(L,r)),P.set({scene:pg(L)}));if(!P.xr){var U,F=function(e,t){var n=s.getState();"never"!==n.frameloop&&Wg(e,!0,n,t)},B=function(){var e=s.getState();e.gl.xr.enabled=e.gl.xr.isPresenting,e.gl.xr.setAnimationLoop(e.gl.xr.isPresenting?F:null),e.gl.xr.isPresenting||Vg(e)},H={connect:function(){var e=s.getState().gl;e.xr.addEventListener("sessionstart",B),e.xr.addEventListener("sessionend",B)},disconnect:function(){var e=s.getState().gl;e.xr.removeEventListener("sessionstart",B),e.xr.removeEventListener("sessionend",B)}};"function"===typeof(null==(U=A.xr)?void 0:U.addEventListener)&&H.connect(),P.set({xr:H})}if(A.shadowMap){var j=A.shadowMap.enabled,G=A.shadowMap.type;if(A.shadowMap.enabled=!!f,fg.boo(f))A.shadowMap.type=bt;else if(fg.str(f)){var V,W={basic:_t,percentage:xt,soft:bt,variance:wt};A.shadowMap.type=null!=(V=W[f])?V:bt}else fg.obj(f)&&Object.assign(A.shadowMap,f);j===A.shadowMap.enabled&&G===A.shadowMap.type||(A.shadowMap.needsUpdate=!0)}var X=tg();X&&("enabled"in X?X.enabled=!y:"legacyMode"in X&&(X.legacyMode=y));qg(A,{outputEncoding:p?3e3:3001,toneMapping:v?sn:hn}),P.legacy!==y&&P.set((function(){return{legacy:y}})),P.linear!==p&&P.set((function(){return{linear:p}})),P.flat!==v&&P.set((function(){return{flat:v}})),!n||fg.fun(n)||kg(n)||fg.equ(n,A,Yg)||qg(A,n),o&&!P.events.handlers&&P.set({events:o(s)});var Z=function(e,t){if(t)return t;if("undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){var n=e.parentElement.getBoundingClientRect();return{width:n.width,height:n.height,top:n.top,left:n.left}}return"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0}:{width:0,height:0,top:0,left:0}}(e,i);return fg.equ(Z,P.size,Yg)||P.setSize(Z.width,Z.height,Z.updateStyle,Z.top,Z.left),M&&P.viewport.dpr!==cg(M)&&P.setDpr(M),P.frameloop!==w&&P.setFrameloop(w),P.onPointerMissed||P.set({onPointerMissed:k}),T&&!fg.equ(T,P.performance,Yg)&&P.set((function(e){return{performance:st(st({},e.performance),T)}})),a=l,c=!0,this},render:function(t){return c||this.configure(),Zg.updateContainer(i.createElement(Kg,{store:s,children:t,onCreated:a,rootElement:e}),l,null,(function(){})),s},unmount:function(){$g(e)}}}function Kg(e){var t=e.store,n=e.children,r=e.onCreated,a=e.rootElement;return ig((function(){var e=t.getState();e.set((function(e){return{internal:st(st({},e.internal),{},{active:!0})}})),r&&r(e),t.getState().events.connected||null==e.events.connect||e.events.connect(a)}),[]),i.createElement(Pg.Provider,{value:t},n)}function $g(e,t){var n=jg.get(e),i=null==n?void 0:n.fiber;if(i){var r=null==n?void 0:n.store.getState();r&&(r.internal.active=!1),Zg.updateContainer(null,i,null,(function(){r&&setTimeout((function(){try{var n,i,a,o;null==r.events.disconnect||r.events.disconnect(),null==(n=r.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(a=r.gl)||null==a.forceContextLoss||a.forceContextLoss(),null!=(o=r.gl)&&o.xr&&r.xr.disconnect(),function(e){for(var t in e.dispose&&"Scene"!==e.type&&e.dispose(),e)null==t.dispose||t.dispose(),delete e[t]}(r),jg.delete(e),t&&t(e)}catch(s){}}),500)}))}}Zg.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:i.version});i.unstable_act;function ey(){return ey=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ey.apply(this,arguments)}var ty=n(494),ny=n.n(ty);function iy(e){var t=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e,n=t.debounce,r=t.scroll,a=t.polyfill,o=t.offsetSize,s=a||("undefined"===typeof window?v((function e(){f(this,e)})):window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");var l=h((0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),2),u=l[0],c=l[1],d=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u}),p=n?"number"===typeof n?n:n.scroll:null,m=n?"number"===typeof n?n:n.resize:null,g=(0,i.useRef)(!1);(0,i.useEffect)((function(){return g.current=!0,function(){g.current=!1}}));var y=h((0,i.useMemo)((function(){var e=function(){if(d.current.element){var e=d.current.element.getBoundingClientRect(),t={left:e.left,top:e.top,width:e.width,height:e.height,bottom:e.bottom,right:e.right,x:e.x,y:e.y};d.current.element instanceof HTMLElement&&o&&(t.height=d.current.element.offsetHeight,t.width=d.current.element.offsetWidth),Object.freeze(t),g.current&&!oy(d.current.lastBounds,t)&&c(d.current.lastBounds=t)}};return[e,m?ny()(e,m):e,p?ny()(e,p):e]}),[c,o,p,m]),3),_=y[0],x=y[1],b=y[2];function w(){d.current.scrollContainers&&(d.current.scrollContainers.forEach((function(e){return e.removeEventListener("scroll",b,!0)})),d.current.scrollContainers=null),d.current.resizeObserver&&(d.current.resizeObserver.disconnect(),d.current.resizeObserver=null)}function S(){d.current.element&&(d.current.resizeObserver=new s(b),d.current.resizeObserver.observe(d.current.element),r&&d.current.scrollContainers&&d.current.scrollContainers.forEach((function(e){return e.addEventListener("scroll",b,{capture:!0,passive:!0})})))}var M,T,E;return M=b,T=Boolean(r),(0,i.useEffect)((function(){if(T){var e=M;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),function(){window.removeEventListener("scroll",e,!0)}}}),[M,T]),E=x,(0,i.useEffect)((function(){var e=E;return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[E]),(0,i.useEffect)((function(){w(),S()}),[r,b,x]),(0,i.useEffect)((function(){return w}),[]),[function(e){e&&e!==d.current.element&&(w(),d.current.element=e,d.current.scrollContainers=ry(e),S())},u,_]}function ry(e){var t=[];if(!e||e===document.body)return t;var n=window.getComputedStyle(e);return[n.overflow,n.overflowX,n.overflowY].some((function(e){return"auto"===e||"scroll"===e}))&&t.push(e),[].concat(t,l(ry(e.parentElement)))}var ay=["x","y","top","bottom","left","right","width","height"],oy=function(e,t){return ay.every((function(n){return e[n]===t[n]}))},sy=Object.defineProperty,ly=Object.defineProperties,uy=Object.getOwnPropertyDescriptors,cy=Object.getOwnPropertySymbols,hy=Object.prototype.hasOwnProperty,fy=Object.prototype.propertyIsEnumerable,dy=function(e,t,n){return t in e?sy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},py=function(e,t){for(var n in t||(t={}))hy.call(t,n)&&dy(e,n,t[n]);if(cy){var i,r=ke(cy(t));try{for(r.s();!(i=r.n()).done;){n=i.value;fy.call(t,n)&&dy(e,n,t[n])}}catch(lA){r.e(lA)}finally{r.f()}}return e};function my(e,t,n){if(e){if(!0===n(e))return e;for(var i=t?e.return:e.child;i;){var r=my(i,t,n);if(r)return r;i=t?null:i.sibling}}}function vy(e){try{return Object.defineProperties(e,{_currentRenderer:{get:function(){return null},set:function(){}},_currentRenderer2:{get:function(){return null},set:function(){}}})}catch(t){return e}}var gy=vy(i.createContext(null)),yy=function(e){_(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return v(n,[{key:"render",value:function(){return i.createElement(gy.Provider,{value:this._reactInternals},this.props.children)}}]),n}(i.Component),_y=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xy=_y.ReactCurrentOwner,by=_y.ReactCurrentDispatcher;function wy(){var e=i.useContext(gy);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");var t=i.useId();return i.useMemo((function(){for(var n=0,i=[null==xy?void 0:xy.current,e,null==e?void 0:e.alternate];n<i.length;n++){var r=i[n];if(r){var a=my(r,!1,(function(e){for(var n=e.memoizedState;n;){if(n.memoizedState===t)return!0;n=n.next}}));if(a)return a}}}),[e,t])}function Sy(){var e=function(){var e,t,n=wy(),r=h(i.useState((function(){return new Map})),1)[0];r.clear();for(var a=n;a;){var o=null==(e=a.type)?void 0:e._context;o&&o!==gy&&!r.has(o)&&r.set(o,null==(t=null==by?void 0:by.current)?void 0:t.readContext(vy(o))),a=a.return}return r}();return i.useMemo((function(){return Array.from(e.keys()).reduce((function(t,n){return function(r){return i.createElement(t,null,i.createElement(n.Provider,(a=py({},r),o={value:e.get(n)},ly(a,uy(o)))));var a,o}}),(function(e){return i.createElement(yy,py({},e))}))}),[e])}var My=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","scene","onPointerMissed","onCreated"],Ty={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Ey(e){var t=Eg(e).handlePointer;return{priority:1,enabled:!0,compute:function(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(Ty).reduce((function(e,n){return st(st({},e),{},at({},n,t(n)))}),{}),update:function(){var t,n=e.getState(),i=n.events,r=n.internal;null!=(t=r.lastEvent)&&t.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:function(t){var n,i=e.getState(),r=i.set,a=i.events;null==a.disconnect||a.disconnect(),r((function(e){return{events:st(st({},e.events),{},{connected:t})}})),Object.entries(null!=(n=a.handlers)?n:[]).forEach((function(e){var n=h(e,2),i=n[0],r=n[1],a=h(Ty[i],2),o=a[0],s=a[1];t.addEventListener(o,r,{passive:s})}))},disconnect:function(){var t,n=e.getState(),i=n.set,r=n.events;r.connected&&(Object.entries(null!=(t=r.handlers)?t:[]).forEach((function(e){var t=h(e,2),n=t[0],i=t[1];if(r&&r.connected instanceof HTMLElement){var a=h(Ty[n],1)[0];r.connected.removeEventListener(a,i)}})),i((function(e){return{events:st(st({},e.events),{},{connected:void 0})}})))}}}var Cy=i.forwardRef((function(e,n){var r=e.children,a=e.fallback,o=e.resize,s=e.style,l=e.gl,u=e.events,c=void 0===u?Ey:u,f=e.eventSource,d=e.eventPrefix,p=e.shadows,m=e.linear,v=e.flat,g=e.legacy,y=e.orthographic,_=e.frameloop,x=e.dpr,b=e.performance,w=e.raycaster,S=e.camera,M=e.scene,T=e.onPointerMissed,E=e.onCreated,C=rt(e,My);i.useMemo((function(){return e=t,void Object.assign($v,e);var e}),[]);var k=Sy(),P=h(iy(st({scroll:!0,debounce:{scroll:50,resize:0}},o)),2),A=P[0],R=P[1],L=i.useRef(null),I=i.useRef(null);i.useImperativeHandle(n,(function(){return L.current}));var O=rg(T),D=h(i.useState(!1),2),N=D[0],z=D[1],U=h(i.useState(!1),2),F=U[0],B=U[1];if(N)throw N;if(F)throw F;var H=i.useRef(null);ig((function(){var e=L.current;R.width>0&&R.height>0&&e&&(H.current||(H.current=Qg(e)),H.current.configure({gl:l,events:c,shadows:p,linear:m,flat:v,legacy:g,orthographic:y,frameloop:_,dpr:x,performance:b,raycaster:w,camera:S,scene:M,size:R,onPointerMissed:function(){return null==O.current?void 0:O.current.apply(O,arguments)},onCreated:function(e){var t;null==e.events.connect||e.events.connect(f?(t=f)&&t.hasOwnProperty("current")?f.current:f:I.current),d&&e.setEvents({compute:function(e,t){var n=e[d+"X"],i=e[d+"Y"];t.pointer.set(n/t.size.width*2-1,-i/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==E||E(e)}}),H.current.render(i.createElement(k,null,i.createElement(og,{set:B},i.createElement(i.Suspense,{fallback:i.createElement(ag,{set:z})},r)))))})),i.useEffect((function(){var e=L.current;if(e)return function(){return $g(e)}}),[]);var j=f?"none":"auto";return i.createElement("div",ey({ref:I,style:st({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:j},s)},C),i.createElement("div",{ref:A,style:{width:"100%",height:"100%"}},i.createElement("canvas",{ref:L,style:{display:"block"}},a)))})),ky=i.forwardRef((function(e,t){return i.createElement(yy,null,i.createElement(Cy,ey({},e,{ref:t})))})),Py=n(184);function Ay(e){var t=(0,i.useRef)(),n=(0,i.useRef)(),r=(0,i.useRef)(),a=(0,i.useRef)(),o=h((0,i.useState)([0,0,0]),2),s=o[0],l=o[1],u=3.141592/180;(0,i.useEffect)((function(){t.current.rotation.y=3*3.141592/2}),[]),(0,i.useEffect)((function(){l(e.euler),n.current.rotation.z=s[0]*u,r.current.rotation.x=s[1]*u,a.current.rotation.y=-s[2]*u}),[e.euler]);var c=Hg(Ap,"navball.png");return c.anisotropy=16,(0,Py.jsx)("group",{ref:n,children:(0,Py.jsx)("group",{ref:r,children:(0,Py.jsx)("group",{ref:a,children:(0,Py.jsxs)("mesh",{ref:t,children:[(0,Py.jsx)("sphereGeometry",{args:[40,48,32]}),(0,Py.jsx)("meshBasicMaterial",{map:c})]})})})})}var Ry=function(e){var t=h((0,i.useState)([0,0,0]),2),n=t[0],r=t[1];return(0,i.useEffect)((function(){console.log(n),Array.isArray(e.euler)&&3===e.euler.length&&r(e.euler)}),[e.euler]),(0,Py.jsx)("div",{id:"navball-container",children:(0,Py.jsx)(ky,{camera:{zoom:3.55,top:150,bottom:-150,left:150,right:-150,near:1,far:1024,position:[0,0,200]},orthographic:!0,flat:!0,children:(0,Py.jsx)(Ay,{euler:n})})})};for(var Ly=function(e){var t=window.innerHeight>700?window.innerHeight-360:340,n=h((0,i.useState)(0),2),r=n[0],a=n[1],o=h((0,i.useState)(0),2),s=o[0],l=o[1],u=h((0,i.useState)(0),2),c=u[0],f=u[1],d=h((0,i.useState)(0),2),p=d[0],m=d[1],v=h((0,i.useState)(0),2),g=v[0],y=v[1],_=h((0,i.useState)(0),2),x=_[0],b=_[1],w=h((0,i.useState)(0),2),S=w[0],M=w[1],T=h((0,i.useState)(0),2),E=T[0],C=T[1],k=h((0,i.useState)(0),2),P=k[0],A=k[1],R=h((0,i.useState)("\ubbf8\uc0ac\ucd9c"),2),L=R[0],I=R[1];return(0,i.useEffect)((function(){if(Array.isArray(e.imu)&&e.imu.length>0){var t=e.imu.length-1,n=Math.pow(9.8*e.imu[t].acc[0],2)+Math.pow(9.8*e.imu[t].acc[1],2),i=Math.sqrt(n),r=9.8*e.imu[t].acc[2],a=Math.sqrt(n+Math.pow(r,2));m(a),y(i),b(r),0===e.imu[t].ejection?I("\ubbf8\uc0ac\ucd9c"):1===e.imu[t].ejection?I("\uc790\uc138"):2===e.imu[t].ejection?I("\uace0\ub3c4"):3===e.imu[t].ejection?I("\ud0c0\uc774\uba38"):I("\uc5d0\ub7ec")}}),[e.imu]),(0,i.useEffect)((function(){if(Array.isArray(e.gps)&&e.gps.length>0){var t=e.gps.length-1,n=Math.pow(e.gps[t].velN,2)+Math.pow(e.gps[t].velE,2),i=Math.sqrt(n),r=e.gps[t].velD,o=Math.sqrt(n+Math.pow(r,2));a(o),l(i),f(r);var s=e.gps[t].height,u=s+Math.pow(r,2)/19.6,c=r/9.8;M(s),C(u),A(c)}}),[e.gps]),(0,Py.jsxs)("div",{className:"info-container",style:{height:t},children:[(0,Py.jsx)("h3",{style:{paddingTop:"10px"},children:"\uc815\ubcf4"}),(0,Py.jsx)("table",{style:{margin:"auto",borderCollapse:"collapse",width:"200px",fontSize:"13px"},children:(0,Py.jsxs)("tbody",{children:[(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\uc18d\ub825"}),(0,Py.jsxs)("td",{children:[r.toFixed(2)," m/s"]})]}),(0,Py.jsxs)("tr",{style:{border:"none"},children:[(0,Py.jsx)("th",{children:"\uc218\ud3c9\uc18d\ub3c4"}),(0,Py.jsxs)("td",{children:[s.toFixed(2)," m/s"]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\uc218\uc9c1\uc18d\ub3c4"}),(0,Py.jsxs)("td",{children:[c.toFixed(2)," m/s"]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\uac00\uc18d\ub3c4"}),(0,Py.jsxs)("td",{children:[p.toFixed(2)," m/s",(0,Py.jsx)("sup",{children:"2"})]})]}),(0,Py.jsxs)("tr",{style:{border:"none"},children:[(0,Py.jsx)("th",{children:"\uc218\ud3c9\uac00\uc18d\ub3c4"}),(0,Py.jsxs)("td",{children:[g.toFixed(2)," m/s",(0,Py.jsx)("sup",{children:"2"})]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\uc218\uc9c1\uac00\uc18d\ub3c4"}),(0,Py.jsxs)("td",{children:[x.toFixed(2)," m/s",(0,Py.jsx)("sup",{children:"2"})]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\uace0\ub3c4"}),(0,Py.jsxs)("td",{children:[S.toFixed(1)," m"]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\ucd5c\uace0\uc810"}),(0,Py.jsxs)("td",{children:[E.toFixed(1)," m"]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\ub3c4\ub2ec \uc2dc\uac04"}),(0,Py.jsxs)("td",{children:[P.toFixed(1)," s"]})]}),(0,Py.jsxs)("tr",{children:[(0,Py.jsx)("th",{children:"\uc0ac\ucd9c"}),(0,Py.jsx)("td",{children:L})]})]})})]})},Iy=n(266),Oy=n.n(Iy),Dy=n(977),Ny=n.n(Dy),zy=n(301),Uy=n.n(zy),Fy=[],By=0;By<6;By++)Fy[By]=[];var Hy=[];function jy(e,t,n){Gy(e);for(var i=0;i<6;i++)if(!n||"0"!==n.charAt(i)){var r=Fy[i];if(Hy[0]=r[0]>0?t[1][0]:t[0][0],Hy[1]=r[1]>0?t[1][1]:t[0][1],Hy[2]=r[2]>0?t[1][2]:t[0][2],Xy(r,Hy)<0)return!1}return!0}function Gy(e){var t=e,n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15];Wy(Fy[0],a-n,u-o,d-c,g-p),Wy(Fy[1],a+n,u+o,d+c,g+p),Wy(Fy[2],a+i,u+s,d+h,g+m),Wy(Fy[3],a-i,u-s,d-h,g-m),Wy(Fy[4],a-r,u-l,d-f,g-v),Wy(Fy[5],a+r,u+l,d+f,g+v)}var Vy=1/6;function Wy(e,t,n,i,r){return e[0]=t*Vy,e[1]=n*Vy,e[2]=i*Vy,e[3]=r*Vy,e}function Xy(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]}var Zy="_maptalks__internal_layer_",qy=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],Yy=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(qy),Jy=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],Qy=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],Ky={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},$y=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],e_=14;function t_(){return Date.now()}function n_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}function i_(e){return null==e}function r_(e){return"number"===typeof e&&!isNaN(e)}function a_(e){return(0|e)===e}function o_(e){return"object"===typeof e&&!!e}function s_(e){return!i_(e)&&("string"===typeof e||null!==e.constructor&&e.constructor===String)}function l_(e){return!i_(e)&&("function"===typeof e||null!==e.constructor&&e.constructor===Function)}var u_=Object.prototype.hasOwnProperty;function c_(e,t){return u_.call(e,t)}var h_=Math.PI/180;function f_(e){return e*h_}function d_(e){return e/h_}var p_="[object process]"===Object.prototype.toString.call("undefined"!==typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],m_={},v_={};function g_(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!p_){var y_=navigator.userAgent.toLowerCase(),__=document.documentElement||{style:{}},x_="ActiveXObject"in window,b_=-1!==y_.indexOf("webkit"),w_=-1!==y_.indexOf("phantom"),S_=-1!==y_.search("android [23]"),M_=-1!==y_.indexOf("chrome"),T_=-1!==y_.indexOf("gecko")&&!b_&&!window.opera&&!x_,E_=/iphone/i.test(y_)&&/micromessenger/i.test(y_),C_="undefined"!==typeof orientation||-1!==y_.indexOf("mobile"),k_=!window.PointerEvent&&window.MSPointerEvent,P_=window.PointerEvent&&navigator.pointerEnabled||k_,A_=x_&&"transition"in __.style,R_="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!S_,L_="MozPerspective"in __.style,I_="OTransition"in __.style,O_=(A_||R_||L_)&&!I_&&!w_,D_="undefined"!==typeof window&&l_(window.createImageBitmap),N_="undefined"!==typeof window&&l_(window.ResizeObserver),z_="undefined"!==typeof window&&l_(window.btoa),U_="undefined"!==typeof window&&l_(window.Proxy),F_=0;M_&&(F_=y_.match(/chrome\/([\d.]+)/)[1]);var B_=!w_&&(P_||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),H_="undefined"!==typeof window&&"WebGLRenderingContext"in window,j_=g_(),G_=!1;try{new OffscreenCanvas(2,2).getContext("2d"),G_=!0}catch(lA){G_=!1}var V_=!1;try{window.addEventListener("testPassive",(function(){}),{get passive(){V_=!0}})}catch(uA){}if(m_={ie:x_,ielt9:x_&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:b_,gecko:T_,android:-1!==y_.indexOf("android"),android23:S_,chrome:M_,chromeVersion:F_,safari:!M_&&-1!==y_.indexOf("safari"),phantomjs:w_,ie3d:A_,webkit3d:R_,gecko3d:L_,opera12:I_,any3d:O_,iosWeixin:E_,mobile:C_,mobileWebkit:C_&&b_,mobileWebkit3d:C_&&R_,mobileOpera:C_&&window.opera,mobileGecko:C_&&T_,touch:!!B_,msPointer:!!k_,pointer:!!P_,retina:j_>1,devicePixelRatio:j_,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:x_&&9===document.documentMode,ie10:x_&&10===document.documentMode,webgl:H_,imageBitMap:D_,resizeObserver:N_,btoa:z_,decodeImageInWorker:G_,monitorDPRChange:!0,supportsPassive:V_,proxy:U_,removeDPRListening:function(e){e&&delete v_[e.id]},checkDevicePixelRatio:function(){if("undefined"!==typeof window&&m_.monitorDPRChange){var e=g_(),t=e!==m_.devicePixelRatio;return t&&(m_.devicePixelRatio=e),t}return!1},addDPRListening:function(e){e&&(v_[e.id]=e)}},"undefined"!==typeof window&&window.matchMedia)for(var W_=1;W_<500;W_++){var X_=(.01*W_).toFixed(2),Z_=window.matchMedia("screen and (resolution: "+X_+"dppx)");Z_&&(Z_.addEventListener?Z_.addEventListener("change",m_.checkDevicePixelRatio):Z_.addListener&&Z_.addListener(m_.checkDevicePixelRatio))}if(m_.devicePixelRatio){var q_=m_.devicePixelRatio;Object.defineProperty(m_,"devicePixelRatio",{get:function(){return q_},set:function(e){if(e!==q_&&(q_=e,m_.monitorDPRChange))for(var t in v_){var n=v_[t];if(n&&n.options&&!n.options.devicePixelRatio&&n.checkSize&&n.getRenderer)n.getRenderer()&&n.checkSize(!0)}}})}}var Y_=m_;function J_(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tx(i.key),i)}}function Q_(){return Q_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Q_.apply(this,arguments)}function K_(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,$_(e,t)}function $_(e,t){return $_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$_(e,t)}function ex(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tx(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var nx,ix,rx=function(){function e(e,t,n){if(i_(e)||i_(t)?i_(e.x)||i_(e.y)?Array.isArray(e)&&(this.x=+e[0],this.y=+e[1],this.z=e[2]):(this.x=+e.x,this.y=+e.y,this.z=e.z):(this.x=+e,this.y=+t,this.z=n),this._isNaN())throw new Error("Position is NaN")}var t=e.prototype;return t.set=function(e,t,n){return this.x=e,this.y=t,this.z=n||0,this},t.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},t._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},t._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},t._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},t.distanceTo=function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},t.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},t.copy=function(){return new this.constructor(this.x,this.y,this.z)},t._add=function(e,t){return i_(e.x)?i_(e[0])?(this.x+=e,this.y+=t):(this.x+=e[0],this.y+=e[1]):(this.x+=e.x,this.y+=e.y),this},t.add=function(e,t){var n,i;return i_(e.x)?i_(e[0])?(n=this.x+e,i=this.y+t):(n=this.x+e[0],i=this.y+e[1]):(n=this.x+e.x,i=this.y+e.y),new this.constructor(n,i)},t._sub=function(e,t){return i_(e.x)?i_(e[0])?(this.x-=e,this.y-=t):(this.x-=e[0],this.y-=e[1]):(this.x-=e.x,this.y-=e.y),this},t._substract=function(){return this._sub.apply(this,arguments)},t.sub=function(e,t){var n,i;return i_(e.x)?i_(e[0])?(n=this.x-e,i=this.y-t):(n=this.x-e[0],i=this.y-e[1]):(n=this.x-e.x,i=this.y-e.y),new this.constructor(n,i)},t.substract=function(){return this.sub.apply(this,arguments)},t.multi=function(e){return new this.constructor(this.x*e,this.y*e)},t._multi=function(e){return this.x*=e,this.y*=e,this},t.div=function(e){return this.multi(1/e)},t._div=function(e){return this._multi(1/e)},t.equals=function(e){return e instanceof this.constructor&&(this.x===e.x&&this.y===e.y&&this.z===e.z)},t._isNaN=function(){return isNaN(this.x)||isNaN(this.y)||r_(this.z)&&isNaN(this.z)},t.isZero=function(){return 0===this.x&&0===this.y},t.toArray=function(){return r_(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},t.toFixed=function(e){return new this.constructor(this.x.toFixed(e),this.y.toFixed(e),r_(this.z)?this.z.toFixed:void 0)},t.toJSON=function(){var e={x:this.x,y:this.y};return r_(this.z)&&(e.z=this.z),e},e}(),ax=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.closeTo=function(e,t){return t||(t=0),this.x>=e.x-t&&this.x<=e.x+t&&this.y>=e.y-t&&this.y<=e.y+t},n.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.unit=function(){return this.copy()._unit()},n._unit=function(){return this._div(this.mag()),this},n.perp=function(){return this.copy()._perp()},n._perp=function(){var e=this.y;return this.y=this.x,this.x=-e,this},n.angleWith=function(e){return this.angleWithSep(e.x,e.y)},n.angleWithSep=function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},n._rotate=function(e){var t=Math.cos(e),n=Math.sin(e),i=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=i,this.y=r,this},n.rotate=function(e){return this.copy()._rotate(e)},t}(rx);function ox(e){var t="data:image/svg+xml";return e.length>4&&".svg"===e.slice(-4)?1:e.slice(0,18)===t?2:0}function sx(e,t){p_&&sx.node?sx.node(e,t):e.src=t[0]}!function(){if(p_)return nx=function(e){return setTimeout(e,16)},void(ix=clearTimeout);var e,t;function n(e){return setTimeout(e,33.333333333333336)}function i(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}"undefined"!=typeof window?(e=window.requestAnimationFrame||i("RequestAnimationFrame")||n,t=window.cancelAnimationFrame||i("CancelAnimationFrame")||i("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)}):(e=n,t=clearTimeout),nx=function(t){return e(t)},ix=function(e){e&&t(e)}}();var lx=0;function ux(){return lx++}function cx(e){return e&&s_(e)?JSON.parse(e):e}function hx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var i=0,r=n.length;i<r;i++)e.push(n[i])}return e.length}function fx(e,t){var n=t.indexOf(e);n>-1&&t.splice(n,1)}function dx(e,t,n){if(!Array.isArray(e))return n?t.call(n,e):t(e);for(var i,r,a=[],o=0,s=e.length;o<s;o++)i_(i=e[o])?a.push(null):Array.isArray(i)?a.push(dx(i,t,n)):(r=n?t.call(n,i):t(i),a.push(r));return a}function px(e,t){return void 0===e?t:e}function mx(e){return Math.sign?Math.sign(e):0===(e=+e)||isNaN(e)?Number(e):e>0?1:-1}function vx(e,t,n){return e*(1-n)+t*n}function gx(e,t,n){if(e===n||e===t)return e;var i=n-t;return((e-t)%i+i)%i+t}function yx(e,t,n){return Math.min(n,Math.max(t,e))}function _x(e){return Array.isArray(e)&&e.length>0}var xx=/^url\((['"])(.+)\1\)$/i,bx=/^url\(([^'"].*[^'"])\)$/i;function wx(e){return s_(e)?bx.test(e)?1:xx.test(e)?2:3:0}function Sx(e){var t=wx(e);return 3===t?e:1===t?bx.exec(e)[1]:2===t?xx.exec(e)[2]:e}var Mx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Tx(e){if(Y_.btoa)return window.btoa(e);for(var t,n,i=String(e),r="",a=0,o=Mx;i.charAt(0|a)||(o="=",a%1);r+=o.charAt(63&t>>8-a%1*8)){if((n=i.charCodeAt(a+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return r}function Ex(e,t){for(var n=atob(e),i=new ArrayBuffer(n.length),r=new Uint8Array(i),a=0;a<n.length;a++)r[a]=255&n.charCodeAt(a);return new Blob([i],{type:t})}function Cx(e,t,n,i){var r=n-e,a=i-t;return Math.atan2(a,r)}var kx="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function Px(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;for(var n in e)if("center"===n){if(!t[n]||!Ax(e[n][0],t[n][0])||!Ax(e[n][1],t[n][1]))return!1}else if(e[n]!==t[n])return!1;return!0}function Ax(e,t,n){return null==n&&(n=1e-6),e>=t-n&&e<=t+n}function Rx(e,t,n,i){e||(e=100),t||(t=4);var r=this,a=this.isVisible();return t*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function o(){if(0===t)return a?r.show():r.hide(),void(n&&(i?n.call(i):n()));t%2===0?r.hide():r.show(),t--,r._flashTimeout=setTimeout(o,e)}),e),this}function Lx(e,t){void 0===e&&(e=[]),void 0===t&&(t="_pt");for(var n=[],i=0,r=e.length;i<r;i++){var a=e[i];if(a){a[t]||(a[t]=new ax(0,0));var o=a[t];o.x=0,o.y=0,n.push(o)}else n.push(null)}return n}function Ix(e,t){t(e.data)}function Ox(e){if(e&&0===e.indexOf("http://")||0===e.indexOf("https://"))return e;var t=document.createElement("a");return t.href=e,e=t.href,t=null,e}var Dx,Nx={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function zx(e,t){void 0===t&&(t=1);var n=e.width,i=e.height;return Nx.cssWidth=n+"px",Nx.cssHeight=i+"px",Nx.width=Math.round(n*t),Nx.height=Math.round(i*t),Nx}var Ux={width:100,height:10};function Fx(){if(!Dx){var e=Ux.width,t=Ux.height;OffscreenCanvas?Dx=new OffscreenCanvas(e,t):((Dx=document.createElement("canvas")).width=e,Dx.height=t)}return Dx}var Bx,Hx=function(){function e(e,t){if(void 0===t&&(t={}),Array.isArray(e))if(e.length<2)console.error("colors.length should >1");else{this.colors=e;for(var n=1/0,i=-1/0,r=0,a=e.length;r<a;r++){var o=e[r][0];n=Math.min(o,n),i=Math.max(o,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},Ux,t),this._initImgData()}else console.error("colors is not array")}var t=e.prototype;return t.getImageData=function(){return this.imgData},t._initImgData=function(){var e=Fx(),t=this.options,n=t.width,i=t.height;e.width=n,e.height=i;var r=e.getContext("2d");r.clearRect(0,0,e.width,e.height);for(var a=r.createLinearGradient(0,0,e.width,0),o=this.colors,s=this.valueOffset,l=0,u=o.length;l<u;l++){var c=o[l],h=c[0],f=c[1],d=(h-this.min)/s;a.addColorStop(d,f)}r.fillStyle=a,r.fillRect(0,0,e.width,e.height),this.imgData=r.getImageData(0,0,e.width,e.height)},t.getColor=function(e){e=Math.max(this.min,e);var t=((e=Math.min(e,this.max))-this.min)/this.valueOffset,n=Math.round(t*this.imgData.width),i=4*(n=Math.min(n,this.imgData.width-1));return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]},e}();function jx(e,t){var n,i,r;if(Qx(e)){var a,o=e.stops&&"object"===typeof e.stops[0][0],s=o||void 0!==e.property,l=o||!s,u=e.type||t||"exponential";if("exponential"===u)a=Wx;else if("interval"===u)a=Vx;else if("categorical"===u)a=Gx;else if("identity"===u)a=qx;else{if("color-interpolate"!==u)throw new Error('Unknown function type "'+u+'"');a=Zx}if(o){for(var c={},h=[],f=0;f<e.stops.length;f++){var d=e.stops[f];void 0===c[d[0].zoom]&&(c[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),c[d[0].zoom].stops.push([d[0].value,d[1]])}for(var p in c)h.push([c[p].zoom,jx(c[p])]);n=function(t,n){var i=Wx({stops:h,base:e.base},t)(t,n);return"function"===typeof i?i(t,n):i},i=!1,r=!1}else l?(n=function(t){var n=a(e,t);return"function"===typeof n?n(t):n},i=!0,r=!1):(n=function(t,n){var i=a(e,n?n[e.property]:null);return"function"===typeof i?i(t,n):i},i=!1,r=!0)}else n=function(){return e},i=!0,r=!0;return n.isZoomConstant=r,n.isFeatureConstant=i,n}function Gx(e,t){for(var n=0;n<e.stops.length;n++)if(t===e.stops[n][0])return e.stops[n][1];return e.default}function Vx(e,t){for(var n=0;n<e.stops.length&&!(t<e.stops[n][0]);n++);return e.stops[Math.max(n-1,0)][1]}function Wx(e,t){for(var n=void 0!==e.base?e.base:1,i=0;!(i>=e.stops.length)&&!(t<=e.stops[i][0]);)i++;return 0===i?e.stops[i][1]:i===e.stops.length?e.stops[i-1][1]:Yx(t,n,e.stops[i-1][0],e.stops[i][0],e.stops[i-1][1],e.stops[i][1])}"function"===typeof Map&&(Bx=new Map);var Xx={width:100,height:1};function Zx(e,t){var n=e.stops;if(n&&n.length>1){var i;if(Bx){var r=JSON.stringify(n);if(!Bx.has(r)){var a=new Hx(n,Xx);Bx.set(r,a)}i=Bx.get(r)}else i=new Hx(n,Xx);var o=i.getColor(t);return[o[0]/255,o[1]/255,o[2]/255,o[3]/255]}return n&&1===n.length?n[0][1]:null}function qx(e,t){return n=t,i=e.default,void 0!==n?n:void 0!==i?i:void 0!==r?r:null;var n,i,r}function Yx(e,t,n,i,r,a){return"function"===typeof r?function(){var o=r.apply(void 0,arguments),s=a.apply(void 0,arguments);return Yx(e,t,n,i,o,s)}:r.length?function(e,t,n,i,r,a){for(var o=[],s=0;s<r.length;s++)o[s]=Jx(e,t,n,i,r[s],a[s]);return o}(e,t,n,i,r,a):Jx(e,t,n,i,r,a)}function Jx(e,t,n,i,r,a){var o,s=i-n,l=e-n;return r*(1-(o=1===t?l/s:(Math.pow(t,l)-1)/(Math.pow(t,s)-1)))+a*o}function Qx(e){return e&&"object"===typeof e&&(e.stops||e.property&&"identity"===e.type)}function Kx(e){for(var t in e)if(Qx(e[t]))return!0;return!1}function $x(e){return nb(e,"exponential")}function eb(e,t){if(!e)return null;var n=!1;if(Array.isArray(e)){for(var i,r=[],a=0;a<e.length;a++)(i=eb(e[a],t))?(r.push(i),n=!0):r.push(e[a]);return n?r:e}var o,s={__fn_types_loaded:!0},l=[];for(o in e)e.hasOwnProperty(o)&&l.push(o);for(var u=function(e){Object.defineProperty(s,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=$x(this["_"+e])),this["__fn_"+e].apply(this,t())},set:function(t){this["_"+e]=t},configurable:!0,enumerable:!0})},c=0,h=l.length;c<h;c++)Qx(e[o=l[c]])?(n=!0,s["_"+o]=e[o],u(o)):s[o]=e[o];return n?s:e}function tb(e){if(!e||!e.stops)return[];for(var t=[],n=0,i=e.stops.length;n<i;n++)t.push(e.stops[n][1]);return t}function nb(e,t){if(!Qx(e))return function(){return e};var n=!0,i=!0,r=(e=JSON.parse(JSON.stringify(e))).stops;if(r)for(var a=0;a<r.length;a++)if(Qx(r[a][1])){var o=nb(r[a][1],t);n=n&&o.isZoomConstant,i=i&&o.isFeatureConstant,r[a]=[r[a][0],o]}var s=jx(e,t);return s.isZoomConstant=n&&s.isZoomConstant,s.isFeatureConstant=i&&s.isFeatureConstant,s}var ib=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function rb(e){return new Function("f","var p = (f && f.properties || {}); return "+ab(e))}function ab(e){if(!e)return"true";var t=e[0];if(e.length<=1)return"any"===t?"false":"true";var n="=="===t?sb(e[1],e[2],"===",!1):"!="===t?sb(e[1],e[2],"!==",!1):"<"===t||">"===t||"<="===t||">="===t?sb(e[1],e[2],t,!0):"any"===t?ub(e.slice(1),"||"):"all"===t?ub(e.slice(1),"&&"):"none"===t?fb(ub(e.slice(1),"||")):"in"===t?cb(e[1],e.slice(2)):"!in"===t?fb(cb(e[1],e.slice(2))):"has"===t?hb(e[1]):"!has"===t?fb(hb(e[1])):"contains"===t?function(e,t,n){var i=ob(e);return void 0!==n?"("+i+" + '').indexOf(\""+t+'") === '+n:"("+i+" + '').indexOf(\""+t+'") >= 0'}(e[1],e[2],e[3]):"true";return"("+n+")"}function ob(e){return"$"===e[0]?"f."+e.substring(1):"p["+JSON.stringify(e)+"]"}function sb(e,t,n,i){return"object"===typeof(r=e)&&r&&e.op?function(e,t,n,i){var r=e.property,a=e.op,o=ob(r);return"length"!==a?(console.error("not support "+a+" op"),"false"):lb(o="(("+o+"+='').length)",r,t,n,i)}(e,t,n,i):lb(ob(e),e,t,n,i);var r}function lb(e,t,n,i,r){var a="$type"===t?ib.indexOf(n):JSON.stringify(n);return(r?"typeof "+e+"=== typeof "+a+"&&":"")+e+i+a}function ub(e,t){return e.map(ab).join(t)}function cb(e,t){"$type"===e&&(t=t.map((function(e){return ib.indexOf(e)})));var n=JSON.stringify(t.sort(db)),i=ob(e);return t.length<=200?n+".indexOf("+i+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+i+", "+n+",0,"+(t.length-1)+")"}function hb(e){return"$id"===e?'"id" in f':JSON.stringify(e)+" in p"}function fb(e){return"!("+e+")"}function db(e,t){return e<t?-1:e>t?1:0}function pb(e){var t=e._toJSON(),n=t.feature;return n.type=ib.indexOf(n.geometry.type),n.subType=t.subType,n}function mb(e){if(!Array.isArray(e))return mb([e]);for(var t=[],n=0;n<e.length;n++){var i=void 0;i=!0===e[n].filter?function(){return!0}:rb(e[n].filter),t.push(vb({},e[n],{filter:i}))}return t}function vb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}var gb=[],yb={};function _b(e,t){return eb(e,(function(){var e=t.getMap();return function(e,t,n){return e[0]=t,e[1]=n,e}(gb,e?e.getZoom():12,n_({},t.getProperties(),function(e,t,n,i){return e["{bearing}"]=t,e["{pitch}"]=n,e["{zoom}"]=i,e}(yb,e&&e.getBearing()||0,e&&e.getPitch()||0,e?e.getZoom():10)))}))}function xb(e){var t={stroke:{stroke:e.markerLineColor,"stroke-width":e.markerLineWidth,"stroke-opacity":e.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:e.markerFill,"fill-opacity":e.markerFillOpacity}};return 0===t.stroke["stroke-width"]&&(t.stroke["stroke-opacity"]=0),t}function bb(e,t,n){if(!e.markerPath)return null;var i=1,r=xb(e);r_(e.markerOpacity)&&(i=e.markerOpacity),r_(e.opacity)&&(i*=e.opacity);var a={};if(r){for(var o in r.stroke)r.stroke.hasOwnProperty(o)&&(i_(r.stroke[o])||(a[o]=r.stroke[o]));for(var s in r.fill)r.fill.hasOwnProperty(s)&&(i_(r.fill[s])||(a[s]=r.fill[s]))}for(var l,u=Array.isArray(e.markerPath)?e.markerPath:[e.markerPath],c=[],h=0;h<u.length;h++)(l=n_({},l=s_(u[h])?{path:u[h]}:u[h],a)).d=l.path,delete l.path,c.push(l);var f=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];i<1&&f.push('opacity="'+i+'"'),e.markerPathWidth&&e.markerPathHeight&&f.push('viewBox="0 0 '+e.markerPathWidth+" "+e.markerPathHeight+'"'),f.push('preserveAspectRatio="none"'),t&&f.push('width="'+t+'"'),n&&f.push('height="'+n+'"'),f.push("><defs></defs>");for(var d=0;d<c.length;d++){var p="<path ";for(var m in c[d])c[d].hasOwnProperty(m)&&(p+=" "+m+'="'+c[d][m]+'"');p+="></path>",f.push(p)}return f.push("</svg>"),"data:image/svg+xml;base64,"+Tx(f.join(" "))}function wb(e,t){if(!e)return[];var n=e;Array.isArray(e)||(n=[e]);for(var i,r,a,o,s=[],l=Jy,u=n.length-1;u>=0;u--)if(e=n[u]){t&&(e=Sb(e));for(var c=0;c<l.length;c++)if(Qx(i=e[l[c]])&&(i=tb(i)),i){Array.isArray(i)||(i=[i]);for(var h=0;h<i.length;h++)"url("===i[h].slice(0,4)&&(i[h]=Sx(i[h])),r=Qy[c],s.push([i[h],e[r[0]],e[r[1]]])}if("path"===e.markerType&&e.markerPath)if(a=Qx(e.markerWidth)?200:e.markerWidth,o=Qx(e.markerHeight)?200:e.markerHeight,Qx(e.markerPath)){i=tb(e.markerPath);for(var f=e.markerPath,d=0;d<i.length;d++)e.markerPath=i[d],s.push([bb(e),a,o]);e.markerPath=f}else s.push([bb(e),a,o])}return s}function Sb(e){if(!e)return null;var t=e;if(p_)return t;for(var n,i=Jy,r=0,a=i.length;r<a;r++)(n=t[i[r]])&&(t[i[r]]=Mb(n));return t}function Mb(e){if(Qx(e)){for(var t=e.stops,n=0;n<t.length;n++)t[n][1]=Mb(t[n][1]);return e}return"url("===e.slice(0,4)&&(e=Sx(e)),e}var Tb=function(){function e(e,t){r_(e)&&r_(t)?(this.width=e,this.height=t):r_(e.width)?(this.width=e.width,this.height=e.height):Array.isArray(e)&&(this.width=e[0],this.height=e[1])}var t=e.prototype;return t.copy=function(){return new e(this.width,this.height)},t.add=function(t,n){var i,r;return t instanceof e?(i=this.width+t.width,r=this.height+t.height):(i=this.width+t,r=this.height+n),new e(i,r)},t.equals=function(e){return this.width===e.width&&this.height===e.height},t.multi=function(t){return new e(this.width*t,this.height*t)},t._multi=function(e){return this.width*=e,this.height*=e,this},t._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},t.toPoint=function(){return new ax(this.width,this.height)},t.toArray=function(){return[this.width,this.height]},t.toJSON=function(){return{width:this.width,height:this.height}},e}();function Eb(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}var Cb=/[\b\t\r\v\f]/gim;function kb(e){return s_(e)?e.replace(Cb,""):e}function Pb(e){return Eb(e).split(/\s+/)}var Ab="undefined"!==typeof document?document.createElement("canvas").getContext("2d"):null;function Rb(e,t){return Rb.node?Rb.node(e,t):(Ab.font=t,Ab.measureText(e).width)}function Lb(e,t,n){var i=Rb(e,t);return new Tb(i,n||e_)}function Ib(e,t,n,i){if(!e||0===e.length)return[{text:"",width:0}];var r=i_(i)?Rb(e,t):i,a=r/e.length,o=Math.floor(n/a/2);if(a>=n||o<=0)return[{text:"",width:n}];if(r<=n)return[{text:e,width:r}];for(var s=[],l=e.substring(0,o),u=a*o,c=o,h=e.length;c<h;c++){var f=e[c],d=Rb(l+f);d>=n?(s.push({text:l,width:u}),l=e.substring(c,o+c),c+=o-1,u=a*o):(l+=f,u=d),c>=h-1&&(u=Rb(l),s.push({text:l,width:u}))}return s}var Ob=/\{([\w_]+)\}/g;function Db(e,t){return s_(e)?e.replace(Ob,(function(e,n){if(!t)return"";var i=t[n];return i_(i)?"":Array.isArray(i)?i.join():i})):e}function Nb(e,t){r_(e)&&(e+=""),e=e||"";var n=t.textMaxHeight||0,i=Bb(e,t);return n&&n<i.size.height&&(i.size.height=n),i}function zb(e,t,n){var i=e.width,r=e.height;return new ax("left"===t?-i:"right"===t?0:-i/2,"top"===n?-r:"bottom"===n?0:-r/2)}var Ub="monospace";function Fb(e){return e.textFont?e.textFont:(e.textStyle&&"normal"!==e.textStyle?e.textStyle+" ":"")+(e.textWeight&&"normal"!==e.textWeight?e.textWeight+" ":"")+e.textSize+"px "+(e.textFaceName?'"'===e.textFaceName[0]?e.textFaceName:'"'+e.textFaceName+'"':Ub)}function Bb(e,t){var n=Fb(t),i=t.textLineSpacing||0,r=Lb(e,n,t.textSize),a=r.width,o=r.height,s=t.textWrapCharacter,l=[],u=t.textWrapWidth;(!u||u>a)&&(u=a),s_(e)||(e+="");var c=0;if(s&&e.indexOf(s)>=0)for(var h=e.split(s),f=0,d=h.length;f<d;f++){var p=h[f],m=Rb(p,n);if(m>u)for(var v=Ib(p,n,u,m),g=0,y=v.length;g<y;g++){var _=v[g].width;_>c&&(c=_),l.push({text:v[g].text,size:new Tb(_,o)})}else m>c&&(c=m),l.push({text:p,size:new Tb(m,o)})}else if(a>u)for(var x=Ib(e,n,u,a),b=0;b<x.length;b++){var w=x[b].width;w>c&&(c=w),l.push({text:x[b].text,size:new Tb(w,o)})}else a>c&&(c=a),l.push({text:e,size:r});var S=l.length;return{total:S,size:new Tb(c,o*S+i*(S-1)),rows:l,rawSize:r}}function Hb(e){var t=0,n=e&&e.length||0;if(!n)return t;for(var i=0;i<n;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return t}function jb(e){return e&&e.colorStops}function Gb(e){var t=[e.type];if(e.places&&t.push(e.places.join()),e.colorStops){for(var n=[],i=e.colorStops.length-1;i>=0;i--)n.push(e.colorStops[i].join());t.push(n.join(","))}return t.join("_")}function Vb(e,t){if(!e)return 1;var n=[];if(Array.isArray(e)){for(var i=0;i<e.length;i++)n.push(Vb(e[i],t));return n.sort().join(",")}var r=Object.keys(e).sort().reduce((function(n,i){return t&&0!==i.indexOf(t)||(n[i]=e[i]),n}),{});return Hb(JSON.stringify(r))}function Wb(e,t){function n(e,t){i_(e.opacity)?e.opacity=t:e.opacity*=t}var i;if(Array.isArray(e)){i=[];for(var r=0;r<e.length;r++){var a=n_({},e[r]);n(a,t),i.push(a)}}else n(i=n_({},e),t);return i}function Xb(e){var t=Array.prototype.slice.call(arguments,1);if(t&&t.length||(t=[{}]),Array.isArray(e)){for(var n,i,r=[],a=0,o=e.length;a<o;a++){n=e[a],i={};for(var s=0,l=t.length;s<l;s++)Array.isArray(t[s])?i_(t[s][a])?n_(i,n||{}):n_(i,n,t[s][a]):n_(i,n,t[s]?t[s]:{});r.push(i)}return r}var u=[{},e];return u.push.apply(u,t),n_.apply(this,u)}function Zb(e){if(e.symbol&&(e=[e]),Array.isArray(e))return e;var t=e.$root,n=e.$iconset;if(e=e.style,t||n){t&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1));qb(e,(function(e){return"{$root}"===e?t:"{$iconset}"===e?n:null}))}return e}function qb(e,t){for(var n=0;n<e.length;n++){var i=e[n].symbol;i&&Jb(i,t)}}var Yb=/(\{\$root\}|\{\$iconset\})/g;function Jb(e,t){for(var n in e)e.hasOwnProperty(n)&&"textName"!==n&&(s_(e[n])&&e[n].length>2?e[n]=e[n].replace(Yb,t):Qx(e[n])?e[n]=Qb(e[n],t):o_(e[n])&&Jb(e[n],t))}function Qb(e,t){var n=e.default;s_(n)&&(e.default=n.replace(Yb,t));for(var i=e.stops,r=0;r<i.length;r++)Array.isArray(i[r])&&(s_(i[r][1])?i[r][1]=i[r][1].replace(Yb,t):Qx(i[r][1])&&(i[r][1]=Qb(i[r][1],t)));return e}function Kb(e){void 0===e&&(e=[]),Array.isArray(e)||(e=[e]);for(var t=e.length,n=0;n<t;n++){var i=e[n];if(i.style){var r=i.style,a=r.lineDasharray,o=r.lineWidth;if(o&&r_(o)&&o>0&&a&&Array.isArray(a)&&a.length)return!0}}return!1}var $b=p_?function(e){return e[0]}:function(e){for(var t=document.documentElement&&document.documentElement.style||{},n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1},ew=$b(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),tw=$b(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),nw=$b(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);$b(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function iw(e,t){var n=document.createElement(e);return t&&yw(n,t),n}function rw(e,t,n){var i=iw(e);return t&&mw(i,t),n&&n.appendChild(i),i}function aw(e){if(!e)return this;if(Y_.ielt9||Y_.ie9){var t=iw("div");t.appendChild(e),t.innerHTML="",t=null}else e.parentNode&&e.parentNode.removeChild(e);return this}function ow(e,t,n,i){if(!e||!e.addEventListener||!t||!n)return this;for(var r=function(t){t||(t=window.event),n.call(i||e,t)},a=t.split(" "),o=a.length-1;o>=0;o--){var s=a[o];if(s)e["Z__"+s]||(e["Z__"+s]=[]),lw(e,s,n)>=0&&(console.warn(e,"find '"+s+"' handler:",n," The old listener function will be removed"),sw(e,s,n)),e["Z__"+s].push({callback:r,src:n}),e.addEventListener(s,r,!!Y_.supportsPassive&&{capture:!1,passive:!1})}return this}function sw(e,t,n){function i(t,n){"mousewheel"===t&&Y_.gecko&&(t="DOMMouseScroll"),e.removeEventListener(t,n,!1)}if(!e||!e.removeEventListener||!t)return this;for(var r=t.split(" "),a=r.length-1;a>=0;a--){var o=r[a];if(o){if(!n&&e["Z__"+o]){for(var s=e["Z__"+o],l=0,u=s.length;l<u;l++)i(s[l].callback);return delete e["Z__"+o],this}var c=lw(e,o,n);if(c<0)return this;i(o,e["Z__"+o][c].callback),e["Z__"+o].splice(c,1)}}return this}function lw(e,t,n){if(!e||!e["Z__"+t]||!n)return-1;for(var i=e["Z__"+t],r=0,a=i.length;r<a;r++)if(i[r].src===n)return r;return-1}function uw(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function cw(e){return e._cancelBubble=!0,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this}function hw(e){return e.onselectstart=function(){return!1},e.ondragstart=function(){return!1},e.setAttribute("unselectable","on"),this}function fw(e,t){return e?(Y_.any3d?xw(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px"),t):null}function dw(e){var t=window.getComputedStyle(e),n=[parseInt(t["padding-left"]),parseInt(t["padding-top"])],i=e.getBoundingClientRect(),r=e.offsetWidth,a=e.offsetHeight,o=r?i.width/r:1,s=a?i.height/a:1;return e.__position=[i.left+n[0],i.top+n[1],o,s],e.__position}function pw(e,t){e||(e=window.event);var n=t.__position;return n||(n=dw(t)),new ax((e.clientX-n[0]-t.clientLeft)/n[2],(e.clientY-n[1]-t.clientTop)/n[3])}function mw(e,t){var n=e.style.cssText;return function(e,t){var n=e.length-t.length;return n>=0&&e.indexOf(t,n)===n}(n,";")||(n+=";"),e.style.cssText=n+t,this}function vw(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=_w(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function gw(e,t){if(void 0===e.classList||vw(e,t)){var n=_w(e);yw(e,(n?n+" ":"")+t)}else for(var i=Pb(t),r=0,a=i.length;r<a;r++)e.classList.add(i[r]);return this}function yw(e,t){return i_(e.className.baseVal)?e.className=t:e.className.baseVal=t,this}function _w(e){return i_(e.className.baseVal)?e.className:e.className.baseVal}function xw(e,t){var n=t||new ax(0,0);return e.style[ew]=Y_.any3d?"translate3d("+n.x+"px,"+n.y+"px,0px)":"translate("+n.x+"px,"+n.y+"px)",this}function bw(e){return/<[a-z\][\s\S]*>/i.test(e)}function ww(e,t){var n=Sw(e);s_(t)?n.innerHTML=t:n.appendChild(t);var i=new Tb(n.clientWidth,n.clientHeight);return aw(n),i}function Sw(e){var t=document.createElement(e);return t.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(t),t}var Mw=ow,Tw=sw;function Ew(e){return e&&("mousemove"===e||"touchmove"===e)}var Cw,kw="function"===typeof Map,Pw=function(){},Aw=function(){function e(e,t){this.max=e,this.onRemove=t||Pw,this.reset()}var t=e.prototype;return t.reset=function(){for(var e in this.data)this.onRemove(this.data[e]);return this.data={},this.order=[],this},t.clear=function(){this.reset(),delete this.onRemove},t.add=function(e,t){if(this.has(e))this.order.splice(this.order.indexOf(e),1),this.data[e]=t,this.order.push(e);else if(this.data[e]=t,this.order.push(e),this.order.length>this.max){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},t.has=function(e){return e in this.data},t.keys=function(){return this.order},t.getAndRemove=function(e){if(!this.has(e))return null;var t=this.data[e];return delete this.data[e],this.order.splice(this.order.indexOf(e),1),t},t.get=function(e){return this.has(e)?this.data[e]:null},t.remove=function(e){if(!this.has(e))return this;var t=this.data[e];return delete this.data[e],this.onRemove(t),this.order.splice(this.order.indexOf(e),1),this},t.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var t=this.getAndRemove(this.order[0]);t&&this.onRemove(t)}return this},e}();kw&&(Cw=function(){function e(e,t){this.max=e,this.onRemove=t||Pw,this.reset()}var t=e.prototype;return t.reset=function(){if(this.data){var e=this.data.values(),t=Array.isArray(e),n=0;for(e=t?e:e[Symbol.iterator]();;){var i;if(t){if(n>=e.length)break;i=e[n++]}else{if((n=e.next()).done)break;i=n.value}var r=i;this.onRemove(r)}}return this.data=new Map,this},t.clear=function(){this.reset(),delete this.onRemove},t.add=function(e,t){return t?(this.has(e)?(this.data.delete(e),this.data.set(e,t)):this.data.set(e,t),this):this},t.keys=function(){var e=new Array(this.data.size),t=0,n=this.data.keys(),i=Array.isArray(n),r=0;for(n=i?n:n[Symbol.iterator]();;){var a;if(i){if(r>=n.length)break;a=n[r++]}else{if((r=n.next()).done)break;a=r.value}var o=a;e[t++]=o}return e},t.shrink=function(){for(var e=this.data.keys(),t=e.next();this.data.size>this.max;){var n=this.getAndRemove(t.value);n&&this.onRemove(n),t=e.next()}},t.has=function(e){return this.data.has(e)},t.getAndRemove=function(e){if(!this.has(e))return null;var t=this.data.get(e);return this.data.delete(e),t},t.get=function(e){return this.has(e)?this.data.get(e):null},t.remove=function(e){if(!this.has(e))return this;var t=this.data.get(e);return this.data.delete(e),this.onRemove(t),this},t.setMaxSize=function(e){return this.max=e,this.data.size>this.max&&this.shrink(),this},e}());var Rw=kw?Cw:Aw,Lw={jsonp:function(e,t){var n="_maptalks_jsonp_"+ux();e.match(/\?/)?e+="&callback="+n:e+="?callback="+n;var i=document.createElement("script");return i.type="text/javascript",i.src=e,window[n]=function(e){t(null,e),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(e,t,n){if(l_(t)){var i=n;n=t,t=i}if(p_&&Lw.get.node)return Lw.get.node(e,n,t);var r=Lw._getClient(n);if(r.open("GET",e,!0),t){for(var a in t.headers)r.setRequestHeader(a,t.headers[a]);r.withCredentials="include"===t.credentials,t.responseType&&(r.responseType=t.responseType)}return r.send(null),r},post:function(e,t,n){var i;if(s_(e)){if(l_(t)){var r=n;n=t,t=r}i=(t=t||{}).postData}else{var a=n;i=t,e=(t=e).url,n=a}if(p_&&Lw.post.node)return t.url=e,Lw.post.node(t,i,n);var o=Lw._getClient(n);if(o.open("POST",t.url,!0),t.headers||(t.headers={}),t.headers["Content-Type"]||(t.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in o)for(var s in t.headers)t.headers.hasOwnProperty(s)&&o.setRequestHeader(s,t.headers[s]);return s_(i)||(i=JSON.stringify(i)),o.send(i),o},_wrapCallback:function(e,t){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?t(new Error("http status 200 returned without content.")):t(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):t(null,e.responseText):t(new Error(e.statusText+","+e.status)))}},_getClient:function(e){var t;try{t=new XMLHttpRequest}catch(uA){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(uA){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(uA){}}}return t.onreadystatechange=Lw._wrapCallback(t,e),t},getArrayBuffer:function(e,t,n){if(l_(t)){var i=n;n=t,t=i}return t||(t={}),t.responseType="arraybuffer",Lw.get(e,t,n)},getImage:function(e,t,n){return Lw.getArrayBuffer(t,n,(function(t,n){if(t)e.onerror&&e.onerror(t);else if(n){var i=window.URL||window.webkitURL,r=e.onload;e.onload=function(){r&&r(),i.revokeObjectURL(e.src)};var a=new Blob([new Uint8Array(n.data)],{type:n.contentType});e.cacheControl=n.cacheControl,e.expires=n.expires,e.src=n.data.byteLength?i.createObjectURL(a):kx}}))},getJSON:function(e,t,n){if(l_(t)){var i=n;n=t,t=i}var r=function(e,t){var i=t?cx(t):null;n(e,i)};return t&&t.jsonp?Lw.jsonp(e,r):Lw.get(e,t,r)}},Iw=1/0,Ow=1/0,Dw=-1/0,Nw=-1/0;function zw(){return[Iw,Ow,Dw,Nw]}var Uw=zw();function Fw(e){e[0]=Iw,e[1]=Ow,e[2]=Dw,e[3]=Nw}function Bw(e,t){if(e)if(Array.isArray(e[0]))for(var n=0,i=e.length;n<i;n++)Bw(e[n],t);else if(Array.isArray(e))for(var r=0,a=e.length;r<a;r++){var o=e[r],s=o.x,l=o.y;t[0]=Math.min(s,t[0]),t[1]=Math.min(l,t[1]),t[2]=Math.max(s,t[2]),t[3]=Math.max(l,t[3])}else{s=e.x,l=e.y;t[0]=Math.min(s,t[0]),t[1]=Math.min(l,t[1]),t[2]=Math.max(s,t[2]),t[3]=Math.max(l,t[3])}}function Hw(e,t,n,i,r){(0===t||t)&&(Array.isArray(t)&&(n=t[1],i=t[2],r=t[3],t=t[0]),e[0]=Math.min(t,e[0]),e[1]=Math.min(n,e[1]),e[2]=Math.max(i,e[2]),e[3]=Math.max(r,e[3]))}function jw(e){return e&&e[0]!==1/0&&void 0!==e[0]}var Gw="#000",Vw=!1,Ww=null,Xw=Math.PI/180,Zw={getCanvas2DContext:function(e){return e.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(e){Vw=e},createCanvas:function(e,t,n){var i;return p_?i=new n(e,t):((i=iw("canvas")).width=e,i.height=t),i},prepareCanvasFont:function(e,t){e.textBaseline="top",e.font=Fb(t);var n=t.textFill;n||(n="#000"),e.fillStyle=Zw.getRgba(n,t.textOpacity)},prepareCanvas:function(e,t,n,i){if(t){var r=t.lineWidth;i_(r)||e.lineWidth===r||(e.lineWidth=r);var a=t.linePatternFile,o=t.lineColor||Gw;if(i)e.strokeStyle="#000";else if(a&&n){var s;(t.linePatternDx||t.linePatternDy)&&(s=[t.linePatternDx,t.linePatternDy]),Zw._setStrokePattern(e,a,r,s,n),t.lineDasharray=[]}else jb(o)?t.lineGradientExtent?e.strokeStyle=Zw._createGradient(e,o,t.lineGradientExtent):e.strokeStyle=Gw:(Array.isArray(o)&&(o=Zw.normalizeColorToRGBA(o)),e.strokeStyle=o);t.lineJoin&&(e.lineJoin=t.lineJoin),t.lineCap&&(e.lineCap=t.lineCap),e.setLineDash&&_x(t.lineDasharray)&&e.setLineDash(t.lineDasharray);var l=t.polygonPatternFile,u=t.polygonFill||"rgba(255,255,255,0)";if(i)e.fillStyle="#000";else if(l&&n){var c=Jw(l),h=n.getImage([c,null,null]);if(h||(h=n.getImage([c+"-texture",null,r])),ox(c)&&h instanceof Image&&(Y_.edge||Y_.ie)){var f=h.width||20,d=h.height||20,p=Zw.createCanvas(f,d);Zw.image(p.getContext("2d"),h,0,0,f,d),h=p}h?(e.fillStyle=e.createPattern(h,"repeat"),(t.polygonPatternDx||t.polygonPatternDy)&&(e.fillStyle.polygonPatternOffset=[t.polygonPatternDx,t.polygonPatternDy])):"undefined"!==typeof console&&console.warn("img not found for",c)}else jb(u)?t.polygonGradientExtent?e.fillStyle=Zw._createGradient(e,u,t.polygonGradientExtent):e.fillStyle="rgba(255,255,255,0)":(Array.isArray(u)&&(u=Zw.normalizeColorToRGBA(u)),e.fillStyle=u)}},_createGradient:function(e,t,n){var i=null,r=t.places,a=n.getMin(),o=n.getMax(),s=n.getWidth(),l=n.getHeight();if(t.type&&"linear"!==t.type){if("radial"===t.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[a.x+r[0]*s,a.y+r[1]*l,s*r[2],a.x+r[3]*s,a.y+r[4]*l,s*r[5]]}else{var u=n.getCenter()._round();r=[u.x,u.y,Math.abs(u.x-a.x),u.x,u.y,0]}i=e.createRadialGradient.apply(e,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[a.x+r[0]*s,a.y+r[1]*l,a.x+r[2]*s,a.y+r[3]*l]}else r=[a.x,a.y,o.x,a.y];i=e.createLinearGradient.apply(e,r)}return t.colorStops.forEach((function(e){i.addColorStop.apply(i,e)})),i},_setStrokePattern:function(e,t,n,i,r){var a,o=Jw(t);if(p_)a=r.getImage([o,null,n]);else{var s=o+"-texture-"+n;if(!(a=r.getImage(s))){var l=r.getImage([o,null,null]);if(l){var u;u=l.width&&l.height?Math.round(l.width*n/l.height):n;var c=Zw.createCanvas(u,n,e.canvas.constructor);Zw.image(c.getContext("2d"),l,0,0,u,n),r.addResource([s,null,n],c),a=c}}}a?(e.strokeStyle=e.createPattern(a,"repeat"),e.strokeStyle.linePatternOffset=i):"undefined"!==typeof console&&console.warn("img not found for",o)},clearRect:function(e,t,n,i,r){e.canvas._drawn=!1,e.clearRect(t,n,i,r)},fillCanvas:function(e,t,n,i){if(Vw&&(t=1),e.canvas._drawn=!0,0!==t){var r,a=Zw._isPattern(e.fillStyle),o=e.fillStyle&&e.fillStyle.polygonPatternOffset,s=o?o[0]:0,l=o?o[1]:0;i_(t)&&(t=1),t<1&&(r=e.globalAlpha,e.globalAlpha*=t),a&&(n=n||0,i=i||0,e.translate(n+s,i+l)),e.fill(),a&&e.translate(-n-s,-i-l),t<1&&(e.globalAlpha=r)}},getRgba:function(e,t){return i_(t)&&(t=1),"#"!==e[0]?(Array.isArray(e)&&(e=Zw.normalizeColorToRGBA(e,t)),e):(7===e.length?(n=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16)):(n=17*parseInt(e.substring(1,2),16),i=17*parseInt(e.substring(2,3),16),r=17*parseInt(e.substring(3,4),16)),"rgba("+n+","+i+","+r+","+t+")");var n,i,r},normalizeColorToRGBA:function(e,t){return void 0===t&&(t=1),"rgba("+255*e[0]+","+255*e[1]+","+255*e[2]+","+(4===e.length?e[3]:1)*t+")"},image:function(e,t,n,i,r,a){e.canvas._drawn=!0;try{r_(r)&&r_(a)?e.drawImage(t,n,i,r,a):e.drawImage(t,n,i)}catch(o){console&&(console.warn("error when drawing image on canvas:",o),console.warn(t))}},text:function(e,t,n,i,r){return Zw._textOnMultiRow(e,r.rows,i,n,r.size,r.rawSize)},_textOnMultiRow:function(e,t,n,i,r,a){var o,s,l=zb(r,n.textHorizontalAlignment,n.textVerticalAlignment),u=a.height+n.textLineSpacing,c=i.add(0,l.y),h=n.textMaxHeight,f=0;Fw(Uw);for(var d=0,p=t.length;d<p;d++){o=t[d].text,s=zb(t[d].size,n.textHorizontalAlignment,n.textVerticalAlignment);var m=c.add(s.x,d*u);Zw._textOnLine(e,o,m,n.textHaloRadius,n.textHaloFill,n.textHaloOpacity);var v=t[d].size,g=m.x,y=m.y,_=g+v.width,x=y+v.height;if(Hw(Uw,g,y,_,x),h>0&&(f+=u)+v.height>=h)break}return Uw},_textOnLine:function(e,t,n,i,r,a){Vw&&(a=1);var o,s,l=0!==a&&0!==i;e.textBaseline="top";var u=e.shadowBlur,c=e.shadowOffsetX,h=e.shadowOffsetY;if(l){var f=e.globalAlpha;e.globalAlpha*=a,e.miterLimit=2,e.lineJoin="round",e.lineCap="round",e.lineWidth=2*i,Array.isArray(r)&&(r=Zw.normalizeColorToRGBA(r)),e.strokeStyle=r,e.strokeText(t,n.x,n.y+1),e.miterLimit=10,e.globalAlpha=f,o=e.globalCompositeOperation,e.globalCompositeOperation="destination-out",s=e.fillStyle,e.fillStyle="#000"}u&&l&&(e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0),Zw.fillText(e,t,n),o&&(e.globalCompositeOperation=o,Zw.fillText(e,t,n,s),u&&(e.shadowBlur=u,e.shadowOffsetX=c,e.shadowOffsetY=h))},fillText:function(e,t,n,i){e.canvas._drawn=!0,i&&(e.fillStyle=i),e.fillText(t,n.x,n.y+1)},_stroke:function(e,t,n,i){if(Vw&&(t=1),e.canvas._drawn=!0,0!==t){var r,a=e.strokeStyle&&e.strokeStyle.linePatternOffset,o=a?a[0]:0,s=a?a[1]:0,l=Zw._isPattern(e.strokeStyle)&&(!i_(n)&&!i_(i)||!i_(o)&&!i_(s));i_(t)&&(t=1),t<1&&(r=e.globalAlpha,e.globalAlpha*=t),l&&(n=n||0,i=i||0,e.translate(n+o,i+s)),e.stroke(),l&&e.translate(-n-o,-i-s),t<1&&(e.globalAlpha=r)}},_path:function(e,t,n,i,r){if(_x(t))for(var a,o,s=_x(n),l=!0!==r&&Zw._isPattern(e.strokeStyle),u=0,c=t.length;u<c;u++)if(a=t[u],!s||e.setLineDash)e.lineTo(a.x,a.y),l&&u>0&&(h(t[u-1],a),e.beginPath(),e.moveTo(a.x,a.y));else if(s){if(u===c-1)break;o=t[u+1],qw(e,a,o,n)}function h(t,n){var r=Cx(t.x,t.y,n.x,n.y);e.save();var a=Math.cos(r);Math.abs(a)<1e-7?e.translate(t.x-e.lineWidth/2,t.y):e.translate(t.x,t.y-e.lineWidth/2/a),e.rotate(r),Zw._stroke(e,i),e.restore()}},path:function(e,t,n,i,r){_x(t)&&(e.beginPath(),e.moveTo(t[0].x,t[0].y),Zw._path(e,t,r,n),Zw._stroke(e,n))},_multiClip:function(e,t){if(t&&0!==t.length)for(var n=0,i=(t=t[0]).length;n<i;n++){var r=t[n],a=r.x,o=r.y;0===n?e.moveTo(a,o):e.lineTo(a,o),n===i-1&&(a=t[0].x,o=t[0].y,e.lineTo(a,o))}},polygon:function(e,t,n,i,r,a){if(e.isMultiClip)Zw._multiClip(e,t);else if(e.isClip)Zw._multiClip(e,Array.isArray(t[0])?t:[t]);else if(_x(t)){var o=Zw._isPattern(e.strokeStyle),s=_x(r)&&!e.setLineDash||o&&!a;_x(t[0])||(t=[t]);var l,u,c,h=e;if(t.length>1&&!p_&&(Ww||(Ww=Zw.createCanvas(1,1)),e.canvas._drawn=!1,Ww.width=e.canvas.width,Ww.height=e.canvas.height,Qw(e=Ww.getContext("2d"),h)),s){for(e.save(),u=0,c=t.length;u<c;u++)_x(t[u])&&(Zw._ring(e,t[u],null,0,!0),l=i,u>0&&(e.globalCompositeOperation="destination-out",l=1),Zw.fillCanvas(e,l,t[u][0].x,t[u][0].y),u>0?e.globalCompositeOperation="source-over":c>1&&(e.fillStyle="#fff"),Zw._stroke(e,0));e.restore()}var f=e.fillStyle;for(u=0,c=t.length;u<c;u++)_x(t[u])&&(a?(Zw.paintSmoothLine(e,t[u],n,a,!0),e.closePath()):Zw._ring(e,t[u],r,n),s||(l=i,u>0&&(e.globalCompositeOperation="destination-out",l=1),Zw.fillCanvas(e,l,t[u][0].x,t[u][0].y),u>0?e.globalCompositeOperation="source-over":c>1&&(e.fillStyle="#fff")),Zw._stroke(e,n));e.fillStyle!==f&&(e.fillStyle=f),t.length>1&&!p_&&(h.drawImage(Ww,0,0),h.canvas._drawn=e.canvas._drawn,Qw(h,e))}},_ring:function(e,t,n,i,r){var a=Zw._isPattern(e.strokeStyle);r||!a||t[0].equals(t[t.length-1])||(t=t.concat([t[0]])),e.beginPath(),e.moveTo(t[0].x,t[0].y),Zw._path(e,t,n,i,r),a||e.closePath()},paintSmoothLine:function(e,t,n,i,r,a,o){if(t)if(t.length<=2||!i)Zw.path(e,t,n);else{var s,l=t.length,u=r?l:l-1;e.beginPath(),e.moveTo(t[0].x,t[0].y),void 0!==o&&(u-=Math.max(u-a-1,0));for(var c=0;c<u;c++){var h=t[c].x,f=t[c].y,d=void 0,p=void 0,m=void 0,v=void 0,g=void 0,y=void 0;c-1<0?r?(d=t[u-1].x,p=t[u-1].y):(d=t[c+1].x,p=t[c+1].y):(d=t[c-1].x,p=t[c-1].y),c+1<l?(m=t[c+1].x,v=t[c+1].y):(m=t[c+1-l].x,v=t[c+1-l].y),c+2<l?(g=t[c+2].x,y=t[c+2].y):r?(g=t[c+2-l].x,y=t[c+2-l].y):(g=t[c].x,y=t[c].y);var _=b(d,p,h,f,m,v,g,y,i,c===u-1?o:1);if(c===u-1&&o>=0&&o<1){e.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5]),t.splice(u-1,l-(u-1)-1);var x=new ax(_[4],_[5]);x.prevCtrlPoint=new ax(_[2],_[3]),t.push(x),l=t.length}else e.bezierCurveTo(_[0],_[1],_[2],_[3],m,v);t[c].nextCtrlPoint=_.slice(0,2),t[c].prevCtrlPoint=s?s.slice(2):null,s=_}!r&&t[1].prevCtrlPoint&&(t[0].nextCtrlPoint=t[1].prevCtrlPoint,delete t[0].prevCtrlPoint),t[l-1].prevCtrlPoint||(t[l-1].prevCtrlPoint=t[l-2].nextCtrlPoint),Zw._stroke(e,n)}function b(e,t,n,i,r,a,o,s,l,u){var c=(e+n)/2,h=(t+i)/2,f=(n+r)/2,d=(i+a)/2,p=(r+o)/2,m=(a+s)/2,v=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),g=Math.sqrt((r-n)*(r-n)+(a-i)*(a-i)),y=v/(v+g),_=g/(g+Math.sqrt((o-r)*(o-r)+(s-a)*(s-a))),x=c+(f-c)*y,b=h+(d-h)*y,w=f+(p-f)*_,S=d+(m-d)*_,M=x+(f-x)*l+n-x,T=b+(d-b)*l+i-b,E=w+(f-w)*l+r-w,C=S+(d-S)*l+a-S,k=[M,T,E,C];return u<1?function(e,t,n,i,r,a,o,s,l,u){var c=1-e,h=1-t,f=n*h*h+2*r*t*h+o*t*t,d=r*h*h+2*o*t*h+l*t*t,p=i*h*h+2*a*t*h+s*t*t,m=a*h*h+2*s*t*h+u*t*t;return[(n*c*c+2*r*e*c+o*e*e)*h+(r*c*c+2*o*e*c+l*e*e)*t,(i*c*c+2*a*e*c+s*e*e)*h+(a*c*c+2*s*e*c+u*e*e)*t,f*c+d*e,p*c+m*e,f*h+d*t,p*h+m*t]}(0,u,n,i,M,T,E,C,r,a):k}},_arcBetween:function(e,t,n,i){var r=i,a=t.distanceTo(n),o=a/2/Math.sin(r/2),s=Math.asin((n.y-t.y)/a);t.x>n.x&&(s=Math.PI-s);var l=s-(90*Xw-r/2),u=Math.cos(l)*o,c=Math.sin(l)*o,h=t.x+u,f=t.y+c,d=Math.asin((n.y-f)/o);h>n.x&&(d=Math.PI-d);var p=d+r;return e.beginPath(),e.arc(h,f,o,d,p),[h,f]},_lineTo:function(e,t){e.lineTo(t.x,t.y)},bezierCurveAndFill:function(e,t,n,i){e.beginPath();var r=t[0];e.moveTo(r.x,r.y);var a=[e];a.push.apply(a,t.splice(1)),Zw._bezierCurveTo.apply(Zw,a),Zw.fillCanvas(e,i),Zw._stroke(e,n)},_bezierCurveTo:function(e,t,n,i){e.bezierCurveTo(t.x,t.y,n.x,n.y,i.x,i.y)},ellipse:function(e,t,n,i,r,a,o){e.beginPath(),n===i&&n===r?e.arc(t.x,t.y,n,0,2*Math.PI):e.ellipse?i!==r?(e.ellipse(t.x,t.y,n,i,0,180*Xw,360*Xw,!1),e.ellipse(t.x,t.y,n,r,0,0,180*Xw,!1)):e.ellipse(t.x,t.y,n,i,0,0,360*Xw,!1):function(t,n,i,r,a){var o=.5522848,s=i*o,l=r*o,u=a*o;e.moveTo(t-i,n),e.bezierCurveTo(t-i,n-l,t-s,n-r,t,n-r),e.bezierCurveTo(t+s,n-r,t+i,n-l,t+i,n),e.bezierCurveTo(t+i,n+u,t+s,n+a,t,n+a),e.bezierCurveTo(t-s,n+a,t-i,n+u,t-i,n),e.closePath()}(t.x,t.y,n,i,r),Zw.fillCanvas(e,o,t.x-n,t.y-i),Zw._stroke(e,a,t.x-n,t.y-i)},rectangle:function(e,t,n,i,r){var a=t.x,o=t.y;e.beginPath(),e.rect(a,o,n.width,n.height),Zw.fillCanvas(e,r,a,o),Zw._stroke(e,i,a,o)},sector:function(e,t,n,i,r,a){var o=Xw,s=i[0],l=i[1];function u(e,t,n,i,s,l){var u=o*-l,c=o*-s;e.beginPath(),e.moveTo(t,n),e.arc(t,n,i,u,c),e.lineTo(t,n),Zw.fillCanvas(e,a,t-i,n-i),Zw._stroke(e,r,t-i,n-i)}u(e,t.x,t.y,n,s,l)},_isPattern:function(e){return!s_(e)&&!("addColorStop"in e)},drawCross:function(e,t,n,i,r){e.canvas._drawn=!0,e.strokeStyle=r,e.lineWidth=i,e.beginPath(),e.moveTo(t-5,n),e.lineTo(t+5,n),e.moveTo(t,n-5),e.lineTo(t,n+5),e.stroke()},copy:function(e,t){var n=t||iw("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),n},pixelRect:function(e,t,n,i){var r=e.lineWidth,a=e.globalAlpha,o=!1;if(r>0&&n>0)o=!0,n<1&&(e.globalAlpha*=n);else{if(!(i>0))return;i<1&&(e.globalAlpha*=i)}e.canvas._drawn=!0,o?e.strokeRect(t[0],t[1],1,1):e.fillRect(t[0],t[1],1,1),e.globalAlpha!==a&&(e.globalAlpha=a)}};function qw(e,t,n,i){var r=t.x,a=t.y,o=n.x,s=n.y,l=i,u=function(e,t){return e<=t},c=function(e,t){return e>=t},h=function(e,t){return Math.min(e,t)},f=function(e,t){return Math.max(e,t)},d={thereYet:c,cap:h},p={thereYet:c,cap:h};a-s>0&&(p.thereYet=u,p.cap=f),r-o>0&&(d.thereYet=u,d.cap=f),e.moveTo(r,a);for(var m,v,g=r,y=a,_=0,x=!0;!d.thereYet(g,o)||!p.thereYet(y,s);)m=Math.atan2(s-a,o-r),v=l[_],g=d.cap(o,g+Math.cos(m)*v),y=p.cap(s,y+Math.sin(m)*v),x?e.lineTo(g,y):e.moveTo(g,y),_=(_+1)%l.length,x=!x}var Yw="data:image/";function Jw(e){return e.substring(0,Yw.length)===Yw?e:Sx(e)}function Qw(e,t){e.filter=t.filter,e.fillStyle=t.fillStyle,e.globalAlpha=t.globalAlpha,e.lineCap=t.lineCap,e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.strokeStyle=t.strokeStyle}var Kw="undefined"!==typeof Promise?Promise:Oy(),$w=function(e){return function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.on=function(e,t,n){if(!e)return this;if(!s_(e))return this._switch("on",e,t);if(!t)return this;this._eventMap||(this._eventMap={});var i,r,a=e.toLowerCase().split(" ");n||(n=this);for(var o=0,s=a.length;o<s;o++){i=a[o],(r=this._eventMap[i])||(r=[],this._eventMap[i]=r);var l=r.length;if(l>0)for(var u=0;u<l;u++)if(t===r[u].handler&&r[u].context===n)return Y_.isTest||console.warn(this,"find '"+e+"' handler:",t," The old listener function will be removed"),this;r.push({handler:t,context:n})}return this},n.addEventListener=function(){return this.on.apply(this,arguments)},n.once=function(e,t,n){if(!s_(e)){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=this._wrapOnceHandler(r,e[r],n));return this._switch("on",i)}for(var a=e.split(" "),o=0,s=a.length;o<s;o++)this.on(a[o],this._wrapOnceHandler(a[o],t,n));return this},n.off=function(e,t,n){if(!this._eventMap||!e)return this;if(!s_(e))return this._switch("off",e,t);if(!t)return this;var i,r,a,o=e.split(" ");n||(n=this);for(var s=0,l=o.length;s<l;s++){if(a="Z__"+(i=o[s].toLowerCase()),!(r=this._eventMap[i]))return this;for(var u=r.length-1;u>=0;u--){var c=r[u];t!==c.handler&&t!==c.handler[a]||c.context!==n||(delete c.handler[a],r.splice(u,1))}r.length||delete this._eventMap[i]}return this},n.removeEventListener=function(){return this.off.apply(this,arguments)},n.listens=function(e,t,n){if(!this._eventMap||!s_(e))return 0;var i=this._eventMap[e.toLowerCase()];if(!i||!i.length)return 0;if(!t)return i.length;for(var r=0,a=i.length;r<a;r++)if(t===i[r].handler&&(i_(n)||i[r].context===n))return 1;return 0},n.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},n.copyEventListeners=function(e){var t,n=e._eventMap;if(!n)return this;for(var i in n)for(var r=0,a=(t=n[i]).length;r<a;r++)this.on(i,t[r].handler,t[r].context);return this},n.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},n._wrapOnceHandler=function(e,t,n){var i=this,r="Z__"+e,a=!1,o=function s(){a||(delete o[r],a=!0,n?t.apply(n,arguments):t.apply(this,arguments),i.off(e,s,this))};return o[r]=t,o},n._switch=function(e,t,n){for(var i in t)t.hasOwnProperty(i)&&this[e](i,t[i],n);return this},n._clearListeners=function(e){this._eventMap&&s_(e)&&(this._eventMap[e.toLowerCase()]&&(this._eventMap[e]=null))},n._clearAllListeners=function(){this._eventMap=null},n._setEventParent=function(e){return this._eventParent=e,this},n._setEventTarget=function(e){return this._eventTarget=e,this},n._fire=function(e,t){if(!this._eventMap)return this;var n=this._eventMap[e.toLowerCase()];if(!n)return this;t||(t={}),t.type=e,t.target=this._eventTarget||this;for(var i,r,a=n.slice(0),o=0,s=a.length;o<s;o++)a[o]&&(i=a[o].context,!0,r=n_({},t),!1===(i?a[o].handler.call(i,r):a[o].handler(r))&&t.domEvent&&cw(t.domEvent));return this},t}(e)},eS=$w(function(){function e(e){this.target=e}var t=e.prototype;return t.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},t.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},t.enabled=function(){return!!this._enabled},t.remove=function(){this.disable(),delete this.target,delete this.dom},e}()),tS=function(){function e(e){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(e),this.callInitHooks(),this._isUpdatingOptions=!1}var t=e.prototype;return t.proxyOptions=function(){var e=this;return Y_.proxy?(this.options.isExtensible||(this.options=new Proxy(this.options,{set:function(t,n,i){if(t[n]===i)return!0;if(t[n]=i,e._isUpdatingOptions)return!0;var r={};return r[n]=i,e.config(r),!0}})),this):this},t.callInitHooks=function(){var e=Object.getPrototypeOf(this);return this._visitInitHooks(e),this},t.setOptions=function(e){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!e)return this;for(var t in e)this.options[t]=e[t];return this},t.config=function(e){if(this._isUpdatingOptions=!0,!e){var t={};for(var n in this.options)this.options.hasOwnProperty(n)&&(t[n]=this.options[n]);return this._isUpdatingOptions=!1,t}if(2===arguments.length){var i={};i[e]=arguments[1],e=i}for(var r in e)this.options[r]=e[r],this[r]&&this[r]instanceof eS&&(e[r]?this[r].enable():this[r].disable());return this.onConfig(e),this._isUpdatingOptions=!1,this},t.onConfig=function(){},t._visitInitHooks=function(e){if(!this._initHooksCalled){var t=Object.getPrototypeOf(e);t._visitInitHooks&&t._visitInitHooks.call(this,t),this._initHooksCalled=!0;var n=e._initHooks;if(n&&n!==t._initHooks)for(var i=0;i<n.length;i++)n[i].call(this)}},e.addInitHook=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r="function"===typeof e?e:function(){this[e].apply(this,n)},a=this.prototype,o=Object.getPrototypeOf(a);return a._initHooks&&a._initHooks!==o._initHooks||(a._initHooks=[]),a._initHooks.push(r),this},e.include=function(){for(var e=0;e<arguments.length;e++)n_(this.prototype,e<0||arguments.length<=e?void 0:arguments[e]);return this},e.mergeOptions=function(e){var t=this.prototype,n=Object.getPrototypeOf(t);return t.options&&t.options!==n.options||(t.options=t.options?Object.create(t.options):{}),n_(t.options,e),this},e}(),nS={},iS=function(e){return function(e){function t(){return e.apply(this,arguments)||this}return K_(t,e),t.registerJSONType=function(e){return e?nS[e]?(console.error(e+" has register. please use Different name for:",this),this):(nS[e]=this,this):this},t.getJSONClass=function(e){return e?nS[e]:null},t.prototype.getJSONType=function(){if(void 0===this._jsonType){var e=Object.getPrototypeOf(this).constructor;for(var t in nS)if(nS[t]===e){this._jsonType=t;break}}if(!this._jsonType)throw new Error("Found an unregistered Layer/Geometry class!");return this._jsonType},t}(e)},rS={},aS=function(){function e(){this._tree=Ny()(9,["[0]","[1]","[2]","[3]"])}var t=e.prototype;return t.collides=function(e){return rS.minX=e[0],rS.minY=e[1],rS.maxX=e[2],rS.maxY=e[3],this._tree.collides(rS)},t.insertBox=function(e){return this._tree.insert(e),this},t.bulkInsertBox=function(e){return this._tree.load(e),this},t.clear=function(){return this._tree.clear(),this},e}();function oS(e){return function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addHandler=function(e,t){if(!t)return this;if(this._handlers||(this._handlers=[]),this[e])return this[e].enable(),this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},n.removeHandler=function(e){if(!e)return this;var t=this[e];if(t){var n=this._handlers.indexOf(t);n>=0&&this._handlers.splice(n,1),this[e].remove(),delete this[e]}return this},n._clearHandlers=function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].remove();this._handlers=[]},t}(e)}var sS="touchstart mousedown",lS={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},uS={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},cS=function(e){function t(t,n){var i;return void 0===n&&(n={}),(i=e.call(this,null)||this).dom=t,i.options=n,i}K_(t,e);var n=t.prototype;return n.enable=function(){return this.dom?(this._onMouseDown=function(e){return this.onMouseDown(e)},Mw(this.dom,sS,this._onMouseDown,this),this):this},n.disable=function(){return this.dom?(this._offEvents(),Tw(this.dom,sS,this._onMouseDown),delete this._onMouseDown,this):this},n.onMouseDown=function(e){if((this.options.rightclick||2!==e.button)&&!(e.touches&&e.touches.length>1)&&(!this.options.cancelOn||!0!==this.options.cancelOn(e))){var t=this.dom;t.setCapture?t.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),t.ondragstart=function(){return!1},delete this.moved;var n=e.touches?e.touches[0]:e;this.startPos=new ax(n.clientX,n.clientY),Tw(document,lS[e.type],this.onMouseMove,this),Tw(document,uS[e.type],this.onMouseUp,this),Mw(document,lS[e.type],this.onMouseMove,this),Mw(document,uS[e.type],this.onMouseUp,this),this.options.ignoreMouseleave||(Tw(this.dom,"mouseleave",this.onMouseUp,this),Mw(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:e,mousePos:new ax(n.clientX,n.clientY)})}},n.onMouseMove=function(e){if(e.touches&&e.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(e));else{var t=e.touches?e.touches[0]:e,n=new ax(t.clientX,t.clientY).sub(this.startPos);(n.x||n.y)&&(this.moved?this.fire("dragging",{domEvent:e,mousePos:new ax(t.clientX,t.clientY)}):(this.fire("dragstart",{domEvent:e,mousePos:this.startPos.copy()}),this.moved=!0))}},n.onMouseUp=function(e){var t=e.changedTouches?e.changedTouches[0]:e;this._offEvents();var n={domEvent:e};r_(t.clientX)&&(n.mousePos=new ax(parseInt(t.clientX,0),parseInt(t.clientY,0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},n._offEvents=function(){var e=this.dom;if(Tw(e,"mouseleave",this.onMouseUp,this),"undefined"!==typeof document&&"undefined"!==typeof window){for(var t in lS)Tw(document,lS[t],this.onMouseMove,this),Tw(document,uS[t],this.onMouseUp,this);e.releaseCapture?e.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},t}(eS),hS=function(e){function t(){return e.apply(this,arguments)||this}return K_(t,e),t.toNumberArrays=function(e){return Array.isArray(e)?dx(e,(function(e){return[e.x,e.y]})):[e.x,e.y]},t.toCoordinates=function(e){if(r_(e[0])&&r_(e[1]))return new t(e);if(e instanceof t)return e;for(var n=[],i=0,r=e.length;i<r;i++){var a=e[i];Array.isArray(a)?r_(a[0])?n.push(new t(a)):n.push(t.toCoordinates(a)):a instanceof t?n.push(a):n.push(new t(a))}return n},t}(rx),fS=function(){function e(e,t){this.type=e,this.properties=t}return e.createProj4=function(t){return new e("proj4",{proj:t})},e.fromProjectionCode=function(t){return t&&e[t=t.toUpperCase().replace(":","")]||null},e}();fS.WGS84=fS.createProj4("+proj=longlat +datum=WGS84 +no_defs"),fS.EPSG4326=fS.WGS84,fS.EPSG3857=fS.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),fS.IDENTITY=fS.createProj4("+proj=identity +no_defs"),fS.CGCS2000=fS.createProj4("+proj=longlat +datum=CGCS2000"),fS.EPSG4490=fS.CGCS2000,fS.BD09LL=fS.createProj4("+proj=longlat +datum=BD09"),fS.GCJ02=fS.createProj4("+proj=longlat +datum=GCJ02");var dS,pS=new ax(0,0),mS=new hS(0,0),vS=new hS(0,0),gS=new hS(0,0),yS=new hS(0,0),_S=new hS(0,0),xS=new hS(0,0),bS=new hS(0,0),wS=new hS(0,0),SS=[],MS=[],TS=function(){function e(e,t,n,i){this._clazz=hS;var r=arguments.length,a=r>0?arguments[r-1]:null;a&&a.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(e,t,n,i)}var t=e.prototype;return t._initialize=function(e,t,n,i){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!i_(e)){var r=this.projection;r_(e)&&r_(t)&&r_(n)&&r_(i)?r?this.set(e,t,n,i):this.set(Math.min(e,n),Math.min(t,i),Math.max(e,n),Math.max(t,i)):Array.isArray(e)?r?this.set(e[0],e[1],e[2],e[3]):this.set(Math.min(e[0],e[2]),Math.min(e[1],e[3]),Math.max(e[0],e[2]),Math.max(e[1],e[3])):r_(e.x)&&r_(t.x)&&r_(e.y)&&r_(t.y)?r?this.set(e.x,e.y,t.x,t.y):(e.x>t.x?(this.xmin=t.x,this.xmax=e.x):(this.xmin=e.x,this.xmax=t.x),e.y>t.y?(this.ymin=t.y,this.ymax=e.y):(this.ymin=e.y,this.ymax=t.y)):r_(e.xmin)&&r_(e.xmax)&&r_(e.ymin)&&r_(e.ymax)&&this.set(e.xmin,e.ymin,e.xmax,e.ymax)}},t._add=function(e){return this._dirty=!0,i_(e.x)?i_(e.xmin)?i_(e[0])||(this.xmin+=e[0],this.ymin+=e[1],this.xmax+=e[0],this.ymax+=e[1]):(this.xmin+=e.xmin,this.ymin+=e.ymin,this.xmax+=e.xmax,this.ymax+=e.ymax):(this.xmin+=e.x,this.ymin+=e.y,this.xmax+=e.x,this.ymax+=e.y),this},t.add=function(){var e=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return e._add.apply(e,arguments)},t._scale=function(e){return this._dirty=!0,this.xmin*=e,this.ymin*=e,this.xmax*=e,this.ymax*=e,this},t._sub=function(e){return this._dirty=!0,i_(e.x)?i_(e.xmin)?i_(e[0])||(this.xmin-=e[0],this.ymin-=e[1],this.xmax-=e[0],this.ymax-=e[1]):(this.xmin-=e.xmin,this.ymin-=e.ymin,this.xmax-=e.xmax,this.ymax-=e.ymax):(this.xmin-=e.x,this.ymin-=e.y,this.xmax-=e.x,this.ymax-=e.y),this},t._substract=function(){return this._sub.apply(this,arguments)},t.sub=function(){var e=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return e._sub.apply(e,arguments)},t.substract=function(){return this.sub.apply(this,arguments)},t.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},t._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},t.getMin=function(e){return e?(e.set(this.xmin,this.ymin),e):new this._clazz(this.xmin,this.ymin)},t.getMax=function(e){return e?(e.set(this.xmax,this.ymax),e):new this._clazz(this.xmax,this.ymax)},t.getCenter=function(e){var t=(this.xmin+this.xmax)/2,n=(this.ymin+this.ymax)/2;return e?(e.set(t,n),e):new this._clazz(t,n)},t.isValid=function(){return!i_(this.xmin)&&!i_(this.ymin)&&!i_(this.xmax)&&!i_(this.ymax)},t.equals=function(e){return this.xmin===e.xmin&&this.xmax===e.xmax&&this.ymin===e.ymin&&this.ymax===e.ymax},t.intersects=function(e){this._project(this),this._project(e);var t=Math.max(this.pxmin,e.pxmin),n=Math.max(this.pymin,e.pymin),i=Math.min(this.pxmax,e.pxmax),r=Math.min(this.pymax,e.pymax),a=!(t>i||n>r);return a},t.within=function(e){return this._project(this),this._project(e),this.pxmin>=e.pxmin&&this.pxmax<=e.pxmax&&this.pymin>=e.pymin&&this.pymax<=e.pymax},t.contains=function(e){if(!e)return!1;this._project(this);var t=this.projection;if(t)if(void 0!==e.x){var n=mS;Array.isArray(e)?(n.x=e[0],n.y=e[1]):(n.x=e.x,n.y=e.y),e=t.project(n,n)}else void 0!==e.xmin&&this._project(e);return(e.x||e.pxmin||0)>=this.pxmin&&(e.x||e.pxmax||0)<=this.pxmax&&(e.y||e.pymin||0)>=this.pymin&&(e.y||e.pymax||0)<=this.pymax},t.getWidth=function(){return Math.abs(this.xmax-this.xmin)},t.getHeight=function(){return Math.abs(this.ymax-this.ymin)},t.getSize=function(){return new Tb(this.getWidth(),this.getHeight())},t.set=function(e,t,n,i){return this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i,this._dirty=!0,this},t.__combine=function(e){var t,n,i,r;void 0!==e.x&&(dS.xmin=dS.xmax=e.x,dS.ymin=dS.ymax=e.y,e=dS),this._project(e),this._project(this),r_(this.pxmin)?(t=Math.min(this.pxmin,e.pxmin),n=Math.min(this.pymin,e.pymin),i=Math.max(this.pxmax,e.pxmax),r=Math.max(this.pymax,e.pymax)):(t=e.pxmin,n=e.pymin,i=e.pxmax,r=e.pymax);var a=this.projection;if(a){vS.set(t,n),gS.set(i,r);var o=a.unproject(vS,vS),s=a.unproject(gS,gS);t=o.x,n=o.y,i=s.x,r=s.y}return MS[0]=t,MS[1]=n,MS[2]=i,MS[3]=r,MS},t._combine=function(e){if(!e||e.isValid&&!e.isValid())return this;var t=this.__combine(e);return this.set(t[0],t[1],t[2],t[3]),this._dirty=!0,this},t.combine=function(e){if(!e||e.isValid&&!e.isValid())return this;var t=this.__combine(e);return new this.constructor(t[0],t[1],t[2],t[3],this.projection)},t.intersection=function(e){if(!this.intersects(e))return null;yS.x=Math.max(this.pxmin,e.pxmin),yS.y=Math.max(this.pymin,e.pymin),_S.x=Math.min(this.pxmax,e.pxmax),_S.y=Math.min(this.pymax,e.pymax);var t=yS,n=_S,i=this.projection;return i&&(t=i.unproject(t,t),n=i.unproject(n,n)),new this.constructor(t,n,i)},t.expand=function(e){var t,n;return r_(e)?t=n=e:(t=e.width||e.x||e[0]||0,n=e.height||e.y||e[1]||0),new this.constructor(this.xmin-t,this.ymin-n,this.xmax+t,this.ymax+n,this.projection)},t._expand=function(e){var t,n;return r_(e)?t=n=e:(t=e.width||e.x||e[0]||0,n=e.height||e.y||e[1]||0),this.xmin-=t,this.ymin-=n,this.xmax+=t,this.ymax+=n,this._dirty=!0,this},t.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},t.toArray=function(e){var t=this.xmin,n=this.ymin,i=this.xmax,r=this.ymax;return e?(e[0].x=t,e[0].y=r,e[1].x=i,e[1].y=r,e[2].x=i,e[2].y=n,e[3].x=t,e[3].y=n,e[4].x=t,e[4].y=r,e):[new this._clazz([t,r]),new this._clazz([i,r]),new this._clazz([i,n]),new this._clazz([t,n]),new this._clazz([t,r])]},t.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},t.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},t.convertTo=function(e,t){if(!this.isValid())return null;var n,i=t||new this.constructor;return t&&i.set(null,null,null,null),this._clazz===hS?n=xS:this._clazz===ax&&(n=pS),n.x=this.xmin,n.y=this.ymax,i._combine(e(n)),n.x=this.xmax,i._combine(e(n)),n.y=this.ymin,i._combine(e(n)),n.x=this.xmin,i._combine(e(n)),i},t._project=function(e){if(e&&e.isValid()){var t=this.projection;if(t){if(e._dirty){bS.set(e.xmax,e.ymin),wS.set(e.xmin,e.ymax),SS[0]=bS,SS[1]=wS;var n=t.projectCoords(SS),i=n[0],r=n[1];e.pxmin=Math.min(i.x,r.x),e.pymin=Math.min(i.y,r.y),e.pxmax=Math.max(i.x,r.x),e.pymax=Math.max(i.y,r.y)}delete e._dirty}else e.pxmin=e.xmin,e.pxmax=e.xmax,e.pymin=e.ymin,e.pymax=e.ymax}else e&&(e.pxmin=e.pxmax=e.pymin=e.pymax=null)},e}();dS=new TS(0,0,0,0);var ES=function(e){function t(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this)._clazz=ax,a}return K_(t,e),t}(TS),CS=function(){function e(e){this.matrix=e}var t=e.prototype;return t.transform=function(e,t,n){var i=this.matrix[0]*(e.x-this.matrix[2])/t,r=-this.matrix[1]*(e.y-this.matrix[3])/t;return n?(n.x=i,n.y=r,n):new ax(i,r)},t.untransform=function(e,t,n){var i=e.x*t/this.matrix[0]+this.matrix[2],r=e.y*t/-this.matrix[1]+this.matrix[3];return n?(n.x=i,n.y=r,n):new hS(i,r)},e}(),kS={project:function(){},unproject:function(){},projectCoords:function(e,t){var n=this;if(!e)return[];if(!Array.isArray(e))return this.project(e);if(0===e.length)return[];if(!this.isSphere())return dx(e,this.project,this);if(Array.isArray(e[0]))return e.map((function(e){return n.projectCoords(e,t)}));for(var i,r,a,o,s,l,u=!1!==t,c=this.getCircum(),h=this.getSphereExtent(),f=h.sx,d=h.sy,p=e[0],m=[this.project(p)],v=1,g=e.length;v<g;v++)o=(a=e[v]).x-p.x,s=a.y-p.y,l=this.project(a),Math.abs(o)>180&&u&&(void 0===i&&(i=a.x>p.x),i&&(l._add(-c.x*mx(o)*f,0),a._add(-360*mx(o),0))),Math.abs(s)>90&&u&&(void 0===r&&(r=a.y<p.y),r&&(l._add(0,-c.y*mx(s)*d),a._add(0,-180*mx(s)))),p=a,m.push(l);return m},unprojectCoords:function(e){return e?Array.isArray(e)?dx(e,this.unproject,this):this.unproject(e):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(e){return!!this.isSphere()&&!this.getSphereExtent().contains(e)},wrapCoord:function(e){if(!this.isSphere())return e;var t=this.getSphereExtent(),n=new hS(e);return t.contains(n)||(n.x=gx(e.x,t.xmin,t.xmax),n.y=gx(e.y,t.ymin,t.ymax)),n},getCircum:function(){if(!this.circum&&this.isSphere()){var e=this.getSphereExtent();this.circum={x:e.getWidth(),y:e.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var e=this.project(new hS(180,90)),t=this.project(new hS(-180,-90));this.extent=new TS(t,e,this),this.extent.sx=e.x>t.x?1:-1,this.extent.sy=e.y>t.y?1:-1}return this.extent}},PS={measureLength:function(e,t){if(!Array.isArray(e))return this.measureLenBetween(e,t);for(var n=0,i=0,r=e.length;i<r-1;i++)n+=this.measureLenBetween(e[i],e[i+1]);return n}},AS=n_({measure:"IDENTITY",measureLenBetween:function(e,t){if(!e||!t)return 0;try{return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}catch(lA){return 0}},measureArea:function(e){if(!Array.isArray(e))return 0;for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n],a=null;a=n===i-1?e[0]:e[n+1],t+=r.x*a.y-r.y*a.x}return Math.abs(t/2)},locate:function(e,t,n,i){return(i=i||new hS(0,0)).set(e.x,e.y),this._locate(i,t,n)},_locate:function(e,t,n){return e?(t||(t=0),n||(n=0),t||n?(e.x=e.x+t,e.y=e.y+n,e):e):null},rotate:function(e,t,n){return e=new hS(e.x,e.y),this._rotate(e,t,n)},_rotate:function(){var e=new ax(0,0);return function(t,n,i){return e.x=t.x-n.x,e.y=t.y-n.y,e._rotate(i*Math.PI/180),t.x=n.x+e.x,t.y=n.y+e.y,t}}()},PS),RS=function(){function e(e){this.radius=e}var t=e.prototype;return t.measureLenBetween=function(e,t){if(!e||!t)return 0;var n=f_(e.y),i=f_(t.y),r=n-i,a=f_(e.x)-f_(t.x);return n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(n)*Math.cos(i)*Math.pow(Math.sin(a/2),2))),n*=this.radius},t.measureArea=function(e){var t,n=f_(this.radius),i=0,r=e,a=r.length;if(a<3)return 0;for(t=0;t<a-1;t++){var o=r[t],s=r[t+1];i+=o.x*n*Math.cos(f_(o.y))*s.y*n-s.x*n*Math.cos(f_(s.y))*o.y*n}return a=r[t],r=r[0],i+=a.x*n*Math.cos(f_(a.y))*r.y*n-r.x*n*Math.cos(f_(r.y))*a.y*n,.5*Math.abs(i)},t.locate=function(e,t,n,i){return(i=i||new hS(0,0)).set(e.x,e.y),this._locate(i,t,n)},t._locate=function(e,t,n){if(!e)return null;if(t||(t=0),n||(n=0),!t&&!n)return e;var i,r,a=f_(e.y);if(0!==n){var o=Math.abs(n);r=gx(180*(a+=2*Math.sin(o/(2*this.radius))*(n>0?1:-1))/Math.PI,-90,90)}else r=e.y;if(0!==t){var s=Math.abs(t),l=f_(e.x);i=gx(180*(l+=2*Math.sqrt(Math.pow(Math.sin(s/(2*this.radius)),2)/Math.pow(Math.cos(a),2))*(t>0?1:-1))/Math.PI,-180,180)}else i=e.x;return e.x=i,e.y=r,e},t.rotate=function(e,t,n){return e=new hS(e),this._rotate(e,t,n)},t._rotate=function(e,t,n){var i=function(e,t,n){void 0===n&&(n={});var i;i=n.final?LS(t,e):LS(e,t);return i>180?-(360-i):i}(t,e),r=i-n,a=this.measureLenBetween(t,e);return e.x=t.x,e.y=t.y,function(e,t,n,i){var r=t/i,a=e.x*Math.PI/180,o=f_(e.y),s=f_(n),l=r*Math.cos(s),u=o+l;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var c=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),h=Math.abs(c)>1e-11?l/c:Math.cos(o),f=r*Math.sin(s)/h,d=a+f;return e.x=(180*d/Math.PI+540)%360-180,e.y=180*u/Math.PI,e}(e,a,r,this.radius)},e}();function LS(e,t){var n=f_(e.y),i=f_(t.y),r=f_(t.x-e.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var a=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(d_(Math.atan2(r,a))+360)%360}var IS=n_({measure:"EPSG:4326",sphere:new RS(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},PS),OS=n_({measure:"BAIDU",sphere:new RS(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},PS),DS=IS,NS={};function zS(e){NS[e.measure]=e}zS(AS),zS(IS),zS(OS);var US,FS={getInstance:function(e){if(!e)return DS;for(var t in NS)if(c_(NS,t)){var n=NS[t].measure;if(!n)continue;if(e.toLowerCase()===n.toLowerCase())return NS[t]}return null}},BS=n_({},kS,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(e,t){var n=this.rad,i=this.metersPerDegree,r=this.maxLatitude,a=e.x,o=Math.max(Math.min(r,e.y),-r),s=a*i,l=(0===o?0:Math.log(Math.tan((90+o)*n/2))/n)*i;return t?(t.x=s,t.y=l,t):new hS(s,l)},unproject:function(e,t){var n,i=this.rad,r=this.metersPerDegree,a=e.x/r,o=e.y;0===o?n=0:(n=o/r,n=(2*Math.atan(Math.exp(n*i))-Math.PI/2)/i),Math.abs(Math.abs(a)-180)<1e-7&&(a=180*mx(a)),Math.abs(Math.abs(n)-this.maxLatitude)<1e-7&&(n=mx(n)*this.maxLatitude);var s=gx(a,-180,180),l=gx(n,-this.maxLatitude,this.maxLatitude);return t?(t.x=s,t.y=l,t):new hS(s,l)}},IS),HS=n_({},kS,{code:"EPSG:4326",project:function(e,t){return t?(t.x=e.x,t.y=e.y,t):new hS(e)},unproject:function(e,t){return t?(t.x=e.x,t.y=e.y,t):new hS(e)}},IS),jS=n_({},HS,{code:"EPSG:4490"}),GS=n_({},kS,{code:"BAIDU",project:function(e,t){return this.convertLL2MC(e,t)},unproject:function(e,t){return this.convertMC2LL(e,t)}},OS,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(e,t){for(var n,i=0,r=this.MCBAND.length;i<r;i++)if(Math.abs(e.y)>=this.MCBAND[i]){n=this.MC2LL[i];break}return this.convertor(e,n,t)},convertLL2MC:function(e,t){var n,i,r;e.x=this.getLoop(e.x,-180,180),e.y=this.getRange(e.y,-74,74);var a=new hS(e.x,e.y);for(i=0,r=this.LLBAND.length;i<r;i++)if(a.y>=this.LLBAND[i]){n=this.LL2MC[i];break}if(!n)for(i=this.LLBAND.length-1;i>=0;i--)if(a.y<=-this.LLBAND[i]){n=this.LL2MC[i];break}return this.convertor(e,n,t)},convertor:function(e,t,n){if(!e||!t)return null;var i=t[0]+t[1]*Math.abs(e.x),r=Math.abs(e.y)/t[9],a=t[2]+t[3]*r+t[4]*r*r+t[5]*r*r*r+t[6]*r*r*r*r+t[7]*r*r*r*r*r+t[8]*r*r*r*r*r*r;return i*=e.x<0?-1:1,a*=e.y<0?-1:1,n?(n.x=i,n.y=a,n):new hS(i,a)},toRadians:function(e){return Math.PI*e/180},toDegrees:function(e){return 180*e/Math.PI},getRange:function(e,t,n){return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),e},getLoop:function(e,t,n){if(e===1/0)return n;if(e===-1/0)return t;for(;e>n;)e-=n-t;for(;e<t;)e+=n-t;return e}}),VS=n_({},kS,{code:"IDENTITY",project:function(e,t){return t?(t.x=e.x,t.y=e.y,t):e.copy()},unproject:function(e,t){return t?(t.x=e.x,t.y=e.y,t):e.copy()}},AS),WS=BS,XS=Object.freeze({EPSG3857:BS,DEFAULT:WS,EPSG4326:HS,EPSG4490:jS,BAIDU:GS,IDENTITY:VS,Common:kS}),ZS=function(e){return function(e){function t(){return e.apply(this,arguments)||this}return K_(t,e),t.registerRenderer=function(e,t){var n=this.prototype,i=Object.getPrototypeOf(n);return n._rendererClasses&&n._rendererClasses!==i._rendererClasses||(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[e.toLowerCase()]=t,this},t.getRendererClass=function(e){var t=this.prototype;return t._rendererClasses?t._rendererClasses[e.toLowerCase()]:null},t}(e)},qS="core-fetch-image";var YS=!1;var JS=[];function QS(e){return JS.indexOf(e)>-1}function KS(e){QS(e)||JS.push(e)}var $S={};var eM,tM="\n    var adapters = {};\n    // Dynamic Create Adapter\n    function createAdapter(key,code){\n        if(adapters[key]||!code){\n            return;\n        }\n        var func=new Function('exports',code+'(exports)');\n        var workerExports={};\n        func(workerExports,self);\n        adapters[key]=workerExports;\n        workerExports.initialize && workerExports.initialize(self);\n        \n    }\n    onmessage = function (msg) {\n        msg = msg.data;\n        //createAdapter\n        if (msg.messageType === 'createAdapter') {\n           var key=msg.key;\n           var code=msg.code;\n           createAdapter(key,code);\n           postMessage({adapterName:key});\n           return;\n        }\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            post(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",nM="\n    workerExports = null;\n";function iM(){if("undefined"===typeof window)return null;if(!eM){var e=function(){var e=tM;for(var t in $S){var n=$S[t];KS(t),l_(n)&&0===n.length&&(n=n()),e+="\n    workerExports = {};\n    ("+n+")(workerExports, self);\n    adapters['"+t+"'] = workerExports",e+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return e+nM}();eM=window.URL.createObjectURL(new Blob([e],{type:"text/javascript"})),$S={}}return eM}function rM(e,t){if($S[e]){var n=$S[e];l_(n)&&0===n.length&&(n=n()),n="("+n+")";if(US){var i=US.workers||[];0===i.length&&console.error("workerpool workers count is 0");var r=0,a=function n(a){(a=a.data||{}).adapterName===e&&++r===i.length&&(i.forEach((function(e){e.removeEventListener("message",n)})),delete $S[e],t())};i.forEach((function(t){t.addEventListener("message",a),t.postMessage({key:e,code:n,messageType:"createAdapter"})}))}}else console.error("not find "+e+" adapter")}var aM,oM="undefined"!==typeof window?window.navigator.hardwareConcurrency||4:0,sM=Math.max(Math.floor(oM/2),1),lM=function(){function e(e){void 0===e&&(e=50),this._limit=e,this._messages=[],this.buffers=[]}var t=e.prototype;return t.addMessage=function(e,t){if(this._messages.push(e),Array.isArray(t))for(var n=0;n<t.length;n++)this.buffers.indexOf(t[n])<0&&this.buffers.push(t[n])},t.isFull=function(){return this._messages.length>=this._limit},t.getMessage=function(){return{messageType:"batch",messages:this._messages}},e}(),uM=function(){function e(){this.active={},this.workerCount="undefined"!==typeof window?window.MAPTALKS_WORKER_COUNT||sM:0,this._messages=[],this._messageBuffers=[]}var t=e.prototype;return t.acquire=function(e){if(!this.workers){this.workers=[];for(var t=iM(),n=0;n<this.workerCount;n++){var i=new Worker(t);i.id=n,this.workers.push(i)}URL.revokeObjectURL(t),YS=!0}return this.active[e]=!0,this.workers.slice()},t.release=function(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)},t.addMessage=function(e,t,n){var i=this._messages[e];i&&i.length||(i=this._messages[e]=[new lM]);var r=i[i.length-1];r.isFull()&&(r=new lM,this._messages[e].push(r)),r.addMessage(t,n)},t.commit=function(){if(this.workers&&this._messages.length)for(var e=0;e<this._messages.length;e++)if(this._messages[e]&&this._messages[e].length){var t=this._messages[e].shift();this.workers[e].postMessage(t.getMessage(),t.buffers)}},e}();function cM(){return aM||(aM=new uM,US=aM),aM}nx&&nx((function e(){cM().commit(),nx(e)}));var hM=0,fM=[],dM=function(){function e(e){var t=this;this._delayMessages=[],this.initializing=!1;var n=QS(e);YS&&!n&&(this.initializing=!0,console.log("Injecting codes in worker with worker key: :"+e),rM(e,(function(){t.initializing=!1,t.created()}))),this.workerKey=e,this.workerPool=cM(),this.currentActor=0,this.actorId=ux(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach((function(e){e.addEventListener("message",t.receiveFn,!1)})),KS(e)}var t=e.prototype;return t.created=function(){var e=this;this._delayMessages.forEach((function(t){var n=t.command,i=t.data,r=t.buffers,a=t.cb,o=t.workerId;e[n](i,r,a,o)})),this._delayMessages=[]},t.isActive=function(){return!!this.workers},t.broadcast=function(e,t,n){var i=this;return this.initializing?(this._delayMessages.push({command:"broadcast",data:e,buffers:t,cb:n}),this):(n=n||function(){},function(e,t,n){e.length||n(null,[]);var i=e.length,r=new Array(e.length),a=null;e.forEach((function(e,o){t(e,(function(e,t){e&&(a=e),r[o]=t,0===--i&&n(a,r)}))}))}(this.workers,(function(n,r){i.send(e,t,r,n.id)}),n),this)},t.send=function(e,t,n,i){if(this.initializing)return this._delayMessages.push({command:"send",data:e,buffers:t,cb:n,workerId:i}),this;var r=n?this.actorId+":"+this.callbackID++:null;return n&&(this.callbacks[r]=n),this.post({data:e,callback:String(r)},t,i),this},t.receive=function(e){var t=this,n=e.data,i=n.callback,r=this.callbacks[i];delete this.callbacks[i],"<request>"===n.type?this.actorId===n.actorId&&this[n.command](n.params,(function(e,i,r){var a={type:"<response>",callback:n.callback};e?a.error=e.message:a.data=i,t.post(a,r||fM,n.workerId)})):r&&n.error?r(n.error):r&&r(null,n.data)},t.remove=function(){var e=this;this.workers.forEach((function(t){t.removeEventListener("message",e.receiveFn,!1)})),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},t.post=function(e,t,n){return("number"!==typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),e.workerId=n,e.workerKey=this.workerKey,e.actorId=this.actorId,this.workerPool.addMessage(n,e,t||fM),n},t.getDedicatedWorker=function(){return hM=(hM+1)%this.workerPool.workerCount},e}();var pM=[],mM=function(e){function t(){return e.call(this,qS)||this}return K_(t,e),t.prototype.fetchImage=function(e,t){var n={url:e};this.send(n,pM,t)},t}(dM),vM=function(e){function t(t){var n;return(n=e.call(this)||this).layer=t,n._painted=!1,n._drawTime=0,!Y_.decodeImageInWorker||Y_.safari||Y_.iosWeixin||(n._resWorkerConn=new mM),n.setToRedraw(),n}K_(t,e);var n=t.prototype;return n.render=function(e){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new gM),this.checkAndDraw(this._tryToDraw,e))},n.checkAndDraw=function(e){var t=this;this._toRedraw=!1;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.checkResources){var a=this.checkResources();a.length>0?(this._loadingResource=!0,this.loadResources(a).then((function(){if(t._loadingResource=!1,t.layer){t.layer.fire("resourceload");var e=t.layer.getMap();t.setToRedraw(),e.getRenderer().callInNextFrame((function(){t.setToRedraw()}))}}))):e.call.apply(e,[this].concat(i))}else e.call.apply(e,[this].concat(i))},n.testIfNeedRedraw=function(){var e=this.getMap();return!this._loadingResource&&(!!this._toRedraw||!(e.isInteracting()&&!this.drawOnInteracting)&&!!this.needToRedraw())},n.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()&&!e.getRenderer().isViewChanged())&&!(!e.getPitch()&&e.isMoving()&&!e.isZooming()&&!e.isRotating()&&!this.layer.options.forceRenderOnMoving)},n.onSkipDrawOnInteracting=function(){},n.isLoadingResource=function(){return this._loadingResource},n.isRenderComplete=function(){return!!this._renderComplete},n.mustRenderOnInteracting=function(){return!this._painted},n.setToRedraw=function(){return this._toRedraw=!0,this},n.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},n.isCanvasUpdated=function(){return!!this._canvasUpdated},n.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,this._resWorkerConn&&(this._resWorkerConn.remove(),delete this._resWorkerConn),delete this.layer},n.onRemove=function(){},n.onAdd=function(){},n.getMap=function(){return this.layer?this.layer.getMap():null},n.getCanvasImage=function(){var e=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==e.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var t=e._pointToContainerPoint(this.southWest)._add(0,-e.height);return{image:this.canvas,layer:this.layer,point:t}},n.clear=function(){this.clearCanvas()},n.isBlank=function(){return!this._painted},n.show=function(){this.setToRedraw()},n.hide=function(){this.clear(),this.setToRedraw()},n.setZIndex=function(){this.setToRedraw()},n.hitDetect=function(e){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var t=this.getMap(),n=t.getDevicePixelRatio(),i=t.getSize();if(e.x<0||e.x>i.width*n||e.y<0||e.y>i.height*n)return!1;var r=this.getImageData&&this.getImageData();if(r){var a=Math.round(n*e.x),o=Math.round(n*e.y)*r.width*4+4*a;return r.data[o+3]>0}try{if(this.context.getImageData(n*e.x,n*e.y,1,1).data[3]>0)return!0}catch(s){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",s),this._errorThrown=!0),!1}return!1},n.loadResources=function(e){this.resources||(this.resources=new gM);var t=this.resources,n=[];if(_x(e))for(var i={},r=e.length-1;r>=0;r--){var a=e[r];a&&a.length&&!i[a.join("-")]&&(i[a.join("-")]=1,t.isResourceLoaded(a,!0)||n.push(new Kw(this._promiseResource(a))))}return Kw.all(n)},n.prepareRender=function(){delete this._renderComplete;var e=this.getMap();this._renderZoom=e.getZoom(),this.canvasExtent2D=this._extent2D=e._get2DExtent(),this.southWest=e._containerPointToPoint(new ax(0,e.height))},n.createCanvas=function(){if(!this.canvas){var e=this.getMap(),t=e.getSize(),n=e.getDevicePixelRatio(),i=Math.round(n*t.width),r=Math.round(n*t.height);if(this.layer._canvas){var a=this.layer._canvas;a.width=i,a.height=r,a.style&&(a.style.width=t.width+"px",a.style.height=t.height+"px"),this.canvas=this.layer._canvas}else this.canvas=Zw.createCanvas(i,r,e.CanvasClass);this.onCanvasCreate()}},n.onCanvasCreate=function(){},n.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=Zw.getCanvas2DContext(this.canvas),this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var e=this.getMap().getDevicePixelRatio();1!==e&&this.context.scale(e,e)}},n.resetCanvasTransform=function(){if(this.context){var e=this.getMap().getDevicePixelRatio();this.context.setTransform(e,0,0,e,0,0)}},n.resizeCanvas=function(e){var t=this.canvas;if(t){var n=e||this.getMap().getSize(),i=this.getMap().getDevicePixelRatio(),r=zx(n,i),a=r.width,o=r.height,s=r.cssWidth,l=r.cssHeight;!this.layer._canvas||t.style.width===s&&t.style.height===l||(t.style.width=s,t.style.height=l),t.width===a&&t.height===o||(t.height=o,t.width=a,1!==i&&this.context&&this.context.scale(i,i))}},n.clearCanvas=function(){if(this.context&&this.getMap()){var e=1/this.getMap().getDevicePixelRatio(),t=this.canvas.width*e,n=this.canvas.height*e;Zw.clearRect(this.context,0,0,Math.max(t,this.canvas.width),Math.max(n,this.canvas.height))}},n.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var e=this.layer.getMask();if(!e)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var t=this._maskExtent=e._getMaskPainter().get2DExtent();return t.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),t},n.clipCanvas=function(e){var t=this.layer.getMask();if(!t)return!1;var n=this.southWest,i=this.getMap();this.southWest=i._containerPointToPoint(new ax(0,i.height)),e.save();var r=i.getDevicePixelRatio();if(1!==r&&(e.save(),e.scale(r,r)),t.getGeometries){e.isMultiClip=!0;var a=t.getGeometries()||[];e.beginPath(),a.forEach((function(t){t._getMaskPainter().paint(null,e)})),e.stroke(),e.isMultiClip=!1}else{e.isClip=!0,e.beginPath(),t._getMaskPainter().paint(null,e),e.isClip=!1}return 1!==r&&e.restore(),e.clip(),this.southWest=n,!0},n.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},n.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},n.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},n.onZoomStart=function(){},n.onZoomEnd=function(){this.setToRedraw()},n.onZooming=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){this.setToRedraw()},n.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},n.onDragRotateStart=function(){},n.onDragRotating=function(){},n.onDragRotateEnd=function(){this.setToRedraw()},n.onSpatialReferenceChange=function(){},n.getDrawTime=function(){return this._drawTime},n._tryToDraw=function(e){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(e)},n._drawAndRecord=function(e){if(this.getMap()){var t=this._painted;this._painted=!0;var n=t_();this.draw(e),n=t_()-n,this._drawTime=t?n:n/2,t&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",e,"drawTime:",this._drawTime)}},n._promiseResource=function(e){var t=this.layer,n=this,i=this.resources,r=t.options.crossOrigin,a=t.options.renderer||"";return function(o){if(i.isResourceLoaded(e,!0))o(e);else if(!ox(e[0])&&n._resWorkerConn&&("canvas"!==t.options.renderer||t.options.decodeImageInWorker)){var s=Ox(e[0]);n._resWorkerConn.fetchImage(s,(function(t,i){if(t)return t&&"undefined"!==typeof console&&console.warn(t),void o(e);Ix(i,(function(t){n._cacheResource(e,t),o(e)}))}))}else{var l=new Image;i_(r)?"canvas"!==a&&(l.crossOrigin=""):l.crossOrigin=r,ox(e[0])&&!p_&&(e[1]&&(e[1]*=2),e[2]&&(e[2]*=2)),l.onload=function(){n._cacheResource(e,l),o(e)},l.onabort=function(t){console&&console.warn("image loading aborted: "+e[0]),t&&console&&console.warn(t),o(e)},l.onerror=function(t){t&&"undefined"!==typeof console&&console.warn(t),i.markErrorResource(e),o(e)},sx(l,e)}}},n._cacheResource=function(e,t){if(this.layer&&this.resources){var n=e[1],i=e[2];if(this.layer.options.cacheSvgOnCanvas&&1===ox(e[0])&&(Y_.edge||Y_.ie)){i_(n)&&(n=t.width||this.layer.options.defaultIconSize[0]),i_(i)&&(i=t.height||this.layer.options.defaultIconSize[1]);var r=Zw.createCanvas(n,i);Zw.image(r.getContext("2d"),t,0,0,n,i),t=r}this.resources.addResource(e,t)}},t}(tS),gM=function(){function e(){this.resources={},this._errors={}}var t=e.prototype;return t.addResource=function(e,t){var n=this;if(this.resources[e[0]]={image:t,width:+e[1],height:+e[2],refCnt:0},t&&t.width&&t.height&&!t.close&&Y_.imageBitMap&&!Y_.safari&&!Y_.iosWeixin){if(t.src&&ox(t.src))return;createImageBitmap(t).then((function(t){n.resources[e[0]]&&(n.resources[e[0]].image=t)}))}},t.isResourceLoaded=function(e,t){if(!e)return!1;var n=this._getImgUrl(e);if(this._errors[n])return!0;var i=this.resources[n];return!!i&&!(t&&ox(e[0])&&(+e[1]>i.width||+e[2]>i.height))},t.login=function(e){var t=this.resources[e];t&&t.refCnt++},t.logout=function(e){var t=this.resources[e];t&&t.refCnt--<=0&&(t.image&&t.image.close&&t.image.close(),delete this.resources[e])},t.getImage=function(e){var t=this._getImgUrl(e);return!this.isResourceLoaded(e)||this._errors[t]?null:this.resources[t].image},t.markErrorResource=function(e){this._errors[this._getImgUrl(e)]=1},t.merge=function(e){if(!e)return this;for(var t in e.resources){var n=e.resources[t];this.addResource([t,n.width,n.height],n.image)}return this},t.forEach=function(e){if(!this.resources)return this;for(var t in this.resources)c_(this.resources,t)&&e(t,this.resources[t]);return this},t._getImgUrl=function(e){return Array.isArray(e)?e[0]:e},t.remove=function(){for(var e in this.resources){var t=this.resources[e];t&&t.image&&t.image.close&&t.image.close()}this.resources={}},e}();!function(){var e;Y_.decodeImageInWorker&&(e=function(){return"\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data) {\n                buffers.push(data.data);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.arrayBuffer())\n            .then(arrayBuffer => {\n                const blob=new Blob([arrayBuffer]);\n                return createImageBitmap(blob);\n            })\n            .then(bitmap => {\n                cb(null, {data:bitmap});\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}"},$S[qS]=e)}();var yM={markerWidth:10,markerHeight:10,markerLineWidth:1},_M=new ax(0,0);function xM(e,t,n,i,r,a){var o=r.x+a.x,s=r.y+a.y;_M.x=o,_M.y=s;var l=function(e){if(!e)return 0;var t=e.x,n=e.y;if(0===t&&0===n)return 0;if(0===t||!t){if(n<0)return-Math.PI/2;if(n>0)return Math.PI/2}var i=n/t;return n<0&&t<0?Math.atan(i)-Math.PI:n>0&&t<0?Math.atan(i)+Math.PI:Math.atan(i)}(_M),u=Math.sqrt(o*o+s*s),c=0,h=0;c+=Math.cos(t+l)*u,h+=Math.sin(t+l)*u;var f=function(e,t,n){var i=Math.PI/2+n,r=Math.PI/4+n,a=n,o=t,s=Math.sqrt(e*e+t*t),l=e,u=Math.cos(i)*o,c=Math.sin(i)*o,h=Math.cos(r)*s,f=Math.sin(r)*s,d=Math.cos(a)*l,p=Math.sin(a)*l,m=Math.min(u,h,d,0),v=Math.min(c,f,p,0);return[m,v,Math.max(u,h,d,0)-m,Math.max(c,f,p,0)-v]}(n,i,t),d=f[0],p=f[1],m=f[2],v=f[3];h+=p;var g=(c+=d)+Math.max(n,m),y=h+Math.max(i,v);return e.set(c,h,g,y),e}var bM=new ax(0,0);function wM(e,t,n,i,r,a,o){var s=bM.set(t,n);if(i)return xM(e,i,a,o,s,r);var l=e.set(s.x,s.y,s.x+a,s.y+o);return l._add(r),i&&function(e,t){var n=e.xmin,i=e.ymin,r=e.xmax,a=e.ymax;AM.set(n,i,r,a),AM.convertTo((function(e){return e._rotate(t)}),e)}(l,i),l}var SM=[];function MM(e,t,n){var i=kM(t,(n=n||PM(SM,t))[0],n[1]);return wM(e,t.markerDx||0,t.markerDy||0,RM(t),i,n[0],n[1])}function TM(e){return"rectangle"===e?"right":"middle"}function EM(e){return"bar"===e||"pie"===e||"pin"===e?"top":"rectangle"===e?"bottom":"middle"}var CM=new Tb(0,0);function kM(e,t,n){var i=2*(e.shadowBlur||0)+.5;CM.width=t,CM.height=n;var r=e.markerType,a=zb(CM,e.markerHorizontalAlignment||TM(r),e.markerVerticalAlignment||EM(r));return a.x!==-t/2&&(a.x-=mx(a.x+t/2)*i),a.y!==-n/2&&(a.y-=mx(a.y+n/2)*i),a}function PM(e,t){var n=px(t.markerWidth,yM.markerWidth),i=px(t.markerHeight,yM.markerHeight),r=px(t.markerLineWidth,yM.markerLineWidth),a=2*((t.shadowBlur||0)+Math.max(Math.abs(t.shadowOffsetX||0)+Math.abs(t.shadowOffsetY||0))),o=Math.round(n+r+a+1),s=Math.round(i+r+a+1);return e[0]=o,e[1]=s,e}var AM=new ES;function RM(e,t){void 0===t&&(t="markerRotation");var n=e[t];return r_(n)?-n*Math.PI/180:0}function LM(e,t,n){var i=t.markerFile,r=n?n.getImage(i):null,a=t.markerWidth||(r?r.width:0),o=t.markerHeight||(r?r.height:0);CM.width=a,CM.height=o;var s=zb(CM,t.markerHorizontalAlignment||"middle",t.markerVerticalAlignment||"top");return wM(e,t.markerDx||0,t.markerDy||0,RM(t),s,a,o)}function IM(e,t,n){var i=n.size,r=zb(i,t.textHorizontalAlignment,t.textVerticalAlignment);if(t.textHaloRadius){var a=t.textHaloRadius;i=i.add(2*a,2*a)}return wM(e,t.textDx||0,t.textDy||0,RM(t,"textRotation"),r,i.width,i.height)}var OM=new ES;function DM(e,t,n,i){var r=e||new ES;if(Array.isArray(t)){for(var a=t,o=0;o<a.length;o++)DM(r,a[o],n,i[o]);return r}return NM(t)&&r._combine(IM(OM,t,i)),zM(t)&&r._combine(LM(OM,t,n)),UM(t)&&r._combine(MM(OM,t)),FM(t)&&r._combine(LM(OM,t)),r}function NM(e){return!!e&&!i_(e.textName)}function zM(e){return!!e&&!i_(e.markerFile)}function UM(e){return!!e&&!(!i_(e.markerFile)||i_(e.markerType)||"path"===e.markerType)}function FM(e){return!!e&&!(!i_(e.markerFile)||"path"!==e.markerType)}var BM,HM=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","markerRotation","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation"],jM=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function GM(e,t,n,i){for(var r,a=[],o=0,s=0,l=e.length;s<l-1;s++)(r=VM(e[s],e[s+1],t,s,n,i))&&(a[o]=a[o]||[],a[o].push({point:r[0],index:s}),r[1]===e[s+1]&&s!==l-2||(a[o].push({point:r[1],index:s+1}),o++));return a}function VM(e,t,n,i,r,a){var o,s,l,u=i?BM:ZM(e,n),c=ZM(t,n);for(BM=c;;){if(!(u|c))return[e,t];if(u&c)return!1;if(a)return[e,t];l=ZM(s=XM(e,t,o=u||c,n,r),n),o===u?(e=s,u=l):(t=s,c=l)}}function WM(e,t,n){var i,r,a,o,s,l,u,c,h,f=[1,4,2,8];for(r=0,u=e.length;r<u;r++)e[r]._code=ZM(e[r],t);for(o=0;o<4;o++){for(c=f[o],i=[],r=0,a=(u=e.length)-1;r<u;a=r++)s=e[r],l=e[a],s._code&c?l._code&c||((h=XM(l,s,c,t,n))._code=ZM(h,t),i.push(h)):(l._code&c&&((h=XM(l,s,c,t,n))._code=ZM(h,t),i.push(h)),i.push(s));e=i}return e}function XM(e,t,n,i,r){var a,o,s=t.x-e.x,l=t.y-e.y,u=i.getMin(),c=i.getMax();8&n?(a=e.x+s*(c.y-e.y)/l,o=c.y):4&n?(a=e.x+s*(u.y-e.y)/l,o=u.y):2&n?(a=c.x,o=e.y+l*(c.x-e.x)/s):1&n&&(a=u.x,o=e.y+l*(u.x-e.x)/s);var h=new ax(a,o);return r&&h._round(),h}function ZM(e,t){var n=0;return e.x<t.getMin().x?n|=1:e.x>t.getMax().x&&(n|=2),e.y<t.getMin().y?n|=4:e.y>t.getMax().y&&(n|=8),n}function qM(e,t,n,i){e=new ax(e);var r,a,o,s=Math.abs(n.x-t.x),l=Math.abs(n.y-t.y),u=Math.sqrt(Math.abs(s*s-l*l));return s>=l?(r=new ax(t.x-u,t.y),a=new ax(t.x+u,t.y),o=2*s):(r=new ax(t.x,t.y-u),a=new ax(t.x,t.y+u),o=2*l),e.distanceTo(r)+e.distanceTo(a)<=o+2*i}var YM=function(){function e(){this.bbox=zw()}var t=e.prototype;return t._setBBOX=function(e,t,n,i,r){return e.isHitTesting||Hw(this.bbox,t,n,i,r),this},t._bufferBBOX=function(e,t){return void 0===t&&(t=0),e.isHitTesting||function(e,t){void 0===t&&(t=0),e[0]-=t,e[1]-=t,e[2]+=t,e[3]+=t}(this.bbox,t),this},t.getMap=function(){return this.geometry.getMap()},t.getPainter=function(){return this.painter},t.isDynamicSize=function(){return!1},e.testColor=function(e){return!(!e||!s_(e))&&$y.indexOf(e)>=0},e}(),JM=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n._prepareContext=function(e){if(Qx(this.symbol.opacity)?this._opacityFn||(this._opacityFn=$x(this.symbol.opacity)):delete this._opacityFn,r_(this.symbol.opacity))e.globalAlpha!==this.symbol.opacity&&(e.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var t=this.getMap();e.globalAlpha=this._opacityFn(t.getZoom())}else 1!==e.globalAlpha&&(e.globalAlpha=1)},n.prepareCanvas=function(e,t,n){e.setLineDash&&_x(t.lineDasharray)&&e.setLineDash(t.lineDasharray);var i=this.getPainter().isHitTesting();Zw.prepareCanvas(e,t,n,i)},n.remove=function(){},n.setZIndex=function(){},n.show=function(){},n.hide=function(){},n._defineStyle=function(e){return _b(e,this.geometry)},t}(YM);function QM(e,t,n,i){var r,a=KM(n),o=n,s=o.markerType.toLowerCase(),l=$M(s,o.markerWidth,o.markerHeight),u=a.lineOpacity,c=a.polygonOpacity;jb(a.polygonFill)&&(jb(a.polygonFill)&&(r||(r=function(e,t,n){var i=new ES;return i._combine(e),i.xmin+=-t/2,i.ymin+=-n/2,i.xmax+=t/2,i.ymax+=n/2,i}(t,o.markerWidth,o.markerHeight)),a.polygonGradientExtent=r));Zw.prepareCanvas(e,a,i);var h=o.markerWidth,f=o.markerHeight,d=o.markerLineWidth/2;if("ellipse"===s)Zw.ellipse(e,t,h/2,f/2,f/2,u,c);else if("cross"===s||"x"===s){for(var p=l.length-1;p>=0;p--)l[p]._add(t);Zw.path(e,l.slice(0,2),u),Zw.path(e,l.slice(2,4),u)}else if("diamond"===s||"bar"===s||"square"===s||"rectangle"===s||"triangle"===s){"bar"===s?t=t.add(0,-d):"rectangle"===s&&(t=t.add(d,d));for(var m=l.length-1;m>=0;m--)l[m]._add(t);Zw.polygon(e,l,u,c)}else if("pin"===s){t=t.add(0,-d);for(var v=l.length-1;v>=0;v--)l[v]._add(t);var g=e.lineCap;e.lineCap="round",Zw.bezierCurveAndFill(e,l,u,c),e.lineCap=g}else{if("pie"!==s)throw new Error("unsupported markerType: "+s);t=t.add(0,-d);var y=180*Math.atan(h/2/f)/Math.PI,_=e.lineCap;e.lineCap="round",Zw.sector(e,t,f,[90-y,90+y],u,c),e.lineCap=_}return e.canvas}function KM(e){var t={lineColor:e.markerLineColor,linePatternFile:e.markerLinePatternFile,lineWidth:e.markerLineWidth,lineOpacity:e.markerLineOpacity,lineDasharray:e.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:e.markerFill,polygonPatternFile:e.markerFillPatternFile,polygonOpacity:e.markerFillOpacity};return 0===t.lineWidth&&(t.lineOpacity=0),t}function $M(e,t,n){var i,r,a,o,s=n/2,l=t/2;if("triangle"===e)return[i=new ax(0,0-s),r=new ax(0-l,0+s),a=new ax(0+l,0+s)];if("cross"===e)return[i=new ax(0-l,0),r=new ax(0+l,0),a=new ax(0,0-s),o=new ax(0,0+s)];if("diamond"===e)return[i=new ax(0-l,0),r=new ax(0,0-s),a=new ax(0+l,0),o=new ax(0,0+s)];if("square"===e)return[i=new ax(0-l,0+s),r=new ax(0+l,0+s),a=new ax(0+l,0-s),o=new ax(0-l,0-s)];if("rectangle"===e)return r=(i=new ax(0,0)).add(t,0),a=i.add(t,n),o=i.add(0,n),[i,r,a,o];if("x"===e)return[i=new ax(0-l,0+s),r=new ax(0+l,0-s),a=new ax(0+l,0+s),o=new ax(0-l,0-s)];if("bar"===e)return[i=new ax(0-l,0-n),r=new ax(0+l,0-n),a=new ax(0+l,0),o=new ax(0-l,0)];if("pin"===e||"pie"===e){var u=n*Math.atan(l/s);return[i=new ax(0,0),r=new ax(0-u,0-n),a=new ax(0+u,0-n),o=new ax(0,0)]}return[]}var eT,tT=new ax(0,0),nT=new ax(0,0),iT=new ax(0,0),rT=new ax(0,0),aT=function(e){function t(t,n,i){var r;return(r=e.call(this)||this).symbol=t,r.geometry=n,r.painter=i,r}K_(t,e);var n=t.prototype;return n.get2DExtent=function(){for(var e=this.getMap(),t=e.getGLRes(),n=new ES,i=this._getRenderPoints()[0],r=i.length-1;r>=0;r--)i[r]&&n._combine(e._pointAtResToPoint(i[r],t));return n},n.isDynamicSize=function(){var e=this.symbol;return Qx(e.markerWidth)||Qx(e.markerHeight)||Qx(e.textSize)},n._rotateExtent=function(e,t){return e.convertTo((function(e){return e._rotate(t)}))},n._getRenderPoints=function(){var e=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(e)},n._getRenderContainerPoints=function(e){var t=this.getPainter();if(t.isSpriting())return this._getRenderPoints()[0];var n,i=this.geometry,r=this.getDxDy();if(i._cPoint&&!e){var a=e?iT:rT;a.set(i._cPoint.x,i._cPoint.y);var o=t.containerOffset;a._sub(o);var s=r.x,l=r.y;(s||l)&&a._add(s||0,l||0),n=[a]}else{var u=this._getRenderPoints()[0];n=this.painter._pointContainerPoints(u,r.x,r.y,e,!0,this.getPlacement())}if(!n||!Array.isArray(n[0]))return n;for(var c=[],h=0,f=n.length;h<f;h++)for(var d=0,p=n[h].length;d<p;d++)c.push(n[h][d]);return c},n.getPlacement=function(){return this.symbol.markerPlacement},n.getRotation=function(){return RM(this.style)},n.getDxDy=function(){var e=this.style,t=e.markerDx,n=e.markerDy;return new ax(t,n)},n._getRotationAt=function(e){var t=this.getRotation();t||(t=0);var n=this._getRenderPoints()[1];if(!n||!n[e])return t;var i=this.getMap(),r=n[e][0],a=n[e][1];if(i.isTransforming()){var o=i.getGLRes();return r=i._pointAtResToContainerPoint(n[e][0],o,0,tT),a=i._pointAtResToContainerPoint(n[e][1],o,0,nT),t+Cx(r.x,r.y,a.x,a.y)}return t+-Cx(r.x,r.y,a.x,a.y)},n._rotate=function(e,t,n){if(n){var i=this.getDxDy(),r=t.sub(i);return e.save(),e.translate(r.x,r.y),e.rotate(n),i}return null},t}(JM),oT=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.getPlacement=function(){return"point"},n.getDxDy=function(){return new ax(0,0)},n.symbolize=function(e){var t=this.geometry,n=t.getLayer();if(t.options.debug||!n||n.options.debug){var i=this.getMap();if(i&&!i.isZooming()){var r=n.options.debugOutline;e.strokeStyle=r,e.fillStyle=r;var a=t.getContainerExtent().toArray();Zw.polygon(e,[a],1,0);for(var o=this._getRenderContainerPoints(),s=this.geometry.getId(),l=$M("cross",10,10),u=0;u<o.length;u++){var c=o[u];i_(s)||Zw.fillText(e,s,c.add(8,-4),r);for(var h=[],f=0;f<l.length;f++)h.push(l[f].add(c));Zw.path(e,h.slice(0,2),1),Zw.path(e,h.slice(2,4),1)}}}},t}(aT),sT=new Tb(1,1),lT=new ES,uT=function(e){function t(t,n,i){var r;return(r=e.call(this,t,n,i)||this).style=r._defineStyle(r.translate()),r}K_(t,e),t.test=function(e){return zM(e)};var n=t.prototype;return n.symbolize=function(e,t){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&0!==n.markerOpacity){var i=this._getRenderContainerPoints();if(_x(i)){var r=this._getImage(t);if(r){this._prepareContext(e);var a,o=n.markerWidth,s=n.markerHeight;if(!r_(o)||!r_(s)){o=r.width,s=r.height,n.markerWidth=o,n.markerHeight=s;var l=n.markerFile;t.isResourceLoaded(l)||t.addResource(l,r);var u=this.getPainter();u.isSpriting()||u.removeCache()}"path"!==this.symbol.markerType&&r_(n.markerOpacity)&&n.markerOpacity<1&&(a=e.globalAlpha,e.globalAlpha*=n.markerOpacity),sT.width=o,sT.height=s;for(var c=zb(sT,n.markerHorizontalAlignment,n.markerVerticalAlignment),h=0,f=i.length;h<f;h++){var d=i[h],p=this.getRotation()?this._rotate(e,d,this._getRotationAt(h)):null,m=void 0;if(p){var v=d.sub(p);d=p;var g=this._getRotationAt(h);(m=xM(lT,g,o,s,d,c))._add(v)}var y=d.x+c.x,_=d.y+c.y;Zw.image(e,r,y,_,o,s),p&&e.restore(),p?this._setBBOX(e,m.xmin,m.ymin,m.xmax,m.ymax):this._setBBOX(e,y,_,y+o,_+s)}void 0!==a&&(e.globalAlpha=a)}else"undefined"!==typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},n._getImage=function(e){return function(e,t){return e&&e.getImage(t)||null}(e,this.style.markerFile)},n.getFixedExtent=function(e){return this._fixedExtent=this._fixedExtent||new ES,LM(this._fixedExtent,this.style,e)},n.translate=function(){var e=this.symbol;return{markerFile:e.markerFile,markerOpacity:px(e.markerOpacity,1),markerWidth:px(e.markerWidth,null),markerHeight:px(e.markerHeight,null),markerRotation:px(e.markerRotation,0),markerDx:px(e.markerDx,0),markerDy:px(e.markerDy,0),markerHorizontalAlignment:px(e.markerHorizontalAlignment,"middle"),markerVerticalAlignment:px(e.markerVerticalAlignment,"top")}},t}(aT),cT=new hS(0,0),hT=new hS(0,0),fT=function(e){function t(t,n,i){var r;return(r=e.call(this)||this).symbol=t,r.geometry=n,r.painter=i,"Point"===n.type?ex(r):(r.style=r._defineStyle(r.translate()),r)}K_(t,e),t.test=function(e,t){if(!e)return!1;if(t&&"Point"===t.type)return!1;for(var n in e){var i=n.slice(0,4);if("line"===i||"poly"===i)return!0}return!1};var n=t.prototype;return n.symbolize=function(e,t){var n=this.style;if(0!==n.polygonOpacity||0!==n.lineOpacity||this.painter.isHitTesting()){var i=this._getPaintParams();if(i){this._prepareContext(e);var r=jb(n.lineColor),a="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!n.lineColor.places&&a||(n.lineGradientExtent=this.geometry.getContainerExtent()._expand(n.lineWidth)),jb(n.polygonFill)&&(n.polygonGradientExtent=this.geometry.getContainerExtent());var o=this.geometry.getLayer().options.geometryEventTolerance||0,s=this.geometry._hitTestTolerance()+o,l=i[0];if("Polygon"===this.geometry.getJSONType()&&l.length>0&&Array.isArray(l[0][0])||"LineString"===this.geometry.type&&l.length>0&&Array.isArray(l[0]))for(var u=0;u<l.length;u++){this.prepareCanvas(e,n,t),r&&a&&!n.lineColor.places&&this._createGradient(e,l[u],n.lineColor);var c=[e,l[u]];i.length>1&&c.push.apply(c,i.slice(1)),c.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray);var h=this.geometry._paintOn.apply(this.geometry,c);this._setBBOX(e,h),this._bufferBBOX(e,s)}else{this.prepareCanvas(e,n,t),r&&a&&!n.lineColor.places&&this._createGradient(e,l,n.lineColor);var f=[e];f.push.apply(f,i),f.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray);var d=this.geometry._paintOn.apply(this.geometry,f);this._setBBOX(e,d),this._bufferBBOX(e,s)}e.setLineDash&&Array.isArray(n.lineDasharray)&&e.setLineDash([])}}},n.get2DExtent=function(){var e=this.getMap(),t=this.geometry._getPrjExtent();if(!t)return null;this._extMin&&this._extMax||(this._extMin=new hS(0,0),this._extMax=new hS(0,0)),this._extMin.x=t.xmin,this._extMin.y=t.ymin,this._extMax.x=t.xmax,this._extMax.y=t.ymax;var n=e._prjToPoint(this._extMin,void 0,cT),i=e._prjToPoint(this._extMax,void 0,hT);return this._pxExtent?this._pxExtent.set(Math.min(n.x,i.x),Math.min(n.y,i.y),Math.max(n.x,i.x),Math.max(n.y,i.y)):this._pxExtent=new ES(n,i),this._pxExtent},n.getFixedExtent=function(){var e=this.style.lineWidth/2;return new ES(-e,-e,e,e)},n._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},n.translate=function(){var e=this.symbol,t={lineColor:px(e.lineColor,"#000"),lineWidth:px(e.lineWidth,2),lineOpacity:px(e.lineOpacity,1),lineDasharray:px(e.lineDasharray,[]),lineCap:px(e.lineCap,"butt"),lineJoin:px(e.lineJoin,"miter"),linePatternFile:px(e.linePatternFile,null),lineDx:px(e.lineDx,0),lineDy:px(e.lineDy,0),polygonFill:px(e.polygonFill,null),polygonOpacity:px(e.polygonOpacity,1),polygonPatternFile:px(e.polygonPatternFile,null),polygonPatternDx:px(e.polygonPatternDx,0),polygonPatternDy:px(e.polygonPatternDy,0),linePatternDx:px(e.linePatternDx,0),linePatternDy:px(e.linePatternDy,0)};return 0===t.lineWidth&&(t.lineOpacity=0),"LineString"!==this.geometry.type||t.polygonFill||(t.polygonFill=t.lineColor),t},n._createGradient=function(e,t,n){if(Array.isArray(t)&&t.length){var i=t.length,r=e.createLinearGradient(t[0].x,t[0].y,t[i-1].x,t[i-1].y);n.colorStops.forEach((function(e){r.addColorStop.apply(r,e)})),e.strokeStyle=r}},t}(JM),dT=function(e){function t(t,n,i){var r,a=(r=e.call(this,t,n,i)||this).translate();return r._dynamic=Kx(a),r.style=r._defineStyle(a),0===r.style.textWrapWidth?ex(r):(r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style)),r)}K_(t,e),t.test=function(e){return NM(e)};var n=t.prototype;return n.symbolize=function(e,t){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var n=this._getRenderContainerPoints();if(_x(n)){var i=this.style,r=this.strokeAndFill,a=Db(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var o=this._textDesc=this._textDesc||Nb(a,this.style);this._prepareContext(e),this.prepareCanvas(e,r,t),Zw.prepareCanvasFont(e,i);for(var s=0,l=n.length;s<l;s++){var u=n[s],c=this.getRotation()?this._rotate(e,u,this._getRotationAt(s)):null;c&&(u=c);var h=Zw.text(e,a,u,i,o);this._setBBOX(e,h),c&&e.restore()}}}},n.getPlacement=function(){return this.symbol.textPlacement},n.getRotation=function(){var e=this.style.textRotation;return r_(e)?-e*Math.PI/180:null},n.getDxDy=function(){var e=this.style;return new ax(e.textDx,e.textDy)},n.getFixedExtent=function(){var e=this.geometry.getTextDesc();return Array.isArray(e)&&(e=e[this._index]),this._fixedExtent=this._fixedExtent||new ES,e?IM(this._fixedExtent,this.style,e):this._fixedExtent},n.translate=function(){var e=this.symbol,t={textName:e.textName,textFaceName:px(e.textFaceName,"monospace"),textWeight:px(e.textWeight,"normal"),textStyle:px(e.textStyle,"normal"),textSize:px(e.textSize,e_),textFont:px(e.textFont,null),textFill:px(e.textFill,"#000"),textOpacity:px(e.textOpacity,1),textHaloFill:px(e.textHaloFill,"#ffffff"),textHaloRadius:px(e.textHaloRadius,0),textHaloOpacity:px(e.textHaloOpacity,1),textWrapWidth:px(e.textWrapWidth,null),textWrapCharacter:px(e.textWrapCharacter,"\n"),textLineSpacing:px(e.textLineSpacing,0),textDx:px(e.textDx,0),textDy:px(e.textDy,0),textHorizontalAlignment:px(e.textHorizontalAlignment,"middle"),textVerticalAlignment:px(e.textVerticalAlignment,"middle"),textAlign:px(e.textAlign,"center"),textRotation:px(e.textRotation,0),textMaxWidth:px(e.textMaxWidth,0),textMaxHeight:px(e.textMaxHeight,0)};return t.textMaxWidth>0&&(!t.textWrapWidth||t.textWrapWidth>t.textMaxWidth)&&(t.textWrapWidth||(t.textMaxHeight=1),t.textWrapWidth=t.textMaxWidth),t},n.translateLineAndFill=function(e){return{lineColor:e.textHaloRadius?e.textHaloFill:e.textFill,lineWidth:e.textHaloRadius,lineOpacity:e.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:e.textFill,polygonOpacity:e.textOpacity}},t}(aT),pT=[],mT=new ES,vT=function(e){function t(t,n,i){var r,a=(r=e.call(this,t,n,i)||this).translate();return r._dynamic=Kx(a),r.style=r._defineStyle(a),r.strokeAndFill=r._defineStyle(KM(r.style)),r.padding=0,r}K_(t,e),t.test=function(e){return UM(e)};var n=t.prototype;return n.symbolize=function(e,t){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&(0!==n.polygonOpacity||0!==n.lineOpacity)){var i=this._getRenderContainerPoints();_x(i)&&(this._prepareContext(e),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(e,i,t):this._drawMarkersWithCache(e,i,t))}},n._drawMarkers=function(e,t,n){for(var i=t.length-1;i>=0;i--){var r=t[i],a=this.getRotation()?this._rotate(e,r,this._getRotationAt(i)):null;a&&(r=a),this._drawVectorMarker(e,r,n),a&&e.restore()}},n._drawMarkersWithCache=function(e,t,n){var i=this._stampSymbol(),r=n.getImage(i);r||(r=this._createMarkerImage(e,n),n.addResource([i,r.width,r.height],r));for(var a=kM(this.style,r.width,r.height),o=t.length-1;o>=0;o--){var s=t[o],l=this.getRotation()?this._rotate(e,s,this._getRotationAt(o)):null,u=void 0;if(l){var c=s.sub(l);s=l;var h=this._getRotationAt(o);(u=xM(mT,h,r.width,r.height,s,a))._add(c)}var f=s.x+a.x,d=s.y+a.y;Zw.image(e,r,f,d),l?(e.restore(),this._setBBOX(e,u.xmin,u.ymin,u.xmax,u.ymax)):this._setBBOX(e,f,d,f+r.width,d+r.height)}},n._createMarkerImage=function(e,t){var n=e.canvas.constructor,i=PM(pT,this.style),r=Zw.createCanvas(i[0],i[1],n),a=this._getCacheImageAnchor(i[0],i[1]),o=r.getContext("2d");return this._drawVectorMarker(o,a,t),r},n._stampSymbol=function(){return this._stamp||(this._stamp=Hb([this.style.markerType,jb(this.style.markerFill)?Gb(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,jb(this.style.markerLineColor)?Gb(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},n._getCacheImageAnchor=function(e,t){var n=2*(this.symbol.shadowBlur||0)+this.padding,i=this.style.markerType;return"bar"===i||"pie"===i||"pin"===i?new ax(e/2,t-n):"rectangle"===i?new ax(n,n):new ax(e/2,t/2)},n._getGraidentExtent=function(e){var t=new ES,n=this.getDxDy(),i=this.getFixedExtent();if(Array.isArray(e))for(var r=e.length-1;r>=0;r--)t._combine(e[r]);else t._combine(e);return t.xmin+=i.xmin-n.x,t.ymin+=i.ymin-n.y,t.xmax+=i.xmax-n.x,t.ymax+=i.ymax-n.y,t},n._drawVectorMarker=function(e,t,n){QM(e,t,this.style,n)},n.getFixedExtent=function(){var e=this.isDynamicSize(),t=this.style.markerWidth,n=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new ES,MM(this._fixedExtent,this.style,e?[128,128*(0===t?1:n/t)]:null)},n.translate=function(){var e=this.symbol,t={markerType:px(e.markerType,"ellipse"),markerFill:px(e.markerFill,"#00f"),markerFillOpacity:px(e.markerFillOpacity,1),markerFillPatternFile:px(e.markerFillPatternFile,null),markerLineColor:px(e.markerLineColor,"#000"),markerLineWidth:px(e.markerLineWidth,yM.markerLineWidth),markerLineOpacity:px(e.markerLineOpacity,1),markerLineDasharray:px(e.markerLineDasharray,[]),markerLinePatternFile:px(e.markerLinePatternFile,null),markerDx:px(e.markerDx,0),markerDy:px(e.markerDy,0),markerWidth:px(e.markerWidth,yM.markerWidth),markerHeight:px(e.markerHeight,yM.markerHeight),markerRotation:px(e.markerRotation,0),shadowBlur:px(e.shadowBlur,0),shadowOffsetX:px(e.shadowOffsetX,0),shadowOffsetY:px(e.shadowOffsetY,0)},n=t.markerType,i=TM(n),r=EM(n);return t.markerHorizontalAlignment=px(e.markerHorizontalAlignment,i),t.markerVerticalAlignment=px(e.markerVerticalAlignment,r),r_(e.markerOpacity)&&(r_(e.markerFillOpacity)&&(t.markerFillOpacity*=e.markerOpacity),r_(e.markerLineOpacity)&&(t.markerLineOpacity*=e.markerOpacity)),t},t}(aT),gT=function(e){function t(t,n,i){var r;i_(t.markerWidth)&&(t.markerWidth=80),i_(t.markerHeight)&&(t.markerHeight=80),t=n_(t,(r=e.call(this,t,n,i)||this).translate());var a=r.style=r._defineStyle(t);return Y_.gecko?r._url=[bb(a,a.markerWidth,a.markerHeight),a.markerWidth,a.markerHeight]:r._url=[bb(a),a.markerWidth,a.markerHeight],r}K_(t,e),t.test=function(e){return FM(e)};var n=t.prototype;return n._prepareContext=function(){},n._getImage=function(e){var t=this;if(e&&e.isResourceLoaded(this._url))return e.getImage(this._url);var n=this.painter,i=new Image;return i.onload=function(){var e=n.getLayer()&&n.getLayer().getRenderer();e&&e.setToRedraw()},i.onerror=function(n){n&&"undefined"!==typeof console&&console.warn(n),e.markErrorResource(t._url)},i.src=this._url[0],e&&e.addResource(this._url,i),i},t}(uT),yT={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},_T=function(e){function t(t,n,i){var r;return(r=e.call(this,t,n,i)||this).style=n.getLayer().options.drawAltitude,r.style&&o_(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:t.textDx||t.markerDx,dy:t.textDy||t.markerDy}),r}K_(t,e),t.test=function(e,t){if(!t.getLayer())return!1;var n=t.getJSONType();return"Marker"===n||"LineString"===n};var n=t.prototype;return n.symbolize=function(e){var t=this.geometry.getLayer();if(t.options.drawAltitude){var n=this.geometry.getProperties();if(n&&n[t.options.altitudeProperty]){var i=this._getStyle();if(this._prepareContext(e),"LineString"===this.geometry.type){var r=this._getPaintParams(i.lineDx,i.lineDy,!1,!0);if(!r)return;var a=this.getPainter().getPaintParams(i.lineDx,i.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(e,r[0],a)}else{var o=this._getRenderContainerPoints(),s=this._getRenderContainerPoints(!0);if(!o||0===o.length)return;this._drawMarkerAltitude(e,o[0],s[0])}}}},n.getDxDy=function(){var e=this.dxdy;return new ax(e.dx||0,e.dy||0)},n.get2DExtent=function(){return"LineString"===this.geometry.type?fT.prototype.get2DExtent.apply(this):e.prototype.get2DExtent.call(this)},n.getPlacement=function(){return"point"},n._getPaintParams=function(e,t){return this.getPainter().getPaintParams(e||0,t||0,null,!0,"_altpt")},n._drawMarkerAltitude=function(e,t,n){var i=this._getStyle();this.prepareCanvas(e,i),Zw.path(e,[t,n],i.lineOpacity,null,i.lineDasharray)},n._drawLineAltitude=function(e,t,n){var i=this._getStyle();if(t.length>0&&Array.isArray(t[0]))for(var r=0;r<t.length;r++)this._drawLine(e,t[r],n[r]);else this._drawLine(e,t,n);e.setLineDash&&Array.isArray(i.lineDasharray)&&e.setLineDash([])},n._drawLine=function(e,t,n){var i=this._getStyle();this.prepareCanvas(e,i);for(var r=0,a=t.length-1;r<a;r++)Zw.polygon(e,[t[r],t[r+1],n[r+1],n[r]],i.lineOpacity,i.polygonOpacity,i.lineDasharray)},n._getStyle=function(){var e=this.geometry.getLayer().options.drawAltitude;return o_(e)||(e=yT),e.lineWidth||(e.lineWidth=0,e.lineOpacity=0),e},t}(aT),xT=[_T,fT,uT,gT,vT,dT],bT=new ax(0,0),wT=new ES,ST=new ES,MT=new ES,TT=new ES,ET=new ES,CT={},kT={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},PT=function(e){function t(t){var n;return(n=e.call(this)||this).geometry=t,n.symbolizers=n._createSymbolizers(),n._altAtGL=n._getGeometryAltitude(),n.bbox=zw(),n._drawTime=0,n}K_(t,e);var n=t.prototype;return n._setDrawTime=function(e){return this._drawTime=e,this},n.getRenderBBOX=function(){var e=this.getLayer();if(e&&e._drawTime!==this._drawTime)return null;Fw(this.bbox);for(var t=this.symbolizers.length-1;t>=0;t--){var n=this.symbolizers[t].bbox;jw(n)&&Hw(this.bbox,n)}return jw(this.bbox)?this.bbox:null},n.getMap=function(){return this.geometry.getMap()},n.getLayer=function(){return this.geometry&&this.geometry.getLayer()},n._createSymbolizers=function(){var e=this.getSymbol(),t=[],n=xT,i=e;Array.isArray(e)||(i=[e]);for(var r=i.length-1;r>=0;r--)for(var a=i[r],o=n.length-1;o>=0;o--)if(n[o].test(a,this.geometry)){var s=new n[o](a,this.geometry,this);s._index=r,t.push(s),s instanceof aT&&(this._hasPoint=!0)}if(!t.length&&console){var l=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(l?":"+l:""):"")+") to draw : "+JSON.stringify(e))}return this._debugSymbolizer=new oT(e,this.geometry,this),t},n.hasPoint=function(){return!!this._hasPoint},n.getRenderPoints=function(e){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),e||(e="center"),this._renderPoints[e]||(this._renderPoints[e]=this.geometry._getRenderPoints(e)),this._renderPoints[e]},n.getPaintParams=function(e,t,n,i,r){void 0===r&&(r="_pt");var a,o,s,l,u,c=this.getLayer()._getRenderer().mapStateCache,h=this.getMap();c&&!this._hitPoint?(a=c.resolution,o=c.pitch,s=c.bearing,l=c.glScale,u=c.containerExtent):(a=h.getResolution(),o=h.getPitch(),s=h.getBearing(),l=h.getGLScale(),u=h.getContainerExtent());var f=this.geometry,d=a,p=0!==o,m=0!==s,v=this._cachedParams,g=f._paintAsPath&&f._paintAsPath();if(g&&this._unsimpledParams&&d<=this._unsimpledParams._res)v=this._unsimpledParams;else if(!v||v._res!==a||this._pitched!==p&&f._redrawWhenPitch()||this._rotated!==m&&f._redrawWhenRotate()){if(!(v=f._getPaintParams()))return null;v._res=d,!f._simplified&&g&&(this._unsimpledParams||(this._unsimpledParams=v),d>this._unsimpledParams._res&&(this._unsimpledParams._res=d)),this._cachedParams=v}if(!v)return null;this._pitched=p,this._rotated=m;var y=l,_=[],x=v[0],b=u,w=this._pointContainerPoints(x,e,t,n,i||this._hitPoint&&!b.contains(this._hitPoint),null,r);if(!w)return null;_.push(w);for(var S=1,M=v.length;S<M;S++)r_(v[S])||v[S]instanceof Tb?r_(v[S])?_.push(v[S]/y):_.push(v[S].multi(1/y)):_.push(v[S]);return _},n._pointContainerPoints=function(e,t,n,i,r,a,o){if(void 0===o&&(o="_pt"),this._aboveCamera())return null;var s,l,u,c=this.getLayer()._getRenderer(),h=c.mapStateCache,f=this.getMap(),d=this.geometry,p=this.containerOffset;h?(s=h.glRes,l=h.containerExtent):(s=f.getGLRes(),l=f.getContainerExtent());var m=this.getLayer().options.roundPoint,v=1/0,g=1/0,y=-1/0,_=-1/0,x=!r,b=c.layer.options.clipBBoxBufferSize||3,w=this.symbolizers;function S(e,i){void 0===e&&(e=[]),void 0===i&&(i=[]);for(var r=Lx(e,o),a=0,u=(r=f._pointsAtResToContainerPoints(e,s,i,r)).length;a<u;a++){var c=r[a];c._sub(p),(t||n)&&c._add(t||0,n||0),m&&(c.x=Math.ceil(c.x),c.y=Math.ceil(c.y)),v=Math.min(c.x,v),g=Math.min(c.y,g),y=Math.max(c.x,y),_=Math.max(c.y,_)}if(x&&Kb(w)){if(ET.ymin=l.ymin,ET.ymin<b&&(ET.ymin=l.ymin-b),ET.xmin=l.xmin-b,ET.xmax=l.xmax+b,ET.ymax=l.ymax+b,d.getShell&&d.getHoles)return WM(r,ET);var h=GM(r,ET,!1);if(h.length){var S=[];return h.forEach((function(e){for(var t=0,n=e.length;t<n;t++)S.push(e[t].point)})),S}}return r}var M=this.getAltitude();if(Array.isArray(e)){var T,E=this.geometry;!r&&E.options.enableClip?(T=this._clip(e,M)).inView&&(x=!1):T={points:e,altitude:M};var C=T.points;M=T.altitude,i&&(M=0);var k=M;u=[];for(var P=[],A=r_(M),R=0,L=C.length;R<L;R++){var I=C[R];if(Array.isArray(I)){if(A){var O=S(I,M);u.push(O);continue}for(var D=[],N=0,z=I.length;N<z;N++)Array.isArray(M)&&(k=M[R]?M[R][N]:0),D.push(k);var U=S(I,D);u.push(U)}else Array.isArray(M)&&(k="vertex-last"===a?M[M.length-1-R]:"line"===a?(M[R]+M[R+1])/2:M[R]),P.push(k)}P.length&&(u=S(C,P))}else e instanceof ax&&(i&&(M=0),u=f._pointAtResToContainerPoint(e,s,M)._sub(p),(t||n)&&u._add(t,n));return kT.minx=v,kT.miny=g,kT.maxx=y,kT.maxy=_,this._containerBbox=kT,u},n._clip=function(e,t){if(r_(t)&&0!==t)return{points:e,altitude:t};if(Array.isArray(t)){for(var n=!1,i=0,r=t.length;i<r;i++)if(0!==t[i]){n=!0;break}if(n)return{points:e,altitude:t}}var a=this.getMap(),o=this.geometry,s=this.getSymbol().lineWidth;r_(s)||(s=4);var l,u,c,h=this.getLayer()._getRenderer().mapStateCache;h?(l=h._2DExtent,u=h.glExtent,c=h.pitch):(l=a._get2DExtent(),u=a._get2DExtentAtRes(a.getGLRes()),c=a.getPitch());var f=l._expand(s);if(c>0&&t){var d=a.cameraLookAt,p=a.cameraPosition;bT.set(p.x,p.y),f=f._combine(bT._add(mx(d[0]-p[0]),mx(d[1]-p[1])))}var m=e;if(this.get2DExtent(null,TT).within(f))return{points:m,altitude:t,inView:!0};var v=u._expand(s*a._glScale);MT.xmin=v.xmin,MT.xmax=v.xmax,MT.ymin=v.ymin,MT.ymax=v.ymax;var g=o.options.smoothness;if(o.getShell&&this.geometry.getHoles&&!g){var y=v.xmin,_=v.ymin,x=v.xmax,b=v.ymax,w=Math.abs(x-y),S=Math.abs(b-_),M=Math.sqrt(w*w+S*S),T=(M-w)/2,E=(M-S)/2;if(MT.xmin=v.xmin-T,MT.xmax=v.xmax+T,MT.ymin=v.ymin-E,MT.ymax=v.ymax+E,Array.isArray(e[0])){m=[];for(var C=0;C<e.length;C++){var k=WM(e[C],MT);k.length&&m.push(k)}}else m=WM(e,MT)}else if("LineString"===o.getJSONType()&&!g){if(Array.isArray(e[0])){m=[];for(var P=0;P<e.length;P++)hx(m,GM(e[P],MT,!1,!!g))}else m=GM(e,MT,!1,!!g);return this._interpolateSegAlt(m,e,t)}return{points:m,altitude:t}},n._interpolateSegAlt=function(e,t,n){if(!Array.isArray(n)){var i=function(e){return e.point};return{points:e.map((function(e){return Array.isArray(e)?e.map(i):e.point})),altitude:n}}var r=AT(e,t,n);n=[];var a=r.map((function(e){if(Array.isArray(e)){var t=[],i=e.map((function(e){return t.push(e.altitude),e.point}));return n.push(t),i}return n.push(e.altitude),e.point}));return{points:a,altitude:n}},n.getSymbol=function(){return this.geometry._getInternalSymbol()},n._resetSymbolizersBBOX=function(){for(var e=this.symbolizers.length-1;e>=0;e--){Fw(this.symbolizers[e].bbox)}return this},n.paint=function(e,t,n){if(this.symbolizers){var i=this.getLayer(),r=i._getRenderer();if(r&&(r.context||t)){var a=r.mapStateCache||{};if(this.geometry._isCheck||!e||e.intersects(this.get2DExtent(r.resources,wT))){var o=this.getMap();if(!this._aboveCamera()){this.containerOffset=n||a.offset||o._pointToContainerPoint(r.southWest)._add(0,-o.height),this._beforePaint();var s=t||r.context;s.isHitTesting||this._resetSymbolizersBBOX();for(var l=[s,r.resources],u=this.symbolizers.length-1;u>=0;u--)(s.shadowBlur||this.symbolizers[u].symbol.shadowBlur)&&this._prepareShadow(s,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],l);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||i.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,l)}}}}},n.getSprite=function(e,t){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var n=new ES;this.symbolizers.forEach((function(t){var i=t.getFixedExtent(e);n._combine(i)}));var i,r=n.getMin().multi(-1),a=t||(this.getMap()?this.getMap().CanvasClass:null),o=Zw.createCanvas(n.getWidth(),n.getHeight(),a);this._renderPoints&&(i=this._renderPoints);for(var s=o.getContext("2d"),l=[s,e],u=this.symbolizers.length-1;u>=0;u--){var c=this.symbolizers[u].getDxDy();this._renderPoints={center:[[r.add(c)]]},this._prepareShadow(s,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],l)}i&&(this._renderPoints=i),this._sprite={canvas:o,offset:n.getCenter()}}return this._spriting=!1,this._sprite},n.isSpriting=function(){return!!this._spriting},n.hitTest=function(e,t){if((!t||t<.5)&&(t=.5),this._hitPoint=e.sub(t,t),!eT){var n=this.getMap()?this.getMap().CanvasClass:null;eT=Zw.createCanvas(1,1,n)}Zw.setHitTesting(!0),eT.width=eT.height=2*t;var i=Zw.getCanvas2DContext(eT);i.isHitTesting=!0;try{this.paint(null,i,this._hitPoint)}catch(uA){throw uA}finally{Zw.setHitTesting(!1)}delete this._hitPoint;for(var r=i.getImageData(0,0,eT.width,eT.height).data,a=3,o=r.length;a<o;a+=4)if(r[a]>0)return!0;return!1},n.isHitTesting=function(){return!!this._hitPoint},n._prepareShadow=function(e,t){t.shadowBlur?(e.shadowBlur=this.isHitTesting()?0:t.shadowBlur,e.shadowColor=t.shadowColor||"#000",e.shadowOffsetX=t.shadowOffsetX||0,e.shadowOffsetY=t.shadowOffsetY||0):e.shadowBlur&&(e.shadowBlur=null,e.shadowColor=null,e.shadowOffsetX=null,e.shadowOffsetY=null)},n._eachSymbolizer=function(e,t){if(this.symbolizers){t||(t=this);for(var n=this.symbolizers.length-1;n>=0;n--)e.apply(t,[this.symbolizers[n]])}},n.get2DExtent=function(e,t){this._verifyProjection();var n=this.getMap();e=e||this.getLayer()._getRenderer().resources;var i=n.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===i&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==i&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new ES),this._extent2D._zoom=i),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(e,new ES)))),!this._extent2D)return r&&delete this._fixedExtent,null;var a=this._fixedExtent,o=a.xmin,s=a.ymin,l=a.xmax,u=a.ymax;return r&&delete this._fixedExtent,ST.set(o,-u,l,-s),t?(t.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),t._add(ST),t):this._extent2D.add(ST)},n._computeExtent2D=function(e){for(var t=this.symbolizers.length-1;t>=0;t--){var n=this.symbolizers[t];e._combine(n.get2DExtent())}return e},n._computeFixedExtent=function(e,t){for(var n=this.symbolizers.length-1;n>=0;n--){var i=this.symbolizers[n];i.getFixedExtent&&t._combine(i.getFixedExtent(e))}return t},n._isDynamicSize=function(){for(var e=this.symbolizers.length-1;e>=0;e--){if(this.symbolizers[e].isDynamicSize())return!0}return!1},n._aboveCamera=function(){var e=this.getMinAltitude(),t=this.getMap(),n=t.getGLRes();e=t.altitudeToPoint(e,n)*mx(e);var i=t.getFrustumAltitude();return e&&i&&i<e},n.getFixedExtent=function(){var e=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new ES):(this._extent2D&&this._extent2D._zoom===e||this.get2DExtent(null,ST),this._fixedExtent)},n.setZIndex=function(e){this._eachSymbolizer((function(t){t.setZIndex(e)}))},n.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(e){e.show()}))):this.getLayer().isCanvasRender()||this.paint()},n.hide=function(){this._eachSymbolizer((function(e){e.hide()}))},n.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var e=this.getLayer();if(e){var t=e.getRenderer();t&&t.setToRedraw()&&t.setToRedraw()}},n.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},n.remove=function(){this.removeCache(),this._removeSymbolizers()},n._removeSymbolizers=function(){this._eachSymbolizer((function(e){delete e.painter,e.remove()})),delete this.symbolizers},n.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},n.getAltitude=function(){return this.geometry._getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},n.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},n.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},n._getGeometryAltitude=function(){var e=this;if(!this.getMap())return 0;var t=this.geometry._getAltitude();return this._propAlt=t,t?this.geometry.getCenter()?Array.isArray(t)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,t.map((function(t){var n=t;return n<e.minAltitude&&(e.minAltitude=n),n>e.maxAltitude&&(e.maxAltitude=n),n}))):(this.minAltitude=this.maxAltitude=t,this.minAltitude):0:(this.minAltitude=this.maxAltitude=0,0)},n._verifyProjection=function(){var e=this.geometry._getProjection()||CT;this._projCode&&this._projCode!==e.code&&this.removeCache(),this._projCode=e.code},n._beforePaint=function(){},n._afterPaint=function(){},t}(tS);function AT(e,t,n){if(!Array.isArray(n))return e;for(var i=[],r=0,a=e.length;r<a;r++)if(Array.isArray(e[r]))i.push(AT(e[r],t,n));else{var o=e[r];if(o.point.equals(t[o.index]))o.altitude=n[o.index],i.push(o);else{var s=void 0,l=void 0;0===o.index?(s=o.index,l=o.index+1):(s=o.index-1,l=o.index);var u=o.point.distanceTo(t[l]),c=u/(u+t[s].distanceTo(o.point)),h=vx(n[s],n[l],1-c);o.altitude=h,i.push(o)}}return i}var RT=new ES,LT=function(e){function t(t,n){var i;return(i=e.call(this)||this).geometry=t,i.isMask=n,i.bbox=zw(),i._drawTime=0,i}K_(t,e);var n=t.prototype;return n._setDrawTime=function(e){return this._drawTime=e,this._eachPainter((function(t){t._setDrawTime(e)})),this},n.getRenderBBOX=function(){var e=this,t=this.getLayer();return t&&t._drawTime!==this._drawTime?null:(Fw(this.bbox),this._eachPainter((function(t){var n=t.getRenderBBOX();jw(n)&&Hw(e.bbox,n)})),jw(this.bbox)?this.bbox:null)},n._eachPainter=function(e){for(var t,n=this.geometry.getGeometries(),i=0,r=n.length;i<r&&(!(t=this.isMask?n[i]._getMaskPainter():n[i]._getPainter())||!t||!1!==e.call(this,t));i++);},n.getLayer=function(){return this.geometry&&this.geometry.getLayer()},n.paint=function(e){this.geometry&&this._eachPainter((function(t){t.paint(e)}))},n.get2DExtent=function(e,t){t&&t.set(null,null,null,null);var n=t||new ES;return this._eachPainter((function(t){n=n._combine(t.get2DExtent(e,RT))})),n},n.remove=function(){var e=arguments;this._eachPainter((function(t){t.remove.apply(t,e)}))},n.setZIndex=function(){var e=arguments;this._eachPainter((function(t){t.setZIndex.apply(t,e)}))},n.show=function(){var e=arguments;this._eachPainter((function(t){t.show.apply(t,e)}))},n.hide=function(){var e=arguments;this._eachPainter((function(t){t.hide.apply(t,e)}))},n.repaint=function(){var e=arguments;this._eachPainter((function(t){t.repaint.apply(t,e)}))},n.refreshSymbol=function(){var e=arguments;this._eachPainter((function(t){t.refreshSymbol.apply(t,e)}))},n.hasPoint=function(){var e=!1;return this._eachPainter((function(t){return!t.hasPoint()||(e=!0,!1)})),e},n.getMinAltitude=function(){var e=!0,t=0;return this._eachPainter((function(n){var i=n.getMinAltitude();(e||i<t)&&(e=!1,t=i)})),t},n.getMaxAltitude=function(){var e=0;return this._eachPainter((function(t){var n=t.getMaxAltitude();n>e&&(e=n)})),e},t}(tS),IT={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var e=[],t=12756274*Math.PI,n=0;n<23;n++)e[n]=t/(256*Math.pow(2,n));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var e=[],t=0;t<23;t++)e[t]=180/(128*Math.pow(2,t));return e}()},BAIDU:{projection:"baidu",resolutions:function(){for(var e=Math.pow(2,18),t=[],n=0;n<23;n++)t[n]=e,e*=.5;return t}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var e=Math.pow(2,8),t=[],n=0;n<23;n++)t[n]=e,e*=.5;return t}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var e=[],t=6378137*Math.PI,n=0;n<23;n++)e[n]=t/(256*Math.pow(2,n));return e}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}}};IT["EPSG:4490"]=IT["EPSG:4326"];var OT=function(){function e(e){void 0===e&&(e={}),this.options=e,this._initSpatialRef()}e.registerPreset=function(e,t){if(e=e&&e.toUpperCase(),IT[e])throw new Error("Spatial reference "+e+" already existed.");IT[e]=t},e.getPreset=function(e){return IT[e.toUpperCase()]},e.getAllPresets=function(){return Object.keys(IT)},e.getProjectionInstance=function(e){if(!e)return null;if(o_(e))return e.locate||("identity"===(e=n_({},e)).measure?n_(e,FS.getInstance("IDENTITY")):n_(e,FS.getInstance("EPSG:4326"))),e;for(var t in e=(e+"").toLowerCase(),XS)if(c_(XS,t)){var n=XS[t].code;if(n&&n.toLowerCase()===e)return XS[t]}return null},e.equals=function(e,t){if(s_(e)||s_(t))return e===t;if(!e&&!t)return!0;if(!e||!t)return!1;if(e.projection!==t.projection)return!1;var n=e.fullExtent,i=t.fullExtent;if(n&&!i||!n&&i)return!1;if(n&&i&&(n.top!==i.top||n.bottom!==i.bottom||n.left!==i.left||n.right!==i.right))return!1;var r=e.resolutions,a=t.resolutions;if(r&&a){if(r.length!==a.length)return!1;for(var o=0;o<r.length;o++)if(r[o]!==a[o])return!1}else if(r||a)return!1;return!0};var t=e.prototype;return t._initSpatialRef=function(){var t=this.options.projection;if(!(t=t?e.getProjectionInstance(t):WS))throw new Error("must provide a valid projection in map's spatial reference.");(t=n_({},kS,t)).measureLength||n_(t,FS.DEFAULT),this._projection=t;var n,i=this.options.resolutions;if(!i&&(t.code&&(n=IT[t.code.toUpperCase()])&&(i=n.resolutions,this.isEPSG="IDENTITY"!==t.code),!i))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=i,this._pyramid=!0,this._pyramid)for(var r=0;r<i.length;r++)if(i[r]&&i[r-1]&&i[r-1]/i[r]!==2){this._pyramid=!1;break}var a=this.options.fullExtent;if(!a&&(t.code&&(n=IT[t.code.toUpperCase()])&&(a=n.fullExtent),!a))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(i_(a.left)?(this._fullExtent=new TS(a),a.left=a.xmin,a.right=a.xmax,a.top=a.ymax,a.bottom=a.ymin):this._fullExtent=new TS(new hS(a.left,a.top),new hS(a.right,a.bottom)),i_(a.top)||i_(a.bottom)||i_(a.left)||i_(a.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");n_(this._fullExtent,a),this._projection.fullExtent=a;var o=a.right>=a.left?1:-1,s=a.top>=a.bottom?-1:1;this._transformation=new CS([o,s,0,0])},t.getResolutions=function(){return this._resolutions||[]},t.getResolution=function(e){var t=0|e;t<0?t=0:t>this._resolutions.length-1&&(t=this._resolutions.length-1);var n=this._resolutions[t];return t!==e&&e>0&&t<this._resolutions.length-1?n+(this._resolutions[t+1]-n)*(e-t):n},t.getProjection=function(){return this._projection},t.getFullExtent=function(){return this._fullExtent},t.getTransformation=function(){return this._transformation},t.getMinZoom=function(){for(var e=0;e<this._resolutions.length;e++)if(!i_(this._resolutions[e]))return e;return 0},t.getMaxZoom=function(){for(var e=this._resolutions.length-1;e>=0;e--)if(!i_(this._resolutions[e]))return e;return this._resolutions.length-1},t.getZoomDirection=function(){return mx(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},t.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},t.isPyramid=function(){return this._pyramid},e}(),DT=new ax(0,0),NT=new ES,zT={},UT=function(e){function t(t){var n,i=n_({},t),r=i.symbol,a=i.properties,o=i.id;return delete i.symbol,delete i.id,delete i.properties,n=e.call(this,i)||this,r?n.setSymbol(r):n._genSizeSymbol(),a&&n.setProperties(a),i_(o)||n.setId(o),n}K_(t,e);var n=t.prototype;return n.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var e=this.getGeometries();return e.length?e[0].getFirstCoordinate():null}var t=this.getCoordinates();if(!Array.isArray(t))return t;do{t=t[0]}while(Array.isArray(t)&&t.length>0);return t},n.getLastCoordinate=function(){if("GeometryCollection"===this.type){var e=this.getGeometries();return e.length?e[e.length-1].getLastCoordinate():null}var t=this.getCoordinates();if(!Array.isArray(t))return t;do{t=t[t.length-1]}while(Array.isArray(t)&&t.length>0);return t},n.addTo=function(e,t){return e.addGeometry(this,t),this},n.getLayer=function(){return this._layer?this._layer:null},n.getMap=function(){return this._layer?this._layer.getMap():null},n.getId=function(){return this._id},n.setId=function(e){var t=this.getId();return this._id=e,this._fireEvent("idchange",{old:t,new:e}),this},n.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},n.setProperties=function(e){var t=this.properties;return this.properties=o_(e)?n_({},e):e,this._repaint(),this._fireEvent("propertieschange",{old:t,new:e}),this},n.getType=function(){return this.type},n.getSymbol=function(){var e=this._symbol;return e?Array.isArray(e)?Xb(e):n_({},e):null},n.setSymbol=function(e){return this._symbolUpdated=e,this._symbol=this._prepareSymbol(e),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},n.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=Vb(this._symbolUpdated)),this._symbolHash},n.updateSymbol=function(e){if(!e)return this;var t=this._getSymbol();if(Array.isArray(t)){if(!Array.isArray(e))throw new Error("Parameter of updateSymbol is not an array.");for(var n=0;n<e.length;n++)NM(e[n])&&delete this._textDesc,t[n]&&e[n]&&(t[n]=Xb(t[n],e[n]))}else{if(Array.isArray(e))throw new Error("Geometry's symbol is not an array to update.");NM(t)&&delete this._textDesc,t=Xb(t||this._getInternalSymbol(),e)}return this._eventSymbolProperties=e,delete this._compiledSymbol,this.setSymbol(t)},n.getTextContent=function(){var e=this._getInternalSymbol();if(Array.isArray(e)){for(var t=[],n=!1,i=0;i<e.length;i++)t[i]=Db(e[i]&&e[i].textName,this.getProperties()),i_(t[i])||(n=!0);return n?t:null}return Db(e&&e.textName,this.getProperties())},n.getTextDesc=function(){if(!this._textDesc){var e=this.getTextContent(),t=this._sizeSymbol,n=Array.isArray(e);Array.isArray(t)?this._textDesc=t.map((function(t,i){return Nb(n?e[i]:"",t)})):this._textDesc=Nb(e,t)}return this._textDesc},n.getCenter=function(){return this._computeCenter(this._getMeasurer())},n.getExtent=function(){var e=this._getPrjExtent(),t=this._getProjection();if(e&&t){var n=t.unproject(new hS(e.xmin,e.ymin)),i=t.unproject(new hS(e.xmax,e.ymax));return new TS(n,i,t)}return this._computeExtent(this._getMeasurer())},n.getContainerExtent=function(e){var t=this.get2DExtent();if(!t||!t.isValid())return null;var n=this.getMap(),i=n.getGLRes(),r=this.getMinAltitude(),a=t.convertTo((function(e){return n._pointAtResToContainerPoint(e,i,r,DT)}),e),o=this.getMaxAltitude();if(o!==r){var s=t.convertTo((function(e){return n._pointAtResToContainerPoint(e,i,o,DT)}),NT);a._combine(s)}var l=this.getLayer();if(l&&"LineString"===this.type&&o&&l.options.drawAltitude){var u=t.convertTo((function(e){return n._pointAtResToContainerPoint(e,i,0,DT)}),NT);a._combine(u)}return a&&a._add(this._getFixedExtent()),this.options.smoothness&&a._expand(.15*a.getWidth()),a},n._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new ES);var e=this._sizeSymbol,t=(e&&e.lineWidth||1)/2;this._fixedExtent.set(-t,-t,t,t);var n=e&&e.lineDx||0;this._fixedExtent._add([n,0]);var i=e&&e.lineDy||0;return this._fixedExtent._add([0,i]),this._fixedExtent},n.get2DExtent=function(){var e=this.getMap();if(!e)return null;if(this._extent2d)return this._extent2d;var t=this._getPrjExtent();if(!t||!t.isValid())return null;var n=t.getMin(),i=t.getMax(),r=e.getGLRes();return e._prjToPointAtRes(n,r,n),e._prjToPointAtRes(i,r,i),this._extent2d=new ES(n,i),this._extent2d.z=e.getZoom(),this._extent2d},n.getSize=function(){var e=this.getContainerExtent();return e?e.getSize():null},n.containsPoint=function(e,t){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return e instanceof hS&&(e=this.getMap().coordToContainerPoint(e)),this._containsPoint(e,t)},n._containsPoint=function(e,t){var n=this._getPainter();return!!n&&(t=t||0,this._hitTestTolerance&&(t+=this._hitTestTolerance()),n.hitTest(e,t))},n.show=function(){if(this.options.visible=!0,this.getMap()){var e=this._getPainter();e&&e.show(),this._fireEvent("show")}return this},n.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var e=this._getPainter();e&&e.hide(),this._fireEvent("hide")}return this},n.isVisible=function(){if(!this.options.visible)return!1;var e=this._getInternalSymbol();if(!e)return!0;if(Array.isArray(e)){if(!e.length)return!0;for(var t=0,n=e.length;t<n;t++)if(i_(e[t].opacity)||e[t].opacity>0)return!0;return!1}return i_(e.opacity)||o_(e.opacity)||r_(e.opacity)&&e.opacity>0},n.getZIndex=function(){return this.options.zIndex||0},n.setZIndex=function(e){var t=this.options.zIndex;return this.options.zIndex=e,this._fireEvent("zindexchange",{old:t,new:e}),this},n.setZIndexSilently=function(e){return this.options.zIndex=e,this},n.bringToFront=function(){var e=this.getLayer();if(!e||!e.getGeoMaxZIndex)return this;var t=e.getGeoMaxZIndex();return this.setZIndex(t+1),this},n.bringToBack=function(){var e=this.getLayer();if(!e||!e.getGeoMinZIndex)return this;var t=e.getGeoMinZIndex();return this.setZIndex(t-1),this},n.translate=function(e,t){if(i_(e))return this;var n=new hS(e,t);if(0===n.x&&0===n.y)return this;var i=this.getCoordinates();if(this._silence=!0,i)if(Array.isArray(i)){var r=dx(i,(function(e){return e.add(n)}));this.setCoordinates(r)}else this.setCoordinates(i.add(n));return this._silence=!1,this._fireEvent("positionchange"),this},n.flash=function(e,t,n,i){return Rx.call(this,e,t,n,i)},n.copy=function(){var e=this.toJSON(),n=t.fromJSON(e);return n.options.visible=!0,n},n.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},n.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},n.toGeoJSON=function(e){e||(e={});var t={type:"Feature",geometry:null};if(i_(e.geometry)||e.geometry){var n=this._exportGeoJSONGeometry();t.geometry=n}var i,r=this.getId();return i_(r)||(t.id=r),(i_(e.properties)||e.properties)&&(i=this._exportProperties()),t.properties=i,t},n.toJSON=function(e){e||(e={});var t=this._toJSON(e);return n_(t,this._exportGraphicOptions(e)),t},n.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},n.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},n.rotate=function(e,t){if("GeometryCollection"===this.type)return this.getGeometries().forEach((function(n){return n.rotate(e,t)})),this;t=t?new hS(t):this.getCenter();var n=this._getMeasurer(),i=this.getCoordinates();if(!Array.isArray(i)){if(t.x!==i.x||t.y!==i.y){var r=n._rotate(i,t,e);this.setCoordinates(r)}return this}return dx(i,(function(i){return n._rotate(i,t,e)})),this.setCoordinates(i),this},n._getConnectPoints=function(){return[this.getCenter()]},n._initOptions=function(e){var t=n_({},e),n=t.symbol,i=t.properties,r=t.id;delete t.symbol,delete t.id,delete t.properties,this.setOptions(t),n&&this.setSymbol(n),i&&this.setProperties(i),i_(r)||this.setId(r)},n._bindLayer=function(e){if(e!==this.getLayer()){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=e,this._clearCache(),this._bindInfoWindow(),this._bindMenu()}},n._prepareSymbol=function(e){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(Sb(this._checkAndCopySymbol(e[n])));return t}return e?Sb(e=this._checkAndCopySymbol(e)):null},n._checkAndCopySymbol=function(e){var t={};for(var n in e)Ky[n]&&s_(e[n])?t[n]=+e[n]:t[n]=e[n];return t},n._getSymbol=function(){return this._symbol},n._setExternSymbol=function(e){return this._eventSymbolProperties=e,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(e),this.onSymbolChanged(),this},n._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},n._getPrjExtent=function(){var e=this._getProjection();return this._verifyProjection(),!this._extent&&e&&(this._extent=this._computePrjExtent(e)),this._extent},n._unbind=function(){var e=this.getLayer();e&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),e.onRemoveGeometry&&e.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},n._getInternalId=function(){return this._internalId},n._setInternalId=function(e){this._internalId=e},n._getMeasurer=function(){return this._getProjection()?this._getProjection():OT.getProjectionInstance(this.options.defaultProjection)},n._getProjection=function(){var e=this.getMap();return e?e.getProjection():null},n._verifyProjection=function(){var e=this._getProjection();this._projCode&&e&&this._projCode!==e.code&&this._clearProjection(),this._projCode=e?e.code:this._projCode},n._getExternalResources=function(){return wb(this._getInternalSymbol())},n._getPainter=function(){var e=this.getLayer();if(!this._painter&&e)if(-1!==qy.indexOf(this.type)){if(e.constructor.getCollectionPainterClass){var t=e.constructor.getCollectionPainterClass();t&&(this._painter=new t(this))}}else if(e.constructor.getPainterClass){var n=e.constructor.getPainterClass();n&&(this._painter=new n(this))}return this._painter},n._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new LT(this,!0):new PT(this)),this._maskPainter},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},n._paint=function(e){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var t=this._getProjection();t&&(this._pcenter=t.project(this._coordinates),this._clearCache())}this._painter.paint(e)}},n._clearCache=function(){delete this._extent,delete this._extent2d},n._clearProjection=function(){delete this._extent,delete this._extent2d},n._repaint=function(){this._painter&&this._painter.repaint()},n.onHide=function(){this.closeMenu(),this.closeInfoWindow()},n.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},n.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},n.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var e={};this._eventSymbolProperties?(e.properties=JSON.parse(JSON.stringify(this._eventSymbolProperties)),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",e)},n._genSizeSymbol=function(){var e=this._getInternalSymbol();if(e)if(Array.isArray(e)){this._sizeSymbol=[];for(var t=!1,n=0;n<e.length;n++){var i=this._sizeSymbol[n]=this._getSizeSymbol(e[n]);!t&&i&&i._dynamic&&(t=!0)}this._sizeSymbol._dynamic=t}else this._sizeSymbol=this._getSizeSymbol(e);else delete this._sizeSymbol},n._getSizeSymbol=function(e){var t=_b({lineWidth:e.lineWidth,lineDx:e.lineDx,lineDy:e.lineDy},this);return(Qx(e.lineWidth)||Qx(e.lineDx)||Qx(e.lineDy))&&(t._dynamic=!0),t},n._getCompiledSymbol=function(){return this._compiledSymbol||(this._compiledSymbol=_b(this._getInternalSymbol(),this)),this._compiledSymbol},n.onConfig=function(e){var t;e.properties&&(t=e.properties,delete e.properties);var n=!1;for(var i in e)if(e.hasOwnProperty(i)){var r=i.slice(0,5);if("arrow"===r||"smoot"===r){n=!0;break}}t?(this.setProperties(t),this._repaint()):n&&this._repaint()},n._setParent=function(e){e&&(this._parent=e)},n._getParent=function(){return this._parent},n._fireEvent=function(e,t){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(t||(t={}),t.type=e,t.target=this,this.getLayer()._onGeometryEvent(t)),this.fire(e,t))},n._toJSON=function(e){return{feature:this.toGeoJSON(e)}},n._exportGraphicOptions=function(e){var t={};return(i_(e.options)||e.options)&&(t.options=this.config()),(i_(e.symbol)||e.symbol)&&(t.symbol=this.getSymbol()),(i_(e.infoWindow)||e.infoWindow)&&this._infoWinOptions&&(t.infoWindow=this._infoWinOptions),t},n._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),t=hS.toNumberArrays(e);return{type:this.getType(),coordinates:t}},n._exportProperties=function(){var e=null,t=this.getProperties();return i_(t)||(e=o_(t)?n_({},t):t),e},n._hitTestTolerance=function(){return 0},n._getAltitude=function(){var e=this.getLayer();if(!e)return 0;var t=e.options,n=e.getAltitude?e.getAltitude():0,i=t.enableAltitude;if(!i)return n;var r=FT(e),a=(this.properties||zT)[r];if(i_(a)){var o=BT(this,n,i);return i_(o)?n:o}return Array.isArray(a)?a.map((function(e){return e+n})):a+n},n.getAltitude=function(){var e=FT(this.getLayer()),t=(this.properties||zT)[e];if(!i_(t))return t;var n=BT(this,0,!1);return i_(n)?0:n},n.setAltitude=function(e){if(!r_(e))return this;var t=this.getLayer(),n=FT(t),i=this.properties||zT,r=i[n];if(!i_(r))if(Array.isArray(r))for(var a=0,o=r.length;a<o;a++)r[a]=e;else i[n]=e;var s=this.getCoordinates?this.getCoordinates():null;if(!s)return this;if(HT(s,e),t){var l=t.getRenderer();l&&l.gl?this.setCoordinates(s):l&&this._repaint()}return this},n._genMinMaxAlt=function(){var e=this,t=this._getAltitude();Array.isArray(t)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,t.forEach((function(t){var n=t;n<e._minAlt&&(e._minAlt=n),n>e._maxAlt&&(e._maxAlt=n)}))):this._minAlt=this._maxAlt=t},n.getMinAltitude=function(){return void 0===this._minAlt&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},n.getMaxAltitude=function(){return void 0===this._maxAlt&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},t}(iS($w(oS(tS))));function FT(e){var t="altitude";e&&(t=e.options.altitudeProperty);return t}function BT(e,t,n){var i=e.getCoordinates?e.getCoordinates():null;if(i){var r=[];if(jT(i,r),r.length){var a=GT(i,t,n);return e.getShell?a[0][0]:a}}return null}function HT(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)HT(e[n],t);else e.z=t}function jT(e,t){if(!t.length)if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)jT(e[n],t);else r_(e.z)&&t.push(e.z)}function GT(e,t,n){if(Array.isArray(e)){for(var i=[],r=0,a=e.length;r<a;r++)i.push(GT(e[r],t,n));return i}return r_(e.z)?n?t+e.z:e.z:n?t:0}UT.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"});var VT={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!Y_.mobile},WT=function(e){function t(t,n){var i,r;return n&&(r=n.canvas,delete n.canvas),(i=e.call(this,n)||this)._canvas=r,i.setId(t),n&&(i.setZIndex(n.zIndex),n.mask&&i.setMask(UT.fromJSON(n.mask))),i.proxyOptions(),i}K_(t,e);var n=t.prototype;return n.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var e=this.getZIndex();i_(e)||(this._renderer.setZIndex(e),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},n.getId=function(){return this._id},n.setId=function(e){var t=this._id;return i_(e)||(e+=""),this._id=e,this.fire("idchange",{old:t,new:e}),this},n.addTo=function(e){return e.addLayer(this),this},n.setZIndex=function(e){return this._zIndex=e,i_(e)?delete this.options.zIndex:this.options.zIndex=e,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(e),this.fire("setzindex",{zIndex:e}),this},n.getZIndex=function(){return this._zIndex||0},n.getMinZoom=function(){var e=this.getMap(),t=this.options.minZoom;return e?Math.max(e.getMinZoom(),t||0):t},n.getMaxZoom=function(){var e=this.getMap(),t=this.options.maxZoom;return e?Math.min(e.getMaxZoom(),i_(t)?1/0:t):t},n.getOpacity=function(){return this.options.opacity},n.setOpacity=function(e){return this.config("opacity",e),this.fire("setopacity",{opacity:e}),this},n.isCanvasRender=function(){var e=this._getRenderer();return e&&e instanceof vM},n.getMap=function(){return this.map?this.map:null},n.getProjection=function(){var e=this.getMap();return e?e.getProjection():null},n.bringToFront=function(){var e=this._getLayerList();if(!e.length)return this;var t=e[e.length-1];if(1===e.length||t===this)return this;var n=t.getZIndex();return this.setZIndex(n+1),this},n.bringToBack=function(){var e=this._getLayerList();if(!e.length)return this;var t=e[0];if(1===e.length||t===this)return this;var n=t.getZIndex();return this.setZIndex(n-1),this},n.show=function(){var e=this;if(!this.options.visible){this.options.visible=!0;var t=this.getRenderer();t&&t.show();var n=this.getMap();t&&n?n.once("renderend",(function(){e.fire("show")})):this.fire("show")}return this},n.hide=function(){var e=this;if(this.options.visible){this.options.visible=!1;var t=this.getRenderer();t&&t.hide();var n=this.getMap();t&&n?n.once("renderend",(function(){e.fire("hide")})):this.fire("hide")}return this},n.isVisible=function(){if(r_(this.options.opacity)&&this.options.opacity<=0)return!1;var e=this.getMap();if(e){var t=e.getZoom();if(!i_(this.options.maxZoom)&&this.options.maxZoom<t||!i_(this.options.minZoom)&&this.options.minZoom>t)return!1}return i_(this.options.visible)&&(this.options.visible=!0),this.options.visible},n.remove=function(){return this.map&&this.map.removeLayer(this),this},n.getMask=function(){return this._mask},n.setMask=function(e){if(!("Point"===e.type&&e._isVectorMarker()||"Polygon"===e.type||"MultiPolygon"===e.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(e._bindLayer(this),"Point"===e.type?e.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):e.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=e,this.options.mask=e.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},n.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},n.onLoad=function(){return!0},n.onLoadEnd=function(){},n.isLoaded=function(){return!!this._loaded},n.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new aS),this._collisionIndex;var e=this.getMap();return e?e.getCollisionIndex():null},n.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},n.getRenderer=function(){return this._getRenderer()},n.onConfig=function(e){if(e&&Object.keys&&Object.keys(e).length>0&&i_(e.animation)){if(this._optionsHook&&l_(this._optionsHook)&&this._optionsHook(e),this._silentConfig)return;var t=this.getRenderer();t&&t.setToRedraw&&t.setToRedraw()}},n.onAdd=function(){},n.onRendererCreate=function(){},n.onCanvasCreate=function(){},n.onRemove=function(){},n._bindMap=function(e,t){e&&(this.map=e,i_(t)||this.setZIndex(t),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},n._initRenderer=function(){var e=this.options.renderer;if(this.constructor.getRendererClass){var t=this.constructor.getRendererClass(e);if(!t)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+e);this._renderer=new t(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},n._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},n._switchEvents=function(e,t){t&&t.getEvents&&this.getMap()&&this.getMap()[e](t.getEvents(),t)},n._getRenderer=function(){return this._renderer},n._getLayerList=function(){return this.map?this.map._layers:[]},n._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var e=this._mask._getMaskPainter();return e?e.get2DExtent():null},t}(iS($w(ZS(tS))));WT.mergeOptions(VT);var XT=WT.prototype.fire;WT.prototype.fire=function(e,t){return"layerload"===e&&(this._loaded=!0),this.map&&(t||(t={}),t.type=e,t.target=this,this.map._onLayerEvent(t)),XT.apply(this,arguments),["show","hide"].indexOf(e)>-1&&this.fire("visiblechange",Object.assign({},t,{visible:this.options.visible})),this};var ZT=new hS(0,0),qT=new ax(0,0),YT=["centerCross","fog","fogColor","debugSky"],JT={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!p_,zoomAnimationDuration:330,panAnimation:!p_,panAnimationDuration:600,rotateAnimation:!p_,zoomable:!0,enableInfoWindow:!0,hitDetect:!Y_.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0,preventTouch:!0,supportPluginEvent:!0,switchDragButton:!1},QT=function(e){function t(n,i){var r;if(!i)throw new Error("Invalid options when creating map.");if(!i.center)throw new Error("Invalid center when creating map.");var a=n_({},i),o=a.zoom;delete a.zoom;var s=new hS(a.center);delete a.center;var l=a.baseLayer;delete a.baseLayer;var u=a.layers;return delete a.layers,(r=e.call(this,a)||this).VERSION=t.VERSION,Object.defineProperty(ex(ex(r)),"id",{value:ux(),writable:!1}),r._loaded=!1,r._initContainer(n),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=o,r._center=s,r.setSpatialReference(a.spatialReference||a.view),r._mapViewPoint=new ax(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),l&&r.setBaseLayer(l),u&&r.addLayer(u),r.setMaxExtent(a.maxExtent),r._Load(),r.proxyOptions(),r}K_(t,e),t.addOnLoadHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(n),this};var n=t.prototype;return n.isLoaded=function(){return!!this._loaded},n.getContainer=function(){return this._containerDOM},n.getSpatialReference=function(){return this._spatialReference},n.setSpatialReference=function(e){var t=this.options.spatialReference;return this._loaded&&OT.equals(t,e)||this._updateSpatialReference(e,t),this},n._updateSpatialReference=function(e,t){if(s_(e)&&(e=OT.getPreset(e)),e=n_({},e),this._center=this.getCenter(),this.options.spatialReference=e,this._spatialReference=new OT(e),this.options.spatialReference&&l_(this.options.spatialReference.projection)){var n=this._spatialReference.getProjection();this.options.spatialReference.projection=n.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:t,new:n_({},this.options.spatialReference)}),this},n.onConfig=function(e){var t=e.spatialReference||e.view;i_(t)||this._updateSpatialReference(t,null);for(var n=!1,i=0,r=YT.length;i<r;i++){if(!i_(e[YT[i]])){n=!0;break}}if(!n)return this;var a=this.getRenderer();return a&&a.setToRedraw(),this},n.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},n.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},n.setCursor=function(e){return delete this._cursor,this._trySetCursor(e),this._cursor=e,this},n.resetCursor=function(){return this.setCursor(null)},n.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var e=this.getProjection().unproject(this._prjCenter);return e.x=Math.round(1e8*e.x)/1e8,e.y=Math.round(1e8*e.y)/1e8,this.centerAltitude&&(e.z=this.centerAltitude),e},n.setCenter=function(e,t){if(!e)return this;e=new hS(e),t&&(e=this._getCenterByPadding(e,this.getZoom(),t));var n=this.getProjection().project(e);return this._verifyExtent(n)?this._loaded?(this.onMoveStart(),this._setPrjCenter(n),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=e,this):this},n.getSize=function(){return i_(this.width)||i_(this.height)?this._getContainerDomSize():new Tb(this.width,this.height)},n.getContainerExtent=function(){var e=this.height,t=this.getPitch(),n=this.options.maxVisualPitch;return n&&t>n&&(e=this._getVisualHeight(n)),new ES(0,this.height-e,this.width,this.height)},n._getVisualHeight=function(e){e=e||.01;var t=(90-this.getPitch())*Math.PI/180,n=this.getFov()*Math.PI/180;e*=Math.PI/180;var i=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(n/2),a=i*r/(1/Math.tan(e)-r)/Math.sin(e),o=i*(Math.sin(t)*a/(i+Math.cos(t)*a));return this.height/2+o},n.getExtent=function(){return this._pointToExtent(this._get2DExtent())},n.getProjExtent=function(){var e=this._get2DExtent();return new TS(this._pointToPrj(e.getMin()),this._pointToPrj(e.getMax()))},n.getPrjExtent=function(){return this.getProjExtent()},n.getMaxExtent=function(){return this.options.maxExtent?new TS(this.options.maxExtent,this.getProjection()):null},n.setMaxExtent=function(e){if(e){var t=new TS(e,this.getProjection());this.options.maxExtent=t;var n=this.getProjection();this._prjMaxExtent=t.convertTo((function(e){return n.project(e)})),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=n.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},n.getZoom=function(){return this._zoomLevel},n.getZoomForScale=function(e,t,n){var i=this.getZoom();if(i_(t)&&(t=i),1===e&&t===i)return i;var r=this._getResolution(t)/e,a=this.getZoomFromRes(r);if(n)return a;var o=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(a-o):Math.floor(a+o)},n.getZoomFromRes=function(e){var t=this._getResolutions(),n=this._getResolution(this.getMinZoom()),i=this._getResolution(this.getMaxZoom());if(n<=i){if(e<=n)return this.getMinZoom();if(e>=i)return this.getMaxZoom()}else{if(e>=n)return this.getMinZoom();if(e<=i)return this.getMaxZoom()}for(var r=t.length,a=0;a<r-1;a++)if(t[a]){var o=t[a+1]-t[a],s=e-t[a];if(mx(o)===mx(s)&&Math.abs(o)>=Math.abs(s))return a+s/o}return r-1},n.setZoom=function(e,t){return void 0===t&&(t={animation:!0}),isNaN(e)||i_(e)||(e=+e,this._loaded&&this.options.zoomAnimation&&t.animation?this._zoomAnimation(e):this._zoom(e)),this},n.getMaxZoom=function(){return i_(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},n.setMaxZoom=function(e){var t=this.getMaxNativeZoom();return e>t&&(e=t),null!==e&&e<this._zoomLevel&&(this.setZoom(e),e=+e),this.options.maxZoom=e,this},n.getMinZoom=function(){return i_(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},n.setMinZoom=function(e){if(null!==e){e=+e;var t=this._spatialReference.getMinZoom();e<t&&(e=t),e>this._zoomLevel&&this.setZoom(e)}return this.options.minZoom=e,this},n.getMaxNativeZoom=function(){var e=this.getSpatialReference();return e?e.getMaxZoom():null},n.getGLRes=function(){if(this._glRes)return this._glRes;var e=this.getSpatialReference().getFullExtent();return this._glRes=(e.right-e.left)/Math.pow(2,19),this._glRes},n.getGLScale=function(e){return i_(e)&&(e=this.getZoom()),this._getResolution(e)/this.getGLRes()},n.zoomIn=function(){return this.setZoom(this.getZoom()+1)},n.zoomOut=function(){return this.setZoom(this.getZoom()-1)},n.isZooming=function(){return!!this._zooming},n.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},n.setCenterAndZoom=function(e,t){return i_(t)||this._zoomLevel===t?this.setCenter(e):(this.setCenter(e),this.setZoom(t,{animation:!1})),this},n._getPaddingSize=function(e){return void 0===e&&(e={}),e.paddingLeft||e.paddingTop||e.paddingRight||e.paddingBottom?{width:(e.paddingLeft||0)+(e.paddingRight||0),height:(e.paddingTop||0)+(e.paddingBottom||0)}:null},n.getFitZoom=function(e,t,n){var i=this;if(!e||!(e instanceof TS))return this._zoomLevel;if(e.xmin===e.xmax&&e.ymin===e.ymax)return this.getMaxZoom();var r=this.getSize(),a=this._getPaddingSize(n);a&&(r={width:r.width-(a.width||0),height:r.height-(a.height||0)});var o=e.convertTo((function(e){return i.coordToPoint(e)})),s=o.getWidth(),l=o.getHeight(),u=r.width/s,c=r.height/l,h=this.getSpatialReference().getZoomDirection()<0?Math.max(u,c):Math.min(u,c);return this.getZoomForScale(h,null,t)},n.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},n.setView=function(e){return e?(e.center&&this.setCenter(e.center),null===e.zoom||isNaN(+e.zoom)||this.setZoom(+e.zoom,{animation:!1}),null===e.pitch||isNaN(+e.pitch)||this.setPitch(+e.pitch),null===e.pitch||isNaN(+e.bearing)||this.setBearing(+e.bearing),this):this},n.getResolution=function(e){return this._getResolution(e)},n.getScale=function(e){var t=i_(e)?this.getZoom():e,n=this._getResolution(this.getMaxNativeZoom());return this._getResolution(t)/n},n._getCenterByPadding=function(e,t,n){void 0===n&&(n={});var i=this.coordinateToPoint(e,t),r=n,a=r.paddingLeft,o=void 0===a?0:a,s=r.paddingRight,l=void 0===s?0:s,u=r.paddingTop,c=void 0===u?0:u,h=r.paddingBottom,f=void 0===h?0:h,d=0,p=0;(o||l)&&(d=(l-o)/2),(c||f)&&(p=(c-f)/2);var m=new ax({x:i.x+d,y:i.y+p});return this.pointToCoordinate(m,t)},n.fitExtent=function(e,t,n,i){if(void 0===n&&(n={}),!e)return this;e=new TS(e,this.getProjection());var r=this.getFitZoom(e,n.isFraction||!1,n)+(t||0),a=e.getCenter();return this._getPaddingSize(n)&&(a=this._getCenterByPadding(a,r,n)),"undefined"===typeof n.animation||n.animation?this._animateTo({center:a,zoom:r},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},i):this.setCenterAndZoom(a,r)},n.getBaseLayer=function(){return this._baseLayer},n.setBaseLayer=function(e){var t=!1;if(this._baseLayer&&(t=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!e)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return this._baseLayer=e,e._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),t&&(t=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},n.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},n.getLayers=function(e){return this._getLayers((function(t){return!(t===this._baseLayer||t.getId().indexOf(Zy)>=0)&&(!e||e(t))}))},n.getLayer=function(e){if(!e)return null;var t=this._layerCache?this._layerCache[e]:null;if(t)return t;var n=this.getBaseLayer();return n&&n.getId()===e?n:null},n.addLayer=function(e){if(!e)return this;if(!Array.isArray(e))return e=Array.prototype.slice.call(arguments,0),this.addLayer(e);this._layerCache||(this._layerCache={});for(var t=this._layers,n=0,i=e.length;n<i;n++){var r=e[n],a=r.getId();if(i_(a))throw new Error("Invalid id for the layer: "+a);if(r.getMap()!==this){if(this._layerCache[a])throw new Error("Duplicate layer id in the map: "+a);this._layerCache[a]=r,r._bindMap(this),t.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:e}),this},n.removeLayer=function(e){if(!e)return this;if(!Array.isArray(e))return this.removeLayer([e]);for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];if(r instanceof WT||(r=this.getLayer(r)),r){var a=r.getMap();if(a&&a===this){t.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var o=r.getId();this._layerCache&&delete this._layerCache[o]}}}if(t.length>0){var s=this.getRenderer();s&&s.setLayerCanvasUpdated(),t.forEach((function(e){e.fire("remove")}))}return this._fireEvent("removelayer",{layers:e}),this},n.sortLayers=function(e){if(!e||!Array.isArray(e))return this;for(var t=[],n=Number.MAX_VALUE,i=0,r=e.length;i<r;i++){var a=e[i];if(s_(e[i])&&(a=this.getLayer(a)),!(a instanceof WT)||!a.getMap()||a.getMap()!==this)throw new Error("It must be a layer added to this map to order.");a.getZIndex()<n&&(n=a.getZIndex()),t.push(a)}for(var o=0,s=t.length;o<s;o++)t[o].setZIndex(n+o);return this},n.toDataURL=function(e){e||(e={});var t=e.mimeType;t||(t="image/png");var n=e.save,i=this._getRenderer();if(i&&i.toDataURL){var r=e.fileName;r||(r="export");var a=i.toDataURL(t,e.quality||.92);if(n&&a){var o;if("undefined"!==typeof Blob&&"undefined"!==typeof atob){var s=Ex(a.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),t);o=URL.createObjectURL(s)}else o=a;var l=document.createElement("a");l.download=r,l.href=o,document.body.appendChild(l),l.click(),document.body.removeChild(l)}return a}return null},n.coordToPoint=function(e,t,n){return this.coordinateToPoint(e,t,n)},n.coordToPointAtRes=function(e,t,n){return this.coordinateToPointAtRes(e,t,n)},n.pointToCoord=function(e,t,n){return this.pointToCoordinate(e,t,n)},n.pointAtResToCoord=function(e,t,n){return this.pointAtResToCoordinate(e,t,n)},n.coordToViewPoint=function(e,t,n){return this.coordinateToViewPoint(e,t,n)},n.viewPointToCoord=function(e,t){return this.viewPointToCoordinate(e,t)},n.coordToContainerPoint=function(e,t,n){return this.coordinateToContainerPoint(e,t,n)},n.containerPointToCoord=function(e,t){return this.containerPointToCoordinate(e,t)},n.containerPointToViewPoint=function(e,t){return t?t.set(e.x,e.y):t=e.copy(),t._sub(this.getViewPoint())},n.viewPointToContainerPoint=function(e,t){return t?t.set(e.x,e.y):t=e.copy(),t._add(this.getViewPoint())},n.checkSize=function(e){var t=t_()-this._initTime<1500&&0===this.width||0===this.height,n=this._getContainerDomSize(),i=this.height,r=this.width;if(!e&&n.width===r&&n.height===i)return this;dw(this._containerDOM);var a=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(n);else{var o=this._getVisualHeight(this.getPitch()),s=new ax(0,this.height-o),l=this._containerPointToPrj(s);this._updateMapSize(n);var u=this._getVisualHeight(this.getPitch()),c=new ax(0,this.height-u);this._setPrjCoordAtContainerPoint(l,c),this._mapViewCoord=this._getPrjCenter()}var h=0===n.width||0===n.height||0===r||0===i;return(t||h)&&(this._eventSilence=!0,this.setCenter(a),delete this._eventSilence),this._fireEvent("resize"),this},n.locate=function(e,t,n){return this.getProjection()._locate(new hS(e),t,n)},n.getMainPanel=function(){return this._getRenderer().getMainPanel()},n.getPanels=function(){return this._panels},n.remove=function(){var e=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var t=this.getLayers(),n=0;n<t.length;n++)t[n].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(e){return"maptalks-wrapper"===e.className})).forEach((function(t){return e._containerDOM.removeChild(t)})),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),Y_.removeDPRListening&&Y_.removeDPRListening(this),this},n.isRemoved=function(){return!this._containerDOM},n.isMoving=function(){return!!this._moving},n.onMoveStart=function(e){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var t=this._getPrjCenter();this._originCenter&&!this._verifyExtent(t)||(this._originCenter=t),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(e?e.domEvent:null,"movestart"))},n.onMoving=function(e){this._fireEvent("moving",this._parseEvent(e?e.domEvent:null,"moving"))},n.onMoveEnd=function(e){if(this._moving=!1,this._suppressRecenter||this._recenterOnTerrain(),this._trySetCursor("default"),this._fireEvent("moveend",e&&e.domEvent?this._parseEvent(e.domEvent,"moveend"):e),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var t=this._originCenter;this._panTo(t)}},n.onDragRotateStart=function(e){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(e?e.domEvent:null,"dragrotatestart"))},n.onDragRotating=function(e){this._fireEvent("dragrotating",this._parseEvent(e?e.domEvent:null,"dragrotating"))},n.onDragRotateEnd=function(e){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(e?e.domEvent:null,"dragrotateend"))},n.isDragRotating=function(){return!!this._dragRotating},n.isOffscreen=function(e,t){void 0===t&&(t=0);var n=this.width+t,i=this.height+t,r=e.xmin,a=e.ymin,o=e.xmax,s=e.ymax;return Array.isArray(e)&&(r=e[0],a=e[1],o=e[2],s=e[3]),o<t||r>=n||s<t||a>i},n.getRenderer=function(){return this._getRenderer()},n.getDevicePixelRatio=function(){return this.options.devicePixelRatio||Y_.devicePixelRatio||1},n.setDevicePixelRatio=function(e){return r_(e)&&e>0&&e!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=e,this.checkSize(!0)),this},n._initContainer=function(e){if(s_(e)){if(this._containerDOM=document.getElementById(e),!this._containerDOM)throw new Error("Invalid container when creating map: '"+e+"'")}else this._containerDOM=e,p_&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},n._trySetCursor=function(e){return this._cursor||this._priorityCursor||(e||(e="default"),this._setCursorToPanel(e)),this},n._setPriorityCursor=function(e){if(e)this._priorityCursor=e,this._setCursorToPanel(e);else{var t=!1;this._priorityCursor&&(t=!0),delete this._priorityCursor,t&&this.setCursor(this._cursor)}return this},n._setCursorToPanel=function(e){var t=this.getMainPanel();t&&t.style&&t.style.cursor!==e&&(t.style.cursor=e)},n._removeLayer=function(e,t){if(e&&t){var n=t.indexOf(e);n>-1&&t.splice(n,1)}},n._sortLayersByZIndex=function(){if(this._layers){for(var e=0,t=this._layers.length;e<t;e++)this._layers[e]._order=e,this._layers[e].sortLayersByZIndex&&this._layers[e].sortLayersByZIndex();this._layers.sort((function(e,t){var n=e.getZIndex()-t.getZIndex();return 0===n?e._order-t._order:n}))}},n._fireEvent=function(e,t){if(!this._eventSilence){"_"!==e[0]&&this.fire("_"+e,t),this.fire(e,t)}},n._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=t_()},n._initRenderer=function(){var e=this.options.renderer,n=t.getRendererClass(e);this._renderer=new n(this),this._renderer.load()},n._getRenderer=function(){return this._renderer},n._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(e){e&&e.load()}),this.getLayers())},n._getLayers=function(e){for(var t=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],i=0;i<t.length;i++)e&&!e.call(this,t[i])||n.push(t[i]);return n},n._eachLayer=function(e){if(!(arguments.length<2)){var t=Array.prototype.slice.call(arguments,1);t&&!Array.isArray(t)&&(t=[t]);for(var n=[],i=0,r=t.length;i<r;i++)n=n.concat(t[i]);for(var a=0,o=n.length;a<o;a++)e.call(e,n[a])}},n._onLayerEvent=function(e){e&&"idchange"===e.type&&(delete this._layerCache[e.old],this._layerCache[e.new]=e.target)},n._resetMapStatus=function(){var e=this.getMaxZoom(),t=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),i=this._spatialReference.getMinZoom();(i_(e)||-1===e||e>n)&&this.setMaxZoom(n),(i_(t)||-1===t||t<i)&&this.setMinZoom(i),(e=this.getMaxZoom())<(t=this.getMinZoom())&&this.setMaxZoom(t),(i_(this._zoomLevel)||this._zoomLevel>e)&&(this._zoomLevel=e),this._zoomLevel<t&&(this._zoomLevel=t),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var a=this._getRenderer();a&&a.resetContainer()},n._getContainerDomSize=function(){if(!this._containerDOM)return null;var e,t,n=this._containerDOM;if(this._containerDomContentRect)return e=this._containerDomContentRect.width,t=this._containerDomContentRect.height,new Tb(e,t);if(i_(n.width)||i_(n.height)){if(i_(n.clientWidth)||i_(n.clientHeight))throw new Error("can not get size of container");e=parseInt(n.clientWidth,0),t=parseInt(n.clientHeight,0)}else{e=n.width,t=n.height;var i=this.getDevicePixelRatio();1!==i&&n.layer&&(e/=i,t/=i)}return new Tb(e,t)},n._updateMapSize=function(e){return this.width=e.width,this.height=e.height,this._getRenderer().updateMapSize(e),this._calcMatrices(),this},n._getPrjCenter=function(){return this._prjCenter},n._setPrjCenter=function(e){this._prjCenter=e,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=e),this._calcMatrices()},n._setPrjCoordAtContainerPoint=function(e,t){if(!this.centerAltitude&&t.x===this.width/2&&t.y===this.height/2)return this;var n=this._containerPointToPoint(t)._sub(this._prjToPoint(this._getPrjCenter())),i=this._pointToPrj(this._prjToPoint(e).sub(n));return this._setPrjCenter(i),this},n._verifyExtent=function(e){if(!e)return!1;var t=this._prjMaxExtent;return!t||t.contains(e)},n._offsetCenterByPixel=function(e){var t=qT.set(this.width/2-e.x,this.height/2-e.y),n=this._containerPointToPrj(t,ZT),i=qT.set(this.width/2,this.height/2);this._setPrjCoordAtContainerPoint(n,i)},n.offsetPlatform=function(e){return e?(this._getRenderer().offsetPlatform(e),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(e),this):this._mapViewPoint},n.getViewPoint=function(){var e=this._getViewPointFrameOffset(),t=this.offsetPlatform();return e&&(t=t.add(e)),t},n._resetMapViewPoint=function(){this._mapViewPoint=new ax(0,0),this._mapViewCoord=this._getPrjCenter()},n._getResolution=function(e){return void 0!==e&&e!==this._zoomLevel||void 0===this._mapRes?(i_(e)&&(e=this._zoomLevel),this._spatialReference.getResolution(e)):this._mapRes},n._getResolutions=function(){return this._spatialReference.getResolutions()},n._prjToPoint=function(e,t,n){t=i_(t)?this.getZoom():t;var i=this._getResolution(t);return this._prjToPointAtRes(e,i,n)},n._prjToPointAtRes=function(e,t,n){return this._spatialReference.getTransformation().transform(e,t,n)},n._prjsToPointsAtRes=function(e,t,n){void 0===n&&(n=[]);for(var i=this._spatialReference.getTransformation(),r=[],a=0,o=e.length;a<o;a++){var s=i.transform(e[a],t,n[a]);r.push(s)}return r},n._pointToPrj=function(e,t,n){t=i_(t)?this.getZoom():t;var i=this._getResolution(t);return this._pointToPrjAtRes(e,i,n)},n._pointToPrjAtRes=function(e,t,n){return this._spatialReference.getTransformation().untransform(e,t,n)},n._pointToPoint=function(e,t,n){return i_(t)?(n?(n.x=e.x,n.y=e.y):n=e.copy(),n):this._pointAtResToPoint(e,this._getResolution(t),n)},n._pointAtResToPoint=function(e,t,n){return n?(n.x=e.x,n.y=e.y):n=e.copy(),n._multi(t/this._getResolution())},n._pointToPointAtRes=function(e,t,n){return n?(n.x=e.x,n.y=e.y):n=e.copy(),n._multi(this._getResolution()/t)},n._containerPointToPrj=function(e,t){return this._pointToPrj(this._containerPointToPoint(e,void 0,t),void 0,t)},n._callOnLoadHooks=function(){var e=t.prototype;if(e._onLoadHooks)for(var n=0,i=e._onLoadHooks.length;n<i;n++)e._onLoadHooks[n].call(this)},n._fixPrjOnWorldWide=function(e){var t=this.getProjection();if(t&&t.fullExtent&&e){var n=t.fullExtent||{},i=n.left,r=n.bottom,a=n.top,o=n.right;r_(i)&&(e.x=Math.max(i,e.x)),r_(o)&&(e.x=Math.min(o,e.x)),r_(r)&&(e.y=Math.max(r,e.y)),r_(a)&&(e.y=Math.min(a,e.y))}return this},t}(oS($w(ZS(tS))));QT.include({coordinateToPoint:function(e,t,n){var i=this._getResolution(t);return this.coordinateToPointAtRes(e,i,n)},coordinateToPointAtRes:function(){var e=new hS(0,0);return function(t,n,i){var r=this.getProjection().project(t,e);return this._prjToPointAtRes(r,n,i)}}(),pointToCoordinate:function(){var e=new hS(0,0);return function(t,n,i){var r=this._pointToPrj(t,n,e);return this.getProjection().unproject(r,i)}}(),pointAtResToCoordinate:function(){var e=new hS(0,0);return function(t,n,i){var r=this._pointToPrjAtRes(t,n,e);return this.getProjection().unproject(r,i)}}(),coordinateToViewPoint:function(){var e=new hS(0,0);return function(t,n,i){return this._prjToViewPoint(this.getProjection().project(t,e),n,i)}}(),viewPointToCoordinate:function(){var e=new hS(0,0);return function(t,n){return this.getProjection().unproject(this._viewPointToPrj(t,e),n)}}(),coordinateToContainerPoint:function(e,t,n){var i=this._getResolution(t);return this.coordinateToContainerPointAtRes(e,i,n)},coordinateToContainerPointAtRes:function(){var e=new hS(0,0);return function(t,n,i){var r=this.getProjection().project(t,e);return this._prjToContainerPointAtRes(r,n,i)}}(),coordinatesToContainerPoints:function(e,t){var n=this._getResolution(t);return this.coordinatesToContainerPointsAtRes(e,n)},coordinatesToContainerPointsAtRes:function(e,t){for(var n=[],i=this._spatialReference.getTransformation(),r=t/this._getResolution(),a=this.getProjection(),o=new hS(0,0),s=this.isTransforming(),l=this._prjToPoint(this._getPrjCenter(),void 0,ZT),u=0,c=e.length;u<c;u++){var h=a.project(e[u],o),f=i.transform(h,t);f=f._multi(r),this._toContainerPoint(f,s,e[u].z,l),n.push(f)}return n},containerPointToCoordinate:function(){var e=new hS(0,0);return function(t,n){var i=this._containerPointToPrj(t,e);return this.getProjection().unproject(i,n)}}(),containerToExtent:function(){var e=new ax(0,0),t=new ax(0,0);return function(n){var i=new ES(this._containerPointToPoint(n.getMin(e),void 0,e),this._containerPointToPoint(n.getMax(t),void 0,t));return this._pointToExtent(i)}}(),distanceToPixel:function(){var e=new ax(0,0),t=new ax(0,0);return function(n,i,r){var a=this.getProjection();if(!a)return null;var o=this.getScale()/this.getScale(r),s=this.getCenter(),l=a.locate(s,n,i),u=this.coordToContainerPoint(s,void 0,e),c=this.coordToContainerPoint(l,void 0,t);return c._sub(u)._multi(o)._abs(),new Tb(c.x,c.y)}}(),distanceToPoint:function(e,t,n,i){var r=this._getResolution(n);return this.distanceToPointAtRes(e,t,r,i)},distanceToPointAtRes:function(){var e=new ax(0,0),t=new hS(0,0);return function(n,i,r,a,o){var s=this.getProjection();if(!s)return null;var l=a||this.getCenter(),u=s.locate(l,n,i,t),c=this.coordToPointAtRes(l,r,e),h=this.coordToPointAtRes(u,r,o);return h._sub(c)._abs(),h}}(),altitudeToPoint:function(){var e=new hS(0,40),t=new ax(0,0);return function(n,i,r){void 0===n&&(n=0);var a=this.distanceToPointAtRes(n,n,i,r||e,t);n<0&&a.x>0&&(a.x=-a.x);var o=this.options.heightFactor;return o&&1!==o&&(a.x*=o,a.y*=o),a.x}}(),pointAtResToAltitude:function(){var e=new hS(0,40);return function(t,n,i){return void 0===t&&(t=0),this.pointAtResToDistance(t,0,n,i||e)}}(),pixelToDistance:function(){var e=new hS(0,0),t=new hS(0,0),n=new hS(0,0),i=new hS(0,0);return function(r,a){var o=this.getProjection();if(!o)return null;var s=this.getFullExtent(),l=s.top>s.bottom?-1:1,u=e.set(this.width/2,this.height/2),c=t.set(this.width/2+r,this.height/2+l*a),h=this.containerPointToCoord(u,n),f=this.containerPointToCoord(c,i);return o.measureLength(h,f)}}(),pointToDistance:function(e,t,n){var i=this.getResolution(n);return this.pointAtResToDistance(e,t,i)},pointAtResToDistance:function(){var e=new ax(0,0),t=new hS(0,0),n=new hS(0,0),i=new hS(0,0);return function(r,a,o,s){var l=this.getProjection();if(!l)return null;var u=s?l.project(s,t):this._getPrjCenter(),c=this._prjToPointAtRes(u,o,e);c._add(r,a);var h=this.pointAtResToCoord(c,o,n),f=s||l.unproject(u,i);return l.measureLength(f,h)}}(),locateByPoint:function(){var e=new ax(0,0);return function(t,n,i){var r=this.coordToContainerPoint(t,void 0,e);return this.containerPointToCoord(r._add(n,i))}}(),_get2DExtent:function(e,t){var n;if(void 0!==e&&e!==this._zoomLevel||!this._mapExtent2D||(n=this._mapExtent2D),n)return t?(t.set(n.xmin,n.ymin,n.xmax,n.ymax),t):n.copy();var i=this._getResolution(e);return this._get2DExtentAtRes(i,t)},_get2DExtentAtRes:function(){var e=new ax(0,0);return function(t,n){var i=this;return t===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo((function(n){return i._containerPointToPointAtRes(n,t,e)}),n)}}(),_pointToExtent:function(){var e=new hS(0,0),t=new hS(0,0);return function(n){var i=n.getMin(),r=n.getMax(),a=this.getFullExtent(),o=!a||a.left<=a.right?[i.x,r.x]:[r.x,i.x],s=o[0],l=o[1],u=!a||a.top>a.bottom?[r.y,i.y]:[i.y,r.y],c=u[0],h=u[1],f=i.set(s,h),d=r.set(l,c);return new TS(this.pointToCoord(f,void 0,e),this.pointToCoord(d,void 0,t),this.getProjection())}}(),_getViewPointFrameOffset:function(){var e=new ax(0,0);return function(){if(this.isZooming())return null;var t=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(t)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(t,void 0,e)):null}}(),_viewPointToPrj:function(){var e=new ax(0,0);return function(t,n){return this._containerPointToPrj(this.viewPointToContainerPoint(t,e),n)}}(),_prjToContainerPoint:function(e,t,n,i){var r=this._getResolution(t);return this._prjToContainerPointAtRes(e,r,n,i)},_prjToContainerPointAtRes:function(){var e=new ax(0,0);return function(t,n,i,r){return this._pointAtResToContainerPoint(this._prjToPointAtRes(t,n,e),n,r||0,i)}}(),_prjToViewPoint:function(){var e=new ax(0,0);return function(t,n,i){var r=this._prjToContainerPoint(t,void 0,e,i);return this.containerPointToViewPoint(r,n)}}(),_viewPointToPoint:function(){var e=new ax(0,0);return function(t,n,i){return this._containerPointToPoint(this.viewPointToContainerPoint(t,e),n,i)}}(),_pointToViewPoint:function(){var e=new hS(0,0);return function(t,n,i){return this._prjToViewPoint(this._pointToPrj(t,n,e),i)}}()}),QT.mergeOptions(JT);var KT=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},n.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},n._onDoubleClick=function(e){var t=this.target;if(t.options.doubleClickZoom){var n=t.getZoom(),i=e.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;t._zoomAnimation(i,e.containerPoint)}},t}(eS);QT.mergeOptions({doubleClickZoom:!0}),QT.addOnLoadHook("addHandler","doubleClickZoom",KT);var $T=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){var e=this.target;if(e){var t=e._panels.mapWrapper||e._containerDOM;this._dragHandler=new cS(t,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},n.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},n._cancelOn=function(e){return!(!this.target.isZooming()&&!this._ignore(e))},n._ignore=function(e){return!!e&&(e.domEvent&&(e=e.domEvent),this.target._ignoreEvent(e))},n._onMouseDown=function(e){delete this.startDragTime,delete this._mode;var t=this.target.options.switchDragButton,n=t?0:2,i="touchstart"===e.domEvent.type;t&&i||e.domEvent.button===n||e.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),uw(e.domEvent)},n._onDragStart=function(e){this.startDragTime=t_(),"move"===this._mode?this._moveStart(e):"rotatePitch"===this._mode&&this._rotateStart(e)},n._onDragging=function(e){this.target._isEventOutMap(e.domEvent)||("move"===this._mode?this._moving(e):"rotatePitch"===this._mode&&this._rotating(e))},n._onDragEnd=function(e){"move"===this._mode?this._moveEnd(e):"rotatePitch"===this._mode&&this._rotateEnd(e),delete this.startDragTime,delete this.startBearing},n._start=function(e){this.preX=e.mousePos.x,this.preY=e.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},n._moveStart=function(e){this._start(e);var t=this.target;t.onMoveStart(e);var n=pw(t._getActualEvent(e.domEvent),t.getContainer());this.startPrjCoord=t._containerPointToPrj(n)},n._moving=function(e){if(this.startDragTime){var t=this.target,n=pw(t._getActualEvent(e.domEvent),t.getContainer());t._setPrjCoordAtContainerPoint(this.startPrjCoord,n),t.onMoving(e)}},n._moveEnd=function(e){if(this.startDragTime){var t="touchend"===e.domEvent.type,n=this.target,i=t_()-this.startDragTime,r=e.mousePos.x,a=e.mousePos.y,o=r-this.startX,s=a-this.startY,l=n._getPrjCenter(),u=l.sub(this._startPrjCenter);if(this._clear(),n.options.panAnimation&&!e.interupted&&n._verifyExtent(n._getPrjCenter())&&i<280&&Math.abs(s)+Math.abs(o)>5){i*=5;var c=t?5:2.8,h=l.add(u._multi(c));n._panTo(h,{duration:t?3*i:2*i,easing:"outExpo"})}else n.onMoveEnd(e)}},n._rotateStart=function(e){this._start(e),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(e),this._db=0},n._rotating=function(e){var t=this.target,n=e.mousePos.x,i=e.mousePos.y,r=t.getPitch(),a=t.getBearing(),o=Math.abs(n-this.preX),s=Math.abs(i-this.preY);if(this._rotateMode||(t.options.dragRotatePitch?this._rotateMode="rotate_pitch":this._rotateMode=o>s?"rotate":o<s?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&s<10)){if(this._rotateMode.indexOf("rotate")>=0&&t.options.dragRotate){var l=.15,u=0;u=t.options.dragPitch||o>s?-.15*(this.preX-n):n>t.width/2?l*(this.preY-i):-.15*(this.preY-i);var c=t.getBearing()+u;this._db=this._db||0,this._db+=u,t._setBearing(c)}this._rotateMode.indexOf("pitch")>=0&&t.options.dragPitch&&t._setPitch(t.getPitch()+.15*(this.preY-i)),this.preX=n,this.preY=i,t.getBearing()===a&&t.getPitch()===r||t.onDragRotating(e)}},n._rotateEnd=function(e){var t=this.target,n=t.getBearing();this._clear();var i=t_()-this.startDragTime;if(t.onDragRotateEnd(e),t.options.rotateAnimation&&Math.abs(n-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!e.interupted&&i<400){var r=t.getBearing();t._animateTo({bearing:r+this._db/1.5},{easing:"outQuint",duration:1600})}},n._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},t}(eS);QT.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),QT.addOnLoadHook("addHandler","draggable",$T);var eE="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend mouseout",tE={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},nE=function(e){return e&&e.getLayer&&e.on&&e.fire},iE=function(e){return e._getInternalId?e._getInternalId():e.getId?e.getId():null},rE=function(e,t,n){if(e._onEvent)return e._onEvent(t,n);var i=e.getLayer();return i&&i.fireGeoEvent?i.fireGeoEvent(e,t,n):null},aE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){var e=this.target,t=e._panels.allLayers||e._containerDOM;Mw(t,eE,this._identifyGeometryEvents,this)},n.removeHooks=function(){var e=this.target,t=e._panels.allLayers||e._containerDOM;Tw(t,eE,this._identifyGeometryEvents,this)},n._identifyGeometryEvents=function(e,t){var n=this.target;if(!n.isInteracting()&&!n._ignoreEvent(e)){var i=null,r=t||e.type,a="mousedown"===r||"touchstart"===r&&e.touches&&1===e.touches.length;if(a)this._mouseDownTime=t_();else if(("click"===r||"touchend"===r)&&this._mouseDownTime){var o=this._mouseDownTime;if(delete this._mouseDownTime,t_()-o>300){if("click"===r)return}else"touchend"===r&&(i="click")}var s=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(s){var l=pw(s,n._containerDOM);"touchstart"===r&&n.options.preventTouch&&uw(e);for(var u=null,c=this.target.getRenderer().getTopElements(),h=a&&2!==e.button,f=0;f<c.length;f++)if(c[f].hitTest(l)){var d=c[f].options.cursor;if(d&&(u=d),h||c[f].events&&c[f].events.indexOf(r)>=0){var p={target:n,type:r,domEvent:e,containerPoint:l};if(h)return n._setPriorityCursor(u),void c[f].mousedown(p);c[f].onEvent(p)}}var m=n._getLayers((function(e){return!(!e.identify||!e.options.geometryEvents)}));if(n._setPriorityCursor(u),m.length){var v=tE[r]||[r],g={includeInternals:!0,filter:function(t){if(t instanceof UT){var n=t._getEventTypeToFire(e);if("mousemove"===r){if(!u&&t.options.cursor&&(u=t.options.cursor),!t.listens("mousemove")&&!t.listens("mouseover")&&!t.listens("mouseenter"))return!1}else if(!t.listens(n)&&!t.listens(i))return!1;return!0}return!!nE(t)},count:1,onlyVisible:n.options.onlyVisibleGeometryEvents,containerPoint:l,layers:m,eventTypes:v,domEvent:e},y=function(t){var a=this,o=!0,s=function(){return a._prevOverGeos&&a._prevOverGeos.geos||[]},l=function(t,n){if(void 0===t&&(t=[]),void 0===n&&(n={}),t&&t.length>0)for(var i=t.length-1;i>=0;i--){var r=t[i];if(nE(r))n[iE(t[i])]||(o=rE(r,e,"mouseout"))}};if("mouseout"===r){var c=s();this._prevOverGeos={geos:[],geomap:{}},l(c,{})}else if("mousemove"===r){var h={};if(t.length>0)for(var f=t.length-1;f>=0;f--){var d=t[f];if(nE(d)){var p=iE(d);h[p]=d,rE(d,e),this._prevOverGeos&&this._prevOverGeos.geomap[p]||rE(d,e,"mouseenter"),o=rE(d,e,"mouseover")}}n._setPriorityCursor(u);var m=s();this._prevOverGeos={geos:t,geomap:h},l(m,h)}else{if(!t||!t.length)return;for(var v=t.length-1;v>=0;v--)if(nE(t[v])){o=rE(t[v],e),i&&rE(t[v],e,i);break}}!1===o&&cw(e)}.bind(this);Ew(r)?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame((function(){n.isInteracting()||n.identifyAtPoint(g,y)})):n.identifyAtPoint(g,y)}}}},t}(eS);QT.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),QT.addOnLoadHook("addHandler","geometryEvents",aE);var oE=4.000244140625,sE=function(e){function t(t){var n;return(n=e.call(this,t)||this)._thisScrollZoom=n._scrollZoom.bind(ex(ex(n))),n._wheelZoomRate=.0022222222222222222,n._defaultZoomRate=.01,n._delta=0,n}K_(t,e);var n=t.prototype;return n.addHooks=function(){ow(this.target._containerDOM,"wheel",this._onWheelScroll,this)},n.removeHooks=function(){sw(this.target._containerDOM,"wheel",this._onWheelScroll)},n._onWheelScroll=function(e){var t=this.target;if(t.options.preventWheelScroll&&(uw(e),cw(e)),t._ignoreEvent(e)||!t.options.zoomable)return!1;var n=t._containerDOM,i=t._checkZoomOrigin(pw(e,n));return t.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(e,i)):this._interval(e,i)},n._seamless=function(e,t){var n=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*e.deltaY:e.deltaY;if(n%oE!==0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),e.shiftKey&&n&&(n/=4),this._lastWheelEvent=e,this._delta-=n,!this._zooming&&this._delta){var i=this.target;this._zoomOrigin=t,i.onZoomStart(null,t)}this._start()},n._start=function(){if(this._delta){this._zooming=!0;var e=this.target;this._active||(e.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},n._scrollZoom=function(){var e=this;if(this._active=!1,this._delta){var t=Math.abs(this._delta)>oE?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);var i=this.target,r=i.getZoom(),a=i.getZoomForScale(n,r,!0);this._delta=0,i.onZooming(a,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((function(){e._zooming=!1,delete e._timeout,i.onZoomEnd(i.getZoom(),e._zoomOrigin)}),210)}},n._interval=function(e,t){var n=this,i=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(e.deltaY?-1*e.deltaY:e.wheelDelta?e.wheelDelta:e.detail)>0?1:-1;e.detail&&(r*=-1);var a=i.getZoom(),o=a+r;if((o=i._checkZoom(r>0?Math.ceil(o):Math.floor(o)))===a)return!1;this._zooming=!0,this._delta||(i.onZoomStart(null,t),this._origin=t,this._delta=r,this._startZoom=i.getZoom());return i._animateTo({zoom:o-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(t){"finished"===t.state.playState?n._requesting<1||Math.abs(o-n._startZoom)>2||o===i.getMaxZoom()||o===i.getMinZoom()?(i._animateTo({zoom:o,around:n._origin},{continueOnViewChanged:!0,duration:100},(function(e){"running"!==e.state.playState&&(delete n._zooming,delete n._requesting)})),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):i_(n._requesting)||(delete n._zooming,n._onWheelScroll(e)):"running"!==t.state.playState&&(delete n._zooming,delete n._requesting)})),!1},t}(eS);QT.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),QT.addOnLoadHook("addHandler","scrollWheelZoom",sE);var lE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){ow(this.target.getContainer(),"touchstart",this._onTouchStart,this)},n.removeHooks=function(){sw(this.target.getContainer(),"touchstart",this._onTouchStart)},n._onTouchStart=function(e){var t=this.target;if(e.touches&&!(e.touches.length<2)){var n=t.getContainer(),i=pw(e.touches[0],n),r=pw(e.touches[1],n);this.preY=i.y,this._startP1=i,this._startP2=r,this._startDist=i.distanceTo(r),this._startVector=i.sub(r),this._startZoom=t.getZoom(),this._startBearing=t.getBearing(),Tw(document,"touchmove",this._onTouchMove,this),Tw(document,"touchend",this._onTouchEnd,this),ow(document,"touchmove",this._onTouchMove,this),ow(document,"touchend",this._onTouchEnd,this),t.options.preventTouch&&uw(e),t._fireEvent("touchactstart")}},n._onTouchMove=function(e){var t=this.target;if(e.touches&&!(e.touches.length<2)){var n=t.getContainer(),i=pw(e.touches[0],n),r=pw(e.touches[1],n),a=i.sub(this._startP1),o=r.sub(this._startP2),s=i.sub(r),l=i.distanceTo(r)/this._startDist,u=180*s.angleWith(this._startVector)/Math.PI,c=.4*((this.preY||i.y)-i.y);this.preY=i.y;var h={domEvent:e,mousePos:[i,r]};if(this.mode||(t.options.touchRotate&&Math.abs(u)>8?this.mode=t.options.touchZoomRotate?"rotate_zoom":"rotate":t.options.touchPitch&&a.y*o.y>0&&Math.abs(a.y)>10&&Math.abs(o.y)>10?this.mode="pitch":t.options.zoomable&&t.options.touchZoom&&Math.abs(1-l)>.15&&(this.mode=t.options.touchZoomRotate&&t.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(h)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=l;var f=t._getResolution(this._startZoom)/l,d=t.getZoomFromRes(f);t.onZooming(d,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(t._setBearing(this._startBearing+u),t.onDragRotating(h)):"pitch"===this.mode&&(t._setPitch(t.getPitch()+c),t.onDragRotating(h)),t._fireEvent("touchactinging")}},n._startTouching=function(e){var t=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var n=t.getSize();this._Origin=new ax(n.width/2,n.height/2),t.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||t.onDragRotateStart(e)},n._onTouchEnd=function(e){delete this.preY;var t=this.target;if(Tw(document,"touchmove",this._onTouchMove,this),Tw(document,"touchend",this._onTouchEnd,this),"zoom"===this.mode||"rotate_zoom"===this.mode){var n=this._scale,i=t._getResolution(this._startZoom)/n,r=t.getZoomFromRes(i);t.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||t.onDragRotateEnd({domEvent:e}),delete this.mode,t._fireEvent("touchactend")},t}(eS);QT.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),QT.addOnLoadHook("addHandler","touchGesture",lE);var uE="__anim_player",cE={outExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},outQuint:function(e){return 1-Math.pow(1-e,5)},in:function(e){return Math.pow(e,2)},out:function(e){return 1-cE.in(1-e)},inAndOut:function(e){return 3*e*e-2*e*e*e},linear:function(e){return e},upAndDown:function(e){return e<.5?cE.inAndOut(2*e):1-cE.inAndOut(2*(e-.5))}},hE=function(){function e(e,t){this.state=e,this.styles=t}var t,n,i;return t=e,(n=[{key:"playState",get:function(){return this.state.playState}},{key:"symbol",get:function(){return this.styles.symbol}}])&&J_(t.prototype,n),i&&J_(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),fE=function(e,t,n,i){this._animation=e,this.options=t,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1,this.target=i},dE={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(e){if(!e)return null;function t(e){if(!Array.isArray(e))return dE._resolveStyles(e);for(var t=[],n=[],i=[],r=0;r<e.length;r++){var a=dE._resolveStyles(e[r]);a&&(t.push(a[0]),n.push(a[1]),i.push(a[2]))}return t.length?[t,n,i]:null}function n(e){var t,n=e;Array.isArray(e)||(n=r_(e)?[0,e]:e instanceof ax||e instanceof hS?[new(t=e.constructor)(0,0),e]:[e,e]);var i=n[0],r=n[1];return r_(i)&&r_(r)?i===r?null:[i,r-i,r]:Array.isArray(i)&&r_(i[0])||i instanceof hS||i instanceof ax?(Array.isArray(i)?(i=new hS(i),r=new hS(r)):(i=new(t=i.constructor)(i),r=new t(r)),i.equals(r)?null:[i,r.sub(i),r]):[i,r,r]}var i,r={},a={},o={};for(var s in e)if(e.hasOwnProperty(s)){var l=e[s];if(!l)continue;if(Array.isArray(l)&&(i_(l[0])||i_(l[1])))continue;var u=void 0;i=l,(u=!Array.isArray(i)&&i.constructor===Object||Array.isArray(i)&&i[0].constructor===Object?t(l):n(l))&&(a[s]=u[0],r[s]=u[1],o[s]=u[2])}return[a,r,o]},framing:function(e,t){t||(t={});var n,i,r,a=t.easing?cE[t.easing]:cE.linear;a||(a=cE.linear),(e=dE._resolveStyles(e))&&(i=e[0],n=e[1],r=e[2]);var o=function e(t,n,i){if(!n||!i)return null;var a={};for(var o in i)if(i.hasOwnProperty(o)){if(n[o]===r[o]){a[o]=n[o];continue}var s=n[o],l=i[o];if(r_(l))a[o]=s+t*l;else if(Array.isArray(l)){for(var u=[],c=0;c<l.length;c++)u.push(e(t,s[c],l[c]));a[o]=u}else{var h=l.constructor;a[o]=h===Object?e(t,s,l):s instanceof ax||s instanceof hS?s.add(l.multi(t)):l}}return a};return function(e,t){var s,l;if(e<0)s={playState:"idle",delta:0},l=i;else if(e<t){var u=a(e/t);s={playState:"running",delta:u},l=o(u,i,n)}else s={playState:"finished",delta:1},l=r;return s.startStyles=i,s.destStyles=r,s.progress=e,s.remainingMs=t-e,new hE(s,l)}},_requestAnimFrame:function(e){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(e),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=nx(dE._frameFn))},_run:function(){if(this._frameQueue.length){var e=this._frameQueue;this._frameQueue=[];for(var t=0,n=e.length;t<n;t++)e[t]();this._frameQueue.length?this._animationFrameId=nx(dE._frameFn):delete this._animationFrameId}},animate:function(e,t,n,i){t||(t={});var r=dE.framing(e,t);return new fE(r,t,n,i)}};dE._frameFn=dE._run.bind(dE),n_(fE.prototype,{_prepare:function(){var e=this.options,t=e.speed||e.duration;s_(t)&&((t=dE.speed[t])||(t=+t)),t||(t=dE.speed.normal),this.duration=t,this._framer=e.framer||dE._requestAnimFrame.bind(dE)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[uE])return this;this.target&&(this.target[uE]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var e=t_();if(!this.startTime){var t=this.options;this.startTime=t.startTime?t.startTime:e}return this._playStartTime=Math.max(e,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},cancel:function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},finish:function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},reverse:function(){},_run:function(){var e=this,t=this._onFrame,n=t_(),i=n-this._playStartTime;if(this.options.repeat&&i>=this.duration&&(this._playStartTime=n,i=0),"running"===this.playState){var r=this._animation(i,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[uE],"idle"===this.playState?this.startTime>n&&setTimeout(this._run.bind(this),this.startTime-n):"running"===this.playState?this._framer((function(){"running"===e.playState&&(e.currentTime=i,t&&t(r),e._run())})):"finished"===this.playState&&(this.finished=!0,t&&t(r))}else if(this.target&&delete this.target[uE],t){"finished"===this.playState?i=this.duration:"idle"===this.playState&&(i=0);var a=this._animation(i,this.duration);a.state.playState=this.playState,t(a)}}});dE.animate;var pE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.animateShow=function(e,t){var n=this;void 0===e&&(e={}),this._showPlayer&&this._showPlayer.finish(),l_(e)&&(t=e={});var i=this.getCoordinates();if(0===i.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var r=!!this.getShell?this.getShell().concat(this.getShell()[0]):i,a=this._getProjection(),o=a.projectCoords(r,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=a.unproject(this._prjAniShowCenter);var s=e.duration||1e3,l=e.easing||"out";this.setCoordinates([]);var u=0;o.length&&(o[0]._distance=0);for(var c=1;c<o.length;c++){var h=o[c].distanceTo(o[c-1]);o[c]._distance=h,u+=h}this._tempCoord=new hS(0,0),this._tempPrjCoord=new ax(0,0);var f=this._showPlayer=dE.animate({t:s},{duration:s,easing:l},(function(e){if(n.getMap()){var a=n._drawAnimShowFrame(e.styles.t,s,u,r,o);"finished"===e.state.playState&&(delete n._showPlayer,delete n._aniShowCenter,delete n._prjAniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,delete n._tempCoord,delete n._tempPrjCoord,n.setCoordinates(i)),t&&t(e,a)}else if("finished"!==f.playState&&(f.finish(),t)){var l=n.getCoordinates();t(e,l[l.length-1])}}),this);return f.play(),f},n._drawAnimShowFrame=function(e,t,n,i,r){if(0===e)return i[0];var a,o,s=e/t*n,l=0;for(a=this._animIdx+1,o=r.length;a<o&&(l=r[a]._distance,!(this._animLenSoFar+l>s));a++)this._animLenSoFar+=l;if(this._animIdx=a-1,this._animIdx>=o-1)return this.setCoordinates(i),i[i.length-1];var u=this._animIdx,c=r[u],h=r[u+1],f=(s-this._animLenSoFar)/l;this._animTailRatio=f;var d=c.x+(h.x-c.x)*f,p=c.y+(h.y-c.y)*f;this._tempPrjCoord.x=d,this._tempPrjCoord.y=p;var m=this._tempPrjCoord,v=i[u],g=i[u+1],y=v.x+(g.x-v.x)*f,_=v.y+(g.y-v.y)*f;this._tempCoord.x=y,this._tempCoord.y=_;var x=this._tempCoord,b=!!this.getShell;if(!b&&this.options.smoothness>0){for(var w=[],S=[],M=0;M<=this._animIdx;M++)w.push(i[M]),S.push(r[M]);w.push(x,x),S.push(m,m),this.setCoordinates(w),this._setPrjCoordinates(S)}else{var T=i.slice(0,this._animIdx+1);T.push(x);var E=r.slice(0,this._animIdx+1);E.push(m),b?(this.setCoordinates([this._aniShowCenter].concat(T)),this._setPrjCoordinates([this._prjAniShowCenter].concat(E))):(this.setCoordinates(T),this._setPrjCoordinates(E))}return x},n._getCenterInExtent=function(e,t,n){var i=this.getExtent();if(!e.intersects(i))return null;var r=n(t,e);if(0===r.length)return null;var a=0,o=0,s=0;r.forEach((function(e){Array.isArray(e)?e.forEach((function(e){e.point&&(e=e.point),a+=e.x,o+=e.y,s++})):(e.point&&(e=e.point),a+=e.x,o+=e.y,s++)}));var l=new hS(a,o)._multi(1/s);return l.count=s,l},n._getPath2DPoints=function(e,t,n){if(!_x(e))return[];var i=this.getMap(),r=!t&&this._shouldSimplify(),a=this.options.simplifyTolerance*i._getResolution(),o=Array.isArray(e[0]);if(delete this._simplified,r&&!o){var s=e.length;e=Uy()(e,a,!1),this._simplified=e.length<s}if(n||(n=i._getResolution()),Array.isArray(e)){var l=[],u="_glPt";if(!Array.isArray(e[0]))return l=Lx(e,u),i._prjsToPointsAtRes(e,n,l);for(var c=[],h=0,f=e.length;h<f;h++){var d=e[h];l=Lx(d,u);var p=i._prjsToPointsAtRes(d,n,l);c.push(p)}return c}return i._prjToPointAtRes(e,n)},n._shouldSimplify=function(){var e=this.getLayer(),t=e.options.enableAltitude;return e&&e.options.enableSimplify&&!t&&this.options.enableSimplify&&!this._showPlayer},n._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},n._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},n._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},n._clearProjection=function(){this._prjCoords=null,e.prototype._clearProjection.call(this)},n._projectCoords=function(e){var t=this._getProjection();return t?t.projectCoords(e,this.options.antiMeridian):[]},n._unprojectCoords=function(e){var t=this._getProjection();return t?t.unprojectCoords(e):[]},n._computeCenter=function(){var e=this._coordinates;if(!_x(e))return null;for(var t=0,n=0,i=0,r=e.length,a=0;a<r;a++)e[a]&&r_(e[a].x)&&r_(e[a].y)&&(t+=e[a].x,n+=e[a].y,i++);return new hS(t/i,n/i)},n._computeExtent=function(){var e=this._coordinates;if(!_x(e))return null;var t=[e];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this.getHoles()),this._coords2Extent(t,this._getProjection())},n._computePrjExtent=function(){var e=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this._getPrjHoles()),this._coords2Extent(e)},n._get2DLength=function(){for(var e=this._getPath2DPoints(this._getPrjCoordinates(),!0),t=0,n=1,i=e.length;n<i;n++)t+=e[n].distanceTo(e[n-1]);return t},n._hitTestTolerance=function(){var t,n=this._getInternalSymbol();if(Array.isArray(n)){t=0;for(var i=0;i<n.length;i++)r_(n[i].lineWidth)&&n[i].lineWidth>t&&(t=n[i].lineWidth)}else t=n.lineWidth;return e.prototype._hitTestTolerance.call(this)+(r_(t)?t/2:1.5)},n._coords2Extent=function(e,t){if(!e||0===e.length||Array.isArray(e[0])&&0===e[0].length)return null;for(var n=new TS(t),i=0,r=e.length;i<r;i++)for(var a=0,o=e[i].length;a<o;a++)n._combine(e[i][a]);return n},t}(UT);pE.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var mE="Polygon",vE=function(e){function t(t,n){var i;return(i=e.call(this,n)||this).type="Polygon",t&&i.setCoordinates(t),i}K_(t,e);var n=t.prototype;return n.getOutline=function(){return this._getPainter()?new t(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},n.setCoordinates=function(e){if(!e)return this._coordinates=null,this._holes=null,this._projectRings(),this;var t=hS.toCoordinates(e),n=t.length;if(Array.isArray(t[0]))if(this._coordinates=this._trimRing(t[0]),n>1){for(var i=[],r=1;r<n;r++)t[r]&&i.push(this._trimRing(t[r]));this._holes=i}else this._holes=null;else this._coordinates=this._trimRing(t);return this._projectRings(),this},n.getCoordinates=function(){if(!this._coordinates)return[];for(var e=this.getHoles(),t=[this._copyAndCloseRing(this._coordinates)],n=0,i=e.length;n<i;n++)t.push(this._copyAndCloseRing(e[n]));return t},n.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getShell(),WM)},n.getShell=function(){return this._coordinates||[]},n.getHoles=function(){return this._holes||[]},n.hasHoles=function(){return this.getHoles().length>0},n._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},n._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},n._cleanRing=function(e){for(var t=e.length-1;t>=0;t--)e[t]||e.splice(t,1)},n._checkRing=function(e){if(this._cleanRing(e),!e||!_x(e))return!1;var t=e[e.length-1],n=!0;return e[0].x===t.x&&e[0].y===t.y||(n=!1),n},n._trimRing=function(e){var t=this._checkRing(e);return _x(e)&&t&&e.splice(e.length-1,1),e},n._copyAndCloseRing=function(e){e=e.slice(0);var t=this._checkRing(e);return _x(e)&&!t?(e.push(e[0].copy()),e):e},n._getPrjShell=function(){return this.getJSONType()===mE?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},n._getPrjHoles=function(){var e=this._getProjection();return this._verifyProjection(),e&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},n._computeGeodesicLength=function(e){var t=this.getCoordinates();if(!_x(t))return 0;for(var n=0,i=0,r=t.length;i<r;i++)n+=e.measureLength(t[i]);return n},n._computeGeodesicArea=function(e){var t=this.getCoordinates();if(!_x(t))return 0;for(var n=e.measureArea(t[0]),i=1,r=t.length;i<r;i++)n-=e.measureArea(t[i]);return n},n._updateCache=function(){e.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},n._clearCache=function(){return delete this._prjShell,e.prototype._clearCache.call(this)},n._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),e.prototype._clearProjection.call(this)},t}(pE);function gE(e){return function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(e){var t=e instanceof hS?e:new hS(e);if(this._coordinates=t,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},n._getCenter2DPoint=function(e){var t=this.getMap();if(!t)return null;var n=this._getPrjCoordinates();return n?(e||(e=t._getResolution()),t._prjToPointAtRes(n,e)):null},n._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pcenter&&e&&this._coordinates&&(this._pcenter=e.project(this._coordinates)),this._pcenter},n._setPrjCoordinates=function(e){this._pcenter=e,this.onPositionChanged()},n._updateCache=function(){this._clearCache();var e=this._getProjection();this._pcenter&&e&&(this._coordinates=e.unproject(this._pcenter))},n._clearProjection=function(){this._pcenter=null,e.prototype._clearProjection.call(this)},n._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},t}(e)}vE.registerJSONType(mE);var yE=new ES,_E=function(e){function t(t,n){var i;return(i=e.call(this,n)||this).type="Point",t&&i.setCoordinates(t),i}K_(t,e);var n=t.prototype;return n.getOutline=function(){var e=this.getCoordinates(),n=this.getContainerExtent(),i=this.getMap().coordToContainerPoint(e);return new t(e,{symbol:{markerType:"square",markerWidth:n.getWidth(),markerHeight:n.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:n.xmin-(i.x-n.getWidth()/2),markerDy:n.ymin-(i.y-n.getHeight()/2)}})},n.setSymbol=function(){var t;delete this._fixedExtent;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.prototype.setSymbol).call.apply(t,[this].concat(i))},n._getSizeSymbol=function(e){for(var t,n={},i=!1,r=!1,a=0;a<HM.length;a++){var o=e[HM[a]];i_(o)||(!i&&Qx(o)&&(i=!0,r=!0),n[HM[a]]=o)}for(var s=0;s<jM.length;s++){var l=e[jM[s]];i_(l)||(!i&&Qx(l)&&(i=!0),n[jM[s]]=l)}return i?(t=_b(n,this),r&&(t._dynamic=!0)):t=n,t},n._setExternSymbol=function(t){return this._symbol||delete this._fixedExtent,e.prototype._setExternSymbol.call(this,t)},n._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},n._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new ES,this._fixedExtent.set(null,null,null,null);var e=this._sizeSymbol;if(!e)return this._fixedExtent;var t=this.getLayer()&&this.getLayer().getRenderer(),n=t&&t.resources,i=this.getTextDesc();if(Array.isArray(e)){yE.set(1/0,1/0,-1/0,-1/0);for(var r=0;r<e.length;r++)e[r]&&this._fixedExtent._combine(DM(yE,e[r],n,i&&i[r]))}else this._fixedExtent=DM(this._fixedExtent,e,n,i);return this._fixedExtent},n._isVectorMarker=function(){var e=this._getInternalSymbol();return!Array.isArray(e)&&UM(e)},n._canEdit=function(){var e=this._getInternalSymbol();return!Array.isArray(e)&&(UM(e)||FM(e)||zM(e))},n._containsPoint=function(t,n){var i=this.getContainerExtent();return n&&(i=i.expand(n)),!!i.contains(t)&&(!this.options.hitTestForEvent||e.prototype._containsPoint.call(this,t,n))},n._computeExtent=function(){return xE.call(this,"getCenter")},n._computePrjExtent=function(){return xE.call(this,"_getPrjCoordinates")},n._computeGeodesicLength=function(){return 0},n._computeGeodesicArea=function(){return 0},n._getSprite=function(e,t){return this._getPainter()?this._getPainter().getSprite(e,t):new PT(this).getSprite(e,t)},t}(gE(UT));function xE(e){var t=this[e]();return t?new TS(t,t,this._getProjection()):null}_E.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1,collision:!0}),_E.registerJSONType("Marker");var bE=function(e){function t(t,n){var i;return(i=e.call(this,n)||this).type="LineString",t&&i.setCoordinates(t),i}K_(t,e);var n=t.prototype;return n.getOutline=function(){return vE.prototype.getOutline.call(this)},n.setCoordinates=function(e){return e?(this._coordinates=hS.toCoordinates(e),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},n.getCoordinates=function(){return this._coordinates||[]},n.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getCoordinates(),GM)},n._computeGeodesicLength=function(e){return e.measureLength(this.getCoordinates())},n._computeGeodesicArea=function(){return 0},t}(pE);bE.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),bE.registerJSONType("LineString");var wE=new ES,SE=function(e){function t(t,n){var i;return(i=e.call(this,n)||this).type="GeometryCollection",i.setGeometries(t),i}K_(t,e);var n=t.prototype;return n.getContainerExtent=function(e){var t=e||new ES;return this.forEach((function(e){t._combine(e.getContainerExtent(wE))})),t},n.setGeometries=function(e){for(var t=this._checkGeometries(e||[]),n=this._getSymbol(),i=this.config(),r=this.getProperties(),a=t.length-1;a>=0;a--)t[a]._initOptions(i),t[a]._setParent(this),t[a]._setEventParent(this),n&&t[a].setSymbol(n),r&&t[a].setProperties(r);return this._geometries=t,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},n.getGeometries=function(){return this._geometries||[]},n.forEach=function(e,t){for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i]&&(t?e.call(t,n[i],i):e(n[i],i));return this},n.filter=function(e,n){if(!e)return new t;var i=[],r=l_(e),a=r?e:rb(e);return this.forEach((function(e){var t=r?e:pb(e);(n?a.call(n,t):a(t))&&i.push(e)}),this),new t(i)},n.translate=function(e){if(!e)return this;if(this.isEmpty())return this;var t=arguments;return this.forEach((function(e){e&&e.translate&&e.translate.apply(e,t)})),this},n.isEmpty=function(){return!_x(this.getGeometries())},n.remove=function(){return this.forEach((function(e){e._unbind()})),UT.prototype.remove.apply(this,arguments)},n.show=function(){return this.options.visible=!0,this.forEach((function(e){e.show()})),this},n.hide=function(){return this.options.visible=!1,this.forEach((function(e){e.hide()})),this},n.onConfig=function(e){this.forEach((function(t){t.config(e)}))},n.getSymbol=function(){var t=e.prototype.getSymbol.call(this);if(!t){var n=[],i=!1;this.forEach((function(e){e.getSymbol()&&!i&&(i=!0),n.push(e.getSymbol())})),i&&(t={children:n})}return t},n.setSymbol=function(e){var t=this;if(e&&e.children)this._symbol=null,this.forEach((function(n,i){n._eventSymbolProperties=t._eventSymbolProperties,n.setSymbol(e.children[i])}));else{var n=this._prepareSymbol(e);this._symbol=n,this.forEach((function(e){e._eventSymbolProperties=t._eventSymbolProperties,e.setSymbol(n)}))}return this.onSymbolChanged(),this},n._setExternSymbol=function(e){return e=this._prepareSymbol(e),this._externSymbol=e,this.forEach((function(t){t._setExternSymbol(e)})),this.onSymbolChanged(),this},n._bindLayer=function(){e.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},n._bindGeometriesToLayer=function(){var e=this.getLayer();this.forEach((function(t){t._bindLayer(e)}))},n._checkGeometries=function(e){var t="The geometry added to collection is invalid.";if(e&&!Array.isArray(e)){if(e instanceof UT)return[e];throw new Error(t)}for(var n=0,i=e.length;n<i;n++)if(!this._checkGeo(e[n]))throw new Error(t+" Index: "+n);return e},n._checkGeo=function(e){return e instanceof UT},n._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(e){e&&e._updateCache&&e._updateCache()}))},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(e){e._removePainter()}))},n._computeCenter=function(e){if(!e||this.isEmpty())return null;for(var t=0,n=0,i=0,r=this.getGeometries(),a=0,o=r.length;a<o;a++)if(r[a]){var s=r[a]._computeCenter(e);s&&(t+=s.x,n+=s.y,i++)}return 0===i?null:new hS(t/i,n/i)},n._containsPoint=function(e,t){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)if(n[i]._containsPoint(e,t))return this._pickGeometryIndex=i,!0;return!1},n._computeExtent=function(e){return ME.call(this,e,"_computeExtent")},n._computePrjExtent=function(e){return ME.call(this,e,"_computePrjExtent")},n._computeGeodesicLength=function(e){if(!e||this.isEmpty())return 0;for(var t=this.getGeometries(),n=0,i=0,r=t.length;i<r;i++)t[i]&&(n+=t[i]._computeGeodesicLength(e));return n},n._computeGeodesicArea=function(e){if(!e||this.isEmpty())return 0;for(var t=this.getGeometries(),n=0,i=0,r=t.length;i<r;i++)t[i]&&(n+=t[i]._computeGeodesicArea(e));return n},n._exportGeoJSONGeometry=function(){var e=[];if(!this.isEmpty())for(var t=this.getGeometries(),n=0,i=t.length;n<i;n++)t[n]&&e.push(t[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:e}},n._toJSON=function(e){var t,n={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter((function(e){return e&&e._toJSON})).map((function(e){var t=e._toJSON();return t.subType?t:e._exportGeoJSONGeometry()}))}},i=this.getId();return i_(i)||(n.id=i),(i_(e.properties)||e.properties)&&(t=this._exportProperties()),n.properties=t,e.feature=n,e},n._clearProjection=function(){if(!this.isEmpty())for(var e=this.getGeometries(),t=0,n=e.length;t<n;t++)e[t]&&e[t]._clearProjection()},n._getConnectPoints=function(){var e=this.getExtent();return[new hS(e.xmin,e.ymax),new hS(e.xmax,e.ymin),new hS(e.xmin,e.ymin),new hS(e.xmax,e.ymax)]},n._getExternalResources=function(){if(this.isEmpty())return[];for(var e,t,n=this.getGeometries(),i=[],r={},a=0,o=n.length;a<o;a++)if(n[a])for(var s=0,l=(e=wb(n[a]._getInternalSymbol())).length;s<l;s++)r[t=e[s].join()]||(i.push(e[s]),r[t]=1);return i},n.startEdit=function(e){var t=this;if(this.isEmpty())return this;e||(e={}),e.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(e.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i].startEdit(e);this._editing=!0;var a=this.getLayer();return a&&"canvas"===a.options.renderer&&this.hide(),setTimeout((function(){t.fire("editstart")}),1),this},n.endEdit=function(){if(this.isEmpty())return this;for(var e=this.getGeometries(),t=0,n=e.length;t<n;t++)e[t].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},n.isEditing=function(){return!!this._editing},t}(UT);function ME(e,t){if(this.isEmpty())return null;for(var n=new TS,i=this.getGeometries(),r=0,a=i.length;r<a;r++)if(i[r]){var o=i[r][t](e);o&&n._combine(o)}return n}SE.registerJSONType("GeometryCollection");var TE=function(e){function t(t,n,i,r){var a;return(a=e.call(this,null,r)||this).GeometryType=t,a.type=n,a._initData(i),a}K_(t,e);var n=t.prototype;return n.getCoordinates=function(){for(var e=[],t=this.getGeometries(),n=0,i=t.length;n<i;n++){var r=t[n];e.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return e},n.setCoordinates=function(e){for(var t=[],n=0,i=(e=e||[]).length;n<i;n++){var r=new this.GeometryType(e[n],this.config());t.push(r)}return this.setGeometries(t),this},n._initData=function(e){(e=e||[]).length&&(e[0]instanceof this.GeometryType?this.setGeometries(e):this.setCoordinates(e))},n._checkGeo=function(e){return e instanceof this.GeometryType},n._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),t=hS.toNumberArrays(e);return{type:this.getType(),coordinates:t}},n._toJSON=function(e){return{feature:this.toGeoJSON(e)}},t}(SE),EE=function(e){function t(t,n){return e.call(this,_E,"MultiPoint",t,n)||this}return K_(t,e),t.prototype.findClosest=function(e){if(!e)return null;var t=this.getCoordinates(),n=null,i=1/0;return t.forEach((function(t){var r=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}(t,e);r<i&&(n=t,i=r)})),n},t}(TE);EE.registerJSONType("MultiPoint");var CE=function(e){function t(){return e.apply(this,arguments)||this}return K_(t,e),t.prototype.getCenterInExtent=function(e){var t=this.getGeometries(),n=0,i=0,r=0;return t.forEach((function(t){var a=t.getCenterInExtent(e);a&&(n+=a.x*a.count,i+=a.y*a.count,r+=a.count)})),0===r?null:new hS(n,i)._multi(1/r)},t}(TE),kE=function(e){function t(t,n){return e.call(this,bE,"MultiLineString",t,n)||this}return K_(t,e),t}(CE);kE.registerJSONType("MultiLineString");var PE=function(e){function t(t,n){return e.call(this,vE,"MultiPolygon",t,n)||this}return K_(t,e),t}(CE);PE.registerJSONType("MultiPolygon");var AE={Marker:_E,LineString:bE,Polygon:vE,MultiPoint:EE,MultiLineString:kE,MultiPolygon:PE},RE={toGeometry:function(e,t){if(s_(e)&&(e=cx(e)),Array.isArray(e)){for(var n=[],i=0,r=e.length;i<r;i++){var a=RE._convert(e[i],t);Array.isArray(a)?hx(n,a):n.push(a)}return n}return RE._convert(e,t)},_convert:function(e,t){if(!e||i_(e.type))return null;var n=e.type;if("Feature"===n){var i=e.geometry,r=RE._convert(i);return r?(r.setId(e.id),r.setProperties(e.properties),t&&t(r),r):null}if("FeatureCollection"===n){var a=e.features;return a?RE.toGeometry(a,t):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(n)>=0){var o=new AE["Point"===n?"Marker":n](e.coordinates);return t&&t(o),o}if("GeometryCollection"===n){var s=e.geometries;if(!_x(s)){var l=new SE;return t&&t(l),l}for(var u=[],c=s.length,h=0;h<c;h++)s[h].subType?u.push(UT.getJSONClass(s[h].subType).fromJSON(s[h])):u.push(RE._convert(s[h]));var f=new SE(u);return t&&t(f),f}return null}},LE=function(e){function t(t,n,i){var r;return r=e.call(this,null,i)||this,t&&r.setCoordinates(t),r._radius=n,r}K_(t,e),t.fromJSON=function(e){var n=e.feature,i=new t(e.coordinates,e.radius,e.options);return i.setProperties(n.properties),i};var n=t.prototype;return n.getRadius=function(){return this._radius},n.setRadius=function(e){return this._radius=e,this.onShapeChanged(),this},n.getShell=function(){for(var e,t,n,i=this._getMeasurer(),r=this.getCoordinates(),a=this.options.numberOfShellPoints,o=this.getRadius(),s=[],l=0,u=a-1;l<u;l++){e=360*l/u*Math.PI/180,t=o*Math.cos(e),n=o*Math.sin(e);var c=i.locate(r,t,n);s.push(c)}return s.push(s[0]),s},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(t,n){var i=this.getMap();if(i.getPitch())return e.prototype._containsPoint.call(this,t,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),a=this.getSize(),o=this._hitTestTolerance()+(n||0),s=r.add(a.width/2,a.height/2);return qM(t,r,s,o)},n._computePrjExtent=function(e){var t=this._getMinMax(e);if(!t)return null;var n=this._getPrjCoordinates(),i=t.map((function(t){return e.project(t)})),r=i[0].x-n.x,a=i[1].x-n.x,o=i[2].y-n.y,s=i[3].y-n.y;return new TS(n.add(r,o),n.add(a,s))},n._computeExtent=function(e){var t=this._getMinMax(e);return t?new TS(t[0].x,t[2].y,t[1].x,t[3].y,this._getProjection()):null},n._getMinMax=function(e){if(!e||!this._coordinates||i_(this._radius))return null;var t=this._radius;return[e.locate(this._coordinates,-t,0),e.locate(this._coordinates,t,0),e.locate(this._coordinates,0,t),e.locate(this._coordinates,0,-t)]},n._computeGeodesicLength=function(){return i_(this._radius)?0:2*Math.PI*this._radius},n._computeGeodesicArea=function(){return i_(this._radius)?0:Math.PI*Math.pow(this._radius,2)},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:hS.toNumberArrays([this.getShell()])}},n._toJSON=function(e){var t=this.getCenter(),n=n_({},e);n.geometry=!1;var i=this.toGeoJSON(n);return i.geometry={type:"Polygon"},{feature:i,subType:"Circle",coordinates:[t.x,t.y],radius:this.getRadius()}},t}(gE(vE));LE.mergeOptions({numberOfShellPoints:60}),LE.registerJSONType("Circle");var IE=function(e){function t(t,n,i,r){var a;return a=e.call(this,null,r)||this,t&&a.setCoordinates(t),a.width=n,a.height=i,a}K_(t,e),t.fromJSON=function(e){var n=e.feature,i=new t(e.coordinates,e.width,e.height,e.options);return i.setProperties(n.properties),i};var n=t.prototype;return n.getWidth=function(){return this.width},n.setWidth=function(e){return this.width=e,this.onShapeChanged(),this},n.getHeight=function(){return this.height},n.setHeight=function(e){return this.height=e,this.onShapeChanged(),this},n.getShell=function(){for(var e,t,n,i,r=this._getMeasurer(),a=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getWidth(),l=this.getHeight(),u=[],c=Math.pow(s/2,2)*Math.pow(l/2,2),h=Math.pow(s/2,2),f=Math.pow(l/2,2),d=0;d<o;d++){t=(e=360*d/o)*Math.PI/180,n=Math.sqrt(c/(h*Math.pow(Math.tan(t),2)+f)),i=Math.sqrt(c/(f*Math.pow(1/Math.tan(t),2)+h)),e>90&&e<270&&(n*=-1),e>180&&e<360&&(i*=-1);var p=r.locate(a,n,i);u.push(p)}return u},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(t,n){var i=this.getMap();if(i.isTransforming())return e.prototype._containsPoint.call(this,t,n);var r=i.getProjection(),a=this._hitTestTolerance()+(n||0),o=r.projectCoords([this._coordinates,i.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian);return qM(t,i._prjToContainerPoint(o[0]),i._prjToContainerPoint(o[1]),a)},n._computePrjExtent=function(){return LE.prototype._computePrjExtent.apply(this,arguments)},n._computeExtent=function(){return LE.prototype._computeExtent.apply(this,arguments)},n._getMinMax=function(e){if(!e||!this._coordinates||i_(this.width)||i_(this.height))return null;var t=this.getWidth(),n=this.getHeight();return[e.locate(this._coordinates,-t/2,0),e.locate(this._coordinates,t/2,0),e.locate(this._coordinates,0,-n/2),e.locate(this._coordinates,0,n/2)]},n._computeGeodesicLength=function(){if(i_(this.width)||i_(this.height))return 0;var e=this.width>this.height?this.width:this.height;return 2*Math.PI*e/2-4*Math.abs(this.width-this.height)},n._computeGeodesicArea=function(){return i_(this.width)||i_(this.height)?0:Math.PI*this.width*this.height/4},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:hS.toNumberArrays([this.getShell()])}},n._toJSON=function(e){var t=n_({},e),n=this.getCenter();t.geometry=!1;var i=this.toGeoJSON(t);return i.geometry={type:"Polygon"},{feature:i,subType:"Ellipse",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},t}(gE(vE));IE.mergeOptions({numberOfShellPoints:80}),IE.registerJSONType("Ellipse");var OE=function(e){function t(t,n,i,r){var a;return a=e.call(this,null,r)||this,t&&a.setCoordinates(t),a._width=n,a._height=i,a}K_(t,e),t.fromJSON=function(e){var n=e.feature,i=new t(e.coordinates,e.width,e.height,e.options);return i.setProperties(n.properties),i};var n=t.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(e){if(this._coordinates=e instanceof hS?e:new hS(e),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var t=this._getProjection();return this._setPrjCoordinates(t.project(this._coordinates)),this},n.getWidth=function(){return this._width},n.setWidth=function(e){return this._width=e,this.onShapeChanged(),this},n.getHeight=function(){return this._height},n.setHeight=function(e){return this._height=e,this.onShapeChanged(),this},n.getShell=function(){var e=this._getMeasurer(),t=this._coordinates,n=this.getMap(),i=1,r=-1;if(n){var a=n.getFullExtent();a.left>a.right&&(i=-1),a.bottom>a.top&&(r=1)}var o=[];return o.push(t),o.push(e.locate(t,i*this._width,0)),o.push(e.locate(t,i*this._width,r*this._height)),o.push(e.locate(t,0,r*this._height)),o.push(t),o},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pnw&&e&&this._coordinates&&(this._pnw=e.project(this._coordinates)),this._pnw},n._setPrjCoordinates=function(e){this._pnw=e,this.onPositionChanged()},n._getPrjShell=function(){var t=e.prototype._getPrjShell.call(this),n=this._getProjection();if(!n.isSphere())return t;for(var i=n.getSphereExtent(),r=i.sx,a=i.sy,o=this._getProjection().getCircum(),s=t[0],l=1,u=t.length;l<u;l++){var c=t[l],h=0,f=0;r*(s.x-c.x)>0&&(h=o.x*r),a*(s.y-c.y)<0&&(f=o.y*a),t[l]._add(h,f)}return t},n._updateCache=function(){this._clearCache();var e=this._getProjection();this._pnw&&e&&(this._coordinates=e.unproject(this._pnw))},n._clearProjection=function(){this._pnw=null,e.prototype._clearProjection.call(this)},n._computeCenter=function(e){return e.locate(this._coordinates,this._width/2,-this._height/2)},n._containsPoint=function(t,n){var i=this.getMap();if(i.isTransforming())return e.prototype._containsPoint.call(this,t,n);var r=i_(n)?this._hitTestTolerance():n,a=i._getResolution()*r,o=this._getPrjExtent().expand(a),s=i._containerPointToPrj(t);return o.contains(s)},n._computePrjExtent=function(e){var t=this._getSouthEast(e);if(!t)return null;var n=e.projectCoords([new hS(this._coordinates.x,t.y),new hS(t.x,this._coordinates.y)],this.options.antiMeridian);return new TS(n[0],n[1])},n._computeExtent=function(e){var t=this._getSouthEast(e);return t?new TS(this._coordinates,t,this._getProjection()):null},n._getSouthEast=function(e){if(!e||!this._coordinates||i_(this._width)||i_(this._height))return null;var t=this.getWidth(),n=-this.getHeight();if(e.fullExtent){var i=e.fullExtent;t*=i.right>i.left?1:-1,n*=i.top>i.bottom?1:-1}var r=e.locate(this._coordinates,t,0),a=e.locate(this._coordinates,0,n);return r.y=a.y,r},n._computeGeodesicLength=function(){return i_(this._width)||i_(this._height)?0:2*(this._width+this._height)},n._computeGeodesicArea=function(){return i_(this._width)||i_(this._height)?0:this._width*this._height},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:hS.toNumberArrays([this.getShell()])}},n._toJSON=function(e){var t=n_({},e),n=this.getCoordinates();t.geometry=!1;var i=this.toGeoJSON(t);return i.geometry={type:"Polygon"},{feature:i,subType:"Rectangle",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},t}(vE);OE.registerJSONType("Rectangle");var DE=function(e){function t(t,n,i,r,a){var o;return(o=e.call(this,t,n,a)||this).startAngle=i,o.endAngle=r,o}K_(t,e),t.fromJSON=function(e){var n=e.feature,i=new t(e.coordinates,e.radius,e.startAngle,e.endAngle,e.options);return i.setProperties(n.properties),i};var n=t.prototype;return n.getStartAngle=function(){return this.startAngle},n.setStartAngle=function(e){return this.startAngle=e,this.onShapeChanged(),this},n.getEndAngle=function(){return this.endAngle},n.setEndAngle=function(e){return this.endAngle=e,this.onShapeChanged(),this},n.getShell=function(){for(var e,t,n,i=this._getMeasurer(),r=this.getCoordinates(),a=this.options.numberOfShellPoints-2,o=this.getRadius(),s=[r.copy()],l=this.getStartAngle(),u=this.getEndAngle()-l,c=0;c<a;c++){e=(u*c/(a-1)+l)*Math.PI/180,t=o*Math.cos(e),n=o*Math.sin(e);var h=i.locate(r,t,n);s.push(h)}return s.push(r.copy()),s},n._containsPoint=function(t,n){var i=this.getMap();if(i.isTransforming())return e.prototype._containsPoint.call(this,t,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),a=this._hitTestTolerance()+(n||0),o=this.getSize(),s=r,l=t,u=l.x-s.x,c=s.y-l.y,h=Math.atan2(c,u),f=h<0?360*(h+2*Math.PI)/(2*Math.PI):360*h/(2*Math.PI),d=this.startAngle%360,p=this.endAngle%360,m=!1;return m=d>p?!(f>p&&f<d):f>=d&&f<=p,l.distanceTo(s)<=o.width/2+a&&m},n._computeGeodesicLength=function(){return i_(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},n._computeGeodesicArea=function(){return i_(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},n._toJSON=function(e){var t=n_({},e),n=this.getCenter();t.geometry=!1;var i=this.toGeoJSON(t);return i.geometry={type:"Polygon"},{feature:i,subType:"Sector",coordinates:[n.x,n.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},t}(LE);DE.mergeOptions({numberOfShellPoints:60}),DE.registerJSONType("Sector");var NE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n._arc=function(e,t,n){for(var i=this.options.arcDegree*Math.PI/180,r=1,a=t.length;r<a;r++){var o=Zw._arcBetween(e,t[r-1],t[r],i),s=[t[r-1].x+t[r].x-o[0],t[r-1].y+t[r].y-o[1]];t[r-1].nextCtrlPoint=s,t[r].prevCtrlPoint=s,Zw._stroke(e,n)}},n._quadraticCurve=function(e,t){if(t.length<=2)Zw._path(e,t);else{var n,i;for(n=2,i=t.length;n<i;n+=2)e.quadraticCurveTo(t[n-1].x,t[n-1].y,t[n].x,t[n].y);if((n-=1)<i)for(;n<i;n++)e.lineTo(t[n].x,t[n].y)}},n._bezierCurve=function(e,t){if(t.length<=3)Zw._path(e,t);else{var n,i;for(n=1,i=t.length;n+2<i;n+=3)e.bezierCurveTo(t[n].x,t[n].y,t[n+1].x,t[n+1].y,t[n+2].x,t[n+2].y);if(n<i)for(;n<i;n++)e.lineTo(t[n].x,t[n].y)}},n._getCurveArrowPoints=function(e,t,n,i,r,a){var o,s=t.length;for(o=a;o<s;o+=a){var l=this._getArrowShape(t[o-1],t[o],n,i,r);l&&e.push(l)}if((o-=a)<s-1)for(o+=1;o<s;o++){var u=this._getArrowShape(t[o-1],t[o],n,i,r);u&&e.push(u)}},t}(bE);NE.mergeOptions({enableSimplify:!1,enableClip:!1});var zE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"ArcCurve"}},n._paintOn=function(e,t,n){e.beginPath(),this._arc(e,t,n),Zw._stroke(e,n),this._paintArrow(e,t,n)},t.fromJSON=function(e){var n=e.feature,i=new t(n.geometry.coordinates,e.options);return i.setProperties(n.properties),i},t}(NE);zE.registerJSONType("ArcCurve"),zE.mergeOptions({arcDegree:90});var UE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e),t.fromJSON=function(e){var n=e.feature,i=new t(n.geometry.coordinates,e.options);return i.setProperties(n.properties),i};var n=t.prototype;return n._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"CubicBezierCurve"}},n._paintOn=function(e,t,n){e.beginPath(),e.moveTo(t[0].x,t[0].y),this._bezierCurve(e,t),Zw._stroke(e,n),this._paintArrow(e,t,n)},n._getArrowPoints=function(e,t,n,i,r){return this._getCurveArrowPoints(e,t,n,i,r,3)},t}(NE);UE.registerJSONType("CubicBezierCurve");var FE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e),t.fromJSON=function(e){var n=e.feature,i=new t(n.geometry.coordinates,e.options);return i.setProperties(n.properties),i};var n=t.prototype;return n._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"QuadBezierCurve"}},n._paintOn=function(e,t,n){e.beginPath(),e.moveTo(t[0].x,t[0].y),this._quadraticCurve(e,t,n),Zw._stroke(e,n),this._paintArrow(e,t,n)},n._getArrowPoints=function(e,t,n,i,r){return this._getCurveArrowPoints(e,t,n,i,r,2)},t}(NE);FE.registerJSONType("QuadBezierCurve");var BE={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},HE={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},jE=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.getContent=function(){return this._content},n.setContent=function(e){var t=this._content;return this._content=kb(e),this._refresh(),this._fireEvent("contentchange",{old:t,new:e}),this},n.onAdd=function(){this._refresh()},n.toJSON=function(){var t=e.prototype.toJSON.call(this);return delete t.symbol,t},n.setSymbol=function(t){if(this._refreshing||!t)return e.prototype.setSymbol.call(this,t);var n=this._parseSymbol(t);if(this.setTextStyle){var i=this.getTextStyle()||{};i.symbol=n[0],this.setTextStyle(i)}else this.setTextSymbol&&this.setTextSymbol(n[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=n[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(n[1]);return this},n._parseSymbol=function(e){var t={},n={};for(var i in e)c_(e,i)&&(0===i.indexOf("text")?t[i]=e[i]:n[i]=e[i]);return[t,n]},n._getTextSize=function(e){return Bb(this._content,e).size},n._getInternalSymbol=function(){return this._symbol},n._getDefaultTextSymbol=function(){return n_({},BE)},n._getDefaultBoxSymbol=function(){return n_({},HE)},n._getDefaultPadding=function(){return[12,8]},t}(_E),GE=function(e){function t(t,n,i,r,a){var o;return void 0===a&&(a={}),(o=e.call(this,n,a)||this)._content=kb(t),o._width=i_(i)?100:i,o._height=i_(r)?40:r,a.boxSymbol&&o.setBoxSymbol(a.boxSymbol),a.textStyle&&o.setTextStyle(a.textStyle),o._refresh(),o}K_(t,e);var n=t.prototype;return n.getWidth=function(){return this._width},n.setWidth=function(e){return this._width=e,this._refresh(),this},n.getHeight=function(){return this._height},n.setHeight=function(e){return this._height=e,this._refresh(),this},n.getBoxSymbol=function(){return n_({},this.options.boxSymbol)},n.setBoxSymbol=function(e){return this.options.boxSymbol=e?n_({},e):e,this.getSymbol()&&this._refresh(),this},n.getTextStyle=function(){return this.options.textStyle?n_({},this.options.textStyle):null},n.setTextStyle=function(e){return this.options.textStyle=e?n_({},e):e,this.getSymbol()&&this._refresh(),this},t.fromJSON=function(e){var n=e.feature,i=new t(e.content,n.geometry.coordinates,e.width,e.height,e.options);return i.setProperties(n.properties),i.setId(n.id),e.symbol&&i.setSymbol(e.symbol),i},n._toJSON=function(e){return{feature:this.toGeoJSON(e),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},n._refresh=function(){var e,t,n=this.getTextStyle()||{},i=n.padding||[12,8];if(Qx(this._width)){var r=(e=JSON.parse(JSON.stringify(this._width))).stops;if(r)for(var a=0;a<r.length;a++)r[a][1]=r[a][1]-2*i[0]}else e=this._width-2*i[0];if(Qx(this._height)){var o=(t=JSON.parse(JSON.stringify(this._height))).stops;if(o)for(var s=0;s<o.length;s++)o[s][1]=o[s][1]-2*i[1]}else t=this._height-2*i[1];var l=n_({},n.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:e,textMaxHeight:t});n.wrap&&!l.textWrapWidth&&(l.textWrapWidth=e);var u,c=n.horizontalAlignment;if(l.textDx=l.markerDx||0,Qx(this._width)){var h=(u=JSON.parse(JSON.stringify(this._width))).stops;if(h)for(var f=0;f<h.length;f++)h[f][1]=h[f][1]/2-i[0],"left"===c&&(h[f][1]*=-1)}else u=l.markerWidth/2-i[0],"left"===c&&(u*=-1);"left"===c?(l.textHorizontalAlignment="right",l.textDx=u):"right"===c&&(l.textHorizontalAlignment="left",l.textDx=u);var d,p=n.verticalAlignment;if(l.textDy=l.markerDy||0,Qx(this._height)){var m=(d=JSON.parse(JSON.stringify(this._height))).stops;if(m)for(var v=0;v<m.length;v++)m[v][1]=m[v][1]/2-i[1],"top"===p&&(m[v][1]*=-1)}else d=l.markerHeight/2-i[1],"top"===p&&(d*=-1);"top"===p?(l.textVerticalAlignment="bottom",l.textDy=d):"bottom"===p&&(l.textVerticalAlignment="top",l.textDy=d),this._refreshing=!0,this.updateSymbol(l),delete this._refreshing},n.startEdit=function(t){var n=this._getCompiledSymbol();if(Qx(this._width)){var i=n.markerWidth;this._oldWidth=this._width,this.setWidth(i)}if(Qx(this._height)){var r=n.markerHeight;this._oldHeight=this._height,this.setHeight(r)}e.prototype.startEdit.call(this,t)},n.endEdit=function(){var t=this.getMap(),n=t&&t.getZoom();if(this._oldWidth){for(var i=this._width/$x(this._oldWidth)(n),r=this._oldWidth.stops,a=0;a<r.length;a++)r[a][1]*=i;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(var o=this._height/$x(this._oldHeight)(n),s=this._oldHeight.stops,l=0;l<s.length;l++)s[l][1]*=o;this.setHeight(this._oldHeight),delete this._oldHeight}e.prototype.endEdit.call(this)},t}(jE);GE.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),GE.registerJSONType("TextBox");var VE=function(e){function t(t,n,i){var r;return void 0===i&&(i={}),r=e.call(this,n,i)||this,i.textSymbol&&r.setTextSymbol(i.textSymbol),i.boxStyle&&r.setBoxStyle(i.boxStyle),r._content=kb(t),r._refresh(),r}K_(t,e);var n=t.prototype;return n.getBoxStyle=function(){return this.options.boxStyle?n_({},this.options.boxStyle):null},n.setBoxStyle=function(e){return this.options.boxStyle=e?n_({},e):e,this._refresh(),this},n.getTextSymbol=function(){return n_({},this._getDefaultTextSymbol(),this.options.textSymbol)},n.setTextSymbol=function(e){return this.options.textSymbol=e?n_({},e):e,this._refresh(),this},t.fromJSON=function(e){var n=e.feature,i=new t(e.content,n.geometry.coordinates,e.options);return i.setProperties(n.properties),i.setId(n.id),e.symbol&&i.setSymbol(e.symbol),i},n._canEdit=function(){return!1},n._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"Label",content:this._content}},n._refresh=function(){var e=n_({},this.getTextSymbol(),{textName:this._content}),t=this.getBoxStyle();if(t){n_(e,t.symbol);var n=this._getBoxSize(e),i=n[1],r=t.padding||this._getDefaultPadding(),a=n[0];e.markerWidth=a.width,e.markerHeight=a.height;var o=e.textDx||0,s=e.textDy||0,l=zb(i,e.textHorizontalAlignment,e.textVerticalAlignment)._add(o,s),u=t.horizontalAlignment||"middle";e.markerDx=l.x,"left"===u?e.markerDx+=e.markerWidth/2-r[0]:"right"===u?e.markerDx-=e.markerWidth/2-i.width-r[0]:e.markerDx+=i.width/2;var c=t.verticalAlignment||"middle";e.markerDy=l.y,"top"===c?e.markerDy+=e.markerHeight/2-r[1]:"bottom"===c?e.markerDy-=e.markerHeight/2-i.height-r[1]:e.markerDy+=i.height/2}this._refreshing=!0,this.updateSymbol(e),delete this._refreshing},n._getBoxSize=function(e){e.markerType||(e.markerType="square");var t,n,i=this.getBoxStyle(),r=this._getTextSize(e),a=i.padding||this._getDefaultPadding();return t=r.width+2*a[0],n=r.height+2*a[1],i.minWidth&&(!t||t<i.minWidth)&&(t=i.minWidth),i.minHeight&&(!n||n<i.minHeight)&&(n=i.minHeight),[new Tb(t,n),r]},t}(jE);VE.mergeOptions({boxStyle:null,textSymbol:null}),VE.registerJSONType("Label");var WE=function(e){return function(e){function t(){return e.apply(this,arguments)||this}K_(t,e),t._hasConnectors=function(e){return!i_(e.__connectors)&&e.__connectors.length>0},t._getConnectors=function(e){return e.__connectors};var n=t.prototype;return n.getConnectSource=function(){return this._connSource},n.setConnectSource=function(e){var t=this._connTarget;return this.onRemove(),this._connSource=e,this._connTarget=t,this.onAdd(),this},n.getConnectTarget=function(){return this._connTarget},n.setConnectTarget=function(e){var t=this._connSource;return this.onRemove(),this._connSource=t,this._connTarget=e,this._updateCoordinates(),this._registerEvents(),this},n._updateCoordinates=function(){var e=this.getMap();if(!e&&this._connSource&&(e=this._connSource.getMap()),!e&&this._connTarget&&(e=this._connTarget.getMap()),e&&this._connSource&&this._connTarget){for(var t,n,i=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),a=0,o=this.getCoordinates(),s=0,l=i.length;s<l;s++)for(var u=i[s],c=0,h=r.length;c<h;c++){var f=r[c],d=e.computeLength(u,f);0===s&&0===c?(t=u,n=f,a=d):d<a&&(t=u,n=f)}_x(o)&&o[0].equals(t)&&o[1].equals(n)||this.setCoordinates([t,n])}},n.onAdd=function(){this._registerEvents(),this._updateCoordinates()},n.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&fx(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(fx(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof UT)||!(this._connTarget instanceof UT)){var e=this.getMap();e&&e.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},n._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},n._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var e=this.options.showOn;if(this.hide(),"moving"===e?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===e?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===e?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof UT)||!(this._connTarget instanceof UT)){var t=this.getMap();t&&t.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},t}(e)},XE={showOn:"always"},ZE=function(e){function t(t,n,i){var r;return r=e.call(this,null,i)||this,1===arguments.length&&(i=t,t=null,n=null),r._connSource=t,r._connTarget=n,r}return K_(t,e),t}(WE(bE));ZE.mergeOptions(XE),ZE.registerJSONType("ConnectorLine");var qE=function(e){function t(t,n,i){var r;return r=e.call(this,null,i)||this,1===arguments.length&&(i=t,t=null,n=null),r._connSource=t,r._connTarget=n,r}return K_(t,e),t}(WE(zE));qE.mergeOptions(XE),qE.registerJSONType("ArcConnectorLine");var YE=[],JE=function(e){function t(t,n,i){var r;n&&!(n instanceof UT)&&!Array.isArray(n)&&Yy.indexOf(n.type)<0&&(i=n,n=null),(r=e.call(this,t,i)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),n&&r.addGeometry(n);var a=r.options.style;return a&&r.setStyle(a),r}K_(t,e);var n=t.prototype;return n.getGeometryById=function(e){return i_(e)||""===e?null:this._geoMap[e]?this._geoMap[e]:null},n.getGeometries=function(e,t){if(!e)return this._geoList.slice(0);for(var n,i=[],r=0,a=this._geoList.length;r<a;r++)n=this._geoList[r],(t?e.call(t,n):e(n))&&i.push(n);return i},n.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},n.getLastGeometry=function(){var e=this._geoList.length;return 0===e?null:this._geoList[e-1]},n.getCount=function(){return this._geoList.length},n.getExtent=function(){if(0===this.getCount())return null;var e=new TS(this.getProjection());return this.forEach((function(t){e._combine(t.getExtent())})),e},n.forEach=function(e,t){for(var n=this._geoList.slice(0),i=0,r=n.length;i<r;i++)t?e.call(t,n[i],i):e(n[i],i);return this},n.filter=function(e,t){var n=[],i=l_(e),r=i?e:rb(e);return this.forEach((function(e){var a=i?e:pb(e);(t?r.call(t,a):r(a))&&n.push(e)}),this),n},n.isEmpty=function(){return!this._geoList.length},n.addGeometry=function(e,t){if(!e)return this;if("FeatureCollection"===e.type)return this.addGeometry(RE.toGeometry(e),t);if(!Array.isArray(e)){var n=arguments.length,i=arguments[n-1];return e=Array.prototype.slice.call(arguments,0,n-1),t=i,i&&o_(i)&&("type"in i||i instanceof UT)&&(e.push(i),t=!1),this.addGeometry(e,t)}if(0===e.length)return this;var r;this._initCache(),t&&(r=new TS),this._toSort=this._maxZIndex>0;for(var a=[],o=0,s=e.length;o<s;o++){var l=e[o];if(!l)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+o);if(!l.getLayer||l.getLayer()!==this){if(!(l instanceof UT)&&(l=UT.fromJSON(l),Array.isArray(l)))for(var u=0,c=l.length;u<c;u++)this._add(l[u],r,o),a.push(l[u]);Array.isArray(l)||(this._add(l,r,o),a.push(l))}}var h=this.getMap();if(h&&(this._getRenderer().onGeometryAdd(a),r&&!i_(r.xmin))){var f=r.getCenter(),d=h.getFitZoom(r);if(o_(t)){var p=l_(t.step)?t.step:function(){};h.animateTo({center:f,zoom:d},n_({duration:h.options.zoomAnimationDuration,easing:"out"},t),p)}else!0===t&&h.setCenterAndZoom(f,d)}return this.fire("addgeo",{geometries:e}),this},n.getGeoMinZIndex=function(){return this._minZIndex},n.getGeoMaxZIndex=function(){return this._maxZIndex},n._add=function(e,t,n){this._toSort||(this._toSort=0!==e.getZIndex()),this._updateZIndex(e.getZIndex());var i=e.getId();if(!i_(i)){if(!i_(this._geoMap[i]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+i+", at index:"+n);this._geoMap[i]=e}var r=ux();e._setInternalId(r),this._geoList.push(e),this.onAddGeometry(e),e._bindLayer(this),e.onAdd&&e.onAdd(),t&&t._combine(e.getExtent()),e._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(e)},n.removeGeometry=function(e){if(!Array.isArray(e))return this.removeGeometry([e]);for(var t=e.length-1;t>=0;t--)e[t]instanceof UT||(e[t]=this.getGeometryById(e[t])),e[t]&&this===e[t].getLayer()&&e[t].remove();return this.fire("removegeo",{geometries:e}),this},n.clear=function(){this._clearing=!0,this.forEach((function(e){e.remove()})),this._geoMap={};var e=this._geoList;this._geoList=[];var t=this._getRenderer();return t&&(t.onGeometryRemove(e),t.clearImageData&&(t.clearImageData(),delete t._lastGeosToDraw)),this._clearing=!1,this.fire("clear"),this},n.onRemoveGeometry=function(e){if(e&&!this._clearing&&(this===e.getLayer()&&!i_(e._getInternalId()))){var t=e.getId();i_(t)||delete this._geoMap[t];var n=this._findInList(e);n>=0&&this._geoList.splice(n,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([e])}},n.getStyle=function(){return this.options.style?this.options.style:null},n.setStyle=function(e){return this.options.style=e,e=Zb(e),this._cookedStyles=mb(e),this.forEach((function(e){this._styleGeometry(e)}),this),this.fire("setstyle",{style:e}),this},n._styleGeometry=function(e){if(!this._cookedStyles)return!1;for(var t=pb(e),n=0,i=this._cookedStyles.length;n<i;n++)if(!0===this._cookedStyles[n].filter(t))return e._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},n.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(e){e._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},n.onAddGeometry=function(e){this.getStyle()&&this._styleGeometry(e)},n.hide=function(){for(var e=0,t=this._geoList.length;e<t;e++)this._geoList[e].onHide();return WT.prototype.hide.call(this)},n._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},n._updateZIndex=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,t)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,t))},n._sortGeometries=function(){var e=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(t,n){return e._updateZIndex(t.getZIndex(),n.getZIndex()),e._compare(t,n)})),this._toSort=!1)},n._compare=function(e,t){return e.getZIndex()===t.getZIndex()?e._getInternalId()-t._getInternalId():e.getZIndex()-t.getZIndex()},n._findInList=function(e){var t=this._geoList.length;if(0===t)return-1;this._sortGeometries();for(var n,i=0,r=t-1;i<=r;){if(n=Math.floor((i+r)/2),this._geoList[n]===e)return n;this._compare(this._geoList[n],e)>0?r=n-1:i=n+1}return-1},n._onGeometryEvent=function(e){if(e&&e.target){var t=e.type;"idchange"===t?this._onGeometryIdChange(e):"zindexchange"===t?this._onGeometryZIndexChange(e):"positionchange"===t?this._onGeometryPositionChange(e):"shapechange"===t?this._onGeometryShapeChange(e):"symbolchange"===t?this._onGeometrySymbolChange(e):"show"===t?this._onGeometryShow(e):"hide"===t?this._onGeometryHide(e):"propertieschange"===t&&this._onGeometryPropertiesChange(e)}},n._onGeometryIdChange=function(e){if(e.new!==e.old||!this._geoMap[e.old]||this._geoMap[e.old]!==e.target){if(!i_(e.new)){if(this._geoMap[e.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+e.new);this._geoMap[e.new]=e.target}i_(e.old)||e.new===e.old||delete this._geoMap[e.old]}},n._onGeometryZIndexChange=function(e){e.old!==e.new&&(this._updateZIndex(e.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(e))},n._onGeometryPositionChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(e)},n._onGeometryShapeChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(e)},n._onGeometrySymbolChange=function(e){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(e)},n._onGeometryShow=function(e){this._getRenderer()&&this._getRenderer().onGeometryShow(e)},n._onGeometryHide=function(e){this._getRenderer()&&this._getRenderer().onGeometryHide(e)},n._onGeometryPropertiesChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(e)},n._hasGeoListeners=function(e){if(!e)return!1;Array.isArray(e)||(YE[0]=e,e=YE);for(var t=this.getGeometries()||[],n=0,i=t.length;n<i;n++)for(var r=0,a=e.length;r<a;r++){var o=e[r];if(t[n].listens(o)>0)return!0}return!1},t}(WT);JE.mergeOptions({drawImmediate:!1,geometryEvents:!0,geometryEventTolerance:1});var QE=new ES,KE={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:Y_.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,collision:!1,collisionBufferSize:2,collisionDelay:250,collisionScope:"layer"},$E=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}K_(t,e);var n=t.prototype;return n.onConfig=function(t){if(e.prototype.onConfig.call(this,t),t.enableAltitude||t.drawAltitude||t.altitudeProperty){var n=this.getRenderer();n&&n.setToRedraw&&n.setToRedraw()}},n.identify=function(e,t){void 0===t&&(t={});var n=this.getRenderer();e instanceof hS||(e=new hS(e));var i=this.getMap().coordToContainerPoint(e);return t.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(i,t):this._hitGeos(this._geoList,i,t)},n.identifyAtPoint=function(e,t){void 0===t&&(t={});var n=this.getRenderer();return e instanceof ax||(e=new ax(e)),t.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(e,t):this._hitGeos(this._geoList,e,t)},n._hitGeos=function(e,t,n){void 0===n&&(n={});var i=n.filter,r=[],a=n.tolerance,o=this.getMap(),s=this.getRenderer(),l=s&&s.getImageData&&s.getImageData();if(l){for(var u=0,c=e.length-1;c>=0;c--){var h=e[c]._hitTestTolerance()+(a||0);h>u&&(u=h)}var f=o.getDevicePixelRatio();l.r=f;for(var d=!1,p=t.x-u,m=t.y-u,v=-u;v<=u;v++){for(var g=-u;g<=u;g++){var y=Math.round((p+v)*f),_=Math.round((m+g)*f)*l.width*4+4*y;if(l.data[_+3]>0){d=!0;break}}if(d)break}if(!d)return r}for(var x=e.length-1;x>=0;x--){var b=e[x];if(b&&b.isVisible()&&b._getPainter()&&b.options.interactive){var w=b._getPainter(),S=w.getRenderBBOX&&w.getRenderBBOX();if(S){var M=t.x,T=t.y;if(M<S[0]||T<S[1]||M>S[2]||T>S[3])continue}if(!(b instanceof bE)||!b._getArrowStyle()&&!(b instanceof NE)){var E=b.getContainerExtent(QE);if(a&&(E=E._expand(a)),!E||!E.contains(t))continue}if(b._containsPoint(t,a)&&(!i||i(b))&&(r.push(b),n.count&&r.length>=n.count))break}}return r},n.getAltitude=function(){return this.options.altitude||0},n.toJSON=function(e){e||(e={});var t={type:this.getJSONType(),id:this.getId(),options:this.config()};if(i_(e.geometries)||e.geometries){var n;if(e.clipExtent){var i=this.getMap(),r=i?i.getProjection():null;n=new TS(e.clipExtent,r)}for(var a=[],o=this.getGeometries(),s=0,l=o.length;s<l;s++){var u=o[s],c=u.getExtent();if(c&&(!n||n.intersects(c))){var h=u.toJSON(e.geometries);a.push(h)}}t.geometries=a}return t},t.fromJSON=function(e){if(!e||"VectorLayer"!==e.type)return null;for(var n=new t(e.id,e.options),i=e.geometries,r=[],a=0;a<i.length;a++){var o=UT.fromJSON(i[a]);o&&r.push(o)}return n.addGeometry(r),n},t.getPainterClass=function(){return PT},t.getCollectionPainterClass=function(){return LT},t}(JE);$E.mergeOptions(KE),$E.registerJSONType("VectorLayer");var eC="_map_tool",tC=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addTo=function(e){return e?(this._map=e,e[eC]&&e[eC].disable(),this.onAdd&&this.onAdd(),this.enable(),e[eC]=this,this._fireEvent("add"),this):this},n.getMap=function(){return this._map},n.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},n.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},n.isEnabled=function(){return!!this._enabled},n.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[eC],delete this._map),this._fireEvent("remove"),this):this},n._registerEvents=function(){this._switchEvents("on")},n._switchEvents=function(e){var t=this.getEvents();t&&this._map[e](t,this)},n._fireEvent=function(e,t){t||(t={}),this.fire(e,t)},t}($w(tS)),nC={},iC=function(e){function t(t){var n;return(n=e.call(this,t)||this)._checkMode(),n._events={click:n._clickHandler,"mousemove touchmove":n._mouseMoveHandler,dblclick:n._doubleClickHandler,"mousedown touchstart":n._mouseDownHandler,"mouseup touchend":n._mouseUpHandler,mousemove:n._mouseMoveHandler,mousedown:n._mouseDownHandler,mouseup:n._mouseUpHandler},n}K_(t,e),t.registerMode=function(e,t){nC[e.toLowerCase()]=t},t.getRegisterMode=function(e){return nC[e.toLowerCase()]};var n=t.prototype;return n.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.setMode=function(e){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=e,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.getSymbol=function(){var e=this.options.symbol;return Xb(e||this.options.symbol)},n.setSymbol=function(e){return e?(this.options.symbol=e,this._geometry&&this._geometry.setSymbol(e),this):this},n.getCurrentGeometry=function(){return this._geometry},n.onAdd=function(){this._checkMode()},n.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var e=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=e.options.autoPanAtEdge,this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!0})),this._geometryEvents=e.options.geometryEvents,this.options.blockGeometryEvents&&e.config("geometryEvents",!1),this},n.onDisable=function(){var e=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(e.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&e.config("geometryEvents",this._geometryEvents),this},n.undo=function(){var e=this._getRegisterMode(),t=e.action;if(!this._shouldRecordHistory(t)||!this._historyPointer)return this;var n=this._clickCoords.slice(0,--this._historyPointer);return e.update(this.getMap().getProjection(),n,this._geometry),this},n.redo=function(){var e=this._getRegisterMode(),t=e.action;if(!this._shouldRecordHistory(t)||i_(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var n=this._clickCoords.slice(0,++this._historyPointer);return e.update(this.getMap().getProjection(),n,this._geometry),this},n._shouldRecordHistory=function(e){return Array.isArray(e)&&"click"===e[0]&&"mousemove"===e[1]&&"dblclick"===e[2]},n._checkMode=function(){this._getRegisterMode()},n._saveMapCfg=function(){var e=this.getMap();this._mapDoubleClickZoom=e.options.doubleClickZoom,e.config({doubleClickZoom:this.options.doubleClickZoom});for(var t=this._getRegisterMode().action,n=!1,i=0;i<t.length;i++)if(t[i].indexOf("mousedown")>=0||t[i].indexOf("touchstart")>=0){n=!0;break}if(n){var r=this.getMap();this._mapDraggable=r.options.draggable,r.config({draggable:!1})}},n._restoreMapCfg=function(){var e=this.getMap();e.config({doubleClickZoom:this._mapDoubleClickZoom}),i_(this._mapDraggable)||e.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n._loadResources=function(){var e=wb(this.getSymbol());e.length>0&&this._drawToolLayer._getRenderer().loadResources(e)},n._getProjection=function(){return this._map.getProjection()},n._getRegisterMode=function(){var e=this.getMode(),n=t.getRegisterMode(e);if(!n)throw new Error(e+" is not a valid mode of DrawTool.");return n},n.getEvents=function(){var e=this._getRegisterMode().action,t={};if(Array.isArray(e)){for(var n=0;n<e.length;n++)t[e[n]]=this._events[e[n]];return t}return null},n._mouseDownHandler=function(e){this._createGeometry(e)},n._mouseUpHandler=function(e){this.endDraw(e)},n._clickHandler=function(e){var t=this.getMap(),n=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var i=this._clickCoords.length,r=t._pointToPrj(e.point2d);if(this._clickCoords[i-1].equals(r))return}if(this._geometry){var a=t._pointToPrj(e.point2d);i_(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var o=this._geometry.snapTo;if(o&&l_(o)){var s=this._getSnapResult(o,e.containerPoint);if(a=s.prjCoord,this._clickCoords=this._clickCoords.concat(s.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(a))return}if(this._clickCoords.push(a),this._historyPointer=this._clickCoords.length,e.drawTool=this,n.update(t.getProjection(),this._clickCoords,this._geometry,e),"point"===this.getMode())return void this.endDraw(e);this._clickCoords.length<=1?this._fireEvent("drawstart",e):this._fireEvent("drawvertex",e),n.clickLimit&&n.clickLimit===this._historyPointer&&this.endDraw(e)}else this._createGeometry(e)},n._createGeometry=function(e){var t=this.getMode(),n=this._getRegisterMode(),i=this.getMap()._pointToPrj(e.point2d),r=this.getSymbol();if(!this._geometry){this._clickCoords=[i],e.drawTool=this,this._geometry=n.create(this.getMap().getProjection(),this._clickCoords,e),r&&"point"!==t?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",e);var a=this._geometry.snapTo;if(a&&l_(a)){var o=this._getSnapResult(a,e.containerPoint),s=this.getMap();if(s&&o){var l=o.prjCoord;this._clickCoords=[l],n.update(s.getProjection(),this._clickCoords,this._geometry,e)}}}"point"===t&&"mousemove"!==e.type&&this.endDraw(e)},n._mouseMoveHandler=function(e){var t=this.getMap();if(t&&!t.isInteracting())if("point"!==this.getMode()||this._geometry){if(this._geometry){var n=this._getMouseContainerPoint(e);if(this._isValidContainerPoint(n)){var i=t._pointToPrj(e.point2d),r=[],a=this._geometry.snapTo;if(a&&l_(a)){var o=this._getSnapResult(a,n);i=o.prjCoord,r=o.effectedVertex}var s=t.getProjection();e.drawTool=this;var l=this._getRegisterMode();if(this._shouldRecordHistory(l.action)){var u=this._clickCoords.slice(0,this._historyPointer);if(u&&u.length>0&&i.equals(u[u.length-1]))return;l.update(s,u.concat(r,[i]),this._geometry,e)}else l.update(s,i,this._geometry,e);this._fireEvent("mousemove",e)}}}else this._createGeometry(e)},n._doubleClickHandler=function(e){if(this._geometry){var t=this._getMouseContainerPoint(e);if(this._isValidContainerPoint(t)){var n=this._getRegisterMode(),i=this._clickCoords;if(!(i.length<2)){var r=this.getMode();if(!(r&&r.indexOf("polygon")>-1&&i.length<3)){for(var a=this.getMap().getProjection(),o=[i[0]],s=1,l=i.length;s<l;s++)i[s].x===i[s-1].x&&i[s].y===i[s-1].y||o.push(i[s]);o.length<2||this._geometry&&this._geometry instanceof vE&&o.length<3||(e.drawTool=this,n.update(a,o,this._geometry,e),this.endDraw(e))}}}}},n._addGeometryToStage=function(e){this._getDrawLayer().addGeometry(e)},n.endDraw=function(e){if(!this._geometry||this._ending)return this;this._ending=!0;var t=this._geometry;return this._clearStage(),e=e||{},this._geometry=t,e.ignoreEndEvent||this._fireEvent("drawend",e),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},n._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n._getMouseContainerPoint=function(e){var t=this._getRegisterMode().action;return(t[0].indexOf("mousedown")>=0||t[0].indexOf("touchstart")>=0)&&cw(e.domEvent),e.containerPoint},n._isValidContainerPoint=function(e){var t=this._map.getSize(),n=t.width,i=t.height;return!(e.x<0||e.y<0)&&!(e.x>n||e.y>i)},n._getSnapResult=function(e,t){var n=this.getMap(),i=[];if(this.options.edgeAutoComplete){var r=this._clickCoords[(this._historyPointer||1)-1];i.push(n._prjToContainerPoint(r));var a=this._clickCoords[(this._historyPointer||1)-2];a&&i.push(n._prjToContainerPoint(a))}var o=e(t,i);t=(o.effectedVertex?o.point:o)||t;var s=n._containerPointToPrj(t);return o.effectedVertex&&(o.effectedVertex=o.effectedVertex.map((function(e){return n._containerPointToPrj(e)}))),{prjCoord:s,effectedVertex:o.effectedVertex||[]}},n._getDrawLayer=function(){var e=Zy+"drawtool",t=this._map.getLayer(e);return t||(t=new $E(e,{enableSimplify:!1,enableAltitude:this.options.enableAltitude}),this._map.addLayer(t)),t},n._fireEvent=function(e,t){t||(t={}),t=n_({},t),this._geometry&&(t.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),t.tempGeometry=this._geometry),tC.prototype._fireEvent.call(this,e,t)},t}(tC);iC.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1});var rC=function(e){function t(t){var n;return(n=e.call(this,t)||this).drawTool=new iC({mode:"boxZoom",ignoreMouseleave:!1}),n}K_(t,e);var n=t.prototype;return n.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},n.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},n._onMouseDown=function(e){this.target.options.boxZoom&&e.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},n._boxZoom=function(e){var t=this.target;this.drawTool.remove();var n=e.geometry,i=n.getCenter(),r=n.getSymbol(),a=r.markerWidth,o=r.markerHeight,s=new TS(i,t.locateByPoint(i,a,o),t.getProjection()),l=t.getFitZoom(s);t._animateTo({center:s.getCenter(),zoom:l})},t}(eS);QT.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),QT.addOnLoadHook("addHandler","boxZoom",rC);var aC=30,oC=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},n.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},n._onMouseMove=function(e){var t=this.target;if(t.options.autoPanAtEdge){var n=e.containerPoint,i=t.getContainerExtent();if(i){var r,a=n.x,o=n.y,s=i.xmax,l=i.ymax;a<aC&&(r=[Math.abs(a-aC),0]),o<aC&&(r=[0,Math.abs(o-aC)]),a+aC>s&&(r=[-Math.abs(a+aC-s),0]),o+aC>l&&(r=[0,-Math.abs(o+aC-l)]),r&&t.panBy(r,{duration:1})}}},t}(eS);function sC(e,t,n){return e*(1-n)+t*n}QT.mergeOptions({autoPanAtEdge:!1}),QT.addOnLoadHook("addHandler","autoPanAtEdge",oC),QT.include({animateTo:function(e,t,n){var i=this;void 0===t&&(t={}),e=n_({},this.getView(),e),l_(t)&&(n=t,t={});var r=this.getProjection(),a=this.getView(),o={},s=!0;for(var l in e)if(c_(e,l)&&!i_(e[l])&&("prjCenter"===l||!i_(a[l])))if(s=!1,"center"===l){var u=new hS(a[l]),c=new hS(e[l]);u.equals(c)||(o.center=[u,c])}else if("prjCenter"===l){var h=new hS(this._getPrjCenter()),f=new hS(e[l]);h.equals(f)||(o.prjCenter=[h,f])}else a[l]!==e[l]&&"around"!==l&&(o[l]=[a[l],e[l]]);if(s)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var d=e.around||new ax(this.width/2,this.height/2),p=this._getRenderer(),m=this._animPlayer=dE.animate(o,{easing:t.easing||"out",duration:t.duration||this.options.zoomAnimationDuration,framer:function(e){p.callInNextFrame(e)},repeat:t.repeat},(function(e){if(i.isRemoved())m.finish();else{if("running"===m.playState){if(e.styles.center){var a=e.styles.center;i._setPrjCenter(r.project(a)),i.onMoving(i._parseEventFromCoord(i.getCenter()))}else if(e.styles.prjCenter){var s=e.styles.prjCenter;i._setPrjCenter(s),i.onMoving(i._parseEventFromCoord(i.getCenter()))}i_(e.styles.zoom)||i.onZooming(e.styles.zoom,d),i_(e.styles.pitch)||i._setPitch(e.styles.pitch),i_(e.styles.bearing)||i._setBearing(e.styles.bearing),i._fireEvent("animating")}else"paused"===m.playState&&m!==i._mapAnimPlayer||(m._interupted||(o.center?i._setPrjCenter(r.project(o.center[1])):o.prjCenter&&i._setPrjCenter(o.prjCenter[1]),i_(o.pitch)||i._setPitch(o.pitch[1]),i_(o.bearing)||i._setBearing(o.bearing[1])),i._endAnim(m,o,d,t));n&&n(e)}}),this);return this._startAnim(o,d),m},_animateTo:function(e,t,n){return void 0===t&&(t={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(e,t,n),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(e,t,n){var i=this;void 0===t&&(t={}),e=n_({},this.getView(),e),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),l_(t)&&(n=t,t={}),t=n_({curve:1.42},t);var r=this;function a(e,t){return r.getResolution(t)/r.getResolution(e)}var o=e.around||new ax(this.width/2,this.height/2),s=this.getMinZoom(),l=this.getMaxZoom(),u=this.getProjection(),c=this.getView(),h=c.zoom,f=c.bearing,d=c.pitch,p="zoom"in e?yx(+e.zoom,s,l):h,m="bearing"in e?+e.bearing:f,v="pitch"in e?+e.pitch:d,g=u.project(e.center&&new hS(e.center)||this.getCenter()),y=a(p,h),_=u.project(this.getCenter()),x=g.sub(_),b=t.curve,w=Math.max(this.width,this.height),S=w/y,M=x.mag();if("minZoom"in t){var T=yx(Math.min(t.minZoom,h,p),s,l),E=w/a(T,h);b=Math.sqrt(E/M*2)}var C=b*b;function k(e){var t=(S*S-w*w+(e?-1:1)*C*C*M*M)/(2*(e?S:w)*C*M);return Math.log(Math.sqrt(t*t+1)-t)}function P(e){return(Math.exp(e)-Math.exp(-e))/2}function A(e){return(Math.exp(e)+Math.exp(-e))/2}var R=k(0),L=function(e){return A(R)/A(R+b*e)},I=function(e){return w*((A(R)*(P(t=R+b*e)/A(t))-P(R))/C)/M;var t},O=(k(1)-R)/b;if(Math.abs(M)<1e-6||!isFinite(O)){if(Math.abs(w-S)<1e-6)return this.animateTo(e,t,n);var D=S<w?-1:1;O=Math.abs(Math.log(S/w))/b,I=function(){return 0},L=function(e){return Math.exp(D*b*e)}}var N=this._getRenderer(),z=this._animPlayer=dE.animate({k:[0,1]},{easing:t.easing||"out",duration:t.duration||8,framer:function(e){N.callInNextFrame(e)}},(function(r){if(i.isRemoved())z.finish();else{var a=r.styles.k,s=a*O,l=1/L(s),u={};if(e.center){var c=1===a?g:_.add(x.multi(I(s)));u.prjCenter=[g,c]}if(h!==p){var y=1===a?p:i.getZoomForScale(l,h,!0);u.zoom=[h,y]}if(d!==v){var b=sC(d,v,a);u.pitch=[v,b]}if(f!==m){var w=sC(f,m,a);u.bearing=[m,w]}if("running"===z.playState){if(u.prjCenter){var S=u.prjCenter;i._setPrjCenter(S[1]),i.onMoving(i._parseEventFromCoord(i.getCenter()))}u.zoom&&i.onZooming(u.zoom[1],o),u.pitch&&i._setPitch(u.pitch[1]),u.bearing&&i._setBearing(u.bearing[1]),i._fireEvent("animating")}else"paused"===z.playState&&z!==i._mapAnimPlayer||(z._interupted||(u.prjCenter&&i._setPrjCenter(u.prjCenter[1]),u.pitch&&i._setPitch(u.pitch[1]),u.bearing&&i._setBearing(u.bearing[1])),i._endAnim(z,u,o,t));n&&n(r)}}));return this._startAnim({center:e.center,zoom:e.zoom!==h,pitch:v!==d,bearing:m!==f},o),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(e,t,n,i){delete this._animRotating;var r,a=e._interupted?"animateinterrupted":"animateend";if(e===this._animPlayer&&delete this._animPlayer,e===this._mapAnimPlayer&&delete this._mapAnimPlayer,t.center)r=e._interupted?this.getCenter():t.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(t.prjCenter){var o;o=e._interupted?this._getPrjCenter():t.prjCenter[1];var s=this._parseEventFromCoord(this.getProjection().unproject(o));s.point2d=this._prjToPoint(o),this.onMoveEnd(s)}i_(t.zoom)||(e._interupted?this.onZoomEnd(this.getZoom()):i.wheelZoom?this.onZooming(t.zoom[1],n):this.onZoomEnd(t.zoom[1])),a&&this._fireEvent(a),i_(t.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),i.wheelZoom||this._resumePrev(e)},_startAnim:function(e,t){this._animPlayer&&((e.center||e.prjCenter)&&this.onMoveStart(),e.zoom&&!this.isZooming()&&this.onZoomStart(e.zoom[1],t),(e.pitch||e.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(e){e&&(delete this._animRotating,"finished"!==e.playState&&(e._interupted=!0,e.cancel()),e===this._animPlayer&&delete this._animPlayer,e===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(e){if(this._prevAnimPlayer){var t=this._prevAnimPlayer;"paused"!==t.playState&&delete this._prevAnimPlayer,e!==t&&(this._animPlayer=t,t.play())}}});var lC="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function uC(e,t,n,i,r){var a=1/Math.tan(t/2),o=1/(i-r);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*i*o,e[15]=0,e}function cC(e,t,n){var i,r,a,o,s,l,u,c,h,f,d,p,m=n[0],v=n[1],g=n[2];return t===e?(e[12]=t[0]*m+t[4]*v+t[8]*g+t[12],e[13]=t[1]*m+t[5]*v+t[9]*g+t[13],e[14]=t[2]*m+t[6]*v+t[10]*g+t[14],e[15]=t[3]*m+t[7]*v+t[11]*g+t[15]):(i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=i,e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=i*m+s*v+h*g+t[12],e[13]=r*m+l*v+f*g+t[13],e[14]=a*m+u*v+d*g+t[14],e[15]=o*m+c*v+p*g+t[15]),e}function hC(e,t,n){var i=n[0],r=n[1],a=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fC(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],v=t[13],g=t[14],y=t[15],_=n[0],x=n[1],b=n[2],w=n[3];return e[0]=_*i+x*s+b*h+w*m,e[1]=_*r+x*l+b*f+w*v,e[2]=_*a+x*u+b*d+w*g,e[3]=_*o+x*c+b*p+w*y,_=n[4],x=n[5],b=n[6],w=n[7],e[4]=_*i+x*s+b*h+w*m,e[5]=_*r+x*l+b*f+w*v,e[6]=_*a+x*u+b*d+w*g,e[7]=_*o+x*c+b*p+w*y,_=n[8],x=n[9],b=n[10],w=n[11],e[8]=_*i+x*s+b*h+w*m,e[9]=_*r+x*l+b*f+w*v,e[10]=_*a+x*u+b*d+w*g,e[11]=_*o+x*c+b*p+w*y,_=n[12],x=n[13],b=n[14],w=n[15],e[12]=_*i+x*s+b*h+w*m,e[13]=_*r+x*l+b*f+w*v,e[14]=_*a+x*u+b*d+w*g,e[15]=_*o+x*c+b*p+w*y,e}function dC(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],y=n*s-i*o,_=n*l-r*o,x=n*u-a*o,b=i*l-r*s,w=i*u-a*s,S=r*u-a*l,M=c*m-h*p,T=c*v-f*p,E=c*g-d*p,C=h*v-f*m,k=h*g-d*m,P=f*g-d*v,A=y*P-_*k+x*C+b*E-w*T+S*M;return A?(A=1/A,e[0]=(s*P-l*k+u*C)*A,e[1]=(r*k-i*P-a*C)*A,e[2]=(m*S-v*w+g*b)*A,e[3]=(f*w-h*S-d*b)*A,e[4]=(l*E-o*P-u*T)*A,e[5]=(n*P-r*E+a*T)*A,e[6]=(v*x-p*S-g*_)*A,e[7]=(c*S-f*x+d*_)*A,e[8]=(o*k-s*E+u*M)*A,e[9]=(i*E-n*k-a*M)*A,e[10]=(p*w-m*x+g*y)*A,e[11]=(h*x-c*w-d*y)*A,e[12]=(s*T-o*C-l*M)*A,e[13]=(n*C-i*T+r*M)*A,e[14]=(m*_-p*b-v*y)*A,e[15]=(c*b-h*_+f*y)*A,e):null}function pC(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mC(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vC(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function gC(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function yC(e){var t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function _C(e,t){var n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function xC(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[0],s=n[1],l=n[2];return e[0]=r*l-a*s,e[1]=a*o-i*l,e[2]=i*s-r*o,e}function bC(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.hypot?Math.hypot(n,i,r):function(){var e=0,t=arguments.length;for(;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}(n,i,r)}function wC(e,t,n){var i=t[0],r=t[1],a=t[2],o=1/(n[3]*i+n[7]*r+n[11]*a+n[15]);return e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])*o,e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])*o,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])*o,e}QT.include({_registerDomEvents:function(){ow(this._panels.mapWrapper||this._containerDOM,lC,this._handleDOMEvent,this)},_removeDomEvents:function(){sw(this._panels.mapWrapper||this._containerDOM,lC,this._handleDOMEvent)},_handleDOMEvent:function(e){var t=this.options.clickTimeThreshold,n=e.type,i="mousedown"===n||"touchstart"===n&&(!e.touches||1===e.touches.length);i&&(this._domMouseDownTime=t_(),this._domMouseDownView=this.getView());var r="contextmenu"===n&&function(e){if(!e._domMouseDownView)return!0;var t=e.getView(),n=e._domMouseDownView;return t.bearing!==n.bearing||t.pitch!==n.pitch}(this);if("contextmenu"===n){uw(e);var a=this._domMouseDownTime;t_()-a<=t&&!r&&this._fireDOMEvent(this,e,"dom:"+e.type)}else this._fireDOMEvent(this,e,"dom:"+e.type);if(!this._ignoreEvent(e)){var o,s=!1;if(i)this._mouseDownTime=t_();else if("click"===n||"touchend"===n||"contextmenu"===n){if(!this._mouseDownTime)return;var l=this._mouseDownTime;if(delete this._mouseDownTime,t_()-l>t){if("click"===n||"contextmenu"===n)return}else if("contextmenu"===n){if(r)return}else"touchend"===n&&(s=!0)}s&&(this._clickTime&&t_()-this._clickTime<=t?(delete this._clickTime,o="dblclick",this._fireDOMEvent(this,e,"dom:dblclick")):(this._clickTime=t_(),o="click",this._fireDOMEvent(this,e,"dom:click"))),this._ignoreEvent(e)||(this._fireDOMEvent(this,e,n),o&&this._fireDOMEvent(this,e,o))}},_ignoreEvent:function(e){if(!e||!this._panels.control)return!1;if(this._isEventOutMap(e))return!0;var t,n=e.srcElement||e.target;if(n)for(;n&&n!==this._containerDOM;){if(n.className&&n.className.indexOf&&(n.className.indexOf("maptalks-control")>=0||n.className.indexOf("maptalks-ui")>=0&&t&&!t.eventsPropagation))return!0;t=n,n=n.parentNode}return!1},_isEventOutMap:function(e){if(this.getPitch()>this.options.maxVisualPitch){var t=pw(this._getActualEvent(e),this._containerDOM);if(!this.getContainerExtent().contains(t))return!0}return!1},_parseEvent:function(e,t){if(!e)return null;var n={domEvent:e};if("keypress"!==t){var i=this._getActualEvent(e);if(i&&void 0!==i.clientX){var r=pw(i,this._containerDOM);n=n_(n,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)});var a=this.options.maxVisualPitch;(this.getPitch()<=a||r.y>=this.height-this._getVisualHeight(a))&&(n=n_(n,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return n},_parseEventFromCoord:function(e){var t=this.coordToContainerPoint(e);return{coordinate:e,containerPoint:t,viewPoint:this.containerPointToViewPoint(t),point2d:this.coordToPoint(e)}},_getActualEvent:function(e){return e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e},_fireDOMEvent:function(e,t,n){var i=this;if(!this.isRemoved()){var r=this._parseEvent(t,n);Ew(n)?this.getRenderer().callInNextFrame((function(){r.domEvent&&r.domEvent._cancelBubble?i._fireEvent("_"+n,r):i._fireEvent(n,r)})):this._fireEvent(n,r)}},_getEventParams:function(e){var t=this,n={domEvent:e},i=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(i){var r=pw(i,t._containerDOM);n.coordinate=t.containerPointToCoordinate(r),n.containerPoint=r,n.viewPoint=t.containerPointToViewPoint(r),n.pont2d=t._containerPointToPoint(r)}return n}}),QT.addOnLoadHook("_registerDomEvents"),QT.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(e){return this._fireEvent("fullscreenstart"),this._requestFullScreen(e||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(e){if(e.requestFullscreen)e.requestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.webkitRequestFullScreen)e.webkitRequestFullScreen();else if(e.msRequestFullScreen)e.msRequestFullScreen();else{var t="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",t)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),QT.include({panTo:function(e,t,n){if(void 0===t&&(t={}),!e)return this;if(l_(t)&&(n=t,t={}),e=new hS(e),"undefined"===typeof t.animation||t.animation){var i=this.getProjection().project(e);return this._panAnimation(i,t.duration,n)}return this.setCenter(e),this},_panTo:function(e,t){return void 0===t&&(t={}),"undefined"===typeof t.animation||t.animation?this._panAnimation(e,t.duration):(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(e,t,n){if(void 0===t&&(t={}),!e)return this;if(l_(t)&&(n=t,t={}),e=new ax(e),this.getContainerExtent().ymin>0&&e.y>30){var i=e.y;e.y=30,e.x=30*e.x/i,console.warn("offset is limited to panBy when pitch is above maxPitch")}if("undefined"===typeof t.animation||t.animation){e=e.multi(-1);var r=this._containerPointToPrj(new ax(this.width/2+e.x,this.height/2+e.y));this._panAnimation(r,t.duration,n)}else{this.onMoveStart(),this._offsetCenterByPixel(e);var a=this.containerPointToCoord(new ax(this.width/2,this.height/2));this.onMoveEnd(this._parseEventFromCoord(a))}return this},_panAnimation:function(e,t,n){return this._animateTo({prjCenter:e},{duration:t||this.options.panAnimationDuration},n)}}),UT.fromJSON=function(e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var r=UT.fromJSON(e[n]);Array.isArray(e)?t=t.concat(r):t.push(r)}return t}return e&&!e.feature?RE.toGeometry(e):(e.subType?(a=UT.getJSONClass(e.subType).fromJSON(e),i_(e.feature.id)||a.setId(e.feature.id)):(a=RE.toGeometry(e.feature),e.options&&a.config(e.options)),e.symbol&&a.setSymbol(e.symbol),e.infoWindow&&a.setInfoWindow(e.infoWindow),a);var a},WT.fromJSON=function(e){if(!e)return null;var t=e.type,n=WT.getJSONClass(t);if(!n||!n.fromJSON)throw new Error("unsupported layer type:"+t);return n.fromJSON(e)},QT.include({JSON_VERSION:"1.0",toJSON:function(e){e||(e={});var t={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};t.options=this.config(),t.options.center=this.getCenter(),t.options.zoom=this.getZoom(),t.options.bearing=this.getBearing(),t.options.pitch=this.getPitch();var n=this.getBaseLayer();(i_(e.baseLayer)||e.baseLayer)&&n&&(t.baseLayer=n.toJSON(e.baseLayer));var i={};e.clipExtent&&(!0===e.clipExtent?i.clipExtent=this.getExtent():i.clipExtent=e.clipExtent);var r=[];if(i_(e.layers)||e.layers&&!Array.isArray(e.layers)){for(var a=this.getLayers(),o=0,s=a.length;o<s;o++)if(a[o].toJSON){var l=n_({},o_(e.layers)?e.layers:{},i);r.push(a[o].toJSON(l))}t.layers=r}else if(_x(e.layers)){for(var u=e.layers,c=0;c<u.length;c++){var h=u[c],f=this.getLayer(h.id);if(f.toJSON){var d=n_({},h.options,i);r.push(f.toJSON(d))}}t.layers=r}else t.layers=[];return t}}),QT.fromJSON=function(e,t,n){if(!e||!t)return null;n||(n={});var i=new QT(e,t.options);if(i_(n.baseLayer)||n.baseLayer){var r=WT.fromJSON(t.baseLayer);r&&i.setBaseLayer(r)}if(i_(n.layers)||n.layers){for(var a=[],o=t.layers,s=0;s<o.length;s++){var l=WT.fromJSON(o[s]);a.push(l)}i.addLayer(a)}return i},QT.include({computeLength:function(e,t){if(!this.getProjection())return null;var n=new hS(e),i=new hS(t);return n.equals(i)?0:this.getProjection().measureLength(n,i)},computeGeometryLength:function(e){return e._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(e){return e._computeGeodesicArea(this.getProjection())},identify:function(e,t){var n=new hS((e=e||{}).coordinate);return this._identify(e,t,(function(t){return t.identify(n,e)}))},identifyAtPoint:function(e,t){var n=e.includeInternals,i=e.tolerance,r=new ax((e=e||{}).containerPoint),a=this.containerPointToCoord(r);return this._identify(e,t,(function(t){var o;return n&&!i_(t.options.geometryEventTolerance)&&(e.tolerance=e.tolerance||0,e.tolerance+=t.options.geometryEventTolerance),o=t.identifyAtPoint?t.identifyAtPoint(r,e):a&&t.identify?t.identify(a,e):[],n&&(i_(i)?delete e.tolerance:e.tolerance=i),o&&o.length||t.fire("identifyempty",e),o}))},_identify:function(e,t,n){var i=e.layers;if(!_x(i))return this;for(var r=e.eventTypes,a=[],o=0,s=i.length;o<s;o++)s_(i[o])?a.push(this.getLayer(i[o])):a.push(i[o]);r&&(a=a.filter((function(e){return!e._hasGeoListeners||e._hasGeoListeners(r)})));for(var l=[],u=a.length-1;u>=0&&!(e.count&&l.length>=e.count);u--){var c=a[u];if(c&&c.getMap()&&(e.includeInvisible||c.isVisible())&&(e.includeInternals||!(c.getId().indexOf(Zy)>=0))){var h=n(c);h&&(Array.isArray(h)?hx(l,h):l.push(h))}}return t.call(this,l),this}}),QT.include({_zoom:function(e,t){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoomOrigin(t),e=this._checkZoom(e),this.onZoomStart(e,t),this._frameZoom=this.getZoom(),this.onZoomEnd(e,t))},_zoomAnimation:function(e,t,n){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoom(e),this.getZoom()!==e&&(t=this._checkZoomOrigin(t),this._startZoomAnim(e,t,n)))},_checkZoomOrigin:function(e){return e&&!this.options.zoomInCenter||(e=new ax(this.width/2,this.height/2)),this.options.zoomOrigin&&(e=new ax(this.options.zoomOrigin)),e},_startZoomAnim:function(e,t,n){i_(n)&&(n=1);var i=this._getResolution(this._startZoomVal)/this._getResolution(e),r=this.options.zoomAnimationDuration*Math.abs(i-n)/Math.abs(i-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:e,around:t},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(e,t){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),delete this.cameraZenithDistance,this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(t),this._fireEvent("zoomstart",{from:this._startZoomVal,to:e}))},onZooming:function(e,t,n){if(this.options.zoomable&&this._frameZoom!==e){i_(n)&&(n=1),this._zoomTo(e,t);var i=this.getResolution(e),r=this.getResolution(this._startZoomVal)/i/n,a=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),o=this.getViewPoint();if(!this.isRotating()&&!a.equals(t)&&1!==r){var s=this.getPitch(),l=a._sub(t)._multi(1/(1-r));s&&(l.y/=Math.cos(s*Math.PI/180)),t=t.add(l)}var u={view:[r,0,0,r,(t.x-o.x)*(1-r),(t.y-o.y)*(1-r)]},c=this.getDevicePixelRatio();1!==c&&(t=t.multi(c)),u.container=[r,0,0,r,t.x*(1-r),t.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:e,origin:t,matrix:u}),this._frameZoom=e}},onZoomEnd:function(e,t){if(this.options.zoomable){var n=this._startZoomVal;this._zoomTo(e,t),this._zooming=!1,this._getRenderer().onZoomEnd(),this._suppressRecenter||this._recenterOnTerrain(),this._fireEvent("zoomend",{from:n,to:e}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(e,t){this._zoomLevel=e,this._calcMatrices(),t&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,t)},_checkZoom:function(e){var t=this.getMaxZoom(),n=this.getMinZoom();return e<n&&(e=n),e>t&&(e=t),e}});var SC=Math.PI/180,MC=new hS(0,0),TC=new ax(0,0);function EC(){return pC(new Array(16))}QT.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/SC},setFov:function(e){if(this.isZooming())return this;if(e=Math.max(.01,Math.min(60,e)),this._fov===e)return this;var t=this.getFov();return this._fov=e*SC,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:t,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/SC:0},setBearing:function(e){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(e)},_setBearing:function(e){if(Y_.ie9)throw new Error("map can't rotate in IE9.");var t=-gx(e,-180,180)*SC;if(this._angle===t)return this;var n=this.getBearing();return this._fireEvent("rotatestart",{from:n,to:t}),this._angle=t,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:n,to:t}),this._fireEvent("rotateend",{from:n,to:t}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(e){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(e)},_setPitch:function(e){if(Y_.ie9)throw new Error("map can't tilt in IE9.");var t=yx(e,0,this.options.maxPitch)*SC;if(this._pitch===t)return this;var n=this.getPitch();return this._fireEvent("pitchstart",{from:n,to:t}),this._pitch=t,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:n,to:t}),this._fireEvent("pitchend",{from:n,to:t}),this},setCameraMovements:function(e,t){var n=this;if(!Array.isArray(e)||!e.length)return this;if(this.setView({center:e[0].center,zoom:e[0].zoom,pitch:e[0].pitch,bearing:e[0].bearing}),1===e.length)return this;var i=1,r=function(a){if("finished"===a.state.playState){++i===e.length-1&&(r=null);var o=e[i];o.duration=o.timestamp-e[i-1].timestamp,t&&t.autoRotate&&(o.bearing=function(e,t){var n=f_(e[0]),i=f_(t[0]),r=f_(e[1]),a=f_(t[1]),o=Math.sin(i-n)*Math.cos(a),s=Math.cos(r)*Math.sin(a)-Math.sin(r)*Math.cos(a)*Math.cos(i-n);return d_(Math.atan2(o,s))}(e[i-1].center,o.center)),n._setCameraMovement(o,r)}};2===e.length&&(r=null);var a=this.getBearing();this._setCameraMovement(Q_({bearing:a},e[i],{duration:e[i].timestamp-e[i-1].timestamp}),r);return{play:function(){n._animPlayer.play()},pause:function(){n._animPlayer.pause()},cancel:function(){n._animPlayer.cancel()},finish:function(){n._animPlayer.finish()},reverse:function(){n._animPlayer.reverse()}}},_setCameraMovement:function(e,t){this.animateTo({zoom:e.zoom,center:e.center,pitch:e.pitch,bearing:e.bearing},{duration:e.duration,easing:"out"},t)},setCameraPosition:function(e){var t=e.position,n=e.pitch,i=e.bearing,r=t[2]*this._meterToGLPoint,a=(this.centerAltitude||0)*this._meterToGLPoint,o=n*SC,s=(r-a)/Math.cos(o),l=Math.sin(o)*s,u=s+a,c=this._getZoomFromCameraToCenterDistance(u),h=gx(i,-180,180)*SC,f=this.getGLRes(),d=new hS(t[0],t[1]),p=this.coordToPointAtRes(d,f),m=new ax(0,0);m.x=p.x+l*Math.sin(h),m.y=p.y+l*Math.cos(h);var v=this._pointToPrjAtRes(m,this.getGLRes());return this._setPrjCenter(v),this.setView({bearing:i,pitch:n,zoom:c}),this},_getZoomFromCameraToCenterDistance:function(e){for(var t=e*this._getFovRatio()*2/(this.height||1)*this.getGLRes(),n=this._getResolutions(),i=0;i<n.length-1;i++){if(n[i]===t)return i;if(n[i+1]===t)return i+1;if(t<n[i]&&t>n[i+1])return(i=(t-n[i])/(n[i+1]-n[i])+i)-1}return i},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var e=90-this.getPitch(),t=this.getFov()/2,n=this.cameraPosition?this.cameraPosition[2]:0;if(t<=e)return n;t=Math.PI*t/180;var i=new ax(this.cameraPosition).distanceTo(new ax(this.cameraLookAt)),r=n*Math.tan(2*t);return n+Math.tan(t)*(i+r)},_pointToContainerPoint:function(e,t,n,i){void 0===n&&(n=0);var r=this._getResolution(t);return this._pointAtResToContainerPoint(e,r,n,i)},_pointAtResToContainerPoint:function(e,t,n,i){void 0===n&&(n=0),i||(i=new ax(0,0)),e=this._pointAtResToPoint(e,t,i);var r,a=this.isTransforming();return a||n||(r=this._prjToPoint(this._getPrjCenter(),void 0,MC)),this._toContainerPoint(i,a,n,r),i},_pointsAtResToContainerPoints:function(e,t,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var r=this.getPitch(),a=this.getBearing(),o=t/this._getResolution();if(0===r&&0===a&&!function(e){if(r_(e))return 0!==e;if(Array.isArray(e)&&e.length>0)for(var t=0,n=e.length;t<n;t++)if(r_(e[t])&&0!==e[t])return!0;return!1}(n)){var s=this._get2DExtent(),l=s.xmin,u=s.ymin,c=s.xmax,h=s.ymax;if(c>l&&h>u){for(var f=this.getSize(),d=f.width,p=f.height,m=(c-l)/d,v=(h-u)/p,g=0,y=e.length;g<y;g++)if(e[g]){var _=i[g];_.x=e[g].x,_.y=e[g].y,_._multi(o),_.x=(_.x-l)*m,_.y=p-(_.y-u)*v}else i[g]=null;return i}}for(var x=Array.isArray(n),b=this.isTransforming(),w=this._prjToPoint(this._getPrjCenter(),void 0,MC),S=0,M=e.length;S<M;S++)if(e[S]){var T=i[S];T.x=e[S].x,T.y=e[S].y,T._multi(o);var E=x?n[S]||0:n;this._toContainerPoint(T,b,E,w)}else i[S]=null;return i},_toContainerPoint:function(){var e=[0,0,0];return function(t,n,i,r){var a=this.width/2,o=this.height/2;if(n||i){this._altitudeScale||(this._altitudeScale=this.altitudeToPoint(100,this.getGLRes())/100);var s=this._glScale;vC(e,t.x*s,t.y*s,i*this._altitudeScale);var l=this._projIfBehindCamera(e,this.cameraPosition,this.cameraForward);wC(l,l,this.projViewMatrix),t.x=l[0]*a+a,t.y=-l[1]*o+o}else t._sub(r.x,r.y),t.set(t.x,-t.y),t._add(a,o)}}(),_projIfBehindCamera:function(){var e=new Array(3),t=new Array(3),n=new Array(3);return function(i,r,a){gC(e,i,r);var o,s,l=(s=e,(o=a)[0]*s[0]+o[1]*s[1]+o[2]*s[2]);return l<=0&&(function(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}(t,a,1.01*l),function(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}(i,r,gC(n,e,t))),i}}(),_containerPointToPoint:function(e,t,n){var i=this._getResolution(t);return this._containerPointToPointAtRes(e,i,n)},_containerPointToPointAtRes:function(){var e=[0,0,0],t=[0,0,0,1],n=[0,0,0,1];return function(i,r,a){if(this.isTransforming()){var o=this.width/2||1,s=this.height/2||1;vC(e,(i.x-o)/o,(s-i.y)/s,0),vC(t,e[0],e[1],0),vC(n,e[0],e[1],1),t[3]=n[3]=1,wC(t,t,this.projViewMatrixInverse),wC(n,n,this.projViewMatrixInverse);var l=t[0],u=n[0],c=t[1],h=n[1],f=t[2],d=n[2],p=f===d?0:(0-f)/(d-f),m=vx(l,u,p),v=vx(c,h,p);return a?(a.x=m,a.y=v):a=new ax(m,v),a._multi(1/this._glScale),this._getResolution()===r?a:this._pointToPointAtRes(a,r,a)}var g=this._prjToPointAtRes(this._getPrjCenter(),r,a),y=this._getResolution()/r,_=y*(i.x-this.width/2),x=y*(i.y-this.height/2);return g._add(_,-x)}}(),_calcMatrices:function(){var e=EC();return function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),n=t.width||1,i=t.height||1;this._glScale=this.getGLScale();var r=this._getCameraWorldMatrix(),a=this.getFov()*Math.PI/180,o=this._getCameraFar(a,this.getPitch());this.cameraFar=o,this.cameraNear=this.cameraCenterDistance/20;var s=this.projMatrix||EC();uC(s,a,n/i,this.cameraNear,o),this.projMatrix=s,this.viewMatrix=dC(this.viewMatrix||EC(),r),this.projViewMatrix=fC(this.projViewMatrix||EC(),s,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=fC(this.projViewMatrixInverse||EC(),r,dC(e,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}}(),_getCameraFar:function(e,t){var n=this.cameraCenterDistance=bC(this.cameraPosition,this.cameraLookAt),i=n,r=(this.options.cameraInfiniteFar?10:4)*n;if(t>0&&(t=t*Math.PI/180,2/Math.PI-t>e/2)){var a=Math.tan(e/2),o=Math.tan(t);r=Math.max(n*a/(1/o-a),r)}return(i+=r)+1},_calcCascadeMatrixes:function(){var e=EC();function t(t,n,i){var r=this.width,a=this.height,o=this.getFov()*Math.PI/180,s=this._getCameraFar(o,n),l=this.cameraCenterDistance;s=l+(s-l)/Math.cos((90-n)*Math.PI/180)*Math.cos((90-t)*Math.PI/180),uC(e,o,r/a,.1,s);var u=this.viewMatrix;return fC(i,e,u)}return function(){var e=this.getPitch(),n=this.options.cascadePitches[0],i=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||EC(),a=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||EC();e>n?t.call(this,e,n,r):mC(this.cascadeFrustumMatrix0,this.projViewMatrix),e>i?t.call(this,e,i,a):mC(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var e=EC(),t=EC(),n=[1,-1,1],i=[0,0,0];return function(){var r=this.width||1,a=this.height||1,o=.5/Math.tan(this._fov/2)*a;return hC(e,this.projMatrix,n),cC(e,e,vC(i,0,0,-o)),this._pitch&&function(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+u*i,e[5]=o*r+c*i,e[6]=s*r+h*i,e[7]=l*r+f*i,e[8]=u*r-a*i,e[9]=c*r-o*i,e[10]=h*r-s*i,e[11]=f*r-l*i}(e,e,this._pitch),this._angle&&function(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],h=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+u*i,e[1]=o*r+c*i,e[2]=s*r+h*i,e[3]=l*r+f*i,e[4]=u*r-a*i,e[5]=c*r-o*i,e[6]=h*r-s*i,e[7]=f*r-l*i}(e,e,this._angle),pC(t),hC(t,t,vC(i,r/2,-a/2,1)),fC(this.domCssMatrix||EC(),t,e)}}(),_getFovZ:function(e){var t=this.getGLScale(e),n=this._getFovRatio();return t*(this.height||1)/2/n},_getCameraWorldMatrix:function(){var e={};return function(){var t=this.getGLRes();this._meterToGLPoint||(this._meterToGLPoint=this.distanceToPointAtRes(100,0,t).x/100);var n=this._prjToPointAtRes(this._prjCenter,t,TC),i=(this.centerAltitude||0)*this._meterToGLPoint;this.cameraLookAt=vC(this.cameraLookAt||[0,0,0],n.x,n.y,i);var r=this.getPitch()*SC,a=this.getBearing()*SC,o=this._getFovZ(),s=(void 0===this.cameraZenithDistance?o:this.cameraZenithDistance)-i,l=s*Math.cos(r),u=Math.sin(r)*s,c=n.x-u*Math.sin(a),h=n.y-u*Math.cos(a);this.cameraPosition=vC(this.cameraPosition||[0,0,0],c,h,l+i),this.cameraToCenterDistance=o;var f=u||1,d=this.cameraUp=vC(this.cameraUp||[0,0,0],Math.sin(a)*f,Math.cos(a)*f,0),p=this.cameraWorldMatrix=this.cameraWorldMatrix||EC();!function(e,t,n,i){var r=[0,0,0],a=[0,0,0],o=[0,0,0];gC(o,t,n),0===yC(o)&&(o[2]=1),_C(o,o),xC(r,i,o),0===yC(o)&&(1===Math.abs(i[2])?o[0]+=1e-4:o[2]+=1e-4,_C(o,o),xC(r,i,o)),_C(r,r),xC(a,o,r),e[0]=r[0],e[4]=a[0],e[8]=o[0],e[1]=r[1],e[5]=a[1],e[9]=o[1],e[2]=r[2],e[6]=a[2],e[10]=o[2]}(p,this.cameraPosition,this.cameraLookAt,d);var m=this.cameraForward||[0,0,0];return gC(m,this.cameraLookAt,this.cameraPosition),this.cameraForward=_C(m,m),function(e,t){var n,i=t[0],r=t[4],a=t[8],o=t[1],s=t[5],l=t[9],u=t[2],c=t[6],h=t[10],f=i+s+h;f>0?(n=.5/Math.sqrt(f+1),e.w=.25/n,e.x=(c-l)*n,e.y=(a-u)*n,e.z=(o-r)*n):i>s&&i>h?(n=2*Math.sqrt(1+i-s-h),e.w=(c-l)/n,e.x=.25*n,e.y=(r+o)/n,e.z=(a+u)/n):s>h?(n=2*Math.sqrt(1+s-i-h),e.w=(a-u)/n,e.x=(r+o)/n,e.y=.25*n,e.z=(l+c)/n):(n=2*Math.sqrt(1+h-i-s),e.w=(o-r)/n,e.x=(a+u)/n,e.y=(l+c)/n,e.z=.25*n)}(e,p),function(e,t){var n=e,i=t.x,r=t.y,a=t.z,o=t.w,s=i+i,l=r+r,u=a+a,c=i*s,h=i*l,f=i*u,d=r*l,p=r*u,m=a*u,v=o*s,g=o*l,y=o*u;n[0]=1-(d+m),n[4]=h-y,n[8]=f+g,n[1]=h+y,n[5]=1-(c+m),n[9]=p-v,n[2]=f-g,n[6]=p+v,n[10]=1-(c+d),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(p,e),function(e,t){var n=e;n[12]=t[0],n[13]=t[1],n[14]=t[2]}(p,this.cameraPosition),p}}(),updateCenterAltitude:function(){this.getRenderer().setToRedraw(),!this.centerAltitude&&this._hasAltitudeLayer()&&(this.centerAltitude=0),this._recenterOnTerrain()},_recenterOnTerrain:function(){if(void 0!==this.centerAltitude){var e=this._queryTerrainByProjCoord(this._prjCenter);i_(e)&&this._hasAltitudeLayer()&&(e=this.centerAltitude);var t=e||0,n=this.getPitch()*SC,i=this.getBearing()*SC,r=(t-this.centerAltitude)*this._meterToGLPoint,a=this._getFovZ(),o=(void 0===this.cameraZenithDistance?a:this.cameraZenithDistance)-this.centerAltitude*this._meterToGLPoint-r/Math.cos(n),s=this.cameraPosition,l=Math.sin(n)*o,u=TC;u.x=s[0]+l*Math.sin(i),u.y=s[1]+l*Math.cos(i);var c=t*this._meterToGLPoint;this.cameraZenithDistance=(s[2]-c)/Math.cos(n)+c,this.centerAltitude=t;var h=this.pointAtResToCoordinate(u,this.getGLRes(),MC);this._eventSilence=!0,this._suppressRecenter=!0,this.setCenter(h),delete this._suppressRecenter,delete this._eventSilence,i_(e)&&delete this.centerAltitude}},_queryTerrainByProjCoord:function(e){for(var t=this._getLayers(),n=0;n<t.length;n++)if(t[n].queryTerrainByProjCoord)return t[n].queryTerrainByProjCoord(e)[0];return 0},_hasAltitudeLayer:function(){for(var e=this._getLayers(),t=0;t<e.length;t++)if(e[t].getTerrainLayer&&e[t].getTerrainLayer())return!0;return!1},_getFovRatio:function(){var e=this.getFov();return Math.tan(e/2*SC)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(e){if(e){var t=e._getRenderer();t&&t.setToRedraw&&t.setToRedraw()}}))}}),QT.include({_onViewChange:function(e){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var t=this._getCurrentView(),n=this._viewHistory.length-1;n>=0;n--)if(Px(e,this._viewHistory[n]))return this._viewHistoryPointer=n,void this._fireViewChange(t,e);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(e);var i=this.options.viewHistoryCount;i>0&&this._viewHistory.length>i&&this._viewHistory.splice(0,this._viewHistory.length-i),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(t,e)},zoomToPreviousView:function(e){if(void 0===e&&(e={}),!this.hasPreviousView())return null;var t=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(t,e),t},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(e){if(void 0===e&&(e={}),!this.hasNextView())return null;var t=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(t,e),t},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(e,t){var n=this,i=this.getView();t.animation?this._animateTo(e,{duration:t.duration},(function(t){"finished"===t.state.playState&&n._fireViewChange(i,e)})):(this.setView(e),this._fireViewChange(i,e))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(e,t){this._fireEvent("viewchange",{old:e,new:t}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),QT.mergeOptions({viewHistory:!0,viewHistoryCount:10});var CC=new aS;QT.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new aS,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||0===this.uiList.length||!this._uiCollidesQueue||0===this._uiCollidesQueue.length)return this;var e=CC;e.clear();for(var t=this.uiList,n=0,i=t.length;n<i;n++){var r=t[n],a=r.options,o=a.collisionBufferSize;if(a.collision){var s=r.getDOM();if(r.isVisible()&&s&&s.getBoundingClientRect){r.bbox||(r.bbox=[0,0,0,0]);var l=s.getBoundingClientRect(),u=l.x,c=l.y,h=l.width,f=l.height;if(0===h||0===f){var d=r.getSize();d&&(h=d.width,f=d.height)}var p=u-o,m=u+h+o,v=c-o,g=c+f+o;r.bbox[0]=p,r.bbox[1]=v,r.bbox[2]=m,r.bbox[3]=g,e.collides(r.bbox)?r._collidesEffect(!1):(e.insertBox(r.bbox),r._collidesEffect(!0))}}}return this._uiCollidesQueue=[],this},_addUI:function(e){return this.uiList||(this.uiList=[]),this.uiList.indexOf(e)>-1||(this.uiList.push(e),this.uiList=this.uiList.sort((function(e,t){return t.options.collisionWeight-e.options.collisionWeight}))),this},_removeUI:function(e){if(!this.uiList)return-1;var t=this.uiList.indexOf(e);return t<0||this.uiList.splice(t,1),t}});var kC=function(e){function t(t){var n;return(n=e.call(this,t)||this).on("enable",n._afterEnable,ex(ex(n))).on("disable",n._afterDisable,ex(ex(n))),n._measureLayers=[],n}K_(t,e);var n=t.prototype;return n.clear=function(){if(_x(this._measureLayers))for(var e=0;e<this._measureLayers.length;e++)this._measureLayers[e].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},n.getMeasureLayers=function(){return this._measureLayers},n.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},n.undo=function(){e.prototype.undo.call(this);var t=this._historyPointer;if(t!==this._vertexes.length)for(var n=t;n<this._vertexes.length;n++)this._vertexes[n].label&&this._vertexes[n].label.remove(),this._vertexes[n].marker.remove();return this},n.redo=function(){e.prototype.redo.call(this);var t=this._historyPointer-1;return this._vertexes[t]&&(this._vertexes[t].marker.getLayer()||(this._vertexes[t].label&&this._vertexes[t].label.addTo(this._measureMarkerLayer),this._vertexes[t].marker.addTo(this._measureMarkerLayer))),this},n._measure=function(e){var t,n,i=this.getMap();e instanceof UT?t=i.computeGeometryLength(e):Array.isArray(e)&&(t=i.getProjection().measureLength(e)),this._lastMeasure=t,n="zh-CN"===this.options.language?[" \u7c73"," \u516c\u91cc"," \u82f1\u5c3a"," \u82f1\u91cc"]:[" m"," km"," feet"," mile"];var r="",a=this.options.decimalPlaces;return this.options.metric&&(r+=t<1e3?t.toFixed(a)+n[0]:(t/1e3).toFixed(a)+n[1]),this.options.imperial&&(t*=3.2808399,r.length>0&&(r+="\n"),r+=t<5280?t.toFixed(a)+n[2]:(t/5280).toFixed(a)+n[3]),r},n._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},n._afterEnable=function(){this._registerMeasureEvents()},n._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},n._msOnDrawStart=function(e){var t=this.getMap(),n=t._pointToPrj(e.point2d),i=ux(),r="distancetool_"+i,a="distancetool_markers_"+i;t.getLayer(r)?(this._measureLineLayer=t.getLayer(r),this._measureMarkerLayer=t.getLayer(a)):(this._measureLineLayer=new $E(r).addTo(t),this._measureMarkerLayer=new $E(a).addTo(t)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var o=new _E(e.coordinate,{symbol:this.options.vertexSymbol});o._setPrjCoordinates(n);var s="zh-CN"===this.options.language?"\u8d77\u70b9":"start",l=new VE(s,e.coordinate,this.options.labelOptions);l._setPrjCoordinates(n),this._lastVertex=l,this._addVertexMarker(o,l)},n._msOnMouseMove=function(e){var t=this._measure(this._msGetCoordsToMeasure(e));if(!this._tailMarker){var n=Xb(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new _E(e.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new VE(t,e.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var i=this._geometry._getPrjCoordinates(),r=i[i.length-1];this._tailMarker.setCoordinates(e.coordinate),this._tailMarker._setPrjCoordinates(r),this._tailLabel.setContent(t),this._tailLabel.setCoordinates(e.coordinate),this._tailLabel._setPrjCoordinates(r)},n._msGetCoordsToMeasure=function(e){return e.geometry.getCoordinates().concat([e.coordinate])},n._msOnDrawVertex=function(e){var t=this._geometry._getPrjCoordinates(),n=t[t.length-1],i=e.geometry,r=new _E(e.coordinate,{symbol:this.options.vertexSymbol}),a=this._measure(i),o=new VE(a,e.coordinate,this.options.labelOptions);this._addVertexMarker(r,o),o._setPrjCoordinates(n),r._setPrjCoordinates(n),this._lastVertex=o},n._addVertexMarker=function(e,t){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:t,marker:e}),this._measureMarkerLayer.addGeometry(e),t&&this._measureMarkerLayer.addGeometry(t)},n._msOnDrawEnd=function(e){if(this._clearTailMarker(),e.geometry._getPrjCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var t=this._lastVertex.getSize();t||(t=new Tb(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),t.width);var n=e.geometry.copy();n._setPrjCoordinates(e.geometry._getPrjCoordinates()),n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},n._addClearMarker=function(e,t,n){var i=this.options.clearButtonSymbol,r={markerDx:(i.markerDx||0)+n,textDx:(i.textDx||0)+n};Array.isArray(i)&&(r=i.map((function(e){return e?{markerDx:(e.markerDx||0)+n,textDx:(e.textDx||0)+n}:null}))),i=Xb(i,r);var a=new _E(e,{symbol:i}),o=this._measureLineLayer,s=this._measureMarkerLayer;a.on("click",(function(){return o.remove(),s.remove(),!1}),this),a.addTo(this._measureMarkerLayer),a._setPrjCoordinates(t)},n._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},n._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},t}(iC);kC.mergeOptions({decimalPlaces:2,mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var PC=function(e){function t(t){var n;return(n=e.call(this,t)||this)._measureLayers=[],n}K_(t,e);var n=t.prototype;return n._measure=function(e){var t,n,i=this.getMap();e instanceof UT?t=i.computeGeometryArea(e):Array.isArray(e)&&(t=i.getProjection().measureArea(e)),this._lastMeasure=t,n="zh-CN"===this.options.language?[" \u5e73\u65b9\u7c73"," \u5e73\u65b9\u516c\u91cc"," \u5e73\u65b9\u82f1\u5c3a"," \u5e73\u65b9\u82f1\u91cc"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="",a=this.options.decimalPlaces;if(this.options.metric&&(r+=t<1e6?t.toFixed(a)+n[0]:(t/1e6).toFixed(a)+n[1]),this.options.imperial){t*=3.2808399,r.length>0&&(r+="\n");var o=27878400;r+=t<o?t.toFixed(a)+n[2]:(t/o).toFixed(a)+n[3]}return r},n._msGetCoordsToMeasure=function(e){return e.geometry.getShell().concat([e.coordinate])},n._msOnDrawVertex=function(e){var t=this.getMap()._pointToPrj(e.point2d),n=new _E(e.coordinate,{symbol:this.options.vertexSymbol});n._setPrjCoordinates(t),this._measure(e.geometry),this._lastVertex=n,this._addVertexMarker(n)},n._msOnDrawEnd=function(e){var t;if(this._clearTailMarker(),e.point2d)t=this.getMap()._pointToPrj(e.point2d);else{var n=e.geometry._getPrjCoordinates();n=n.slice(0,n.length-1),e.geometry._setPrjCoordinates(n),t=n[n.length-1]}if(e.geometry._getPrjCoordinates().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var i=this._measure(e.geometry),r=this.getMap().getProjection().unproject(t),a=new VE(i,r,this.options.labelOptions).addTo(this._measureMarkerLayer);a._setPrjCoordinates(t);var o=a.getSize();o||(o=new Tb(10,10)),this._addClearMarker(r,t,o.width);var s=e.geometry.copy();s._setPrjCoordinates(e.geometry._getPrjCoordinates()),s.addTo(this._measureLineLayer),this._lastMeasure=s.getArea()},t}(kC);PC.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}});var AC={create:function(e,t){var n=e.unproject(t[0]),i=new LE(n,0);return i._setPrjCoordinates(t[0]),i},update:function(e,t,n){var i=n.getMap(),r=Array.isArray(t)?t[t.length-1]:t,a=e.unproject(r),o=i.computeLength(n.getCenter(),a);n.setRadius(o)},generate:function(e){return e}};iC.registerMode("circle",n_({clickLimit:2,action:["click","mousemove","click"]},AC)),iC.registerMode("freeHandCircle",n_({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},AC));var RC={create:function(e,t){var n=e.unproject(t[0]),i=new IE(n,0,0);return i._setPrjCoordinates(t[0]),i},update:function(e,t,n){var i=n.getMap(),r=n.getCenter(),a=Array.isArray(t)?t[t.length-1]:t,o=e.unproject(a),s=i.computeLength(r,new hS({x:o.x,y:r.y})),l=i.computeLength(r,new hS({x:r.x,y:o.y}));n.setWidth(2*s),n.setHeight(2*l)},generate:function(e){return e}};iC.registerMode("ellipse",n_({clickLimit:2,action:["click","mousemove","click"]},RC)),iC.registerMode("freeHandEllipse",n_({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},RC));var LC={create:function(e,t){var n=new vE([]);return n._firstClick=t[0],n},update:function(e,t,n,i){var r=n.getMap(),a=i.containerPoint,o=r._prjToContainerPoint(n._firstClick),s=[[o.x,o.y],[a.x,o.y],[a.x,a.y],[o.x,a.y]];n.setCoordinates(s.map((function(e){return r.containerPointToCoord(new ax(e))}))),n._setPrjCoordinates(s.map((function(e){return r._containerPointToPrj(new ax(e))})))},generate:function(e){return e}};iC.registerMode("rectangle",n_({clickLimit:2,action:["click","mousemove","click"]},LC)),iC.registerMode("freeHandRectangle",n_({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},LC)),iC.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(e,t){var n=e.unproject(t[0]),i=new _E(n);return i._setPrjCoordinates(t[0]),i},generate:function(e){return e},update:function(e,t,n){if(Array.isArray(t)&&(t=t[t.length-1]),!t)return n;var i=e.unproject(t);return n.setCoordinates(i),n}});var IC={create:function(e,t){var n=t.map((function(t){return e.unproject(t)})),i=new bE(n);return i._setPrjCoordinates(t),i},update:function(e,t,n){var i,r=n.getSymbol();Array.isArray(t)?i=t:(i=n._getPrjCoordinates()).push(t);var a=i.map((function(t){return e.unproject(t)}));n.setCoordinates(a),n._setPrjCoordinates(i);var o=n.getLayer();if(o){var s=o.getGeometryById("polygon");if(!s&&i.length>=3){if(s=new vE([a],{id:"polygon"}),r){var l=Xb(r,{lineOpacity:0});s.setSymbol(l)}s.addTo(o)}s&&s._setPrjCoordinates(i)}},generate:function(e){var t=new vE(e.getCoordinates(),{symbol:e.getSymbol()});return t._setPrjCoordinates(e._getPrjCoordinates()),t._projCode=e._projCode,t}};iC.registerMode("polygon",n_({action:["click","mousemove","dblclick"]},IC)),iC.registerMode("freeHandPolygon",n_({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},IC));var OC={create:function(e,t){var n=t.map((function(t){return e.unproject(t)})),i=new bE(n);return i._setPrjCoordinates(t),i},update:function(e,t,n){var i;Array.isArray(t)?i=t:(i=n._getPrjCoordinates()).push(t);var r=i.map((function(t){return e.unproject(t)}));n.setCoordinates(r),n._setPrjCoordinates(i)},generate:function(e){return e}};function DC(e){for(var t=e.tileInfo,n=[t.cols,t.rows],i=[],r=t.lods,a=0,o=r.length;a<o;a++)i.push(r[a].resolution);var s=e.fullExtent,l=t.origin,u=[1,-1,l.x,l.y];return delete s.spatialReference,{spatialReference:{resolutions:i,fullExtent:s},tileSystem:u,tileSize:n}}function NC(e,t){return void 0===t&&(t=[]),t.forEach((function(t){var n=t[0],i=t[1];e=e.replace(n,i)})),e}function zC(e){var t=e.projection,n=e.isArcgis,i=e.isGeoServer,r=e.isSuperMap,a=.0002645833333333333;return(n||i||r)&&(a=28e-5),t&&t.indexOf("4326")>-1&&(a=2.3767925226029154e-9,(n||r)&&(a=2.518101729011901e-9),i&&(a=2.51528279553466e-9)),a}iC.registerMode("linestring",n_({action:["click","mousemove","dblclick"]},OC)),iC.registerMode("freeHandLinestring",n_({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},OC)),iC.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(e,t){var n=t.map((function(t){return e.unproject(t)})),i=new zE(n);return i._setPrjCoordinates(t),i},update:OC.update,generate:function(e){return e}}),iC.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(e,t){var n=t.map((function(t){return e.unproject(t)})),i=new FE(n);return i._setPrjCoordinates(t),i},update:OC.update,generate:function(e){return e}}),iC.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(e,t){var n=t.map((function(t){return e.unproject(t)})),i=new UE(n);return i._setPrjCoordinates(t),i},update:OC.update,generate:function(e){return e}}),iC.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(e,t){t=t[0];var n=e.unproject(t),i=new _E(n);return i._firstClick=t,i},update:function(e,t,n,i){var r=n.getMap(),a=r._prjToContainerPoint(n._firstClick),o=i.containerPoint;t=r._containerPointToPrj(new hS(Math.min(a.x,o.x),Math.min(a.y,o.y)));var s=e.unproject(t);n.setCoordinates(s)._setPrjCoordinates(t),n.updateSymbol({markerWidth:Math.abs(a.x-o.x),markerHeight:Math.abs(a.y-o.y)})},generate:function(e){return e}}),OT.loadArcgis=function(e,t,n){if(void 0===n&&(n={jsonp:!0}),s_(e)&&"{"!==e.substring(0,1))Lw.getJSON(e,(function(e,n){if(e)t(e);else{var i=DC(n);t(null,i)}}),n);else{s_(e)&&(e=cx(e));var i=DC(e);t(null,i)}return this};var UC="wmts";function FC(e,t){var n=e.getElementsByTagName(t);if(n&&n.length)return n;var i=UC+":"+t;return e.getElementsByTagName(i)}function BC(e,t){for(var n=0;n<e.length;n++){var i=e[n];if((i=i.getElementsByTagName("ows:Identifier")[0])&&i.textContent===t)return e[n]}return null}function HC(e,t){void 0===t&&(t={});var n,i,r,a=FC(e,"TileMatrix"),o=[],s=[],l=[],u=!1;if(!n){var c=e.getElementsByTagName("ows:SupportedCRS")[0];c&&(n=function(e){for(var t="",n=e.split(""),i=n.length-1;i>=0&&!isNaN(n[i]);i--)t=n[i]+t;return t}(n=(n=c.textContent).split("EPSG")[1]),n=function(e){var t=e.indexOf("EPSG")>-1?e:"EPSG:"+e;return NC(t,[["4490","4326"],["102100","3857"],["900913","3857"]])}(n))}i||(i=e.getElementsByTagName("ows:Identifier")[0])&&(i=i.textContent),t.projection=n;for(var h=1/0,f=0;f<a.length;f++){var d=a[f],p=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(p))?(r=p.substr(0,p.lastIndexOf(":")),p=(p=p.split(":"))[p.length-1],p=parseInt(p),u=!0,t.isGeoServer=!0):p=parseInt(p),h=Math.min(h,p);var m=FC(d,"ScaleDenominator")[0].textContent,v=FC(d,"TopLeftCorner")[0].textContent,g=FC(d,"TileWidth")[0].textContent,y=FC(d,"TileHeight")[0].textContent;if(0===l.length&&l.push(parseInt(g),parseInt(y)),0===s.length){var _=v.split(" ").filter((function(e){return""!==e})).map((function(e){return parseFloat(e)})),x=_[0],b=_[1];x>0?s.push(1,-1,b,x):s.push(1,-1,x,b)}var w=zC(t),S=parseFloat(m)*w;o.push(S)}if(h>0)for(var M=o[0],T=h-1;T>=0;T--)M*=2,o.splice(0,0,M);return{resolutions:o,tileSize:l,tileSystem:s,projection:n,TileMatrixSet:i,isGeoServer:u,levelStr:r}}OT.loadWMTS=function(e,t,n){return void 0===n&&(n={jsonp:!0}),s_(e)&&Lw.get(e,(function(i,r){if(i)t(i);else{var a=function(e,t,n){null==n.isArcgis&&(n.isArcgis=e.indexOf("arcgis")>-1),null==n.isSuperMap&&(n.isSuperMap=e.indexOf("supermap")>-1);var i=(new DOMParser).parseFromString(e,"text/xml").querySelectorAll("Contents")[0];if(!i)return[];var r=FC(i,"Layer");if(!r.length)return[];for(var a=[],o=0,s=i.childNodes.length;o<s;o++)"TileMatrixSet"===i.childNodes[o].localName&&a.push(i.childNodes[o]);if(!a.length)return[];for(var l=[],u=0,c=r.length;u<c;u++){var h=r[u],f=h.querySelectorAll("Style")[0];f&&(f=f.getElementsByTagName("ows:Identifier")[0])&&(f=f.textContent);var d=h.getElementsByTagName("ows:Identifier")[0];d&&(d=d.textContent);var p=FC(h,"TileMatrixSetLink");if(0!==p.length)for(var m=0,v=p.length;m<v;m++){var g=p[m];(g=FC(g,"TileMatrixSet")[0])&&(g=g.textContent);var y=BC(a,g);if(y){var _=h.querySelectorAll("ResourceURL")[0],x="";_&&(x=_.attributes.template.value);var b=HC(y,n),w=b.resolutions,S=b.tileSize,M=b.tileSystem,T=b.projection,E=b.TileMatrixSet,C=b.isGeoServer,k=b.levelStr;x.length||(x=t.substr(0,t.lastIndexOf("?")),x+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var P=NC(x,[["{LAYER}",d],["{Layer}",d],["{layer}",d],["{STYLE}",f],["{Style}",f],["{style}",f],["{TileMatrixSet}",E],["{TileMatrix}",C?k+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",C?"image/png":"tiles"]]);l.push({tileSize:S,tileSystem:M,spatialReference:{resolutions:w,projection:T},urlTemplate:P,info:{layerName:d,TileMatrixSet:E,style:f,tileSize:S,tileSystem:M,resolutions:w,projection:T,urlTemplate:P}})}}}return l}(r,e,n);t(null,a)}}),n),this};var jC=function(e){function t(t){var n;return(n=e.call(this,t)||this).proxyOptions(),n}K_(t,e);var n=t.prototype;return n.addTo=function(e){return this._owner=e,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},n.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},n._collides=function(){var e=this.getMap();return e?(e._addUI(this),e._insertUICollidesQueue(),this):this},n._collidesEffect=function(e){var t=this.getDOM();if(!t)return this;var n=e?"visible":"hidden";if(t.style.visibility=n,!t.classList||!t.classList.add)return this;if(!this.options.collisionFadeIn)return this;var i="mtk-ui-fadein",r=t.classList.contains(i);return e&&!r?t.classList.add(i):!e&&r&&t.classList.remove(i),this},n.show=function(e){var t=this,n=this.getMap();if(!n)return this;this.options.visible=!0,(e=e||this._coordinate||this._owner.getCenter())instanceof hS||(e=new hS(e));var i=this.isVisible();this._showBySymbolChange||this.fire("showstart");var r=this._getUIContainer();this._coordinate=e,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var a=this.__uiDOM=this.buildOn(n);a.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(a);var o=this.options.zIndex;if(!a)return this._showBySymbolChange||this.fire("showend"),this._collides(),this.setZIndex(o),this;this._measureSize(a),this._singleton()&&(a._uiComponent=this,n[this._uiDomKey()]=a),this._setPosition(),a.style[nw]=null,r.appendChild(a);var s=this._getAnimation();if(i&&(s.ok=!1),s.ok&&(s.fade&&(a.style.opacity=0),s.scale)){if(this.getTransformOrigin){var l=this.getTransformOrigin();a.style[tw]=l}a.style[ew]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(a.style.display=""),this.options.eventsToStop&&Mw(a,this.options.eventsToStop,cw);var u=s.transition;return s.ok&&u&&(a.offsetHeight,u&&(a.style[nw]=u),s.fade&&(a.style.opacity=1),s.scale&&(a.style[ew]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),clearTimeout(this._autoPanId),this.options.autoPan&&(this._autoPanId=setTimeout((function(){t._autoPan()}),32)),this.setZIndex(o),this},n.hide=function(){var e=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var t=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(t.ok=!1),t.ok?(n.offsetHeight,n.style[nw]=t.transition,setTimeout((function(){n.style.display="none",e.fire("hide")}),this.options.animationDuration)):(n.style.display="none",this.fire("hide")),t.fade&&(n.style.opacity=0),t.scale&&(n.style[ew]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},n.isVisible=function(){if(!this.options.visible)return!1;var e=this.getDOM();return this.getMap()&&e&&e.parentNode&&"none"!==e.style.display},n.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var e=this.getMap();return e&&e._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},n.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},n.getOwner=function(){return this._owner},n.getDOM=function(){return this.__uiDOM},n.setZIndex=function(e){if(!r_(e))return this;var t=this.getDOM();return t?(t.style.zIndex=e,e!==this.options.zIndex&&(this.options.zIndex=e),this):this},n._roundPoint=function(e){return this.options.roundPoint&&(e=e._round()),e},n.getPosition=function(){if(!this.getMap())return null;var e=this._roundPoint(this._getViewPoint());if(this.getOffset){var t=this._roundPoint(this.getOffset());t&&e._add(t)}return e},n._getAnimation=function(){for(var e={fade:!1,scale:!1},t=this.options.animation?this.options.animation.split(","):[],n=0;n<t.length;n++){var i=Eb(t[n]);"fade"===i?e.fade=!0:"scale"===i&&(e.scale=!0)}var r=null;return e.fade&&(r="opacity "+this.options.animationDuration+"ms"),e.scale&&(r=r?r+",":"",r+=ew+" "+this.options.animationDuration+"ms"),e.transition=r,e.ok=null!==r,e},n._getViewPoint=function(){var e=0,t=this._coordinate||{};r_(t.z)?e=t.z:this._owner&&this._owner.getAltitude&&(e=this._owner.getAltitude()||0);var n=this._meterToPoint(this._coordinate,e);return this.getMap().coordToViewPoint(this._coordinate,void 0,n)._add(this.options.dx,this.options.dy)},n._meterToPoint=function(e,t){return t},n._autoPan=function(){var e=this.getMap(),t=this.getDOM();if(t&&e&&!e.isMoving()){var n=this._getViewPoint()._round(),i=e.width,r=e.height;if(t&&t.getBoundingClientRect){var a=50,o=t.getBoundingClientRect(),s=0,l=0,u=o.left,c=o.right,h=o.top,f=o.bottom,d=o.width,p=o.height;if(d>0&&p>0){if(u<a&&(s=a-u),0===s&&c+a>i&&(s=-(c+a-i)),h<a&&(l=a-h),0===l&&f+a>r&&(l=-(f+a-r)),0!==s||0!==l)e.getPitch()>40&&0!==l&&this._coordinate?e.animateTo({center:this._coordinate},{duration:e.options.panAnimationDuration}):e.panBy([Math.ceil(s),Math.ceil(l)]);return}}var m=e.viewPointToContainerPoint(n),v=this.getOffset(),g=m.add(v),y=e._viewPointToPrj(n),_=parseInt(t.clientWidth),x=parseInt(t.clientHeight),b=0,w=0;if(g.x<0?b=50-g.x:g.x+_>i&&(b=-(g.x+_-i)-50),g.y-x<0?w=Math.abs(g.y-x)+50:g.y+x>r&&(w=r-(g.y+x)-50),_>=i&&(b=i/2-m.x),0!==w||0!==b){var S=m.add(b,w),M=e._containerPointToPoint(S)._sub(e._prjToPoint(e._getPrjCenter())),T=e._pointToPrj(e._prjToPoint(y).sub(M));e._panAnimation(T)}}},n._measureSize=function(e){var t=this._getUIContainer();e.style.position="absolute";var n=e.style.bottom?"bottom":"top";if(e.style.display="",t.appendChild(e),e.getBoundingClientRect){var i=e.getBoundingClientRect();this._size=new Tb(i.width,i.height)}else this._size=new Tb(e.clientWidth,e.clientHeight);return e.style.display="none",e.style.left="0px",e.style[n]="0px",this._size},n._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var e=this.options.eventsToStop;if(this._singleton()){var t=this.getMap(),n=this._uiDomKey();if(t[n]){e&&Tw(t[n],e,cw);var i=t[n]._uiComponent;i&&i!==this&&i.isVisible()&&i.fire("hide"),aw(t[n]),i&&!this.hideDom&&i._switchMapEvents("off"),delete t[n]}delete this.__uiDOM}else this.__uiDOM&&(e&&Tw(this.__uiDOM,e,cw),aw(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},n._uiDomKey=function(){return"__ui_"+this._getClassName()},n._singleton=function(){return this.options.single},n._getUIContainer=function(){return this.getMap()._panels.ui},n._getClassName=function(){return"UIComponent"},n._switchMapEvents=function(e){var t=this.getMap();if(t){this._mapEventsOn="on"===e;var n=this._getDefaultEvents();if(this.getEvents&&n_(n,this.getEvents()),n)for(var i in n)n.hasOwnProperty(i)&&t[e](i,n[i],this)}},n._switchEvents=function(e){var t=this._getOwnerEvents();if(this._owner)for(var n in t)t.hasOwnProperty(n)&&this._owner[e](n,t[n],this)},n._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},n._getOwnerEvents=function(){var e={};return this._owner&&this._owner instanceof UT&&(e.positionchange=this.onGeometryPositionChange,e.symbolchange=this._updatePosition),this.getOwnerEvents&&n_(e,this.getOwnerEvents()),e},n.onGeometryPositionChange=function(e){this._owner&&this.isVisible()&&(this._showBySymbolChange=!0,this.show(e.target.getCenter()),delete this._showBySymbolChange)},n.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},n.onEvent=function(){this.isVisible()&&this._updatePosition()},n.onZoomEnd=function(){this.isVisible()&&this._setPosition()},n.onResize=function(){this.isVisible()&&this._setPosition()},n.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},n._updatePosition=function(){return this.getMap()?(this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this)),this):this},n._setPosition=function(){var e=this.getDOM();if(e){e.style[nw]=null;var t=this.getPosition();this._pos=t,e.style[ew]=this._toCSSTranslate(t)+" scale(1)"}},n._toCSSTranslate=function(e){if(!e)return"";if(Y_.any3d){var t=this.getMap(),n=t?t.getBearing():0,i=t?t.getPitch():0,r="";return this.options.pitchWithMap&&i&&(r+=" rotateX("+Math.round(i)+"deg)"),this.options.rotateWithMap&&n&&(r+=" rotateZ("+Math.round(-n)+"deg)"),"translate3d("+e.x+"px,"+e.y+"px, 0px)"+r}return"translate("+e.x+"px,"+e.y+"px)"},n._observerDomSize=function(e){var t=this;return e&&Y_.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver((function(e){if(e.length){var n=e[0].borderBoxSize;n&&n.length?t._domContentRect={width:n[0].inlineSize,height:n[0].blockSize}:t._domContentRect=e[0].contentRect}else delete t._domContentRect;t.onDomSizeChange&&t.onDomSizeChange()})),this._resizeObserver.observe(e),this):this},n.isSupportZoomFilter=function(){return!1},n.onConfig=function(){return this._updatePosition(),this},t.isSupport=function(e){return!!(e&&l_(e.on)&&l_(e.off)&&l_(e.getCenter))},t}($w(tS));jC.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1,zIndex:0});var GC="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",VC=function(e){function t(t,n){var i;return(i=e.call(this,n)||this)._markerCoord=new hS(t),i}K_(t,e);var n=t.prototype;return n._getClassName=function(){return"UIMarker"},n.setCoordinates=function(e){return this._markerCoord=e,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},n.getCoordinates=function(){return this._markerCoord},n.getCenter=function(){return this.getCoordinates()},n.getAltitude=function(){var e=this.getCoordinates()||{};return r_(e.z)?e.z:this.options.altitude||0},n.setAltitude=function(e){return r_(e)&&this._markerCoord&&(this._markerCoord.z=e,this._updatePosition&&(this._updatePosition(),this._collides())),this},n.setContent=function(e){var t=this.options.content;return this.options.content=e,this.fire("contentchange",{old:t,new:e}),this.isVisible()&&this.show(),this},n.getContent=function(){return this.options.content},n.onAdd=function(){this.show()},n.show=function(){return e.prototype.show.call(this,this._markerCoord)},n.flash=function(e,t,n,i){return Rx.call(this,e,t,n,i)},n.buildOn=function(){var e,t=this.options.content,n=s_(t);return n||l_(t)?(e=iw("div"),n?e.innerHTML=this.options.content:t.bind(this)(e)):e=this.options.content,this.options.containerClass&&(e.className=this.options.containerClass),this._registerDOMEvents(e),e},n.getOffset=function(){var e=this.getSize(),t=-e.width/2,n=-e.height/2,i=this.options,r=i.horizontalAlignment,a=i.verticalAlignment;return"left"===r?t=-e.width:"right"===r&&(t=0),"top"===a?n=-e.height:"bottom"===a&&(n=0),new ax(t,n)},n.getTransformOrigin=function(){return"center center"},n.onDomRemove=function(){var e=this.getDOM();this._removeDOMEvents(e)},n.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},n._registerDOMEvents=function(e){Mw(e,GC,this._onDomEvents,this)},n._onDomEvents=function(e){var t=this.getMap()._parseEvent(e,e.type),n=e.type;if("mousedown"===n&&(this._mousedownEvent=e),"mouseup"===n&&(this._mouseupEvent=e),("click"!==n||!this._mouseClickPositionIsChange())&&("touchstart"===n&&(this._touchstartTime=t_()),this.fire(e.type,t),"touchend"===n&&Y_.touch)){var i=this.getMap().options.clickTimeThreshold||280;t_()-this._touchstartTime<i&&this._onDomEvents(n_({},e,{type:"click"}))}},n._removeDOMEvents=function(e){Tw(e,GC,this._onDomEvents,this)},n._mouseClickPositionIsChange=function(){var e=this._mousedownEvent||{},t=e.x,n=e.y,i=this._mouseupEvent||{},r=i.x,a=i.y;return t!==r||n!==a},n._getConnectPoints=function(){var e=this.getMap(),t=e.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),i=n.width,r=n.height;return[e.containerPointToCoordinate(t.add(-i/2,0)),e.containerPointToCoordinate(t.add(i/2,0)),e.containerPointToCoordinate(t.add(0,r/2)),e.containerPointToCoordinate(t.add(0,-r/2))]},n._getViewPoint=function(){var e=0;if(this._owner){var t=this.getAltitude();t>0&&(e=this._meterToPoint(this._coordinate,t))}return this.getMap().coordToViewPoint(this._coordinate,void 0,e)._add(this.options.dx,this.options.dy)},n._getDefaultEvents=function(){return n_({},e.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},n._setPosition=function(){this.onZoomFilter(),e.prototype._setPosition.call(this)},n.onZoomFilter=function(){var e=this.getDOM();e&&(this.isVisible()||"none"===e.style.display?this.isVisible()&&"none"===e.style.display&&(e.style.display=""):e.style.display="none")},n.isVisible=function(){var e=this.getMap();if(!e)return!1;if(!this.options.visible)return!1;var t=e.getZoom(),n=this.options,i=n.minZoom,r=n.maxZoom;return!(!i_(i)&&t<i||!i_(r)&&t>r)&&(this.getDOM()&&!0)},n.isSupportZoomFilter=function(){return!0},t}(oS(jC));VC.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"});var WC=Y_.touch?"touchstart mousedown":"mousedown",XC=function(e){function t(t){return e.call(this,t)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){this.target.on(WC,this._startDrag,this)},n.removeHooks=function(){this.target.off(WC,this._startDrag,this)},n._startDrag=function(e){var t=e.domEvent;t.touches&&t.touches.length>1||2===t.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=e.coordinate,this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),this.target.fire("dragstart",e))},n._prepareDragHandler=function(){this._dragHandler=new cS(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},n._cancelOn=function(e){var t=(e.srcElement||e.target).tagName.toLowerCase();return"button"===t||"input"===t||"select"===t||"option"===t||"textarea"===t},n._onMouseDown=function(e){cw(e.domEvent)},n._dragging=function(e){var t=this.target,n=t.getMap()._parseEvent(e.domEvent),i=n.domEvent;if(!(i.touches&&i.touches.length>1))if(this._isDragging){var r=n.coordinate,a=n.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=a);var o=r.sub(this._lastCoord),s=a.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=a,this.target.setCoordinates(this.target.getCoordinates().add(o)),n.coordOffset=o,n.pointOffset=s,t.fire("dragging",n)}else this._isDragging=!0},n._endDrag=function(e){var t=this.target,n=t.getMap();if(this._dragHandler&&(t.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,n){var i=n._parseEvent(e.domEvent);t&&t._mouseClickPositionIsChange&&t._mouseClickPositionIsChange()&&t.fire("dragend",i)}},n.isDragging=function(){return!!this._isDragging},t}(eS);VC.addInitHook("addHandler","draggable",XC);var ZC=/\{ *([\w_]+) *\}/g,qC={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},YC=new Tb(0,0),JC=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n._getClassName=function(){return"InfoWindow"},n.addTo=function(t){return t instanceof UT&&(t.getInfoWindow()&&t.getInfoWindow()!==this&&t.removeInfoWindow(),t._infoWindow=this),e.prototype.addTo.call(this,t)},n.setContent=function(e){var t=this.options.content;return this.options.content=e,this.fire("contentchange",{old:t,new:e}),this.isVisible()&&this.show(this._coordinate),this},n.getContent=function(){return this.options.content},n.setTitle=function(e){var t=e;return this.options.title=e,this.fire("contentchange",{old:t,new:e}),this.isVisible()&&this.show(this._coordinate),this},n.getTitle=function(){return this.options.title},n.buildOn=function(){var e=l_(this.options.content),t=s_(this.options.content);if(this.options.custom){if(t||e){var n=iw("div");return t?(n.innerHTML=this.options.content,this._replaceTemplate(n)):this.options.content.bind(this)(n),n}return this._replaceTemplate(this.options.content),this.options.content}this._bindDomEvents(this.getDOM(),"off");var i=iw("div");this.options.containerClass&&(i.className=this.options.containerClass);var r=this._getWindowWidth();i.style.width=r_(r)?r+"px":"auto",i.style.bottom="0px";var a='<em class="maptalks-ico"></em>';this.options.title&&(a+="<h2>"+this.options.title+"</h2>"),a+='<a href="javascript:void(0);" class="maptalks-close">\xd7</a><div class="maptalks-msgContent"></div>',i.innerHTML=a,this._replaceTemplate(i);var o=i.querySelector(".maptalks-msgContent");return t||e?t?o.innerHTML=this.options.content:this.options.content.bind(this)(o):o.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this),ow(i.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),e||this._replaceTemplate(o),this._bindDomEvents(i,"on"),i},n._replaceTemplate=function(e){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&e&&e.innerHTML){var t=this._owner.getProperties()||{};if(o_(t)){var n=e.innerHTML;e.innerHTML=n.replace(ZC,(function(e,n){return t[n]}))}}return this},n.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},n.getOffset=function(){var e=this.getSize(),t=new ax(-e.width/2,0);this.options.custom?t._sub(0,e.height):t._sub(4,12);var n=this.getOwner();if(n instanceof _E||n instanceof EE){var i,r;if(n instanceof _E)i=n._getPainter(),r=n.getSize();else{var a=n.getGeometries();if(!a||!a.length)return t;i=a[0]._getPainter(),r=a[0].getSize()}if(r||(r=YC),i){var o=i.getFixedExtent();t._add(o.xmax-r.width/2,o.ymin)}else t._add(0,-r.height)}return t},n.show=function(t){return this.getMap()&&this.getMap().options.enableInfoWindow?e.prototype.show.call(this,t):this},n.getEvents=function(){if(!this.options.autoCloseOn)return null;var e={};return e[this.options.autoCloseOn]=this.hide,e},n.getOwnerEvents=function(){var e=this.getOwner();if(!this.options.autoOpenOn||!e)return null;var t={};return t[this.options.autoOpenOn]=this._onAutoOpen,t},n.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},n.onDomRemove=function(){this._onCloseBtnClick&&(sw(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},n._onAutoOpen=function(e){var t=this,n=this.getOwner();setTimeout((function(){n instanceof _E||n instanceof jC?t.show(n.getCoordinates()):n instanceof EE?t.show(n.findClosest(e.coordinate)):n instanceof bE||n instanceof kE?(t.getMap().getScale()>=8&&(e.coordinate=t._rectifyMouseCoordinte(n,e.coordinate)),t.show(e.coordinate)):t.show(e.coordinate)}),1)},n._rectifyMouseCoordinte=function(e,t){var n=this;return e instanceof bE?this._rectifyLineStringMouseCoordinate(e,t).coordinate:e instanceof kE?e.getGeometries().map((function(e){return n._rectifyLineStringMouseCoordinate(e,t)})).sort((function(e,t){return e.dis-t.dis}))[0].coordinate:t},n._rectifyLineStringMouseCoordinate=function(e,t){for(var n=this,i=e.getCoordinates().map((function(e){return n.getMap().coordToContainerPoint(e)})),r=this.getMap().coordToContainerPoint(t),a=1/0,o=-1,s=0,l=i.length;s<l;s++){var u=i[s],c=r.distanceTo(u);c<a&&(a=c,o=s)}var h=[];0===o?h.push(i[0],i[1]):o===i.length-1?h.push(i[o-1],i[o]):h.push(i[o-1],i[o],i[o+1]);for(var f=[],d=this.getMap().getSize(),p=d.width,m=d.height,v=0,g=h.length-1;v<g;v++){var y=h[v],_=h[v+1];if(y.x===_.x)for(var x=Math.max(0,Math.min(y.y,_.y)),b=Math.min(m,Math.max(y.y,_.y)),w=x;w<=b;w++)f.push(new ax(y.x,w));else for(var S=(_.y-y.y)/(_.x-y.x),M=Math.max(0,Math.min(y.x,_.x)),T=Math.min(p,Math.max(y.x,_.x)),E=M;E<=T;E++){var C=S*(E-y.x)+y.y;f.push(new ax(E,C))}}for(var k=1/0,P=-1,A=0,R=f.length;A<R;A++){var L=f[A],I=r.distanceTo(L);I<k&&(k=I,P=A)}return{dis:k,coordinate:P<0?t:this.getMap().containerPointToCoord(f[P])}},n._getWindowWidth=function(){var e=qC.width,t=this.options.width;return t||(t=e),t},n._bindDomEvents=function(e,t){if(e){var n=this._getDomEvents(),i="on"===t?Mw:Tw;for(var r in n)i(e,r,n[r],this)}},n._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},n._onDomMouseover=function(e){var t=this.getMap();t&&(t.options.preventWheelScroll=!1)},n._onDomMouseout=function(e){var t=this.getMap();t&&(t.options.preventWheelScroll=!0)},t}(jC);JC.mergeOptions(qC);var QC="remove hide shapechange positionchange dragend animatestart",KC=function(e){K_(n,e);var t=n.prototype;function n(t,n){var i;return void 0===n&&(n={}),(i=e.call(this,n)||this)._content=t,i}return t._getClassName=function(){return"ToolTip"},t.addTo=function(t){if(n.isSupport(t))return t.on("mousemove",this.onMouseMove,this),t.on("mouseout",this.onMouseOut,this),t.on(QC,this.hideDom,this),e.prototype.addTo.call(this,t);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},t.setStyle=function(e){return this.options.containerClass=e,this},t.getStyle=function(){return this.options.containerClass},t.getContent=function(){return this._content},t.buildOn=function(){var e=iw("div"),t=this.options||{};t.height&&(e.style.height=t.height+"px"),t.width&&(e.style.width=t.width+"px");var n=t.containerClass||t.cssName;return!n&&t.height&&(e.style.lineHeight=t.height+"px"),l_(this._content)?this._content.bind(this)(e):e.innerHTML='<div class="'+n+'">'+this._content+"</div>",e},t.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},t.onMouseMove=function(e){var t=this;clearTimeout(this._timeout);var n=this.getMap();if(n){var i=n.locateByPoint(e.coordinate,-5,25);0===this.options.showTimeout?this.show(i):this._timeout=setTimeout((function(){n&&t.show(i)}),this.options.showTimeout)}},t.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(QC,this.hideDom,this))},t.hideDom=function(){return this.hide()},t.onEvent=function(){return e.prototype.onEvent.call(this),this.hideDom(),this},t._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},n}(jC);KC.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var $C=function(e){function t(t){return e.call(this,t)||this}K_(t,e);var n=t.prototype;return n._getClassName=function(){return"Menu"},n.addTo=function(e){return e._menu&&e._menu!==this&&e.removeMenu(),e._menu=this,this._owner=e,jC.prototype.addTo.apply(this,arguments)},n.setItems=function(e){return this.options.items=e,this},n.getItems=function(){return this.options.items||[]},n.buildOn=function(){if(this.options.custom){if(s_(this.options.items)){var e=iw("div");return e.innerHTML=this.options.items,e}return this.options.items}var t=iw("div");this.options.containerClass&&gw(t,this.options.containerClass),t.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();return t.appendChild(n),Mw(t,"contextmenu",uw),t},n.getOffset=function(){if(!this.getMap())return null;var e=this.getMap().getSize(),t=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),i=0,r=0;return t.x+n.width>e.width&&(i=-n.width),t.y+n.height>e.height&&(r=-n.height),new ax(i,r)},n.getTransformOrigin=function(){var e=this.getOffset()._multi(-1);return e.x+"px "+e.y+"px"},n.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},n._createMenuItemDom=function(){var e=this,t=this.getMap(),n=iw("ul");gw(n,"maptalks-menu-items");var i,r,a=this.getItems();function o(n){return function(i){var r=t._parseEvent(i,"click");r.target=e,r.owner=e._owner,r.index=n,!1!==this._callback(r)&&(e.hide(),e._owner&&e._owner.fire("closemenu"))}}for(var s=0,l=a.length;s<l;s++){if("-"===(i=a[s])||"_"===i)gw(r=iw("li"),"maptalks-menu-splitter");else{r=iw("li");var u=i.item;l_(u)&&(u=u({owner:this._owner,index:s})),r.innerHTML=u,r._callback=i.click,Mw(r,"click",o(s))}n.appendChild(r)}var c=this.options.maxHeight||0;return c>0&&mw(n,"max-height: "+c+"px; overflow-y: auto;"),n},n._getMenuWidth=function(){return this.options.width||160},t}(jC);$C.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var ek={setMenu:function(e){return this._menuOptions=e,this._menu?this._menu.setOptions(e):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(e){var t=this instanceof QT?this:this.getMap();return e||(e=this.getCenter()),this._menu?this._menu.show(e):this._menuOptions&&t&&(this._bindMenu(),this._menu.show(e)),this.fire("openmenu",{coordinate:e}),this},setMenuItems:function(e){return this._menuOptions||(this._menuOptions={}),Array.isArray(e)&&(this._menuOptions.custom=!1),this._menuOptions.items=e,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new $C(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(e){return this.openMenu(e.coordinate),!1}};QT.include(ek),UT.include(ek);var tk=function(e){function t(t){return t&&t.position&&!s_(t.position)&&(t.position=n_({},t.position)),e.call(this,t)||this}K_(t,e);var n=t.prototype;return n.addTo=function(e){if(this.remove(),!e.options.control)return this;this._map=e;var t=e._panels.control;return this.__ctrlContainer=iw("div"),mw(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),t.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:t}),this},n.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},n.getMap=function(){return this._map},n.getPosition=function(){return n_({},this._parse(this.options.position))},n.setPosition=function(e){return s_(e)?this.options.position=e:this.options.position=n_({},e),this._updatePosition(),this},n.getContainerPoint=function(){var e,t,n=this.getPosition(),i=this.getMap().getSize();return i_(n.left)?i_(n.right)||(e=i.width-parseInt(n.right)):e=parseInt(n.left),i_(n.top)?i_(n.bottom)||(t=i.height-parseInt(n.bottom)):t=parseInt(n.top),new ax(e,t)},n.getContainer=function(){return this.__ctrlContainer},n.getDOM=function(){return this._controlDom},n.show=function(){return this.__ctrlContainer.style.display="",this},n.hide=function(){return this.__ctrlContainer.style.display="none",this},n.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},n.remove=function(){return this._map?(aw(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},n._parse=function(e){var n=e;return s_(e)&&(n=t.positions[n]),n},n._updatePosition=function(){var e=this.getPosition();for(var t in e||(e={top:20,left:20}),e)e.hasOwnProperty(t)&&(e[t]=parseInt(e[t]),this.__ctrlContainer.style[t]=e[t]+"px");this.fire("positionchange",{position:n_({},e)})},t}($w(tS));tk.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},QT.mergeOptions({control:!0}),QT.include({addControl:function(e){return this._containerDOM.getContext||e.addTo(this),this},removeControl:function(e){return e&&e.getMap()===this?(e.remove(),this):this}});var nk="addlayer removelayer setbaselayer baselayerremove",ik=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(){return this._attributionContainer=iw("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},n.onAdd=function(){this.getMap().on(nk,this._update,this)},n.onRemove=function(){this.getMap().off(nk,this._update,this)},n._update=function(){var e=this.getMap();if(e){var t=e._getLayers((function(e){return e.options.attribution})).reverse().map((function(e){return e.options.attribution})),n=this.options.content+(t.length>0?" - "+t.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}},t}(tk);ik.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),QT.mergeOptions({attribution:!0}),QT.addOnLoadHook((function(){var e=this.options.attribution||this.options.attributionControl;e&&(this.attributionControl=new ik(e),this.addControl(this.attributionControl))}));var rk=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(e){var t=this._getCompass();return this._compass=t,this._registerDomEvents(),e.on("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),t},n.onAdd=function(){this._rotateCompass()},n._getCompass=function(){return iw("div","maptalks-compass")},n._registerDomEvents=function(){Mw(this._compass,"click",this._resetView,this)},n._rotateCompass=function(){var e=this.getMap().getBearing().toFixed(1);e<=180&&(e*=-1),e!==this._bearing&&(this._bearing=e,mw(this._compass,"transform: rotate("+this._bearing+"deg);"))},n.onRemove=function(){this.getMap().off("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),delete this._compass,delete this._bearing},n._resetView=function(){this.getMap().animateTo({bearing:0})},t}(tk);rk.mergeOptions({position:{top:120,left:20}}),QT.mergeOptions({compassControl:!1}),QT.addOnLoadHook((function(){this.options.compassControl&&(this.compassControl=new rk(this.options.compassControl),this.addControl(this.compassControl))}));var ak=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(){var e=this.container=iw("div",this.options.containerClass),t=this.panel=iw("div","panel"),n=this.button=iw("button");return e.appendChild(n),e.appendChild(t),e},n.onAdd=function(){Mw(this.button,"mouseover",this._show,this),Mw(this.panel,"mouseleave",this._hide,this),Mw(this.getMap(),"click",this._hide,this)},n.onRemove=function(){this.panel&&(Tw(this.button,"mouseover",this._show,this),Tw(this.panel,"mouseleave",this._hide,this),Tw(this.getMap(),"click",this._hide,this),aw(this.panel),aw(this.button),delete this.panel,delete this.button,delete this.container)},n._show=function(){vw(this.container,"shown")||(gw(this.container,"shown"),this._createPanel())},n._hide=function(e){this.panel.contains(e.toElement||e.relatedTarget)||yw(this.container,this.options.containerClass)},n._createPanel=function(){this.panel.innerHTML="";var e=iw("ul");this.panel.appendChild(e),this._renderLayers(this.getMap(),e)},n._renderLayers=function(e,t){var n=this,i=e.getBaseLayer(),r=e.getLayers(),a=r.length;if(i){var o=i.layers||[i],s=iw("li","group"),l=iw("ul"),u=iw("label");u.innerHTML=this.options.baseTitle,s.appendChild(u);for(var c=0,h=o.length;c<h;c++){var f=o[c];this._isExcluded(f)&&(l.appendChild(this._renderLayer(o[c],!0)),s.appendChild(l),t.appendChild(s))}}if(a){var d=iw("li","group"),p=iw("ul"),m=iw("label"),v=iw("input");v.type="checkbox",v.checked=!0,m.innerHTML=this.options.overlayTitle,d.appendChild(v),d.appendChild(m);for(var g=function(e){var t=e.target.checked,n=e.target.parentNode;if(n){var i=n.getElementsByTagName("ul")[0];if(i){var r=function(e){var n=e._layer;n&&n[t?"show":"hide"]()},a=function(e){var n=e._layer,i=e.childNodes[0];i&&(i.checked=t),n&&n[t?"show":"hide"]()};r(n),i.childNodes.forEach((function(e){a(e);var t=e.getElementsByTagName("ul")[0];t&&(r(e),t.childNodes.forEach((function(e){a(e)})))}))}}},y=0;y<a;y++){var _=r[y];this._isExcluded(_)&&(_.getLayers?function(){var e=iw("li","group"),t=iw("ul"),i=iw("label"),r=iw("input");i.innerHTML=_.getId(),r.type="checkbox",r.checked=_.isVisible(),r.onchange=g,e.appendChild(r),e.appendChild(i),e.appendChild(t),e._layer=_,p.appendChild(e),(_.getLayers()||[]).forEach((function(e){t.appendChild(n._renderLayer(e,!1,r.checked))}))}():p.appendChild(this._renderLayer(_)),_&&!_.isVisible()&&(v.checked=!1))}d.appendChild(p),t.appendChild(d),v.onchange=g}},n._isExcluded=function(e){var t=e.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(t)>=0)},n._renderLayer=function(e,t,n){var i=this;void 0===n&&(n=!0);var r=iw("li","layer"),a=iw("label"),o=iw("input"),s=this.getMap(),l=e.options.visible;e.options.visible=!0;var u=e.isVisible();return e.options.visible=l,r.className="layer",t?(o.type="radio",o.name="base"):o.type="checkbox",o.checked=l&&u,n||(o.checked=!1),u||o.setAttribute("disabled","disabled"),o.onchange=function(t){if("radio"===t.target.type){var n=s.getBaseLayer(),r=n.layers;if(r)for(var a=0,o=r.length;a<o;a++){var l=r[a];l[l===e?"show":"hide"]()}else n.isVisible()||n.show();s._fireEvent("setbaselayer")}else e[t.target.checked?"show":"hide"]();i.fire("layerchange",{target:e})},r.appendChild(o),a.innerHTML=e.getId(),r.appendChild(a),r._layer=e,r},t}(tk);ak.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),QT.mergeOptions({layerSwitcherControl:!1}),QT.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new ak(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var ok=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(){var e=this.options.size;this.options.maximize||(e=[0,0]);var t=iw("div"),n=this.mapContainer=iw("div");n.style.width=e[0]+"px",n.style.height=e[1]+"px",n.className=this.options.containerClass;var i=this.button=iw("div");return i.className=this.options.buttonClass,t.appendChild(n),t.appendChild(i),t},n.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),Mw(this.button,"click",this._onButtonClick,this),this._updateButtonText()},n.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),Tw(this.button,"click",this._onButtonClick,this)},n.maxmize=function(){var e=this.options.size,t=this.mapContainer;return t.style.width=e[0]+"px",t.style.height=e[1]+"px",this._createOverview(),this},n.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var e=this.mapContainer;return e.style.width="0px",e.style.height="0px",this},n.getOverviewMap=function(){return this._overview},n._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},n._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},n._createOverview=function(){var e=this.getMap(),t=this.mapContainer,n=e.config();n_(n,{center:e.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new QT(t,n),this._updateBaseLayer(),this._perspective=new vE(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new $E("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},n._getOverviewZoom=function(){var e=this.getMap(),t=e.getZoom(),n=e.getMinZoom(),i=this.options.level;if(i>0){for(var r=i;r>0;r--)if(t-r>=n)return t-r}else for(var a=i;a<0;a++)if(t-a>=n)return t-a;return t},n._onDragEnd=function(){var e=this._perspective.getCenter();this._overview.setCenter(e),this.getMap().panTo(e)},n._getPerspectiveCoords=function(){var e=this.getMap(),t=e.getProjection();return e.getContainerExtent().toArray().map((function(n){if(t){var i=e._containerPointToPrj(n);return e._fixPrjOnWorldWide(i),t.unproject(i)}return e.containerPointToCoordinate(n)}))},n._update=function(){if(this._overview){dw(this._overview._containerDOM);var e=this._getPerspectiveCoords();this._perspective.setCoordinates(e),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},n._updateSpatialReference=function(){if(this._overview){var e=this.getMap().options.spatialReference;this._overview.setSpatialReference(e)}},n._updateBaseLayer=function(){if(this._overview){var e=this.getMap().getBaseLayer();if(e){var t=e.layers,n=0;if(t)for(var i=0,r=t.length;i<r;i++){if(t[i].isVisible()){n=i;break}}var a=e.toJSON(),o=null;t?(o=a.layers[n].options).visible=!0:o=a.options,this._overview.setMinZoom(o.minZoom||null).setMaxZoom(o.maxZoom||null),delete o.minZoom,delete o.maxZoom,delete a.options.canvas,a.options.visible=!0,a.options.renderer="canvas";var s=WT.fromJSON(a);for(var l in e)l_(e[l])&&e.hasOwnProperty(l)&&e[l]!==e.constructor.prototype[l]&&(s[l]=e[l]);this._overview.setBaseLayer(s)}else this._overview.setBaseLayer(null)}},t}(tk);ok.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),QT.mergeOptions({overviewControl:!1}),QT.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new ok(this.options.overviewControl),this.addControl(this.overviewControl))}));var sk=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(){var e;if(this.options.custom)s_(this.options.content)?(e=iw("div")).innerHTML=this.options.content:e=this.options.content;else{if(e=iw("div","maptalks-panel"),this.options.closeButton){var t=iw("a","maptalks-close");t.innerText="\xd7",t.href="javascript:;",t.onclick=function(){e.style.display="none"},e.appendChild(t)}var n=iw("div","maptalks-panel-content");n.innerHTML=this.options.content,e.appendChild(n)}return this.draggable=new cS(e,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),e},n.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),tk.prototype.update.call(this)},n.setContent=function(e){var t=this.options.content;return this.options.content=e,this.fire("contentchange",{old:t,new:e}),this.isVisible()&&this.update(),this},n.getContent=function(){return this.options.content},n._cancelOn=function(e){var t=(e.srcElement||e.target).tagName.toLowerCase();return"button"===t||"input"===t||"select"===t||"option"===t||"textarea"===t},n._onDragStart=function(e){this._startPos=e.mousePos,this._startPosition=n_({},this.getPosition()),this.fire("dragstart",e)},n._onDragging=function(e){var t=e.mousePos.sub(this._startPos),n=this._startPosition,i=this.getPosition();i_(i.top)||(i.top=parseInt(n.top)+t.y),i_(i.bottom)||(i.bottom=parseInt(n.bottom)-t.y),i_(i.left)||(i.left=parseInt(n.left)+t.x),i_(i.right)||(i.right=parseInt(n.right)-t.x),this.setPosition(i),this.fire("dragging",e)},n._onDragEnd=function(e){delete this._startPos,delete this._startPosition,this.fire("dragend",e)},n._getConnectPoints=function(){var e=this.getMap(),t=this.getContainerPoint(),n=this.getDOM(),i=parseInt(n.clientWidth),r=parseInt(n.clientHeight);return[e.containerPointToCoordinate(t.add(i/2,0)),e.containerPointToCoordinate(t.add(i,r/2)),e.containerPointToCoordinate(t.add(i/2,r)),e.containerPointToCoordinate(t.add(0,r/2))]},t}(tk);sk.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var lk=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(){var e=this._getReset();return this._reset=e,this._registerDomEvents(),e},n.onAdd=function(){this._view=this.options.view?this.options.view:this.getMap().getView()},n.setView=function(e){this._view=e},n._getReset=function(){return iw("div","maptalks-reset")},n._registerDomEvents=function(){Mw(this._reset,"click",this._resetView,this)},n.onRemove=function(){delete this._reset,delete this._view},n._resetView=function(){this.getMap().setView(this._view)},t}(tk);lk.mergeOptions({position:{top:156,left:20},view:null}),QT.mergeOptions({resetControl:!1}),QT.addOnLoadHook((function(){this.options.resetControl&&(this.resetControl=new lk(this.options.resetControl),this.addControl(this.resetControl))}));var uk="zoomend moving moveend",ck=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(e){return this._map=e,this._scaleContainer=iw("div",this.options.containerClass),this._addScales(),e.on(uk,this._update,this),this._map._loaded&&this._update(),this._scaleContainer},n.onRemove=function(){this.getMap().off(uk,this._update,this)},n._addScales=function(){var e="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=rw("div",this.options.containerClass?null:e,this._scaleContainer)),this.options.imperial&&(this._iScale=rw("div",this.options.containerClass?null:e,this._scaleContainer))},n._update=function(){var e=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(e)},n._updateScales=function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},n._updateMetric=function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},n._updateImperial=function(e){var t,n,i,r=3.2808399*e;r>5280?(t=r/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mile",n/t)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" feet",i/r))},n._updateScale=function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},n._getRoundNum=function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)},t}(tk);ck.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),QT.mergeOptions({scaleControl:!1}),QT.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new ck(this.options.scaleControl),this.addControl(this.scaleControl))}));var hk=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(e){this._map=e;var t=iw("div"),n=iw("ul","maptalks-toolbar-hx");t.appendChild(n),this.options.vertical?gw(t,"maptalks-toolbar-vertical"):gw(t,"maptalks-toolbar-horizonal");var i=this;function r(e,t,n,r){var a=i._getItems()[t];return function(i){return cw(i),e({target:a,index:t,childIndex:n,dom:r})}}var a=this.options.items;if(_x(a))for(var o=0,s=a.length;o<s;o++){var l=a[o],u=iw("li");if(28!==this.options.height&&(u.style.lineHeight=this.options.height+"px"),u.style.height=this.options.height+"px",u.style.cursor="pointer",bw(l.item)){u.style.textAlign="center";var c=ww("div",l.item);u.innerHTML='<div style="margin-top:'+(this.options.height-c.height)/2+'px;">'+l.item+"</div>"}else u.innerHTML=l.item;if(l.click&&Mw(u,"click",r(l.click,o,null,u)),_x(l.children)){var h=this._createDropMenu(o);u.appendChild(h),u._menu=h,Mw(u,"mouseover",(function(){this._menu.style.display=""})),Mw(u,"mouseout",(function(){this._menu.style.display="none"}))}n.appendChild(u)}return t},n._createDropMenu=function(e){var t=this;function n(e,n,i){var r=t._getItems()[n].children[i];return function(t){return cw(t),e({target:r,index:n,childIndex:i})}}var i=iw("div","maptalks-dropMenu"),r=this._getItems(),a=r.length,o=iw("ul"),s=r[e].children;e===a-1&&s&&(i.style.cssText="right: 0px;",o.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(o.style.bottom=0)),i.appendChild(iw("em","maptalks-ico"));for(var l=0,u=0,c=s.length;u<c;u++){var h=Lb(s[u].item,"12px");h.width>l&&(l=h.width)}for(var f=0,d=s.length;f<d;f++){var p=s[f],m=iw("li");m.innerHTML='<a href="javascript:;">'+p.item+"</a>",m.style.cursor="pointer",m.style.width=l+24+"px",Mw(m.childNodes[0],"click",n(p.click,e,f)),o.appendChild(m)}if(this.options.vertical){var v=l<95?95:l;this.options.reverseMenu?i.style.right=-(v+20+2)+"px":i.style.left=-(v+20+2)+"px"}else this.options.reverseMenu?i.style.bottom="28px":i.style.top="29px";return i.appendChild(o),i.style.display="none",i},n._getItems=function(){return this.options.items||[]},t}(tk);hk.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var fk=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.buildOn=function(e){var t=this.options,n=iw("div","maptalks-zoom");if(t.zoomLevel){var i=iw("span","maptalks-zoom-zoomlevel"),r=iw("span","maptalks-zoom-zoomlevel-text");i.appendChild(r),n.appendChild(i),this._levelDOM=r}var a=iw("div","maptalks-zoom-slider"),o=iw("a","maptalks-zoom-zoomin");o.href="javascript:;",a.appendChild(o),this._zoomInButton=o;var s=iw("a","maptalks-zoom-zoomout");return s.href="javascript:;",a.appendChild(s),this._zoomOutButton=s,n.appendChild(a),e.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},n.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this)},n._update=function(){this._updateText()},n._updateText=function(){if(this._levelDOM){var e=this.getMap().getZoom();a_(e)||(e=Math.floor(10*e)/10),this._levelDOM.innerHTML=e}},n._registerDomEvents=function(){this._zoomInButton&&Mw(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Mw(this._zoomOutButton,"click",this._onZoomOutClick,this)},n._onZoomInClick=function(e){uw(e),this.getMap().zoomIn()},n._onZoomOutClick=function(e){uw(e),this.getMap().zoomOut()},t}(tk);fk.mergeOptions({position:"top-left",zoomLevel:!0,seamless:!1}),QT.mergeOptions({zoomControl:!1}),QT.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new fk(this.options.zoomControl),this.addControl(this.zoomControl))}));var dk=function(){function e(e,t,n,i){Array.isArray(e)?(this.scale={x:e[0],y:e[1]},this.origin={x:e[2],y:e[3]}):(this.scale={x:e,y:t},this.origin={x:n,y:i})}return e.getDefault=function(e){var t=e.code.toLowerCase();return"baidu"===t?"baidu":t==="EPSG:4326".toLowerCase()||t==="EPSG:4490".toLowerCase()?"tms-global-geodetic":"identity"===t?[1,-1,0,0]:"web-mercator"},e}(),pk=6378137*Math.PI;n_(dk,{"web-mercator":new dk([1,-1,-pk,pk]),"tms-global-mercator":new dk([1,1,-pk,-pk]),"tms-global-geodetic":new dk([1,1,-180,-90]),baidu:new dk([1,1,0,0])});var mk=function(){function e(e,t,n,i){this.map=e,this.tileSize=i,this.fullExtent=n,this.prepareTileInfo(t,n),this._xScale=n.right>=n.left?1:-1,this._yScale=n.top>=n.bottom?1:-1;var r=e.getGLRes();this._pointOrigin=e._prjToPointAtRes(new ax(this.tileSystem.origin),r),this._glRes=r}var t=e.prototype;return t.prepareTileInfo=function(e,t){if(s_(e)?e=dk[e.toLowerCase()]:Array.isArray(e)&&(e=new dk(e)),!e)throw new Error("Invalid TileSystem");this.tileSystem=e;var n=t.right>t.left?1:-1,i=t.top>t.bottom?-1:1,r=e.origin.x,a=e.origin.y;this.transformation=new CS([n,i,r,a])},t._getTileNum=function(e,t){var n=this.tileSystem,i=this.tileSize,r=Math.floor(1e-7*n.scale.x+e.x/(i.width*t)),a=Math.ceil(1e-7*n.scale.y+e.y/(i.height*t));return{x:n.scale.x*r,y:n.scale.y*a}},t.getTileIndex=function(e,t,n){var i=this.tileSystem,r=this.transformation.transform(e,1),a=this._getTileNum(r,t);return i.scale.x<0&&(a.x-=1),i.scale.y>0&&(a.y-=1),this.getNeighorTileIndex(a.x,a.y,0,0,t,n)},t.getNeighorTileIndex=function(e,t,n,i,r,a){var o=this.tileSystem,s=e+o.scale.x*n,l=t-o.scale.y*i,u=!1,c=s,h=l,f=this._getTileFullIndex(r);return a&&(!0!==a&&"x"!==a||(f.xmax===f.xmin?s=f.xmin:s<f.xmin?(s=f.xmax-(f.xmin-s)%(f.xmax-f.xmin))===f.xmax&&(s=f.xmin):s>=f.xmax&&(s=f.xmin+(s-f.xmin)%(f.xmax-f.xmin))),!0!==a&&"y"!==a||(f.ymax===f.ymin?l=f.ymin:l>=f.ymax?l=f.ymin+(l-f.ymin)%(f.ymax-f.ymin):l<f.ymin&&(l=f.ymax-(f.ymin-l)%(f.ymax-f.ymin))===f.ymax&&(l=f.ymin))),(s<f.xmin||s>f.xmax||l>f.ymax||l<f.ymin)&&(u=!0),{x:s,y:l,idx:c,idy:h,out:u}},t._getTileFullIndex=function(e){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[e])return this._tileFullIndex[e];var t=this.fullExtent,n=this.transformation,i=this._getTileNum(n.transform(new hS(t.left,t.top),1),e),r=this._getTileNum(n.transform(new hS(t.right,t.bottom),1),e),a=this.tileSystem;return a.scale.x<0&&(i.x-=1,r.x-=1),a.scale.y>0&&(i.y-=1,r.y-=1),this._tileFullIndex[e]=new TS(i,r),this._tileFullIndex[e]},t.getTilePrjNW=function(e,t,n,i){var r=this.tileSystem,a=this.tileSize,o=r.origin.y+this._yScale*r.scale.y*(t+(1===r.scale.y?1:0))*n*a.height,s=r.origin.x+this._xScale*r.scale.x*(e+(1===r.scale.x?0:1))*n*a.width;return i?(i.set(s,o),i):new hS(s,o)},t.getTilePointNW=function(e,t,n,i){var r=this._glRes/n,a=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*r+this._yScale*a.scale.y*(t+(1===a.scale.y?1:0))*o.height,l=this._pointOrigin.x*r+this._xScale*a.scale.x*(e+(1===a.scale.x?0:1))*o.width;return i?(i.set(l,s),i):new ax(l,s)},t.getTilePrjSE=function(e,t,n,i){var r=this.tileSystem,a=this.tileSize,o=r.origin.y+this._yScale*r.scale.y*(t+(1===r.scale.y?0:1))*n*a.height,s=r.origin.x+this._xScale*r.scale.x*(e+(1===r.scale.x?1:0))*n*a.width;return i?(i.set(s,o),i):new hS(s,o)},t.getTilePointSE=function(e,t,n,i){var r=this._glRes/n,a=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*r+this._yScale*a.scale.y*(t+(1===a.scale.y?0:1))*o.height,l=this._pointOrigin.x*r+this._xScale*a.scale.x*(e+(1===a.scale.x?1:0))*o.width;return i?(i.set(l,s),i):new ax(l,s)},t.getTilePrjExtent=function(e,t,n){var i=this.getTilePrjNW(e,t,n),r=this.getTilePrjSE(e,t,n);return new TS(i,r)},e}(),vk=new ax(0,0),gk="undefined"!==typeof Set,yk=function(){function e(){this._table=gk?new Set:{}}var t=e.prototype;return t.add=function(e){gk?this._table.add(e):this._table[e]=!0},t.has=function(e){return gk?this._table.has(e):this._table[e]},t.reset=function(){gk?this._table.clear():this._table={}},e}(),_k={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,loadingLimitOnInteracting:3,loadingLimit:0,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!p_,fadeDuration:1e3/60*10,debug:!1,spatialReference:null,maxCacheSize:256,renderer:Y_.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,tileStackStartDepth:7,tileStackDepth:3,awareOfTerrain:!0},xk=/\{ *([\w_]+) *\}/g,bk=new ax(0,0),wk=new ax(0,0),Sk=new ax(0,0),Mk=new ax(0,0),Tk=new ax(0,0),Ek=new ax(0,0),Ck=[[0,0,0],[0,0,0]],kk=[0,0,0],Pk=[0,0,0],Ak=[],Rk=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e),t.fromJSON=function(e){return e&&"TileLayer"===e.type?new t(e.id,e.options):null};var n=t.prototype;return n.forceReload=function(){return this.fire("forcereloadstart"),this.clear(),this.load(),this.fire("forcereloadend"),this},n.getTileSize=function(){if(this._tileSize)return this._tileSize;var e=this.options.tileSize;return r_(e)&&(e=[e,e]),this._tileSize=new Tb(e),this._tileSize},n.getTiles=function(e,t){return this._coordCache={},this._isPyramidMode()?this._getPyramidTiles(e,t):this._getCascadeTiles(e,t)},n._isPyramidMode=function(){var e=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&e&&e.isPyramid()},n._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var e=this.getSpatialReference(),t=e.getFullExtent(),n=e.getResolution(0),i=this.getMap();return this._tileFullExtent=t.convertTo((function(e){return i._prjToPointAtRes(e,n,vk)})),this._tileFullExtent},n._getRootNodes=function(e){var t=this.getMap();if(this._rootNodes){var n=this._rootNodes,i=n.tiles,r=n.mapWidth,a=n.mapHeight;if(t.width!==r||t.height!==a){for(var o=this._getRootError(),s=0;s<i.length;s++)i[s].error=o;this._rootNodes.mapWidth=t.width,this._rootNodes.mapHeight=t.height}for(var l=0;l<i.length;l++)i[l].offset[0]=e[0],i[l].offset[1]=e[1];return this._rootNodes}var u=this.getSpatialReference(),c=u.getResolution(0),h=this._getTileConfig(),f=u.getFullExtent(),d=h.tileSystem,p=d.origin,m=d.scale,v=h.getTilePrjExtent(0,0,c),g=v.getWidth(),y=v.getHeight(),_=1e-5,x=Math.abs((p.x-f.left)/g);x=Math.ceil(x-_);var b=Math.abs((f.right-p.x)/g);b=Math.ceil(b-_);var w=Math.ceil(Math.abs(f.top-p.y)/y);w=Math.ceil(w-_);var S=Math.ceil(Math.abs(f.bottom-p.y)/y);if((b+x)*((S=Math.ceil(S-_))+w)>32)return{status:0,error:"Too many root nodes"};for(var M=this._getRootError(),T=[],E=this.options.zoomOffset,C=-x;C<b;C++)for(var k=-w;k<S;k++){var P=m.y<0?k:-(k+1);T.push({x:C,y:P,z:0,idx:C,idy:P,res:c,extent2d:h.getTilePrjExtent(C,P,c).convertTo((function(e){return t._prjToPointAtRes(e,c,vk)})),id:this._getTileId(C,P,0),url:this.getTileUrl(C,P,0+E),offset:[0,0],error:M,children:[]})}return this._rootNodes={status:1,tiles:T,mapWidth:t.width,mapHeight:t.height},this._getRootNodes(e)},n._getRootError=function(){var e=this.getMap(),t=f_(e.getFov()),n=e.width/e.height,i=e.cameraPosition[2],r=i*Math.tan(.5*t),a=r*n,o=Math.sqrt(i*i+r*r+a*a);return e._getFovZ(0)*(o/i)*this.getSpatialReference().getResolution(0)/e.getResolution(0)},n._getPyramidTiles=function(e,t){var n=this.getMap();isNaN(+e)&&(e=this._getTileZoom(n.getZoom()));var i,r=this.getSpatialReference(),a=Math.min(e,this.getMaxZoom(),this.options.maxAvailableZoom||1/0),o=n.projViewMatrix,s=this._getTileFullExtent(),l=this._getTileOffset(0);if(this.options.repeatWorld){var u=n.getContainerExtent(),c=this._convertToExtent2d(u),h=r.getResolution(0)/n.getResolution();if(c.within(s.copy()._scale(h))){var f=this._getRootNodes(l);if(1!==f.status)return console.warn(f.error),this._disablePyramid=!0,this.getTiles(e,t);i=f.tiles.concat()}else{var d=n.getPitch(),p=n.options.cascadePitches[1],m=Math.floor(n._getVisualHeight(p)),v=d<=p?u:new ES(0,n.height-m,n.width,n.height);this._visitedTiles=new yk;var g=this._getTiles(0,v,2,t&&t.getRenderer(),!0),y=this._getRootError();g.tiles.forEach((function(e){e.error=y})),i=g.tiles}}else{var _=this._getRootNodes(l);if(1!==_.status)return console.warn(_.error),this._disablePyramid=!0,this.getTiles(e,t);i=_.tiles.concat()}for(var x=n.getGLRes(),b={0:l},w=new ES,S=[],M=[];i.length>0;){var T=i.pop();T.z!==a?(b[T.z+1]||(b[T.z+1]=this._getTileOffset(T.z+1)),this._splitNode(T,o,i,S,w,a,b[T.z+1],t&&t.getRenderer(),x),this.isParentTile(e,a,T)&&M.push(T)):(w._combine(T.extent2d),S.push(T))}return M.sort(Lk),{tileGrids:[{extent:w,count:S.length,tiles:S,parents:M,offset:[0,0],zoom:e}],count:S.length}},n.isParentTile=function(e,t,n){var i=Math.max(this.getMinZoom(),e-this.options.tileStackStartDepth),r=Math.min(t,i+this.options.tileStackDepth);return n.z>=i&&n.z<r},n._splitNode=function(e,t,n,i,r,a,o,s,l){for(var u=this.options.zoomOffset,c=this._getTileConfig().tileSystem.scale.y,h=e.z+1,f=this.getSpatialReference(),d=e.x,p=e.y,m=e.extent2d,v=e.idx,g=e.idy,y=m.getWidth()/2*2,_=m.getHeight()/2*2,x=2*m.xmin,b=2*m.ymax,w=2*m.ymin,S=s||this.getRenderer(),M=!1,T=[],E=f.getResolution(h),C=E/l,k=0;k<4;k++){var P=k%2,A=k>>1,R=(d<<1)+P,L=(p<<1)+A,I=(v<<1)+P,O=(g<<1)+A;e.children||(e.children=[]);var D=e.children[k];D||(D=this._getTileId(I,O,h),e.children[k]=D);var N=S.isTileCachedOrLoading(D),z=void 0,U=N&&N.info;if(!U){if(this.tileInfoCache||(this.tileInfoCache=new Rw(4*this.options.maxCacheSize)),!(U=this.tileInfoCache.get(D))){if(c<0){var F=x+P*y,B=b-A*_;z=new ES(F,B-_,F+y,B)}else{var H=x+P*y,j=w+A*_;z=new ES(H,j,H+y,j+_)}U={x:R,y:L,idx:I,idy:O,z:h,extent2d:z,error:e.error/2,res:E,id:D,children:[],url:this.getTileUrl(R,L,h+u),offset:o},this.tileInfoCache.add(D,U)}s&&(U.layer=this.getId())}U.error=e.error/2,U.offset[0]=o[0],U.offset[1]=o[1];var G=this._isTileVisible(U,t,C,a,o);if(1===G)M=!0;else{if(-1===G)continue;if(0===G&&h!==a)return i.push(e),void r._combine(e.extent2d)}T.push(U)}h===a?M?n.push.apply(n,T):(i.push(e),r._combine(e.extent2d)):n.push.apply(n,T)},n._isTileVisible=function(e,t,n,i,r){if(0===e.z)return 1;if(!this._isTileInFrustum(e,t,n,r))return-1;var a=this.options.maxError;return i_(a)&&(a=1),this._getScreenSpaceError(e,n,i,r)>=a?1:0},n._isTileInFrustum=function(e,t,n,i){if(!this._zScale){var r=this.getMap(),a=r.getGLRes();this._zScale=r.altitudeToPoint(100,a)/100}var o=this.getRenderer(),s=e.extent2d,l=s.xmin,u=s.ymin,c=s.xmax,h=s.ymax;Ck[0][0]=(l-i[0])*n,Ck[0][1]=(u-i[1])*n;var f=e.minAltitude||o&&o.avgMinAltitude||0;Ck[0][2]=f*this._zScale,Ck[1][0]=(c-i[0])*n,Ck[1][1]=(h-i[1])*n;var d=e.maxAltitude||o&&o.avgMaxAltitude||0;return Ck[1][2]=d*this._zScale,jy(t,Ck)},n._getScreenSpaceError=function(e,t,n,i){var r=e.error,a=this.getMap(),o=e.extent2d,s=o.xmin,l=o.ymin,u=o.xmax,c=o.ymax;kk[0]=(s-i[0])*t,kk[1]=(l-i[1])*t,Pk[0]=(u-i[0])*t,Pk[1]=(c-i[1])*t;var h=function(e,t,n){var i=Math.max(e[0]-n[0],0,n[0]-t[0]),r=Math.max(e[1]-n[1],0,n[1]-t[1]),a=Math.max(e[2]-n[2],0,n[2]-t[2]);return Math.sqrt(i*i+r*r+a*a)}(kk,Pk,a.cameraPosition),f=Math.max(Math.abs(h),1e-7),d=Math.abs(e.z-n);return r*(a.height<1e3||d<=1?1:d<=2?.7:.605)/f},n._getCascadeTiles=function(e,t){var n=this.getMap(),i=n.getPitch(),r=t&&t.getRenderer(),a=n.getContainerExtent(),o=[],s=0,l=this.getMinZoom(),u=n.options.cascadePitches[0],c=n.options.cascadePitches[1],h=Math.floor(n._getVisualHeight(c)),f=i_(e)?this._getTileZoom(n.getZoom()):e;if(this._visitedTiles=new yk,!i_(e)||!this.options.cascadeTiles||i<=u||!i_(l)&&f<=l){var d=i<=c?a:new ES(0,n.height-h,n.width,n.height),p=this._getTiles(f,d,2,r);return p&&(s+=p.tiles.length,o.push(p)),{tileGrids:o,count:s}}var m=Math.floor(n._getVisualHeight(u)),v=new ES(0,n.height-m,n.width,n.height),g=this._getTiles(f,v,0,r);s+=g?g.tiles.length:0,o.push(g);var y,_,x=v.ymin,b=n.getSpatialReference().getZoomDirection(),w=b;if(i>c){f-w<=l&&(w=0);var S=new ES(0,n.height-h,n.width,x);s+=(y=this._getTiles(f-w,S,1,r))?y.tiles.length:0,x=S.ymin,w+=4*b,o.push(y)}if(f-w>=l){var M=new ES(0,a.ymin,n.width,x);s+=(_=this._getTiles(f-w,M,2,r))?_.tiles.length:0,o.push(_)}return y&&_&&(o[1]=_,o[2]=y),{tileGrids:o,count:s}},n.getTileUrl=function(e,t,n){var i=this.options.urlTemplate,r="";if(this.options.subdomains){var a=this.options.subdomains;if(_x(a)){var o=(e+t)%a.length;o<0&&(o=0),r=a[o]}}if(l_(i))return i(e,t,n,r);var s={x:e,y:t,z:n,s:r};return this.options.token&&(s.token=this.options.token),this.options.customTags&&n_(s,this.options.customTags),i.replace(xk,(function(e,t){var n=s[t];if(void 0===n)throw new Error("No value provided for variable "+e);return"function"===typeof n&&(n=n(s)),n}))},n.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},n.getSpatialReference=function(){var e=this.getMap();if(e&&(!this.options.spatialReference||OT.equals(this.options.spatialReference,e.options.spatialReference)))return e.getSpatialReference();if(this._sr)return this._sr;var t=this.options.spatialReference;if(s_(t)&&!(t=OT.getPreset(t)))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+OT.getAllPresets().join());return this._sr=new OT(t),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==e.getSpatialReference().toJSON().projection,this._sr},n.getMinZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(e.prototype.getMinZoom.call(this),this._srMinZoom):e.prototype.getMinZoom.call(this)},n.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(e.prototype.getMaxZoom.call(this),this._srMaxZoom):e.prototype.getMaxZoom.call(this)},n._getTileZoom=function(e){if(!this._hasOwnSR){var t=this.getMap().getResolution(e),n=this.getSpatialReference().getResolution(e);e+=Math.log(n/t)*Math.LOG2E}var i=this.options.maxAvailableZoom;return!i_(i)&&e>i&&(e=i),a_(e)||(e=Math.round(e)),e=Math.max(0,e)},n._getTiles=function(e,t,n,i,r){var a=this.getMap(),o=e,s=a.projViewMatrix,l=a.getResolution(e)/a.getResolution(e-1)===.5;n<2&&(0===n&&l&&(o-=1),s=0===n?a.cascadeFrustumMatrix0:1===n?a.cascadeFrustumMatrix1:a.projViewMatrix);var u=o+this.options.zoomOffset,c=this._getTileOffset(o),h=c[0]||c[1],f={zoom:o,extent:null,offset:c,tiles:[]};if(u<0)return f;if(!a||!this.isVisible()||!a.width||!a.height)return f;if(!r){var d=this.getMinZoom(),p=this.getMaxZoom();if(!i_(d)&&o<d||!i_(p)&&o>p)return f}var m=this._getTileConfig();if(!m)return f;var v,g={zoom:c},y=this.getSpatialReference().getResolution(o);v=this._hasOwnSR?a.getGLScale(o):y/a.getGLRes();var _=!this._hasOwnSR&&this.options.repeatWorld,x=this._convertToExtent2d(t),b=this._getMask2DExtent();if(b){var w=b.intersection(x);if(!w)return f;t=w.convertTo((function(e){return a._pointToContainerPoint(e,void 0,0,vk)}))}var S,M=a._containerPointToPrj(t.getCenter(),bk),T=a._prjToPoint(M,o,wk);S=h?this._project(a._pointToPrj(T._add(c),o,wk),wk):this._project(M,wk);var E=a.getGLScale()/a.getGLScale(o);Sk.x=x.xmin*E,Sk.y=x.ymax*E,Mk.x=x.xmax*E,Mk.y=x.ymin*E;for(var C=this._project(a._pointToPrj(Sk._add(c),o,Sk),Sk),k=this._project(a._pointToPrj(Mk._add(c),o,Mk),Mk),P=m.getTileIndex(S,y,_),A=m.getTileIndex(C,y,_),R=m.getTileIndex(k,y,_),L=Math.ceil(Math.abs(P.idy-A.idy)),I=Math.ceil(Math.abs(P.idx-A.idx)),O=Math.ceil(Math.abs(P.idy-R.idy)),D=Math.ceil(Math.abs(P.idx-R.idx)),N=(L+O+1)*(I+D+1),z=this.getTileSize(),U=this.getRenderer()||i,F=this._getTileConfig().tileSystem.scale,B=[],H=new ES,j=new ax(0,0),G=-L;G<=O;G++)for(var V=-I,W=-1/0,X=!1;V>=W&&V<=D;){var Z=m.getNeighorTileIndex(P.idx,P.idy,V,G,y,_);W===-1/0?V++:V--;var q=this._getTileId(Z.idx,Z.idy,o);if(!(Z.out||this._visitedTiles&&this._visitedTiles.has(q))){var Y=U&&U.isTileCachedOrLoading(q);Y&&(Y=Y.info);var J=void 0;if(Y){var Q=Y.extent2d;j.set(Q.xmin,Q.ymax),J=j}else if(this._hasOwnSR){var K=m.getTilePrjNW(Z.x,Z.y,y);J=a._prjToPoint(this._unproject(K,Mk),o)}else J=m.getTilePointNW(Z.x,Z.y,y);var $=void 0,ee=void 0;if(this._hasOwnSR){var te=void 0;if(this._hasOwnSR){var ne=m.getTilePrjSE(Z.x,Z.y,y);te=a._prjToPoint(this._unproject(ne,Mk),o,Mk)}else te=m.getTilePointSE(Z.x,Z.y,y);$=Math.ceil(Math.abs(te.x-J.x)),ee=Math.ceil(Math.abs(te.y-J.y))}else $=z.width,ee=z.height;var ie=F.x*(Z.idx-Z.x)*$,re=F.y*(Z.idy-Z.y)*ee;Y||!ie&&!re||J._add(ie,re);var ae=Y&&Y.extent2d||new ES(J.x,J.y-ee,J.x+$,J.y);if(N<=4||X||this._isTileInExtent(s,ae,c,v)){var oe=this._hasOwnSR?a._getResolution(o):y;this._visitedTiles&&0===n&&this._visitedTiles.add(q),l&&0===n?(this._splitTiles(s,B,U,Z,o+1,oe,ae,ie,re,g,i),H._combine(ae)):(Y?(Y.offset[0]=c[0],Y.offset[1]=c[1]):(Y={z:o,x:Z.x,y:Z.y,idx:Z.idx,idy:Z.idy,extent2d:ae,offset:c,id:q,res:oe,url:this.getTileUrl(Z.x,Z.y,u)},i&&(Y.layer=this.getId())),B.push(Y),H._combine(ae)),W===-1/0?(W=V,V=D):X||(X=!0)}}}if(B.length){var se=a._containerPointToPoint(t.getCenter(),o,vk)._add(c),le=new ax(0,0),ue=new ax(0,0);B.sort((function(e,t){return le.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),ue.set((t.extent2d.xmin+t.extent2d.xmax)/2,(t.extent2d.ymin+t.extent2d.ymax)/2),le.distanceTo(se)-ue.distanceTo(se)}))}return{offset:c,zoom:e,extent:H,tiles:B}},n._convertToExtent2d=function(e){var t=this,n=this.getMap();return e.convertTo((function(e){if(e.y>0&&e.y<n.height){var i=(0===e.x?0:1)+e.y;t._coordCache[i]||(t._coordCache[i]=n._containerPointToPoint(e)),t._coordCache[i]}return n._containerPointToPoint(e,void 0,vk)}))},n._splitTiles=function(e,t,n,i,r,a,o,s,l,u,c){var h=this._getTileConfig().tileSystem.scale.y,f=this.getMap().getGLScale(r),d=Tk.set(2*o.xmin,h<0?2*o.ymax:2*o.ymin),p=o.getWidth(),m=o.getHeight(),v=2*i.idx,g=2*i.idy,y=2*i.x,_=2*i.y,x=this._checkAndAddTile(e,n,v,g,y,_,r,a,0,0,p,m,d,f,u,c);x&&t.push(x),(x=this._checkAndAddTile(e,n,v,g,y,_,r,a,0,1,p,m,d,f,u,c))&&t.push(x),(x=this._checkAndAddTile(e,n,v,g,y,_,r,a,1,0,p,m,d,f,u,c))&&t.push(x),(x=this._checkAndAddTile(e,n,v,g,y,_,r,a,1,1,p,m,d,f,u,c))&&t.push(x)},n._checkAndAddTile=function(e,t,n,i,r,a,o,s,l,u,c,h,f,d,p,m){var v=this._getTileId(n+l,i+u,o);if(this._visitedTiles&&this._visitedTiles.has(v))return null;var g=p[o];g||(g=p[o]=this._getTileOffset(o));var y=this._getTileConfig().tileSystem.scale.y,_=new ES(f.x+l*c,f.y+y*u*h,f.x+(l+1)*c,f.y+y*(u+1)*h);if(!this._isSplittedTileInExtent(e,_,g,d))return null;var x=s/2,b=t&&t.isTileCachedOrLoading(v);return b?b=b.info:(b={z:o,x:r+l,y:a+u,extent2d:_,id:v,offset:g,res:x,url:this.getTileUrl(r+l,a+u,o+this.options.zoomOffset)},m&&(b.layer=this.getId())),b},n._getTileOffset=function(e){var t=this.options.offset;return l_(t)&&(t=t.call(this,e)),r_(t)&&(t=[t,t]),t||[0,0]},n._getTileId=function(e,t,n,i){return(i||this.getId())+"_"+e+"_"+t+"_"+n},n._project=function(e,t){if(this._hasOwnSR){var n=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(n.unproject(e,t),t)}return e},n._unproject=function(e,t){if(this._hasOwnSR){var n=this.getMap(),i=this.getSpatialReference(),r=n.getProjection(),a=i.getProjection();return r.project(a.unproject(e,t),t)}return e},n._initTileConfig=function(){var e=this.getMap(),t=this.getTileSize(),n=this.getSpatialReference(),i=n.getProjection(),r=n.getFullExtent();this._defaultTileConfig=new mk(e,dk.getDefault(i),r,t),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new mk(e,this.options.tileSystem,r,t)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},n._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},n._bindMap=function(t){var n=t.getBaseLayer();return n===this&&(n.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),e.prototype._bindMap.apply(this,arguments)},n._isTileInExtent=function(e,t,n,i){var r,a=this.getMap();if(e!==a.projViewMatrix){var o=t.getCenter(Ek)._sub(n[0],n[1])._multi(i);vC(Ak,o.x,o.y,0),r=function(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,e}(Ak,Ak,a.projViewMatrix)[1]<0?a.projViewMatrix:e}else r=a.projViewMatrix;return Ck[0][0]=(t.xmin-n[0])*i,Ck[0][1]=(t.ymin-n[1])*i,Ck[1][0]=(t.xmax-n[0])*i,Ck[1][1]=(t.ymax-n[1])*i,jy(r,Ck)},n._isSplittedTileInExtent=function(e,t,n,i){var r=this.getMap();return Ck[0][0]=(t.xmin-n[0])*i,Ck[0][1]=(t.ymin-n[1])*i,Ck[1][0]=(t.xmax-n[0])*i,Ck[1][1]=(t.ymax-n[1])*i,jy(r.projViewMatrix,Ck)},n.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},n._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var e=this.getRenderer();e&&e.clear()},n.getPolygonOffsetCount=function(){return 2},n.getPolygonOffset=function(){return this._polygonOffset||0},n.setPolygonOffset=function(e){return this._polygonOffset=e,this},t}(WT);function Lk(e,t){return e.z-t.z}Rk.registerJSONType("TileLayer"),Rk.mergeOptions(_k);var Ik=new Tb(256,256),Ok="show hide remove setzindex forcereloadstart";function Dk(e){return Array.isArray(e)||(e=[e]),e}var Nk=function(e){function t(t,n,i){var r;return(r=e.call(this,t,i)||this).layers=n||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}K_(t,e),t.fromJSON=function(e){if(!e||"GroupTileLayer"!==e.type)return null;var n=e.layers.map((function(e){return WT.fromJSON(e)}));return new t(e.id,n,e.options)};var n=t.prototype;return n.getLayers=function(){return this.layers},n.addLayer=function(e){var t=this;void 0===e&&(e=[]),e=Dk(e);var n=this.layers.length;return e.forEach((function(e){e instanceof Rk&&(-1!==t.layers.indexOf(e)||t.layerMap[e.getId()]||t.layers.push(e))})),n!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},n.removeLayer=function(e){var t=this;void 0===e&&(e=[]),e=Dk(e);var n=this.layers.length;return e.forEach((function(e){if(e instanceof Rk||(e=t.layerMap[e]),e instanceof Rk){var n=t.layers.indexOf(e);n>=0&&(t.layers.splice(n,1),e._doRemove(),e.off(Ok,t._onLayerShowHide,t))}})),n!==this.layers.length&&(this._refresh(),this._renderLayers()),this},n.clearLayers=function(){var e=this;return this.layers.forEach((function(t){t._doRemove(),t.off(Ok,e._onLayerShowHide,e)})),this.layers=[],this._refresh(),this._renderLayers(),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(e){return e.toJSON()})),options:this.config()}},n.getTileSize=function(e){var t=this.getLayer(e);return t?t.getTileSize():Ik},n.getTiles=function(e,t){for(var n=this.layers,i=[],r=0,a=0,o=n.length;a<o;a++){var s=n[a];if(s&&s.options.visible&&s.isVisible()&&s.getMap()){var l=s.getTiles(e,t||this);l&&0!==l.count&&(r+=l.count,hx(i,l.tileGrids))}}return{count:r,tileGrids:i}},n.onAdd=function(){this._sortLayers(),this._refresh(),e.prototype.onAdd.call(this)},n.onRemove=function(){var t=this;this.layers.forEach((function(e){e._doRemove(),e.off(Ok,t._onLayerShowHide,t)})),this.layerMap={},this._groupChildren=[],e.prototype.onRemove.call(this)},n.getLayer=function(e){return this.getChildLayer(e)},n.getChildLayer=function(e){var t=this.layerMap[e];if(t)return t;for(var n=0;n<this._groupChildren.length;n++){var i=this._groupChildren[n].getChildLayer(e);if(i)return i}return null},n._removeChildTileCache=function(e){if(!e)return this;var t,n=this.getRenderer();if(!n)return this;var i=e.getId(),r=function(){return t&&t.info&&t.info.layer===i};n.tileCache&&n.tileCache.keys().forEach((function(e){t=n.tileCache.get(e),r()&&n.tileCache.remove(e)}));var a=n.tilesInView||{};for(var o in a)t=a[o],r()&&delete a[o];var s=n.tilesLoading||{};for(var l in s)t=s[l],r()&&n.abortTileLoading(t.image,t.info);return this},n._onLayerShowHide=function(e){var t=e||{},n=t.type,i=t.target;return"remove"===n&&i?(this.layers.splice(this.layers.indexOf(i),1),i._doRemove(),i.off(Ok,this._onLayerShowHide,this),this._refresh()):"setzindex"===n?this._sortLayers():"forcereloadstart"===n&&this._removeChildTileCache(i),this._renderLayers(),this},n._renderLayers=function(){var e=this.getRenderer();return e&&e.setToRedraw(),this},n._refresh=function(){var e=this,t=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach((function(n){e.layerMap[n.getId()]=n,n.getChildLayer&&e._groupChildren.push(n),n.getMap()||n._bindMap(t),n.off(Ok,e._onLayerShowHide,e),n.on(Ok,e._onLayerShowHide,e)})),this},n.isVisible=function(){if(!e.prototype.isVisible.call(this))return!1;for(var t=this.layers,n=0,i=t.length;n<i;n++)if(t[n].isVisible())return!0;return!1},n._checkChildren=function(){var e=this,t={};this.layers.forEach((function(n){var i=n.getId();if(t[i])throw new Error("Duplicate child layer id ("+i+") in the GroupTileLayer ("+e.getId()+")");t[i]=1}))},n._sortLayers=function(){this.layers.sort((function(e,t){return e.options.zIndex-t.options.zIndex}))},t}(Rk);Nk.registerJSONType("GroupTileLayer"),Nk.mergeOptions({maxCacheSize:1024});var zk,Uk={crs:null,uppercase:!1,detectRetina:!1},Fk={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},Bk=function(e){function t(t,n){var i;return i=e.call(this,t)||this,zk||(zk=n_({},i.options)),i.wmsParams=n_({},Fk),i.setOptions(n),i.setZIndex(n.zIndex),Y_.proxy||i._optionsHook(n),i}K_(t,e);var n=t.prototype;return n._optionsHook=function(e){for(var t in void 0===e&&(e={}),e)"tileSize"===t&&(this._tileSize=null),t in zk||(this.wmsParams[t]=e[t]);var n=this.getTileSize();return this.wmsParams.width=n.width,this.wmsParams.height=n.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},n.onAdd=function(){var t=this.getMap().getDevicePixelRatio(),n=Uk.detectRetina?t:1;this.wmsParams.width*=n,this.wmsParams.height*=n;var i=this.options.crs||this.getMap().getProjection().code,r=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[r]=i,e.prototype.onAdd.call(this)},n.getTileUrl=function(t,n,i){var r=this.getSpatialReference().getResolution(i),a=this._getTileConfig().getTilePrjExtent(t,n,r),o=a.getMax(),s=a.getMin(),l=(this._wmsVersion>=1.3&&("EPSG:4326"===this.wmsParams.crs||"EPSG:4490"===this.wmsParams.crs)?[s.y,s.x,o.y,o.x]:[s.x,s.y,o.x,o.y]).join(","),u=e.prototype.getTileUrl.call(this,t,n,i);return u+function(e,t,n){var i=[];for(var r in e)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(e[r]));return(t&&-1!==t.indexOf("?")?"&":"?")+i.join("&")}(this.wmsParams,u,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+l},n.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},t.fromJSON=function(e){return e&&"WMSTileLayer"===e.type?new t(e.id,e.options):null},t}(Rk);Bk.registerJSONType("WMSTileLayer"),Bk.mergeOptions(Uk);var Hk=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).options.hasOwnProperty("forceRenderOnMoving")||(i.options.forceRenderOnMoving=!1),i}K_(t,e);var n=t.prototype;return n.drawTile=function(){},n.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},t.fromJSON=function(e){return e&&"CanvasTileLayer"===e.type?new t(e.id,e.options):null},t}(Rk);function jk(e,t,n){var i=e.createShader(t);if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){var r=e.getShaderInfoLog(i);throw e.deleteShader(i),new Error("Failed to compile shader: "+r)}return i}function Gk(e,t,n){var i=jk(e,e.VERTEX_SHADER,t),r=jk(e,e.FRAGMENT_SHADER,n);if(!i||!r)return null;var a=e.createProgram();return a?(e.attachShader(a,i),e.attachShader(a,r),e.linkProgram(a),{program:a,vertexShader:i,fragmentShader:r}):null}function Vk(e,t,n){if(Array.isArray(n[0])){for(var i=Float32Array.BYTES_PER_ELEMENT,r=0,a=0;a<n.length;a++)r+=n[a][1]||0;for(var o=0,s=0;s<n.length;s++){var l=e.getAttribLocation(t,n[s][0]);if(l<0)throw new Error("Failed to get the storage location of "+n[s][0]);e.vertexAttribPointer(l,n[s][1],e[n[s][2]||"FLOAT"],!1,i*r,i*o),o+=n[s][1]||0,e.enableVertexAttribArray(l)}}else{var u=e.getAttribLocation(t,n[0]);e.vertexAttribPointer(u,n[1],e[n[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(u)}}Hk.registerJSONType("CanvasTileLayer");var Wk={never:512,"<":513,"=":514,"<=":515,">":516,"!=":517,">=":518,always:519};var Xk=[1,1,1,1],Zk="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",qk="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n        uniform vec4 u_base_color;\n        uniform float u_alpha_test;\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n            gl_FragColor *= u_base_color;\n            if (gl_FragColor.a < u_alpha_test) {\n                discard;\n            }\n        }\n    ",Yk=[0,0],Jk=[0,0,0],Qk=new Array(16),Kk=new ax(20,20),$k=function(e){var t=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.drawGLImage=function(e,t,n,i,r,a,o,s,l){this.gl.program!==this.program&&this.useProgram(this.program);var u=this.gl;if(this.loadTexture(e),this.canvas.gl&&this.canvas.gl.wrap){var c=this.layer&&this.layer.options.opacity;i_(c)&&(c=1),o*=c}Jk[0]=t||0,Jk[1]=n||0,Jk[2]=0;var h=this.layer;if(h){var f=h.options.altitude,d=r_(f);if(d||(this._layerAlt=0),this._layerAltitude!==f&&d){var p=h.getMap();if(p){var m=p.altitudeToPoint(f,p.getGLRes());this._layerAltitude=f,this._layerAlt=m}}}Jk[2]=this._layerAlt||0;var v=pC(Qk);cC(v,v,Jk),hC(v,v,[a,a,1]),fC(v,this.getMap().projViewMatrix,v),u.uniformMatrix4fv(this.program.u_matrix,!1,v),u.uniform1f(this.program.u_opacity,o),u.uniform1f(this.program.u_debug_line,0),u.uniform4fv(this.program.u_base_color,l||Xk),u.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0);var g=e.glBuffer;!g||g.width===i&&g.height===r||(this.saveImageBuffer(g),delete e.glBuffer),e.glBuffer?u.bindBuffer(u.ARRAY_BUFFER,g):e.glBuffer=this.bufferTileData(0,0,i,r),Yk[0]="a_position",Yk[1]=2,Yk[2]=e.glBuffer.type,this.enableVertexAttrib(Yk),u.drawArrays(u.TRIANGLE_STRIP,0,4),s&&this.drawDebug(v,0,0,i,r,s)},n.drawDebug=function(e,t,n,i,r,a){var o=this.gl;o.disable(o.DEPTH_TEST),o.bindBuffer(o.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),o.bufferData(o.ARRAY_BUFFER,new Float32Array([t,n,t+i,n,t+i,n-r,t,n-r,t,n]),o.DYNAMIC_DRAW),o.uniformMatrix4fv(this.program.u_matrix,!1,e),o.uniform1f(this.program.u_opacity,1),o.uniform1f(this.program.u_debug_line,1),o.uniform4fv(this.program.u_base_color,Xk),o.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0),o.drawArrays(o.LINE_STRIP,0,5);var s=this._debugInfoCanvas;if(!s){var l=this.getMap().getDevicePixelRatio()>1?2:1;(s=this._debugInfoCanvas=document.createElement("canvas")).width=256*l,s.height=32*l;var u=s.getContext("2d");u.font="20px monospace",u.scale(l,l)}var c=s.getContext("2d");c.clearRect(0,0,s.width,s.height);var h=this.layer.options.debugOutline;Zw.fillText(c,a,Kk,h),this.loadTexture(s),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,s);var f=t,d=t+(i=256),p=n-r+32,m=n-r;o.bufferData(o.ARRAY_BUFFER,this.set8(f,p,f,m,d,p,d,m),o.DYNAMIC_DRAW),o.uniform1f(this.program.u_debug_line,0),o.drawArrays(o.TRIANGLE_STRIP,0,4),o.enable(o.DEPTH_TEST)},n.bufferTileData=function(e,t,n,i,r){var a,o=e,s=e+n,l=t,u=t-i;a=a_(o)&&a_(s)&&a_(l)&&a_(u)?this.set8Int(o,l,o,u,s,l,s,u):this.set8(o,l,o,u,s,l,s,u);var c=this.loadImageBuffer(a,r);return c.width=n,c.height=i,c.type=a instanceof Int16Array?"SHORT":"FLOAT",c},n.drawTinImage=function(e,t,n,i,r){var a=this.gl;this.loadTexture(e),a.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),a.uniform1f(this.program.u_opacity,r),a.bindBuffer(a.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(t),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.DYNAMIC_DRAW),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),a.DYNAMIC_DRAW),a.drawElements(a.TRIANGLES,i.length,a.UNSIGNED_SHORT,0)},n.createCanvas2=function(){this.canvas2=Zw.createCanvas(this.canvas.width,this.canvas.height)},n.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=function(e,t){for(var n={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},i=["webgl","experimental-webgl"],r=null,a=0;a<i.length;++a){try{r=e.getContext(i[a],t||n)}catch(uA){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var e=this.gl;e.clearColor(0,0,0,0),e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Zk,this.layer.options.fragmentShader||qk),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),e.bufferData(e.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW),this.enableSampler("u_image"),e.activeTexture(e.TEXTURE0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},n.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},n.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},n.disposeImage=function(e){e&&(e.texture&&this.saveTexture(e.texture),e.glBuffer&&this.saveImageBuffer(e.glBuffer),delete e.texture,delete e.glBuffer)},n._createTexture=function(e){var t=this.gl,n=this.getTexture()||t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),eP(e.width)&&eP(e.height)||(e=function(e){if(eP(e.width)&&eP(e.height))return e;var t=e.width,n=e.height;eP(t)||(t=tP(t));eP(n)||(n=tP(n));var i=document.createElement("canvas");return i.width=t,i.height=n,i.getContext("2d").drawImage(e,0,0,t,n),i}(e)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),n},n.getTexture=function(){this._textures||(this._textures=[]);var e=this._textures;return e&&e.length>0?e.pop():null},n.saveTexture=function(e){this._textures.push(e)},n.loadTexture=function(e){var t=this.getMap(),n=this.gl,i=e.texture;return i||(i=this._createTexture(e),e.texture=i),n.bindTexture(n.TEXTURE_2D,i),t.getRenderer().isViewChanged()?n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),i},n.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var e=this._imageBuffers;return e&&e.length>0?e.pop():null},n.saveImageBuffer=function(e){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(e)},n.loadImageBuffer=function(e,t){var n=this.gl,i=t||this.createImageBuffer();return n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW),i},n.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},n.removeGLCanvas=function(){var e=this.gl;if(e){if(this._debugBuffer&&(e.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(t){e.deleteBuffer(t)})),delete this._buffers),this._textures&&(this._textures.forEach((function(t){return e.deleteTexture(t)})),delete this._textures),this._debugInfoCanvas){var t=this._debugInfoCanvas.texture;t&&e.deleteTexture(t),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var n=e.program;e.deleteShader(n.fragmentShader),e.deleteShader(n.vertexShader),e.deleteProgram(n),delete this.gl,delete this.canvas2}},n.createBuffer=function(){var e=this.gl.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},n.enableVertexAttrib=function(e){Vk(this.gl,this.gl.program,e)},n.createProgram=function(e,t){for(var n=this.gl,i=Gk(n,e,t),r=i.program,a=i.vertexShader,o=i.fragmentShader,s=n.getProgramParameter(r,35718),l=[],u=0;u<s;++u){var c=n.getActiveUniform(r,u);l.push(c.name)}return r.vertexShader=a,r.fragmentShader=o,this._initUniforms(r,l),r},n.useProgram=function(e){var t=this.gl;return t.useProgram(e),t.program=e,this},n.enableSampler=function(e,t){var n=this.gl,i=this._getUniform(n.program,e);return t||(t=0),n.uniform1i(i,t),i},n._initUniforms=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=t[n],a=i.indexOf("[");a>=0&&(i=i.substring(0,a),p_||(r=r.substring(0,a))),e[i]=this._getUniform(e,r)}},n._getUniform=function(e,t){var n=this.gl.getUniformLocation(e,t);if(!n)throw new Error("Failed to get the storage location of "+t);return n},t}(e);return n_(t.prototype,{set8:function(){var e=Y_.ie9?null:new Float32Array(8);return function(t,n,i,r,a,o,s,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e}}(),set8Int:function(){var e=Y_.ie9?null:new Int16Array(8);return function(t,n,i,r,a,o,s,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e}}()}),t};function eP(e){return 0===(e&e-1)&&0!==e}function tP(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var nP={renderer:Y_.webgl?"gl":"canvas",crossOrigin:null,alphaTest:0,depthMask:!0,depthFunc:"<="},iP=new ax(0,0),rP=function(e){function t(t,n,i){var r;return!n||Array.isArray(n)||n.url||(i=n,n=null),(r=e.call(this,t,i)||this)._images=n,r}K_(t,e);var n=t.prototype;return n.onAdd=function(){this._prepareImages(this._images)},n.setImages=function(e){return this._images=e,this._prepareImages(e),this},n.getImages=function(){return this._images},n._prepareImages=function(e){e=e||[],Array.isArray(e)||(e=[e]);var t=this.getMap(),n=t.getGLRes();this._imageData=e.map((function(e){var i=new TS(e.extent);return n_({},e,{extent:i,extent2d:i.convertTo((function(e){return t.coordToPointAtRes(e,n)}))})})),this._images=e;var i=this.getRenderer();i&&i.refreshImages()},t}(WT);rP.mergeOptions(nP);var aP=[],oP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},n.checkResources=function(){var e=this;if(this._imageLoaded)return aP;var t=this.layer._imageData.map((function(e){return[e.url,null,null]}));if(this.resources){var n=[],i=new gM;t.forEach((function(t){if(e.resources.isResourceLoaded(t)){var r=e.resources.getImage(t);i.addResource(t,r)}else n.push(t)})),this.resources.forEach((function(t,n){i.isResourceLoaded(t)||e.retireImage(n.image)})),this.resources=i,t=n}return this._imageLoaded=!0,t},n.retireImage=function(e){e.close&&e.close()},n.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},n.draw=function(e,t){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(e,t),this.completeRender())},n._drawImages=function(){var e=this.layer._imageData,t=this.getMap(),n=t._get2DExtentAtRes(t.getGLRes());if(e&&e.length)for(var i=0;i<e.length;i++){var r=e[i].extent2d,a=this.resources&&this.resources.getImage(e[i].url);a&&n.intersects(r)&&(this._painted=!0,this._drawImage(a,r,e[i].opacity||1))}},n._drawImage=function(e,t,n){var i=0,r=this.context;n<1&&(i=r.globalAlpha,r.globalAlpha=n);var a=this.getMap(),o=iP.set(t.xmin,t.ymax),s=a._pointAtResToContainerPoint(o,a.getGLRes()),l=s.x,u=s.y,c=a.getBearing();c&&(r.save(),r.translate(l,u),c&&r.rotate(-c*Math.PI/180),l=u=0);var h=a.getGLScale();r.drawImage(e,l,u,t.getWidth()/h,t.getHeight()/h),c&&r.restore(),i&&(r.globalAlpha=i)},n.drawOnInteracting=function(){this.draw()},t}(vM),sP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.drawOnInteracting=function(e,t,n){this.draw(t,n)},n._prepareGLContext=function(){var e,t=this.gl;if(t){t.disable(t.STENCIL_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthFunc((e=this.layer.options.depthFunc,Wk[e]));var n=i_(this.layer.options.depthMask)||!!this.layer.options.depthMask;t.depthMask(n)}},n._drawImages=function(t,n){var i=this.gl;if(n&&n.renderTarget){var r=n.renderTarget.fbo;if(r){var a=n.renderTarget.getFramebuffer(r);i.bindFramebuffer(i.FRAMEBUFFER,a)}}(this._prepareGLContext(),e.prototype._drawImages.call(this),n&&n.renderTarget)&&(n.renderTarget.fbo&&i.bindFramebuffer(i.FRAMEBUFFER,null))},n.isDrawable=function(){return!0},n._drawImage=function(e,t,n){this.drawGLImage(e,t.xmin,t.ymax,t.getWidth(),t.getHeight(),1,n)},n.createContext=function(){this.createGLContext()},n.resizeCanvas=function(t){this.canvas&&(e.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.retireImage=function(e){e.close&&e.close(),this.disposeImage(e)},n.onRemove=function(){this.removeGLCanvas(),e.prototype.onRemove.call(this)},t}($k(oP));rP.registerRenderer("canvas",oP),rP.registerRenderer("gl",sP);var lP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.getPrepareParams=function(){return[]},n.getDrawParams=function(){return[]},n.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=Zw.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},n.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&e.prototype.needToRedraw.call(this)},n.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,arguments)},n.drawOnInteracting=function(){this._drawLayerOnInteracting.apply(this,arguments)},n.getCanvasImage=function(){var t=e.prototype.getCanvasImage.call(this);if(t&&t.image&&this.layer.options.doubleBuffer){var n=t.image;this.buffer.width===n.width&&this.buffer.height===n.height||(this.buffer.width=n.width,this.buffer.height=n.height);var i=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(i,this.context);(void 0===r||r)&&(Zw.image(i,n,0,0),t.image=this.buffer)}return t},n.remove=function(){return delete this._drawContext,e.prototype.remove.call(this)},n.onZoomStart=function(t){this.layer.onZoomStart(t),e.prototype.onZoomStart.call(this,t)},n.onZooming=function(t){this.layer.onZooming(t),e.prototype.onZooming.call(this,t)},n.onZoomEnd=function(t){this.layer.onZoomEnd(t),e.prototype.onZoomEnd.call(this,t)},n.onMoveStart=function(t){this.layer.onMoveStart(t),e.prototype.onMoveStart.call(this,t)},n.onMoving=function(t){this.layer.onMoving(t),e.prototype.onMoving.call(this,t)},n.onMoveEnd=function(t){this.layer.onMoveEnd(t),e.prototype.onMoveEnd.call(this,t)},n.onResize=function(t){this.layer.onResize(t),e.prototype.onResize.call(this,t)},n.prepareDrawContext=function(){if(!this._predrawed){var e=uP(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(e)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},n._prepareDrawParams=function(){if(!this.getMap())return null;var e=this.getViewExtent();if(e.maskExtent&&!e.extent.intersects(e.maskExtent))return this.completeRender(),null;var t=[this.context,e],n=uP(this.getDrawParams());return t.push.apply(t,n),t.push.apply(t,this._drawContext),t},n._drawLayer=function(){var e=this._prepareDrawParams();if(e){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.layer.draw.apply(this.layer,e.concat(n)),this.completeRender()}},n._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var e=this._prepareDrawParams();if(e){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.layer.drawOnInteracting.apply(this.layer,e.concat(n)),this.completeRender()}}},t}(vM);function uP(e){return e||(e=[]),Array.isArray(e)||(e=[e]),e}var cP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.isCanvasRender=function(){return!0},n.prepareToDraw=function(){},n.draw=function(){},n.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},n.play=function(){return this.config("animation",!0),this},n.pause=function(){return this.config("animation",!1),this},n.isPlaying=function(){return this.options.animation},n.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},n.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},n.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},n.onCanvasCreate=function(){return this},n.onZoomStart=function(){},n.onZooming=function(){},n.onZoomEnd=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){},n.onResize=function(){},n.doubleBuffer=function(e){return e.clearRect(0,0,e.canvas.width,e.canvas.height),this},t}(WT);cP.mergeOptions({doubleBuffer:!1,animation:!1}),cP.registerRenderer("canvas",lP);var hP=new ax(0,0),fP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.getParticles=function(){},n.draw=function(e,t){var n=this.getParticles(t_());if(n&&0!==n.length){var i=this.getMap(),r=t.extent;t.maskExtent&&(r=t.extent.intersection(t.maskExtent)),r=r.convertTo((function(e){return i._pointToContainerPoint(e,void 0,0,hP)}));for(var a=2*Math.PI,o=0,s=n.length;o<s;o++){var l=n[o].point;if(r.contains(l)){var u=n[o].color||this.options.lineColor||"#fff",c=n[o].r;e.fillStyle!==u&&(e.fillStyle=u),c<=2?e.fillRect(l.x-c/2,l.y-c/2,c,c):(e.beginPath(),e.arc(l.x,l.y,c/2,0,a),e.fill())}}this._fillCanvas(e)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},n._fillCanvas=function(e){var t=e.globalCompositeOperation;e.globalCompositeOperation="destination-out";var n=this.options.trail||30;e.fillStyle="rgba(0, 0, 0, "+1/n+")",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation=t},t}(cP);fP.mergeOptions({animation:!0}),fP.registerRenderer("canvas",function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},n.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},n.onSkipDrawOnInteracting=function(){this._shouldClear=!0},t}(lP));var dP,pP,mP=new gM,vP=function(e){function t(t,n,i){var r;(r=e.call(this,i)||this).target=t,t.once("remove",r.delete,ex(ex(r)));var a=r.options.symbol,o=a.markerLineWidth||1;return r.w=a.markerWidth+o,r.h=a.markerHeight+o,r.opacity=i_(a.opacity)?1:a.opacity,r.map=n,r.events=i.events,r._fetchImage(),r.addTo(n),r}K_(t,e);var n=t.prototype;return n.getCursor=function(){return this.options.cursor||"default"},n._fetchImage=function(){var e=this.map,t=this.options.symbol,n=t.markerFile;this.url=n||Vb(t);var i=mP.getImage(this.url);if(!i){var r=this.w,a=this.h;if(n)(i=new Image).onload=function(){var t=e.getRenderer();t&&t.setToRedraw()},i.src=this.url;else{var o=document.createElement("canvas");o.width=r,o.height=a,i=QM(o.getContext("2d"),{x:r/2,y:a/2},t,mP)}mP.addResource([this.url,r,a],i)}mP.login(this.url),this._img=i},n.setContainerPoint=function(e){this._point=e,this._point._sub(this.w/2,this.h/2)},n.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},n.offset=function(e){this._point._add(e)},n.render=function(e){if(!this._img)return!1;var t=this.options.symbol,n=t.markerDx||0,i=t.markerDy||0,r=this.map,a=this._point,o=a.x,s=a.y,l=this.w,u=this.h;if(o+l>0&&o<r.width&&s+u>0&&s<r.height){var c=r.getDevicePixelRatio();return e.globalAlpha=this.opacity,e.drawImage(this._img,Math.round((o+n)*c),Math.round((s+i)*c),Math.round(l*c),Math.round(u*c)),!0}return!1},n.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}mP.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},n.hitTest=function(e){var t=this.options.symbol,n=t.markerDx||0,i=t.markerDy||0,r=this.w,a=this.h,o=this._point.x+n,s=this._point.y+i;return e.x>=o&&e.x<=o+r&&e.y>=s&&e.y<=s+a},n.addTo=function(e){this.map=e,e.getRenderer().addTopElement(this)},n.onEvent=function(e){this.fire(e.type,e)},n.mousedown=function(e){var t=e.target,n=this.options.cursor;n&&t.setCursor(n),this.onDragstart(e)},n.onDragstart=function(e){var t=e.containerPoint,n=e.target,i=n._panels.mapWrapper||n._containerDOM,r=this._dragger=new cS(i);r.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),r.type="handle",r.onMouseDown(e.domEvent),dP=t.x,pP=t.y,this.fire("dragstart",{containerPoint:t})},n.onDragging=function(e){if(this._dragger){var t=this.map,n=pw(e.domEvent,t._containerDOM),i={x:n.x-dP,y:n.y-pP},r=t.containerPointToCoord(new ax(dP,pP)),a=t.containerPointToCoord(n);dP=n.x,pP=n.y,this.offset(i),this.fire("dragging",{containerPoint:n,coordOffset:a._sub(r)})}},n.onDragend=function(e){if(this._dragger){var t=this.map;t.resetCursor();var n=pw(e.domEvent,t._containerDOM),i={x:n.x-dP,y:n.y-pP};this.offset(i),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:n})}},t}($w(tS)),gP=function(){function e(e,t){this.target=e,e.once("remove",this.delete,this),this.map=t,this.addTo(t)}var t=e.prototype;return t.setPoints=function(e){this.points=e;var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y}));this.xmin=Math.min.apply(Math,t),this.xmax=Math.max.apply(Math,t),this.ymin=Math.min.apply(Math,n),this.ymax=Math.max.apply(Math,n)},t.hitTest=function(){return!1},t.render=function(e){var t=this.map;if(!(this.xmax<=0||this.xmin>=t.width||this.ymax<=0||this.ymin>=t.height)){var n=t.getDevicePixelRatio();e.lineWidth=1,e.strokeStyle="#000",e.globalAlpha=1,e.beginPath();var i=this.points;e.moveTo(a(i[0].x),a(i[0].y));for(var r=1;r<this.points.length;r++)e.lineTo(a(i[r].x),a(i[r].y));e.closePath(),e.stroke()}function a(e){return Math.round(e)*n+.5}},t.addTo=function(e){this.map=e,e.getRenderer().addTopElement(this)},t.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}},e}(),yP=Zy+"_edit_stage_";function _P(e,t){return{markerType:e,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:t}}var xP={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:_P("ellipse",1),vertexHandleSymbol:_P("square",1),newVertexHandleSymbol:_P("square",.4)},bP=function(e){function t(t,n){var i;return(i=e.call(this,n)||this)._geometry=t,i._geometry?i:ex(i)}K_(t,e);var n=t.prototype;return n.getMap=function(){return this._geometry.getMap()},n.prepare=function(){var e=this.getMap();e&&(e.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},n._prepareEditStageLayer=function(){var e=this._geometry.getLayer();if("canvas"===e.options.renderer){var t=this.getMap(),n=ux(),i=yP+n+"_shadow";if(this._shadowLayer=t.getLayer(i),!this._shadowLayer){var r=e.constructor;this._shadowLayer=new r(i),t.addLayer(this._shadowLayer)}}},n.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var e,t=this._geometry,n="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=t.options.draggable,n?(t.config("draggable",!1),(e=t.copy()).setSymbol(t._getInternalSymbol()),e.copyEventListeners(t),t._getParent()&&e.copyEventListeners(t._getParent()),e._setEventTarget(t),e.setId(null).config({draggable:!1}),this._shadow=e,t.hide()):t instanceof _E&&t.config("draggable",!0),this._switchGeometryEvents("on"),(t instanceof _E||t instanceof LE||t instanceof OE||t instanceof IE)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(e),t instanceof _E?e&&(e.config("draggable",!0),e.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),t instanceof _E&&!1!==this.options.resize?this.createMarkerEditor():t instanceof LE?this.createCircleEditor():t instanceof OE||t instanceof IE?this.createEllipseOrRectEditor():t instanceof DE||(t instanceof vE||t instanceof bE)&&this.createPolygonEditor()}},n.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},n.isEditing=function(){return!i_(this.editing)&&this.editing},n._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},n._switchGeometryEvents=function(e){if(this._geometry){var t=this._getGeometryEvents();for(var n in t)this._geometry[e](n,t[n],this)}},n._onGeoSymbolChange=function(e){this._shadow&&this._shadow.setSymbol(e.target._getInternalSymbol())},n._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},n._createOrRefreshOutline=function(){var e=this._geometry,t=this._editOutline;t||(this._editOutline=new gP(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var n=this._editOutline.points;if(e instanceof _E)this._editOutline.setPoints(e.getContainerExtent().toArray(n));else{var i=this.getMap();(n=e._getPrjExtent().toArray(n)).forEach((function(e){return i._prjToContainerPoint(e,null,e)})),this._editOutline.setPoints(n)}return t},n._createCenterHandle=function(){var e,t=this,n=this.getMap(),i=this.options.centerHandleSymbol,r=n.coordToContainerPoint(this._geometry.getCenter()),a=this.createHandle(r,{symbol:i,cursor:"move",onDown:function(){if(t._shadow){var n=Wb((e=t._shadow.copy())._getInternalSymbol(),.5);e.setSymbol(n).addTo(t._geometry.getLayer())}},onMove:function(n){var i=n.coordOffset;e?e.translate(i):t._geometry.translate(i)},onUp:function(){if(e){var n=e.getFirstCoordinate(),i=t._geometry.getFirstCoordinate(),r=n.sub(i);t._update("translate",r),e.remove()}}});this._addRefreshHook((function(){var e=t._geometry.getCenter();a.setContainerPoint(n.coordToContainerPoint(e))}))},n._createHandleInstance=function(e,t){var n=this.getMap(),i=eb(t.symbol,(function(){return[n.getZoom(),{"{bearing}":n.getBearing(),"{pitch}":n.getPitch(),"{zoom}":n.getZoom()}]})),r=this.options.removeVertexOn,a=new vP(this,n,{symbol:i,cursor:t.cursor,events:r});return a.setContainerPoint(e),a},n.createHandle=function(e,t){t||(t={});var n=this._createHandleInstance(e,t),i=this;return n.on("dragstart",(function(e){return this._updating=!0,t.onDown&&(this._geometry.fire("handledragstart"),t.onDown.call(i,e.containerPoint,e)),!1}),this),n.on("dragging",(function(e){return i._hideContext(),t.onMove&&(this._geometry.fire("handledragging"),t.onMove.call(i,e)),!1}),this),n.on("dragend",(function(e){return t.onUp&&(this._geometry.fire("handledragend"),t.onUp.call(i,e)),this._updating=!1,!1}),this),t.onRefresh&&(n.refresh=t.onRefresh),n},n._createResizeHandles=function(e,t,n){var i=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],a=[null,"y",null,"x","x",null,"y",null],o=this._geometry,s=o instanceof _E;e||(e=[]);var l=this,u=[],c={},h=this.getMap(),f=this.options.vertexHandleSymbol,d=function(){for(var d=function(){if(s){var e=o.getContainerExtent();return[new ax(e.xmin,e.ymin),new ax((e.xmax+e.xmin)/2,e.ymin),new ax(e.xmax,e.ymin),new ax(e.xmin,(e.ymin+e.ymax)/2),new ax(e.xmax,(e.ymin+e.ymax)/2),new ax(e.xmin,e.ymax),new ax((e.xmax+e.xmin)/2,e.ymax),new ax(e.xmax,e.ymax)]}var t=o._getPrjExtent();return[new ax(t.xmin,t.ymax),new ax((t.xmax+t.xmin)/2,t.ymax),new ax(t.xmax,t.ymax),new ax(t.xmin,(t.ymax+t.ymin)/2),new ax(t.xmax,(t.ymax+t.ymin)/2),new ax(t.xmin,t.ymin),new ax((t.xmax+t.xmin)/2,t.ymin),new ax(t.xmax,t.ymin)]}(),p=function(p){if(Array.isArray(e)&&e.some((function(e){return e===p})))return"continue";var m,v=d[p],g=s?v:h._prjToContainerPoint(v);if(u.length<d.length-e.length){var y=i.createHandle(g,{symbol:f,cursor:r[p],axis:a[p],onMove:(m=p,function(e){l._updating=!0,t(e.containerPoint,m),o.fire("resizing")}),onUp:function(){l._updating=!1,n()}});c[p]=u.length,u.push(y)}else u[c[p]].setContainerPoint(g)},m=0;m<d.length;m++)p(m)};return d(),this._addRefreshHook(d),u},n.createMarkerEditor=function(){var e=this,t=this._shadow||this._geometry,n=this.getMap();if(t._canEdit()){this._history||this._recordHistory(d());var i=t._getInternalSymbol(),r=new ax(0,0);r_(i.markerDx)&&(r.x=i.markerDx),r_(i.markerDy)&&(r.y=i.markerDy);var a=null,o="middle",s="middle";if(vT.test(i)){var l=i.markerType;"pin"===l||"pie"===l||"bar"===l?(a=[5,6,7],o="bottom"):"rectangle"===l&&(a=[0,1,2,3,5],o="top",s="left")}else(uT.test(i)||gT.test(i))&&(o="bottom",a=[5,6,7]);var u,c=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var h=t.getSize();u=h.width/h.height}var f=this._createResizeHandles(a,(function(i,l){if(a&&a.indexOf(l)>=0){var h=n.containerPointToCoordinate(i.sub(r)),d=t.getCoordinates();h.x=d.x,t.setCoordinates(h),e._updateCoordFromShadow(!0),i=f[f.length-1-l].getContainerPoint()}var p=n.coordToContainerPoint(t.getCoordinates()).add(r),m=t._getInternalSymbol(),v=i.sub(p);"bottom"===o&&i.y>p.y&&(v.y=0);var g="middle"===o?2:1,y="left"===s?1:2,_=Math.abs(v.x)*y,x=Math.abs(v.y)*g;u&&(x=(_=Math.max(_,x*u))/u);var b=c[l];t instanceof GE?((u||0===b||2===b)&&(t.setWidth(_),t!==e._geometry&&e._geometry.setWidth(_)),(u||1===b||2===b)&&(t.setHeight(x),t!==e._geometry&&e._geometry.setHeight(x))):((u||0===b||2===b)&&(m.markerWidth=Math.min(_,e._geometry.options.maxMarkerWidth||1/0)),(u||1===b||2===b)&&(m.markerHeight=Math.min(x,e._geometry.options.maxMarkerHeight||1/0)),t.setSymbol(m),t!==e._geometry&&e._geometry.setSymbol(m))}),(function(){e._update(d())}))}else console&&console.warn("A marker can't be resized with symbol:",t.getSymbol());function d(){var e=[["setCoordinates",t.getCoordinates().toArray()]];return t instanceof GE?(e.push(["setWidth",t.getWidth()]),e.push(["setHeight",t.getHeight()])):e.push(["setSymbol",t.getSymbol()]),e}},n.createCircleEditor=function(){var e=this,t=this._shadow||this._geometry,n=this.getMap();this._history||this._recordHistory([["setCoordinates",t.getCoordinates().toArray()],["setRadius",t.getRadius()]]),this._createResizeHandles(null,(function(i){var r=t.getCenter(),a=n.containerPointToCoord(i),o=new bE([[r.x,r.y],[a.x,r.y]]),s=new bE([[r.x,r.y],[r.x,a.y]]),l=Math.max(n.computeGeometryLength(o),n.computeGeometryLength(s));t.setRadius(l),t!==e._geometry&&e._geometry.setRadius(l)}),(function(){e._update("setRadius",t.getRadius())}))},n.createEllipseOrRectEditor=function(){var e=this,t=[2,1,2,0,0,2,1,2],n=this._shadow||this._geometry;this._history||this._recordHistory(s());var i,r=this.getMap(),a=this._geometry instanceof OE;this.options.fixAspectRatio&&(i=n.getWidth()/n.getHeight());var o=this._createResizeHandles(null,(function(s,l){var u,c,h,f=a?1:2,d=o[l].getContainerPoint(),p=t[l];if(a){var m=o[7-l].getContainerPoint(),v=(u=d.sub(m)).abs();c=r.pixelToDistance(v.x,0),h=r.pixelToDistance(0,v.y);var g=n.getSize(),y=n.getCoordinates(),_=n.getWidth(),x=n.getHeight(),b=r.containerPointToCoord(s),w=r.containerPointToCoord(m),S=new bE([[w.x,w.y],[b.x,w.y]]),M=new bE([[w.x,w.y],[w.x,b.y]]);if(c=r.computeGeometryLength(S),h=r.computeGeometryLength(M),0===p)if(i&&(v.y=v.x/i,g.height=Math.abs(v.y),h=c/i),d.y=m.y-g.height/2,b.y=y.y,4===l)b.x=Math.min(b.x,y.x);else{var T=r.locate(y,_,0);b.x=r.locate(new hS(T.x,b.y),-c,0).x}else if(1===p)i&&(v.x=v.y*i,g.width=Math.abs(v.x),c=h*i),d.x=m.x-g.width/2,b.x=y.x,b.y=Math.max(b.y,w.y);else{if(i&&(c>h*i?(h=c/i,d.y=m.y+v.x*mx(u.y)/i):(c=h*i,d.x=m.x+v.y*mx(u.x)*i)),0===l||5===l){var E=0===l?r.locate(y,_,0):r.locate(y,_,-x);b.x=r.locate(new hS(E.x,b.y),-c,0).x}else b.x=Math.min(b.x,w.x);b.y=Math.max(b.y,w.y)}n.setCoordinates(b),e._updateCoordFromShadow(!0)}else{var C=n.getCenter(),k=r.containerPointToCoord(d),P=new bE([[C.x,C.y],[k.x,C.y]]),A=new bE([[C.x,C.y],[C.x,k.y]]);c=r.computeGeometryLength(P),h=r.computeGeometryLength(A),i&&(h=(c=Math.max(c,h*i))/i)}(i||0===p||2===p)&&(n.setWidth(c*f),n!==e._geometry&&e._geometry.setWidth(c*f)),(i||1===p||2===p)&&(n.setHeight(h*f),n!==e._geometry&&e._geometry.setHeight(h*f))}),(function(){e._update(s())}));function s(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},n.createPolygonEditor=function(){var e=this.getMap(),t=this._shadow||this._geometry,n=this;this._history||this._recordHistory("setCoordinates",hS.toNumberArrays(t.getCoordinates()));var i=t instanceof vE?3:2,r="maptalks--editor-vertex-index",a={0:[]},o={0:[]};function s(e){if(void 0===e&&(e=0),t instanceof vE){var n=t.getCoordinates()[e]||[];return n.slice(0,n.length-1)}return t.getCoordinates()}function l(e){return void 0===e&&(e=0),0===e?t._getPrjCoordinates():t._getPrjHoles()[e-1]}function u(){for(var e in a){for(var t=a[e].length-1;t>=0;t--)a[e][t][r]=t;for(var i=o[e].length-1;i>=0;i--)o[e][i][r]=i}n._updateCoordFromShadow()}function c(e){n._updating=!0;var s=e.target,c=s[r],h=r_(s._ringIndex)?s._ringIndex:0,f=l(h);if(!(f.length<=i)){var d,p=t instanceof bE&&(0===c||c===f.length-1);if(f.splice(c,1),h>0?t._prjHoles[h-1]=f:t._setPrjCoordinates(f),t._updateCache(),a[h].splice(c,1)[0].delete(),c<o[h].length&&o[h].splice(c,1)[0].delete(),d=0===c?o[h].length-1:c-1,o[h].splice(d,1)[0].delete(),p||o[h].splice(d,0,v.call(n,d,h)),h>0){var m=t.getCoordinates(),g=m[h];g&&Array.isArray(g)&&g.length>1&&(g.splice(c,1),t!==this._geometry&&t.setCoordinates(m))}u(),n._updating=!1}}function h(i,r,a){void 0===a&&(a=0);var s=n._geometry.snapTo;s&&l_(s)&&(i=n._geometry.snapTo(i)||i);var u,c=l(a),h=e._containerPointToPrj(i.sub(d())),f=c[r];f.x=h.x,f.y=h.y,t._updateCache(),t.onShapeChanged(),n._updateCoordFromShadow(!0),u=0===r?o[a].length-1:r-1,o[a][r]&&o[a][r].refresh(),o[a][u]&&o[a][u].refresh()}var f=new ax(0,0);function d(){var e=t._getCompiledSymbol();return f.x=e.lineDx||0,f.y=e.lineDy||0,f}function p(t,i,a){void 0===i&&(i=0);var o=(a||s(i))[t],l=n.createHandle(e.coordToContainerPoint(o)._add(d()),{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){h(l.getContainerPoint(),l[r],i)},onRefresh:function(t,n){o=(n||s(i))[l[r]];var a=e.coordToContainerPoint(o);l.setContainerPoint(a._add(d()))},onUp:function(){n._updateCoordFromShadow()},onDown:function(e,t){!t||!t.domEvent||t.domEvent.button}});return l[r]=t,l._ringIndex=i,l.on(n.options.removeVertexOn,c),l}var m=!1;function v(i,c,f){void 0===c&&(c=0);var g,y=f||s(c);g=i+1>=y.length?y[0]:y[i+1];var _=y[i].add(g).multi(.5),x=n.createHandle(_,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(i,a){if(!a||!a.domEvent||2!==a.domEvent.button){var s=l(c),u=x[r],h=x.getContainerPoint(),f=e._containerPointToPrj(h);s.splice(u+1,0,f),c>0?t._prjHoles[c-1]=s:t._setPrjCoordinates(s),t._updateCache(),x.opacity=1,o[c].splice(u,0,v.call(n,u,c),v.call(n,u+1,c)),m=!0}},onMove:function(){h(x.getContainerPoint(),x[r]+1,c)},onUp:function(e){if(e&&e.domEvent&&2===e.domEvent.button)m=!1;else{var t=x[r];fx(x,o[c]),x.delete(),a[c].splice(t+1,0,p.call(n,t+1,c)),u(),n._updateCoordFromShadow(),m=!1}},onRefresh:function(t,n){y=n||s(t);var i,a=x[r];i=a===y.length-1?0:a+1;var o=y[a].add(y[i]).multi(.5),l=e.coordToContainerPoint(o);x.setContainerPoint(l._add(d()))}});return x[r]=i,x}if(t instanceof vE)for(var g=t.getHoles().length+1,y=0;y<g;y++){a[y]=[],o[y]=[];for(var _=s(y),x=0,b=_.length;x<b;x++)a[y].push(p.call(this,x,y,_)),x<b-1&&o[y].push(v.call(this,x,y,_));o[y].push(v.call(this,_.length-1,y,_))}else{for(var w=s(0),S=0,M=w.length;S<M;S++)a[0].push(p.call(this,S,0,w)),S<M-1&&o[0].push(v.call(this,S,0,w));o[0].length&&2===t.getCoordinates().length&&(o[0][0].options.symbol.markerDx=12)}this._addRefreshHook((function(){if(!m){for(var e in o)for(var n=s(e),i=o[e].length-1;i>=0;i--)o[e][i].refresh(e,n);for(var r in o[0].length&&t instanceof bE&&(2===t.getCoordinates().length?o[0][0].options.symbol.markerDx=12:t.getCoordinates().length>2&&(o[0][0].options.symbol.markerDx=0)),a)for(var l=s(r),u=a[r].length-1;u>=0;u--)a[r][u].refresh(r,l)}}))},n._refresh=function(){if(this._refreshHooks)for(var e=this._refreshHooks.length-1;e>=0;e--)this._refreshHooks[e].call(this)},n._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},n._addRefreshHook=function(e){e&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(e))},n._update=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this._exeHistory([e,n]),this._recordHistory.apply(this,[e].concat(n))},n._updateCoordFromShadow=function(e){var t=(this._shadow||this._geometry).getCoordinates(),n=this._geometry,i=this._updating;this._updating=!0,n.setCoordinates(t),e||this._recordHistory("setCoordinates",hS.toNumberArrays(n.getCoordinates())),this._updating=i},n._recordHistory=function(e){this._history||(this._history=[],this._historyPointer=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this._history.length){var r=this._history[this._history.length-1];if(r[0]===e&&JSON.stringify(r[1])===JSON.stringify(n))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([e,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},n.cancel=function(){if(!this._history||0===this._historyPointer)return this;this._historyPointer=0;var e=this._history[0];return this._exeAndReset(e),this},n.undo=function(){if(!this._history||0===this._historyPointer)return this;var e=this._history[--this._historyPointer];return this._exeAndReset(e),this},n.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var e=this._history[++this._historyPointer];return this._exeAndReset(e),this},n._exeAndReset=function(e){if(!this._updating){this._exeHistory(e);var t=this._history,n=this._historyPointer;this.stop(),this._history=t,this._historyPointer=n,this.start()}},n._onDragStart=function(){this._updating=!0},n._onDragEnd=function(){this._updating=!1},n._exeHistory=function(e){if(Array.isArray(e)){var t=this._updating;this._updating=!0;var n=this._shadow||this._geometry,i=this._geometry;Array.isArray(e[0])?e[0].forEach((function(e){var t=e[0],r=e.slice(1);n[t].apply(n,r),n!==i&&i[t].apply(i,r)})):(n[e[0]].apply(n,e[1]),n!==i&&i[e[0]].apply(i,e[1])),this._updating=t}},t}($w(tS));bP.mergeOptions(xP);var wP={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var e=this._textEditor.innerHTML;e=e.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=e;var t=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(t),Tw(this._textEditor,"mousedown dblclick",cw),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var e=this.getMap(),t=this._createEditor();this._textEditor=t,e.on("mousedown",this.endEditText,this);var n=this._getEditorOffset();this._editUIMarker=new VC(this.getCoordinates(),{animation:null,content:t,dx:n.dx,dy:n.dy}).addTo(e),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var e=this._getInternalSymbol()||{},t=0,n=0,i=e.textHorizontalAlignment;return"middle"===i||i_(i)?(t=(e.textDx||0)-2,n=(e.textDy||0)-2):(t=(e.markerDx||0)-2,n=(e.markerDy||0)-2),{dx:t,dy:n}},_createEditor:function(){var e=this.getContent(),t=this.getSize(),n=this._getInternalSymbol()||{},i=t.width,r=n.textFill||"#000000",a=n.textSize||12,o=t.height,s=n.markerLineColor||"#000",l=n.markerFill||"#3398CC",u=n.textLineSpacing||0,c=iw("div");return c.contentEditable=!0,c.style.cssText="background:"+l+"; border:1px solid "+s+";\n            color:"+r+";font-size:"+a+"px;width:"+(i-2)+"px;height:"+(o-2)+"px;margin: auto;\n            line-height:"+(a+u)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",c.innerText=e,Mw(c,"mousedown dblclick",cw),c.onkeyup=function(e){var t=c.style.height||0;13===e.keyCode&&(c.style.height=parseInt(t)+a/2+"px")},c},_setCursorToLast:function(e){var t;window.getSelection?(e.focus(),(t=window.getSelection()).selectAllChildren(e),t.collapseToEnd()):document.selection&&((t=document.selection.createRange()).moveToElementText(e),t.collapse(!1),t.select())}};jE.include(wP),UT.include({animate:function(e,t,n){var i=this;this._animPlayer&&this._animPlayer.finish(),l_(t)&&(n=t),t||(t={});var r,a=this.getMap(),o=this._getProjection(),s=this._prepareAnimationStyles(e),l=t.focus;if(delete this._animationStarted,a){var u=a._getRenderer();t.framer=function(e){u.callInNextFrame(e)}}var c=dE.animate(s,t,(function(e){if(a&&a.isRemoved())c.finish();else{a&&!i._animationStarted&&l&&a.onMoveStart();var t=e.styles;for(var s in t)if("symbol"!==s&&"translate"!==s&&t.hasOwnProperty(s)){var u="set"+s[0].toUpperCase()+s.slice(1);i[u](t[s])}var h=t.translate;if(h){var f=h;r&&(f=h.sub(r)),r=h,i.translate(f)}var d=t.symbol;if(d){var p=i.getSymbol()||{};i.setSymbol(Xb(p,d))}if(a&&l){var m=o.project(i.getCenter());a._setPrjCenter(m);var v=a._parseEventFromCoord(o.unproject(m));"running"!==c.playState?a.onMoveEnd(v):a.onMoving(v)}i._fireAnimateEvent(c.playState),n&&n(e)}}),this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(e){var t=this._getInternalSymbol(),n={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if("translate"!==i&&"symbol"!==i){var a=this["get"+i[0].toUpperCase()+i.substring(1)]();n[i]=[a,r]}else if("symbol"===i){var o=void 0;if(Array.isArray(e.symbol)){if(!Array.isArray(t))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");o=[];for(var s=e.symbol,l=0;l<s.length;l++)if(s[l]){var u={};for(var c in s[l])s[l].hasOwnProperty(c)&&(u[c]=[t[l][c],s[l][c]]);o.push(u)}else o.push(null)}else{if(Array.isArray(t))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var h in o={},r)r.hasOwnProperty(h)&&(o[h]=[t[h],r[h]])}n.symbol=o}else"translate"===i&&(n.translate=new hS(r))}return n},_fireAnimateEvent:function(e){"finished"===e?(delete this._animationStarted,this._fireEvent("animateend")):"running"===e&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var SP=Zy+"_drag_stage",MP=Y_.touch?"touchstart mousedown":"mousedown",TP=function(e){function t(t){return e.call(this,t)||this}K_(t,e);var n=t.prototype;return n.addHooks=function(){this.target.on(MP,this._startDrag,this)},n.removeHooks=function(){this._endDrag(),this.target.off(MP,this._startDrag,this),delete this.container},n._prepareDragHandler=function(){this._dragHandler=new cS(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},n._prepareShadow=function(){var e=this,t=this.target;if("canvas"===t.getLayer().options.renderer){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var n=this._shadow=t.copy();if(n.getGeometries){var i=n.getGeometries(),r=t.getGeometries();i.forEach((function(t,n){e._updateShadowSymbol(t,r[n])}))}else this._updateShadowSymbol(n,t);n.setId(null),this._prepareShadowConnectors()}},n._updateShadowSymbol=function(e,t){if(e.setSymbol(t._getInternalSymbol()),t.options.dragShadow){var n=Wb(e._getInternalSymbol(),.5);e.setSymbol(n)}},n._prepareShadowConnectors=function(){var e=this.target,t=this._shadow,n=this._dragStageLayer._getRenderer().resources,i=[];if(ZE._hasConnectors(e))for(var r=ZE._getConnectors(e),a=0,o=r.length;a<o;a++){var s=r[a],l=s.config(),u=s._getInternalSymbol();l.symbol=Wb(u,.5);var c=void 0;c=s.getConnectSource()===e?new s.constructor(t,s.getConnectTarget(),l):new s.constructor(s.getConnectSource(),t,l),i.push(c),s.getLayer()&&s.getLayer()._getRenderer()&&n.merge(s.getLayer()._getRenderer().resources)}this._shadowConnectors=i,i.push(t),this._dragStageLayer.bringToFront().addGeometry(i)},n._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},n._prepareDragStageLayer=function(){var e=this.target.getMap(),t=this.target.getLayer();this._dragStageLayer=e.getLayer(SP),this._dragStageLayer||(this._dragStageLayer=new $E(SP,{enableAltitude:t.options.enableAltitude,altitudeProperty:t.options.altitudeProperty}),e.addLayer(this._dragStageLayer));var n=new gM;n.merge(t._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},n._startDrag=function(e){var t=this.target.getMap();if(t&&(!this.target._getParent()&&!this.isDragging())){var n=e.domEvent;n.touches&&n.touches.length>1||2===n.button||(this.container=t._panels.mapWrapper||t._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(e.coordinate),this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),Mw(this.container,"mouseleave",this._endDrag,this),this._startParam=e,this._moved=!1)}},n._dragging=function(e){var t=this.target,n=t.getMap(),i=n._parseEvent(e.domEvent),r=i.domEvent;if(!(r.touches&&r.touches.length>1)){var a=n._getVisualHeight(n.options.maxVisualPitch);if(!(i.containerPoint.y<n.height-a)){if(!this._moved)return this._moved=!0,t.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(t.options.dragShadow||t.hide(),this._shadow._fireEvent("dragstart",i)),this.target._fireEvent("dragstart",this._startParam||i),void delete this._startParam;var o=this._shadow||t,s=o.options.dragOnAxis,l=o.options.dragOnScreenAxis,u=i.containerPoint,c=i.coordinate;this._lastPoint=this._lastPoint||u,this._lastCoord=this._lastCoord||c,l?("x"===s?u.y=this._lastPoint.y:"y"===s&&(u.x=this._lastPoint.x),c=n.containerPointToCoord(u)):c=this._correctCoord(c);var h=u.sub(this._lastPoint),f=c.sub(this._lastCoord);l||("x"===s?h.y=f.y=0:"y"===s&&(h.x=f.x=0)),this._lastPoint=u,this._lastCoord=c,o.translate(f),o===t||t.options.dragShadow||t.translate(f),i.coordOffset=f,i.pointOffset=h,o._fireEvent("dragging",i),o!==t&&t._fireEvent("dragging",i)}}},n._endDrag=function(e){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&Tw(this.container,"mouseleave",this._endDrag,this),this.target){var t=this.target;t.off("click",this._endDrag,this),t.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=t.getMap();if(this.enabled()&&n){var i=n._parseEvent(e?e.domEvent:null);this._updateTargetAndRemoveShadow(i),this._moved&&t._fireEvent("dragend",i)}}},n.isDragging=function(){return!!this._isDragging},n._updateTargetAndRemoveShadow=function(e){if(this._shadow){var t=this.target,n=t.getMap();t.options.dragShadow||t.show();var i=this._shadow;if(i){if(t.options.dragShadow){var r=i.getFirstCoordinate(),a=t.getFirstCoordinate(),o=r.sub(a);t.translate(o)}i._fireEvent("dragend",e),i.remove(),delete this._shadow}this._shadowConnectors&&(n.getLayer(SP).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new gM,this._dragStageLayer.remove())}},n._correctCoord=function(e){var t=this.target.getMap();if(!t.getPitch())return e;var n=this.target;if(!n.getMinAltitude())return e;var i=(n.getMinAltitude()+n.getMaxAltitude())/2;return t.locateByPoint(e,0,-i)},t}(eS);UT.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),UT.addInitHook("addHandler","draggable",TP),UT.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),UT.include({startEdit:function(e){var t=this.getMap();return t&&this.options.editable?(this._editor&&this.endEdit(),this._editor=new bP(this,e),this._editor.start(),this._getParent()||this.fire("editstart"),t.getRenderer().setToRedraw(),this):this},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._getParent()||this.fire("editend");var e=this.getMap();e&&e.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),UT.include({_onEvent:function(e,t){var n=this.getMap();if(n){var i=t||this._getEventTypeToFire(e);"contextmenu"===i&&this.listens("contextmenu")&&(cw(e),uw(e));var r=n._getEventParams(e);r_(this._pickGeometryIndex)&&(r.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(i,r)}},_getEventTypeToFire:function(e){return e.type}}),UT.include({setInfoWindow:function(e){return this.removeInfoWindow(),e instanceof JC?(this._infoWindow=e,this._infoWinOptions=n_({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=n_({},e),this._infoWindow?this._infoWindow.setOptions(e):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(e){return this.getMap()?(e||(e=this.getCenter()),this._infoWindow?this._infoWindow.show(e):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(e)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var e=this._infoWinOptions;return e?(this._infoWindow=new JC(e),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var EP=new ax(0,0),CP=new ax(0,0),kP=new ax(0,0),PP=new ax(0,0),AP=[],RP=function(e){function t(){return e.call(this,qS)||this}K_(t,e);var n=t.prototype;return n.checkUrl=function(e){return e&&s_(e)?Ox(e):e},n.fetchImage=function(e,t,n,i){var r={url:e=this.checkUrl(e),fetchOptions:i};this.send(r,AP,n,t)},t}(dM),LP=new Image,IP=function(e){function t(t){var n;return(n=e.call(this,t)||this).tilesInView={},n.tilesLoading={},n._parentTiles=[],n._childTiles=[],n._tileQueue=[],n.tileCache=new Rw(t.options.maxCacheSize,(function(e){n.deleteTile(e)})),Y_.decodeImageInWorker&&n.layer.options.decodeImageInWorker&&("gl"===t.options.renderer||!Y_.safari&&!Y_.iosWeixin)&&(n._tileImageWorkerConn=new RP),n._compareTiles=DP.bind(ex(ex(n))),n}K_(t,e);var n=t.prototype;return n.getCurrentTileZoom=function(){return this._tileZoom},n.draw=function(e,t){var n=this.getMap();if(this.isDrawable()){var i=this.prepareCanvas();if(!i||i.intersects(this.canvasExtent2D)){var r;this._renderTimestamp!==e&&(this._consumeTileQueue(),this._computeAvgTileAltitude(),this._renderTimestamp=e);var a=!1,o=this._frameTiles;if(o&&e===o.timestamp){if(o.empty)return;r=o}else{if(!(r=this._getTilesInCurrentFrame()))return this._frameTiles={empty:!0,timestamp:e},void this.completeRender();a=!0,this._frameTiles=r,this._frameTiles.timestamp=e,r.loadingCount&&this.loadTileQueue(r.tileQueue)}var s=r,l=s.tiles,u=s.childTiles,c=s.parentTiles,h=s.placeholders,f=s.loading,d=s.loadingCount;this._drawTiles(l,c,u,h,t),d||f||(n.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),a&&this._retireTiles()}else this.completeRender()}},n.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},n._getTilesInCurrentFrame=function(){var e=this.getMap(),t=this.layer.getTiles();if(this._frameTileGrids=t,!(t=t.tileGrids)||!t.length)return null;var n=t.reduce((function(e,t){return e+(t&&t.tiles&&t.tiles.length||0)}),0);n>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*n+1);var i=0,r=!1,a={},o=[],s=[],l={},u=[],c={},h=[],f={},d={},p=this._markTiles(),m=this._getLoadLimit(),v=t.length;this._tileZoom=t[0].zoom;for(var g=0;g<v;g++){var y=t[g],_=y.tiles,x=y.parents||AP,b=x.length,w=x.concat(_),S=void 0;w.length&&(S=this._generatePlaceHolder(w[0].res));for(var M=0,T=w.length;M<T;M++){var E=w[M],C=E.id,k=M<b,P=!1;if(this._isLoadingTile(C))P=r=!0,this.tilesLoading[C].current=!0;else{var A=this._getCachedTile(C,k);if(A)k||(A.image&&this.isTileFadingIn(A.image)&&(P=r=!0,this.setToRedraw()),o.push(A),this.isTileComplete(A)||(P=!0));else if(P=r=!0,!(m&&i+p[0]>m)&&(!e.isInteracting()||e.isMoving()||e.isRotating()))i++,d[C]=E}if(!k&&(P&&!a[C])){a[C]=1,S&&!f[C]&&(E.cache=!1,h.push({image:S,info:E}),f[C]=1);var R=this._findChildTiles(E);if(R.length&&R.forEach((function(e){c[e.info.id]||(u.push(e),c[e.info.id]=1)})),!R.length||4!==R.length){var L=this._findParentTile(E);if(L){var I=L.info.id;void 0===l[I]&&(l[I]=s.length,s.push(L))}}}}}return this.tileCache.shrink(),{childTiles:u,parentTiles:s,tiles:o,placeholders:h,loading:r,loadingCount:i,tileQueue:d}},n.removeTileCache=function(e){delete this.tilesInView[e],this.tileCache.remove(e)},n.isTileCachedOrLoading=function(e){return this.tileCache.get(e)||this.tilesInView[e]||this.tilesLoading[e]},n.isTileCached=function(e){return!(!this.tileCache.get(e)&&!this.tilesInView[e])},n.isTileFadingIn=function(e){return this._getTileFadingOpacity(e)<1},n._drawTiles=function(e,t,n,i,r){var a=this;t.length&&(t.sort(this._compareTiles),this._parentTiles=t),n.length&&(this._childTiles=n,this._childTiles.sort(this._compareTiles));var o=!0,s=this.canvas._parentTileTimestamp;this.layer.constructor!==Rk&&this.layer.constructor!==Bk||(this._renderTimestamp===s?o=!1:this.canvas._parentTileTimestamp=this._renderTimestamp);var l={tiles:e,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:r};if(this.onDrawTileStart(l,r),o&&1===this.layer.options.opacity){this.layer._silentConfig=!0;var u=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,this.drawingChildTiles=!0,this._childTiles.forEach((function(e){return a._drawTile(e.info,e.image,r)})),delete this.drawingChildTiles,this.drawingParentTiles=!0,this._parentTiles.forEach((function(e){return a._drawTile(e.info,e.image,r)})),delete this.drawingParentTiles,this.layer.options.fadeAnimation=u,this.layer._silentConfig=!1}this.drawingCurrentTiles=!0,e.sort(this._compareTiles);for(var c=0,h=e.length;c<h;c++)this._drawTileAndCache(e[c],r);if(delete this.drawingCurrentTiles,o&&this.layer.options.opacity<1){this.layer._silentConfig=!0;var f=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,this.drawingChildTiles=!0,this._childTiles.forEach((function(e){return a._drawTile(e.info,e.image,r)})),delete this.drawingChildTiles,this.drawingParentTiles=!0,this._parentTiles.forEach((function(e){return a._drawTile(e.info,e.image,r)})),delete this.drawingParentTiles,this.layer.options.fadeAnimation=f,this.layer._silentConfig=!1}i.forEach((function(e){return a._drawTile(e.info,e.image,r)})),this.onDrawTileEnd(l,r)},n.onDrawTileStart=function(){},n.onDrawTileEnd=function(){},n._drawTile=function(e,t,n){t&&this.drawTile(e,t,n)},n._drawTileAndCache=function(e,t){this.tilesInView[e.info.id]=e,this._drawTile(e.info,e.image,t)},n.drawOnInteracting=function(e,t,n){this.draw(t,n)},n.needToRedraw=function(){var t=this.getMap();return!!this._tileQueue.length||(t.getPitch()?e.prototype.needToRedraw.call(this):!(!t.isRotating()&&!t.isZooming())||(t.isMoving()?!!this.layer.options.forceRenderOnMoving:e.prototype.needToRedraw.call(this)))},n.hitDetect=function(){return!1},n._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit||0},n.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},n.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],e.prototype.clear.call(this)},n._isLoadingTile=function(e){return!!this.tilesLoading[e]},n.clipCanvas=function(t){return e.prototype.clipCanvas.call(this,t)},n._clipByPitch=function(e){var t=this.getMap();if(t.getPitch()<=t.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var n=t.getContainerExtent(),i=t.getDevicePixelRatio();return e.save(),e.strokeStyle="rgba(0, 0, 0, 0)",e.beginPath(),e.rect(0,Math.ceil(n.ymin)*i,Math.ceil(n.getWidth())*i,Math.ceil(n.getHeight())*i),e.stroke(),e.clip(),!0},n.loadTileQueue=function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t],i=this.loadTile(n);void 0===i.loadTime&&(this.tilesLoading[n.id]={image:i,current:!0,info:n})}},n.loadTile=function(e){var t=this,n={};if(this.loadTileBitmap){this.loadTileBitmap(e.url,e,(function(n){t.onTileLoad(n,e)}))}else if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(n,e);else{var i=this.layer.getTileSize(e.layer);(n=new Image).width=i.width,n.height=i.height,n.onload=this.onTileLoad.bind(this,n,e),n.onerror=this.onTileError.bind(this,n,e),this.loadTileImage(n,e.url)}return n},n._fetchImage=function(e,t){var n=this;if(e instanceof Image)e.src=t.url;else{var i=t.x,r=t.y,a=Math.abs(i+r)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(t.url,a,(function(i,r){i?n.onTileError(e,t,i):Ix(r,(function(e){n.onTileLoad(e,t)}))}),this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},n.loadTileImage=function(e,t){var n=this.layer.options.crossOrigin;return i_(n)||(e.crossOrigin=n),sx(e,[t])},n.abortTileLoading=function(e,t){t&&void 0!==t.id&&this.removeTileLoading(t),e&&(e.onload=OP,e.onerror=OP,e.src=kx)},n.onTileLoad=function(e,t){this.removeTileLoading(t),this._tileQueue.push({tileInfo:t,tileData:e}),this.setToRedraw()},n.removeTileLoading=function(e){delete this.tilesLoading[e.id],this.setToRedraw()},n._consumeTileQueue=function(){for(var e=0,t=this.layer.options.tileLimitPerFrame,n=this._tileQueue;n.length&&(t<=0||e<t);){var i=n.shift(),r=i.tileData,a=i.tileInfo;this.checkTileInQueue(r,a)&&(this.consumeTile(r,a),e++)}},n._computeAvgTileAltitude=function(){var e=0,t=0,n=0;for(var i in this.tilesInView){var r=this.tilesInView[i]&&this.tilesInView[i].info;r&&(e+=r.minAltitude||0,t+=r.maxAltitude||0,n++)}this.avgMinAltitude=e/n,this.avgMaxAltitude=t/n},n.checkTileInQueue=function(){return!0},n.consumeTile=function(e,t){if(this.layer&&this.tilesInView){var n={tile:t,tileImage:e};this.layer.fire("tileload",n),e=n.tileImage,this.resetTileLoadTime(e),this.removeTileLoading(t),this._addTileToCache(t,e),this.setToRedraw()}},n.resetTileLoadTime=function(e){e.loadTime=t_()},n.onTileError=function(e,t){if(this.layer){if(e.onerrorTick=e.onerrorTick||0,this.layer.options.tileRetryCount>e.onerrorTick)return e.onerrorTick++,this._fetchImage(e,t),void this.removeTileLoading(t);var n=this.layer.options.errorUrl;if(n){if(e instanceof Image&&e.src!==n)return e.src=n,void this.removeTileLoading(t);(e=new Image).src=n}e=e instanceof Image?e:LP,this.abortTileLoading(e,t),e.loadTime=0,this.removeTileLoading(t),this._addTileToCache(t,e),this.setToRedraw(),this.layer.fire("tileerror",{tile:t})}},n.drawTile=function(e,t){if(t&&this.getMap()){var n=e.extent2d,i=e.offset,r=EP.set(n.xmin-i[0],n.ymax-i[1]),a=e.z,o=e.id,s=this.getMap(),l=s.getZoom(),u=this.context,c=s._pointAtResToContainerPoint(r,e.res,0,CP),h=s.getBearing(),f=h||l!==a,d=this.getTileOpacity(t,e),p=u.globalAlpha;d<1&&(u.globalAlpha=d),f||c._round();var m=c.x,v=c.y,g=e.extent2d.xmax-e.extent2d.xmin,y=e.extent2d.ymax-e.extent2d.ymin;if(f){u.save(),u.translate(m,v),h&&u.rotate(-h*Math.PI/180),g+=.5,y+=.5;var _=s._getResolution();if(_!==e.res){var x=e.res/_;u.scale(x,x)}m=v=0}if(Zw.image(u,t,m,v,g,y),this.layer.options.debug){var b=this.layer.options.debugOutline;u.save(),u.strokeStyle=b,u.fillStyle=b,u.strokeWidth=10,u.font="20px monospace";var w=new ax(m,v);Zw.rectangle(u,w,{width:g,height:y},1,0),Zw.fillText(u,this.getDebugInfo(o),w._add(32,y-14),b),Zw.drawCross(u,m+g/2,v+y/2,2,b),u.restore()}f&&u.restore(),u.globalAlpha!==p&&(u.globalAlpha=p),this.setCanvasUpdated()}},n.getDebugInfo=function(e){var t=e.split("_"),n=t.length;return t[n-3]+"/"+t[n-2]+"/"+t[n-1]},n._findChildTiles=function(e){var t=this._getLayerOfTile(e.layer);if(!t||!t.options.background||e.z>this.layer.getMaxZoom())return AP;var n=this.getMap(),i=[];if(t._isPyramidMode()){for(var r=2*e.x,a=2*e.y,o=e.z+1,s=[],l=0;l<2;l++)for(var u=0;u<2;u++)s.push(r+l,a+u,o);for(;s.length;){var c=s.pop(),h=s.pop(),f=s.pop(),d=t._getTileId(f,h,c,e.layer),p=c+1<=e.z+2,m=this.tileCache.getAndRemove(d);if(m){if(this.isValidCachedTile(m))i.push(m),this.tileCache.add(d,m);else if(p)for(var v=0;v<2;v++)for(var g=0;g<2;g++)s.push(2*f+v,2*h+g,c+1)}else if(p)for(var y=0;y<2;y++)for(var _=0;_<2;_++)s.push(2*f+y,2*h+_,c+1)}return i}for(var x=e.res,b=e.extent2d.getMin(),w=e.extent2d.getMax(),S=t._project(n._pointToPrjAtRes(b,x,kP),kP),M=t._project(n._pointToPrjAtRes(w,x,PP),PP),T=1;T<1;T++)this._findChildTilesAt(i,S,M,t,e.z+T);return i},n._findChildTilesAt=function(e,t,n,i,r){var a=i.getId(),o=i.getSpatialReference().getResolution(r);if(o)for(var s,l,u=i._getTileConfig().getTileIndex(t,o),c=i._getTileConfig().getTileIndex(n,o),h=Math.min(u.idx,c.idx),f=Math.max(u.idx,c.idx),d=Math.min(u.idy,c.idy),p=Math.max(u.idy,c.idy),m=h;m<f;m++)for(var v=d;v<p;v++)s=i._getTileId(m,v,r,a),(l=this.tileCache.getAndRemove(s))&&this.isValidCachedTile(l)&&(e.push(l),this.tileCache.add(s,l))},n._findParentTile=function(e){var t=this.getMap(),n=this._getLayerOfTile(e.layer);if(!n||!n.options.background)return null;var i=n.getMinZoom(),r=e.z-i;if(n._isPyramidMode()){for(var a=e.z-1;a>=i;a--){var o=e.z-a,s=Math.pow(2,o),l=Math.floor(e.x/s),u=Math.floor(e.y/s),c=n._getTileId(l,u,a,e.layer),h=this.tileCache.getAndRemove(c);if(h&&this.isValidCachedTile(h))return this.tileCache.add(c,h),h}return null}for(var f=n.getSpatialReference(),d=f.getZoomDirection(),p=e.res,m=e.extent2d.getCenter(),v=n._project(t._pointToPrjAtRes(m,p)),g=1;g<=r;g++){var y=e.z-d*g,_=f.getResolution(y);if(_){var x=n._getTileConfig().getTileIndex(v,_),b=n._getTileId(x.x,x.y,y,e.layer),w=this.tileCache.getAndRemove(b);if(w)return this.tileCache.add(b,w),w}}return null},n.isValidCachedTile=function(e){return!!e.image},n.isTileComplete=function(){return!0},n._getLayerOfTile=function(e){return this.layer.getChildLayer?this.layer.getChildLayer(e):this.layer},n._getCachedTile=function(e,t){var n=this.tilesInView,i=this.tileCache.getAndRemove(e);if(i){t||(n[e]=i);var r=this.tilesLoading;if(r&&r[e]){r[e].current=!1;var a=r[e],o=a.image,s=a.info;this.abortTileLoading(o,s),delete r[e]}}else i=n[e];return i&&(i.current=!0,this.tileCache.add(e,i)),i},n._addTileToCache=function(e,t){this.tilesInView[e.id]={image:t,current:!0,info:e}},n.getTileOpacity=function(e,t){var n=this._getTileFadingOpacity(e);if(this.layer.getChildLayer){var i=this.layer.getLayer(t.layer);i&&(n*=i.options.opacity)}return n},n._getTileFadingOpacity=function(e){return this.layer.options.fadeAnimation&&e.loadTime?Math.min(1,(t_()-e.loadTime)/this.layer.options.fadeDuration):1},n.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,e.prototype.onRemove.call(this)},n._markTiles=function(){var e=0,t=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.tilesLoading[n].current=!1,e++;if(this.tilesInView)for(var i in this.tilesInView)this.tilesInView[i].current=!1,t++;return[e,t]},n._retireTiles=function(e){for(var t in this.tilesLoading){var n=this.tilesLoading[t];!e&&n.current||(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),this.removeTileLoading(n.info))}for(var i in this.tilesInView){var r=this.tilesInView[i];r.current||(delete this.tilesInView[i],this.tileCache.has(i)||this.deleteTile(r))}},n.deleteTile=function(e){e&&e.image&&(e.image.close&&e.image.close(),e.image.onload=null,e.image.onerror=null)},n._generatePlaceHolder=function(e){var t=this.getMap(),n=this.layer.options.placeholder;if(!n||t.getPitch())return null;var i=this.layer.getTileSize(),r=e/t._getResolution(),a=this._tilePlaceHolder=this._tilePlaceHolder||Zw.createCanvas(1,1,t.CanvasClass);return a.width=i.width*r,a.height=i.height*r,l_(n)?n(a):function(e){var t=e.getContext("2d"),n=e.width,i=e.height,r=n/16,a=i/16;t.beginPath();for(var o=0;o<16;o++)t.moveTo(0,o*a),t.lineTo(n,o*a),t.moveTo(o*r,0),t.lineTo(o*r,i);t.strokeStyle="rgba(180, 180, 180, 0.1)",t.lineWidth=1,t.stroke(),t.beginPath();for(var s=[[0,0],[n,0],[0,i],[n,i],[0,0],[0,i],[n,0],[n,i],[0,i/2],[n,i/2],[n/2,0],[n/2,i]],l=1;l<s.length;l+=2)t.moveTo(s[l-1][0],s[l-1][1]),t.lineTo(s[l][0],s[l][1]);t.lineWidth=4,t.stroke()}(a),a},t}(vM);function OP(){return!1}function DP(e,t){return Math.abs(this._tileZoom-e.info.z)-Math.abs(this._tileZoom-t.info.z)}Rk.registerRenderer("canvas",IP);var NP=new ax(0,0),zP={properties:{}},UP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.isDrawable=function(){return!0},n.needToRedraw=function(){var t=this.getMap();return!(!this._gl()||t.getPitch()||!t.isZooming()||t.isMoving()||t.isRotating())||e.prototype.needToRedraw.call(this)},n.onDrawTileStart=function(e,t){var n=this.gl;n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.enable(n.POLYGON_OFFSET_FILL),n.enable(n.STENCIL_TEST),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE);var i=i_(this.layer.options.depthMask)||!!this.layer.options.depthMask;if(n.depthMask(i),t&&t.renderTarget){var r=t.renderTarget.fbo;if(r){var a=t.renderTarget.getFramebuffer(r);n.bindFramebuffer(n.FRAMEBUFFER,a)}}},n.onDrawTileEnd=function(e,t){var n=this.gl;t&&t.renderTarget&&(t.renderTarget.fbo&&n.bindFramebuffer(n.FRAMEBUFFER,null))},n.drawTile=function(t,n,i){if(!i||!i.sceneFilter||i.sceneFilter(zP)){var r=this.getMap();if(t&&r&&n){var a=t._glScale=t._glScale||t.res/r.getGLRes(),o=t.extent2d.xmax-t.extent2d.xmin,s=t.extent2d.ymax-t.extent2d.ymin;if(!1!==t.cache&&this._bindGLBuffer(n,o,s),this._gl()){var l=t.extent2d,u=t.offset,c=NP.set(l.xmin-u[0],t.extent2d.ymax-u[1]),h=c.x*a,f=c.y*a,d=this.getTileOpacity(n,t),p=null;this.layer.options.debug&&(p=this.getDebugInfo(t.id));var m=this.gl;m.stencilFunc(m.LEQUAL,Math.abs(this.getCurrentTileZoom()-t.z),255);var v=this.layer.getPolygonOffset(),g=this.drawingCurrentTiles?v:v+1;m.polygonOffset(g,g),this.drawGLImage(n,h,f,o,s,a,d,p),this._getTileFadingOpacity(n)<1?this.setToRedraw():this.setCanvasUpdated()}else e.prototype.drawTile.call(this,t,n)}}},n._bindGLBuffer=function(e,t,n){e.glBuffer||(e.glBuffer=this.bufferTileData(0,0,t,n))},n.loadTileImage=function(e,t){var n=this.layer.options.crossOrigin;e.crossOrigin=null!==n?n:"",e.src=t},n.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},n.createContext=function(){e.prototype.createContext.call(this),this.createGLContext()},n.resizeCanvas=function(t){this.canvas&&(e.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return e.prototype.getCanvasImage.call(this);var t=e.prototype.getCanvasImage.call(this);return t&&(t.image=this.canvas2),t},n._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var e=this.getMap();return e&&(e.getPitch()||e.getBearing())||this.layer&&!!this.layer.options.fragmentShader},n.deleteTile=function(t){e.prototype.deleteTile.call(this,t),t&&t.image&&this.disposeImage(t.image),delete t.image},n.onRemove=function(){e.prototype.onRemove.call(this),this.removeGLCanvas()},t}($k(IP));function FP(e){var t=this.layer.getTileSize(),n=this.canvas.constructor,i=this.getMap(),r=i.getDevicePixelRatio(),a=Zw.createCanvas(t.width*r,t.height*r,n);a.layer=this.layer;var o=this,s=new ax(e.extent2d.xmin,e.extent2d.ymax),l=new TS(i.pointToCoordinate(s),i.pointToCoordinate(s.add(t.width,t.height)),i.getProjection());return this.layer.drawTile(a,{url:e.url,point:s,center:i.pointToCoordinate(s.add(t.width/2,t.height/2)),extent:l,z:e.z,x:e.x,y:e.y},(function(t){t?o.onTileError(a,e):o.onTileLoad(a,e)})),a}Rk.registerRenderer("gl",UP);var BP=function(e){function t(){return e.apply(this,arguments)||this}return K_(t,e),t.prototype.loadTile=function(){return FP.apply(this,arguments)},t}(IP),HP=function(e){function t(){return e.apply(this,arguments)||this}return K_(t,e),t.prototype.loadTile=function(){return FP.apply(this,arguments)},t}(UP);Hk.registerRenderer("canvas",BP),Hk.registerRenderer("gl",HP);var jP="undefined"!==typeof Int8Array?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[];!function(){function e(e,t,n){this.gl=e,this.quadVertices=t||jP,this.attributes=["a_position",3,GP(t)],this.debug=n}var t=e.prototype;t.start=function(){var e=this.gl;e.enable(e.STENCIL_TEST),e.stencilMask(255),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE),e.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),Vk(e,this.program,this.attributes),this.transformLoc||(this.transformLoc=e.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=e.getUniformLocation(this.program,"color")),this.debug||e.colorMask(!1,!1,!1,!1)},t.end=function(){var e=this.gl;e.depthMask(!0),this._restore(),this.debug||e.colorMask(!0,!0,!0,!0)},t.draw=function(e){var t=this.gl;t.uniformMatrix4fv(this.transformLoc,!1,e),t.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),t.drawArrays(t.TRIANGLE_STRIP,0,4)},t.remove=function(){var e=this.gl;return this.buffer&&e.deleteBuffer(this.buffer),this.program&&(e.deleteShader(this.program.fragmentShader),e.deleteShader(this.program.vertexShader),e.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},t.stencilMask=function(e){return this.gl.stencilMask(e),this},t.stencilFunc=function(e,t,n){return this.ref=t,this.gl.stencilFunc(e,t,n),this},t.stencilOp=function(e,t,n){return this.gl.stencilOp(e,t,n),this},t.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},t._save=function(){var e=this.gl;this._savedProgram=e.program},t._restore=function(){var e=this.gl;e.program=this._savedProgram,e.program&&e.useProgram(e.program)},t._createBuffer=function(){var e=this.gl;if(this.buffer=e.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.quadVertices,e.STATIC_DRAW)},t._createProgram=function(){var e=Gk(this.gl,"\n    attribute vec3 a_position;\n    uniform mat4 transform;\n\n    void main()\n    {\n        gl_Position = transform * vec4(a_position, 1.0);\n    }\n","\n    precision mediump float;\n    uniform vec3 color;\n    void main()\n    {\n        gl_FragColor = vec4(color, 1.0);\n    }\n"),t=e.program,n=e.vertexShader,i=e.fragmentShader;t.vertexShader=n,t.fragmentShader=i,this.program=t}}();function GP(e){return e instanceof Float32Array?"FLOAT":e instanceof Int16Array?"SHORT":e instanceof Uint16Array?"UNSIGNED_SHORT":e instanceof Int8Array?"BYTE":e instanceof Uint8Array||e instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}var VP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n.checkResources=function(){var e=this._geosToCheck||[];if(!this._resourceChecked&&this.layer._geoList&&hx(e,this.layer._geoList),!_x(e))return[];for(var t=[],n={},i=e.length-1;i>=0;i--){var r=e[i]._getExternalResources();if(r.length)if(this.resources)for(var a=0;a<r.length;a++){var o=r[a][0];this.resources.isResourceLoaded(r[a])||n[o]||(t.push(r[a]),n[o]=1)}else t.push.apply(t,r)}return this._resourceChecked=!0,delete this._geosToCheck,t},n.render=function(){return this.layer._sortGeometries(),e.prototype.render.apply(this,arguments)},n._addGeoToCheckRes=function(e){e&&(Array.isArray(e)||(e=[e]),this._geosToCheck||(this._geosToCheck=[]),hx(this._geosToCheck,e))},n.onGeometryAdd=function(e){this._addGeoToCheckRes(e),WP(this)},n.onGeometryRemove=function(){WP(this)},n.onGeometrySymbolChange=function(e){this._addGeoToCheckRes(e.target),WP(this)},n.onGeometryShapeChange=function(){WP(this)},n.onGeometryPositionChange=function(){WP(this)},n.onGeometryZIndexChange=function(){WP(this)},n.onGeometryShow=function(){WP(this)},n.onGeometryHide=function(){WP(this)},n.onGeometryPropertiesChange=function(){WP(this)},t}(vM);function WP(e){e.layer.options.drawImmediate&&e.render(),e.setToRedraw()}var XP=new ES,ZP=[],qP=new ES,YP=new aS,JP=function(e){function t(){return e.apply(this,arguments)||this}K_(t,e);var n=t.prototype;return n._geoIsCollision=function(e,t){if(!e)return!1;if(!e.options.collision)return!1;if("Point"===e.getType()&&e.getContainerExtent){e.bbox||(e.bbox=[0,0,0,0]);var n=this.layer.options.collisionBufferSize,i=e.getContainerExtent();if(!i)return!1;if(e.bbox[0]=i.xmin-n,e.bbox[1]=i.ymin-n,e.bbox[2]=i.xmax+n,e.bbox[3]=i.ymax+n,t.collides(e.bbox))return!0;t.insertBox(e.bbox)}return!1},n.getImageData=function(){if(!this.layer.options.geometryEvents||!this._lastRenderTime||t_()-this._lastRenderTime<32)return null;if(!this.context||!this.context.canvas)return null;if(!this._imageData){var e=this.context.canvas,t=e.width,n=e.height;try{this._imageData=this.context.getImageData(0,0,t,n)}catch(i){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",i)}}return this._imageData},n.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=t_()},n.checkResources=function(){var t=this,n=e.prototype.checkResources.apply(this,arguments),i=this.layer.getStyle();return i&&(Array.isArray(i)||(i=[i]),i.forEach((function(e){for(var i=wb(e.symbol,!0),r=0,a=i.length;r<a;r++)t.resources.isResourceLoaded(i[r])||n.push(i[r])}))),n},n.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()||!this.layer.options.enableAltitude)||!(t.isZooming()&&!t.isRotating()&&!t.getPitch()&&!this._hasPoint&&this.layer.constructor===$E)&&e.prototype.needToRedraw.call(this)},n.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},n.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},n.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var e=this.getMap(),t=this.layer.getCount(),n=this.mapStateCache.resolution;(e.isZooming()&&e.options.seamlessZoom&&void 0!==this._drawnRes&&n>1.5*this._drawnRes&&this._geosToDraw.length<t||e.isMoving()||e.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._drawnRes=n),this._sortByDistanceToCamera(e.cameraPosition);var i=this.layer.options,r=i.collision,a=i.collisionDelay;if(r){var o=t_();this._lastCollisionTime||(this._lastCollisionTime=o),o-this._lastCollisionTime<=a?this._geosToDraw=this._lastGeosToDraw||this._geosToDraw:(this._collidesGeos(),this._lastCollisionTime=o)}for(var s=0,l=this._geosToDraw.length;s<l;s++){var u=this._geosToDraw[s];u._isCheck||u.isVisible()?(u._paint(this._displayExtent),this._geosToDraw[s]._cPoint=void 0,this._geosToDraw[s]._inCurrentView=void 0):(delete u._cPoint,delete u._inCurrentView)}this.clearImageData(),this._lastGeosToDraw=this._geosToDraw}},n.show=function(){this.layer.forEach((function(e){e._repaint()})),e.prototype.show.apply(this,arguments)},n.forEachGeo=function(e,t){this.layer.forEach(e,t)},n.drawGeos=function(){this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._sortByDistanceToCamera(this.getMap().cameraPosition),this._collidesGeos();for(var e=0,t=this._geosToDraw.length;e<t;e++)this._geosToDraw[e]._paint(),this._geosToDraw[e]._cPoint=void 0,this._geosToDraw[e]._inCurrentView=void 0;this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,this._setDrawGeosDrawTime()},n.prepareToDraw=function(){return this.layer._drawTime=t_(),this._hasPoint=!1,this._geosToDraw=[],this},n._setDrawGeosDrawTime=function(){for(var e=this.layer._drawTime,t=0,n=this._geosToDraw.length;t<n;t++){var i=this._geosToDraw[t]._painter;i&&i._setDrawTime&&i._setDrawTime(e)}return this},n.checkGeo=function(e){if("Point"!==e.type||void 0===this._onlyHasPoint){if(e._isCheck=!1,e&&e.isVisible()&&e.getMap()&&e.getLayer()&&e.getLayer().isCanvasRender()){var t=e._getPainter(),n=!0;if(e._inCurrentView)n=!0;else if(!1===e._inCurrentView)n=!1;else{var i=t.get2DExtent(this.resources,XP);i&&i.intersects(this._displayExtent)||(n=!1)}n&&(t.hasPoint()&&(this._hasPoint=!0),e._isCheck=!0,this._geosToDraw.push(e))}}else e._inCurrentView&&(this._hasPoint=!0,e._isCheck=!0,this._geosToDraw.push(e))},n._collidesGeos=function(){if(!this.layer.options.collision)return this;var e=this.layer.options.collisionScope,t=this.layer.getMap(),n="map"===e?t.getCollisionIndex():YP;n===YP&&n.clear();var i=this._geosToDraw;this._geosToDraw=[];for(var r=0,a=i.length;r<a;r++)this._geoIsCollision(i[r],n)||this._geosToDraw.push(i[r]);return this},n.onZoomEnd=function(){delete this.canvasExtent2D,e.prototype.onZoomEnd.apply(this,arguments)},n.onRemove=function(){this.forEachGeo((function(e){e.onHide()})),delete this._geosToDraw},n.onGeometryPropertiesChange=function(t){t&&this.layer._styleGeometry(t.target),e.prototype.onGeometryPropertiesChange.call(this,t)},n._updateDisplayExtent=function(){var e=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(e))return void this.completeRender();e=e.intersection(this._maskExtent)}this._displayExtent=e},n.identifyAtPoint=function(e,t){void 0===t&&(t={});var n=this._geosToDraw;return n?this.layer._hitGeos(n,e,t):[]},n._updateMapStateCache=function(){var e=this.getMap(),t=e._pointToContainerPoint(this.southWest)._add(0,-e.height),n=e.getResolution(),i=e.getPitch(),r=e.getBearing(),a=e.getGLScale(),o=e.getGLRes(),s=e.getContainerExtent(),l=e._get2DExtent(),u=e._get2DExtentAtRes(o);return this.mapStateCache={resolution:n,pitch:i,bearing:r,glScale:a,glRes:o,_2DExtent:l,glExtent:u,containerExtent:s,offset:t},this},n._batchConversionMarkers=function(e){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var t=[],n=[],i=[],r={},a=this.layer,o=a.options,s=a.getAltitude?a.getAltitude():0,l=a.isCanvasRender();this._onlyHasPoint=!0;for(var u=0,c=0,h=this.layer._geoList.length;c<h;c++){var f=this.layer._geoList[c];if("Point"===f.getType()){var d=f._painter;d||(d=f._getPainter());var p=d.getRenderPoints("center")[0][0],m=o.enableAltitude?f._getAltitude():s;void 0===r[m]&&(r[m]=d.getAltitude()),t[u]=p,i[u]=r[m],n[u]=f,u++}else this._onlyHasPoint=!1}if(0===u)return[];var v=this.getMap(),g=Lx(t,"_pt");g=v._pointsAtResToContainerPoints(t,e,i,g);for(var y=v.getContainerExtent(),_=y.xmax,x=y.ymax,b=y.xmin,w=y.ymin,S={},M=0,T=n.length;M<T;M++){var E=n[M];if(E._cPoint=g[M],E._cPoint){var C=g[M],k=C.x,P=C.y;if(E._inCurrentView=k>=b&&P>=w&&k<=_&&P<=x,!E._inCurrentView){var A=E.getSymbolHash(),R=void 0;R=A?S[A]=S[A]||E._painter.getFixedExtent():E._painter.getFixedExtent(),qP.set(R.xmin,R.ymin,R.xmax,R.ymax),qP._add(g[M]),E._inCurrentView=qP.intersects(y)}E._inCurrentView&&(E.isVisible()&&l||(E._inCurrentView=!1),this._onlyHasPoint&&E._inCurrentView&&(this._hasPoint=!0,E._isCheck=!0,this._geosToDraw.push(E)))}else E._inCurrentView=!1}return g},n._sortByDistanceToCamera=function(e){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var t=this.getMap(),n=t.distanceToPoint(1e3,0,t.getGLScale()).x/1e3,i="center";this._geosToDraw.sort((function(t,r){var a=t.getType(),o=r.getType();if("Point"!==a||"Point"!==o)return 0;var s=t._painter,l=r._painter;if(!s||!l)return 0;var u=s.getRenderPoints(i)[0][0],c=l.getRenderPoints(i)[0][0],h=s.getAltitude()*n,f=l.getAltitude()*n;vC(ZP,u.x,u.y,h);var d=bC(ZP,e);return vC(ZP,c.x,c.y,f),bC(ZP,e)-d}))}},n._constructorIsThis=function(){return this.constructor===t},t}(VP);$E.registerRenderer("canvas",JP);var QP=function(e){function t(t){var n;return(n=e.call(this)||this).map=t,n._handlerQueue=[],n._thisDocVisibilitychange=n._onDocVisibilitychange.bind(ex(ex(n))),n._thisDocDragStart=n._onDocDragStart.bind(ex(ex(n))),n._thisDocDragEnd=n._onDocDragEnd.bind(ex(ex(n))),n}K_(t,e);var n=t.prototype;return n.callInNextFrame=function(e){this._handlerQueue.push(e)},n.executeFrameCallbacks=function(){var e=this._handlerQueue;this._handlerQueue=[];for(var t=0,n=e.length;t<n;t++)e[t]()},n.offsetPlatform=function(e,t){if(!this.map._panels.front)return this;if(!t&&0===e.x&&0===e.y)return this;var n=this.map._panels,i=this._frontCount=n.back.layerDOM.childElementCount,r=this._backCount=n.front.layerDOM.childElementCount,a=this._uiCount=n.front.uiDOM.childElementCount;if(i||r||a){var o=this.map.offsetPlatform();o=e?o.add(e)._round():o.round(),r&&fw(n.back,o),(i||a)&&fw(n.front,o)}return this},n.domChanged=function(){var e=this.map._panels;if(!e.front)return!1;var t=e.back.layerDOM.childElementCount;if(void 0===this._frontCount||this._frontCount!==t)return!0;var n=e.front.layerDOM.childElementCount;if(void 0===this._backCount||this._backCount!==n)return!0;var i=e.front.uiDOM.childElementCount;return void 0===this._uiCount||this._uiCount!==i},n.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var e=new ax(0,0);fw(this.map._panels.back,e),fw(this.map._panels.front,e)}},n.onZoomEnd=function(){this.resetContainer()},n.onLoad=function(){this._frameLoop()},n._onDocVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},n._getWrapPanel=function(){if(!this.map)return null;var e=this.map.getPanels();return e&&e.mapWrapper},n._onDocDragStart=function(){var e=this._getWrapPanel();e&&(e.style.overflow="visible")},n._onDocDragEnd=function(){var e=this._getWrapPanel();e&&(e.style.overflow="hidden")},n._containerIsOffscreen=function(){var e=this.map.getContainer();return!e||!e.style||"none"===e.style.display||Math.min(e.clientWidth,e.clientHeight)<=0},t}(tS),KP=function(e){function t(t){var n;return(n=e.call(this,t)||this)._containerIsCanvas=!!t._containerDOM.getContext,n._registerEvents(),n._loopTime=0,n._resizeEventList=[],n._resizeTime=-1/0,n}K_(t,e);var n=t.prototype;return n.load=function(){this.initContainer()},n.renderFrame=function(e){var t=this.map;if(!t||!t.options.renderable)return!1;if(this._handleResizeEventList(e),t.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(e),delete this._isViewChanged,t._fireEvent("framestart"),this.updateMapDOM(),t.clearCollisionIndex();var n=this._getAllLayerToRender();return this.drawLayers(n,e),this.drawLayerCanvas(n)&&(this.drawTops(),this._drawCenterCross(),t.options.debugSky&&this._debugSky()),this._needClear=!1,t._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,t.uiCollides(),!0},n.updateMapDOM=function(){var e=this.map;if(!e.isZooming()){var t=e._getViewPointFrameOffset();t?e.offsetPlatform(t):this.domChanged()&&this.offsetPlatform(null,!0)}},n.drawLayers=function(e,t){for(var n=this.map,i=n.isInteracting(),r=[],a=[],o=n.options.fpsOnInteracting||0,s=0===o?0:1e3/o,l=this.map.options.layerCanvasLimitOnInteracting,u=e.length,c=n.getBaseLayer(),h=0,f=0;f<u;f++){var d=e[f];if(d.isVisible()){var p=d.isCanvasRender();p&&r.push(d.getId());var m=d._getRenderer();if(m){var v=this._checkLayerRedraw(d);p&&m.isCanvasUpdated()&&(v||a.push(d.getId()),this.setLayerCanvasUpdated());var g=m.__zoomTransformMatrix;if(delete m.__zoomTransformMatrix,v){if(i&&p){if(l>0&&u-1-f>l&&d!==c){d._getRenderer().clearCanvas();continue}h+=this._drawCanvasLayerOnInteracting(d,h,s,t)}else i&&m.drawOnInteracting?(m.prepareRender&&m.prepareRender(),m.checkAndDraw?m.checkAndDraw(m.drawOnInteracting,this._eventParam,t):m.drawOnInteracting(this._eventParam,t)):(m.render(t),p&&g&&m.isLoadingResource()&&(m.__zoomTransformMatrix=g));p&&(a.push(d.getId()),this.setLayerCanvasUpdated())}else p&&i&&(n.isZooming()&&!n.getPitch()?(m.prepareRender(),m.__zoomTransformMatrix=this._zoomMatrix):(n.getPitch()||n.isRotating())&&m.clearCanvas())}}}var y=this._canvasIds||[],_=this._updatedIds||[];if(this._canvasIds=r,this._updatedIds=a,!this.isLayerCanvasUpdated()){var x="---";y.join(x)===r.join(x)&&_.join(x)===a.join(x)||this.setLayerCanvasUpdated()}},n._checkLayerRedraw=function(e){if(this.isSpatialReferenceChanged())return!0;var t=this.map,n=e._getRenderer();return e.isCanvasRender()?n.testIfNeedRedraw():!(!n.needToRedraw||!n.needToRedraw())||(t.isInteracting()||this.isViewChanged())},n._drawCanvasLayerOnInteracting=function(e,t,n,i){var r=this.map,a=e._getRenderer(),o=a.getDrawTime(),s=0===n||n>0&&t+o<=n;if(a.mustRenderOnInteracting&&a.mustRenderOnInteracting())a.render(i);else{if(a.drawOnInteracting&&(e===r.getBaseLayer()||s||r.isZooming()&&e.options.forceRenderOnZooming||r.isMoving()&&e.options.forceRenderOnMoving||r.isRotating()&&e.options.forceRenderOnRotating))return a.prepareRender(),a.prepareCanvas(),a.checkAndDraw?a.checkAndDraw(a.drawOnInteracting,this._eventParam,i):a.drawOnInteracting(this._eventParam,i),o;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&a.clearCanvas():(a.prepareRender(),a.__zoomTransformMatrix=this._zoomMatrix)}return a.drawOnInteracting&&!s&&a.onSkipDrawOnInteracting(this._eventParam,i),0},n._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var e=this.map;this._updatedIds.reverse().forEach((function(t){var n=e.getLayer(t);if(n){var i=n._getRenderer();i&&i.isRenderComplete()&&n.fire("layerload")}}))}},n.isLayerCanvasUpdated=function(){return this._canvasUpdated},n.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},n.drawLayerCanvas=function(e){var t=this.map;if(!t)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&!1===this._needClear)return!1;this.canvas||this.createCanvas(),t._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n,i=t.isInteracting(),r=t.options.layerCanvasLimitOnInteracting,a=e.length,o=[],s=0;s<a;s++){if(e[s].isVisible()&&e[s].isCanvasRender())if(e[s]._getRenderer()){var l=this._getLayerImage(e[s]);l&&l.image&&(e[s]===t.getBaseLayer()?n=[e[s],l]:o.push([e[s],l]))}}var u=this.canvas.width,c=this.canvas.height;n&&(this._drawLayerCanvasImage(n[0],n[1],u,c),this._drawFog()),a=o.length;for(var h=i&&r>=0&&a>r?a-r:0;h<a;h++)this._drawLayerCanvasImage(o[h][0],o[h][1],u,c);return t._fireEvent("renderend",{context:this.context}),!0},n.setToRedraw=function(){var e=this._getAllLayerToRender();this._needClear=!0;for(var t=0,n=e.length;t<n;t++){var i=e[t].getRenderer();i&&i.canvas&&i.setToRedraw&&i.setToRedraw()}},n.updateMapSize=function(e){if(e&&!this._containerIsCanvas){var t=e.width+"px",n=e.height+"px",i=this.map._panels;i.mapWrapper.style.width=t,i.mapWrapper.style.height=n,this._updateCanvasSize()}},n.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},n.toDataURL=function(e,t){return this.canvas?this.canvas.toDataURL(e,t):null},n.remove=function(){Y_.webgl&&"undefined"!==typeof document&&(sw(document,"visibilitychange",this._thisDocVisibilitychange),sw(document,"dragstart",this._thisDocDragStart),sw(document,"dragend",this._thisDocDragEnd)),this._resizeInterval&&clearInterval(this._resizeInterval),this._resizeObserver&&this._resizeObserver.disconnect(),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},n.hitDetect=function(e){var t=this.map;if(t&&t.options.hitDetect&&!t.isInteracting()){var n=t._getLayers(),i="default",r=t.options.hitDetectLimit||0,a=0;e&&e._round&&e._round();for(var o=n.length-1;o>=0;o--){var s=n[o];if(!(!s.options.hitDetect||s.isEmpty&&s.isEmpty())){var l=s._getRenderer();if(l&&l.hitDetect&&(!l.isBlank||!l.isBlank())){if("default"!==s.options.cursor&&l.hitDetect(e)){i=s.options.cursor||"pointer";break}if(a++,r>0&&a>r)break}}}t._trySetCursor(i)}},n._getLayerImage=function(e){var t=e._getRenderer();return t.getCanvasImage?t.getCanvasImage():null},n.initContainer=function(){var e=this.map._panels;function t(t,n,i,r){var a=iw("div",n);return i&&(a.style.cssText=i),e[t]=a,r||hw(a),a}var n=this.map._containerDOM;if(!this._containerIsCanvas){n.innerHTML="";var i="position:absolute;top:0px;left:0px;",r=t("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),a=t("allLayers","maptalks-all-layers",i+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),o=t("backStatic","maptalks-back-static",i+"z-index:0;",!0),s=t("back","maptalks-back",i+"z-index:1;"),l=t("backLayer","maptalks-back-layer",i),u=t("canvasContainer","maptalks-canvas-layer",i+"border:none;z-index:2;"),c=t("frontStatic","maptalks-front-static",i+"z-index:3;",!0),h=t("front","maptalks-front",i+"z-index:4;",!0),f=t("frontLayer","maptalks-front-layer",i+"z-index:0;"),d=t("ui","maptalks-ui",i+"border:none;z-index:1;",!0),p=t("control","maptalks-control","z-index:1",!0);n.appendChild(r),a.appendChild(o),s.appendChild(l),s.layerDOM=l,a.appendChild(s),a.appendChild(u),h.appendChild(f),h.layerDOM=f,h.uiDOM=d,a.appendChild(c),a.appendChild(h),h.appendChild(d),r.appendChild(a),r.appendChild(p),this.createCanvas(),this.resetContainer();var m=this.map._getContainerDomSize();this.updateMapSize(m)}},n.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var e=this._mapview,t=this._getMapView();return this._isViewChanged=!e||!Px(e,t),this._isViewChanged},n._recordView=function(){var e=this.map;!e._onViewChange||e.isInteracting()||e.isAnimating()||Px(e.getView(),e._getCurrentView())||e._onViewChange(e.getView())},n.isSpatialReferenceChanged=function(){return this._spatialRefChanged},n._getMapView=function(){var e=this.map,t=e._getPrjCenter();return{x:t.x,y:t.y,zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing(),width:e.width,height:e.height}},n._frameLoop=function(e){var t=this;this.map?(e=e||0,this._frameTimestamp=e,this._resizeCount=0,this.renderFrame(e),this._animationFrame=nx((function(e){t._frameLoop(e)}))):this._cancelFrameLoop()},n._cancelFrameLoop=function(){this._animationFrame&&ix(this._animationFrame)},n._drawLayerCanvasImage=function(e,t,n,i){var r=this.context,a=t.point.round(),o=this.map.getDevicePixelRatio();1!==o&&a._multi(o);var s=t.image,l=s.width,u=s.height;if(!(a.x+l<=0||a.y+u<=0)){var c=e.options.opacity;if(r_(c)||(c=1),!(c<=0)){var h=t.opacity;if(r_(h)||(h=1),!(h<=0)){var f=r.globalAlpha;c<1&&(r.globalAlpha*=c),h<1&&(r.globalAlpha*=h),e.options.cssFilter&&(r.filter=e.options.cssFilter);var d=e.getRenderer(),p=d.__zoomTransformMatrix,m=d.clipCanvas(this.context);p&&(r.save(),r.setTransform.apply(r,p)),r.drawImage(s,0,0,l,u,a.x,a.y,n,i),p&&r.restore(),m&&r.restore(),"none"!==r.filter&&(r.filter="none"),r.globalAlpha=f}}}},n._drawCenterCross=function(){var e=this.map.options.centerCross;if(e){var t=this.context,n=new ax(this.canvas.width/2,this.canvas.height/2);l_(e)?e(t,n):Zw.drawCross(this.context,n.x,n.y,2,"#f00")}},n._drawContainerExtent=function(){var e=this.map.options.cascadePitches,t=this.map.height-this.map._getVisualHeight(e[0]),n=this.map.height-this.map._getVisualHeight(e[1]),i=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,i.ymin),r.lineTo(i.xmax,i.ymin),r.stroke(),r.beginPath(),r.moveTo(0,t),r.lineTo(i.xmax,t),r.stroke(),r.beginPath(),r.moveTo(0,n),r.lineTo(i.xmax,n),r.stroke()},n._drawFog=function(){var e=this.map;if(!(e.getPitch()<=e.options.maxVisualPitch)&&e.options.fog){var t=e.getDevicePixelRatio(),n=this.context,i=e.getContainerExtent(),r=(e.height-e._getVisualHeight(75))*t;r<0&&(r=0);var a=i.ymin*t,o=Math.ceil(a-r),s=e.options.fogColor.join(),l=n.createLinearGradient(0,r,0,a+30),u=1-30/(o+30);l.addColorStop(0,"rgba("+s+", 0)"),l.addColorStop(.3,"rgba("+s+", 0.3)"),l.addColorStop(u,"rgba("+s+", 1)"),l.addColorStop(1,"rgba("+s+", 0)"),n.beginPath(),n.fillStyle=l,n.fillRect(0,r,Math.ceil(i.getWidth())*t,Math.ceil(o+30))}},n._debugSky=function(){var e=this.map;if(!e)return this;var t=e.getContainerExtent().ymin;if(t<=0)return this;var n=this.context;return n.strokeStyle="red",n.strokeRect(0,0,e.width,t),this},n._getAllLayerToRender=function(){return this.map._getLayers()},n.clearCanvas=function(){this.canvas&&Zw.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var e=this.map,t=e.getSize(),n=this.canvas,i=zx(t,e.getDevicePixelRatio()),r=i.width,a=i.height,o=i.cssWidth,s=i.cssHeight;return!n.style||n.style.width===o&&n.style.height===s||(n.style.width=o,n.style.height=s),(r!==n.width||a!==n.height)&&(n.height=a,n.width=r,this.topLayer.width=n.width,this.topLayer.height=n.height,!0)},n.createCanvas=function(){this.topLayer=iw("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=iw("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},n._updateDomPosition=function(e){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(e-this._checkPositionTime)>=500&&(dw(this.map._containerDOM),this._checkPositionTime=Math.min(e,this._checkPositionTime)),this},n._handleResizeEventList=function(e){if(!this._resizeEventList)return this;var t=this._resizeEventList.length;if(0===t)return this;if(this._resizeTime&&e-this._resizeTime<60)return this;var n=this._resizeEventList[t-1].contentRect;return this.map._containerDomContentRect=n,this._resizeEventList=[],this._checkSize(n),this._resizeCount=this._resizeCount||0,this.renderFrame((this._frameTimestamp||0)+ ++this._resizeCount/100),this._resizeTime=e,this},n._checkSize=function(){this.map&&this.map.checkSize()},n._setCheckSizeInterval=function(e){var t=this;Y_.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver((function(e){!t.map||t.map.isRemoved()?t._resizeObserver.disconnect():e.length&&(t._resizeEventList=t._resizeEventList||[],t._resizeEventList.push(e[0]))})),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=e,this._resizeInterval=setInterval((function(){!t.map||t.map.isRemoved()?clearInterval(t._resizeInterval):t._checkSize()}),this._checkSizeInterval))},n._registerEvents=function(){var e=this,t=this.map;t.options.checkSize&&!p_&&"undefined"!==typeof window&&this._setCheckSizeInterval(t.options.checkSizeInterval),Y_.mobile||t.on("_mousemove",this._onMapMouseMove,this),t.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(t){e._eventParam=t})),t.on("_zooming",(function(n){t.getPitch()||(e._zoomMatrix=n.matrix.container),e._eventParam=n})),t.on("_zoomend",(function(t){e._eventParam=t,delete e._zoomMatrix})),t.on("_spatialreferencechange",(function(){e._spatialRefChanged=!0})),Y_.webgl&&"undefined"!==typeof document&&(ow(document,"visibilitychange",this._thisDocVisibilitychange,this),ow(document,"dragstart",this._thisDocDragStart,this),ow(document,"dragend",this._thisDocDragEnd,this)),Y_.addDPRListening&&Y_.addDPRListening(this.map)},n._onMapMouseMove=function(e){var t=this,n=this.map;!n.isInteracting()&&n.options.hitDetect&&(this._hitDetectFrame&&ix(this._hitDetectFrame),this._hitDetectFrame=nx((function(){t.hitDetect(e.containerPoint)})))},n._getCanvasLayers=function(){return this.map._getLayers((function(e){return e.isCanvasRender()}))},n.addTopElement=function(e){this._tops||(this._tops=[]),this._tops.push(e)},n.removeTopElement=function(e){if(this._tops){var t=this._tops.indexOf(e);t>=0&&this._tops.splice(t,1)}},n.getTopElements=function(){return this._tops||[]},n.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var e=this.getTopElements(),t=!1,n=0;n<e.length;n++)e[n].render(this.topCtx)&&(t=!0);t&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},t}(QP);QT.registerRenderer("canvas",KP),QT.mergeOptions({fog:!1,fogColor:[233,233,233]});var $P={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};_E.include($P),IE.include($P),LE.include($P),DE.include($P),OE.include({_getRenderPoints:function(e){var t=this.getMap(),n=t.getGLRes();if("vertex"===e){for(var i=this._trimRing(this.getShell()),r=[],a=0,o=i.length;a<o;a++)r.push(t.coordToPointAtRes(i[a],n));return[r,null]}return[[t.coordToPointAtRes(this.getCenter(),n)],null]}});var eA={_getRenderPoints:function(e){var t,n=this.getMap(),i=n.getGLRes(),r=null;if("point"===e)(t=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&t.length>0&&Array.isArray(t[0])&&(t=t[0].concat(t[1]));else if("vertex"===e)if(r=[],(t=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&t.length>0&&Array.isArray(t[0])){for(var a=0,o=t.length;a<o;a++)for(var s=0,l=t[a].length;s<l;s++)0===s?r.push([t[a][s],t[a][s+1]]):r.push([t[a][s-1],t[a][s]]);t=t[0].concat(t[1])}else for(var u=0,c=t.length;u<c;u++)0===u?r.push([t[u],t[u+1]]):r.push([t[u-1],t[u]]);else if("line"===e){t=[],r=[];var h=this._getPath2DPoints(this._getPrjCoordinates(),!1,i);if(h.length>0&&Array.isArray(h[0]))for(var f,d=1,p=h.length;d<p;d++){f=h[d],this instanceof vE&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(f[0]);for(var m=1,v=f.length;m<v;m++)t.push(f[m].add(f[m-1])._multi(.5)),r.push([f[m-1],f[m]])}else{this instanceof vE&&h.length>0&&!h[0].equals(h[h.length-1])&&h.push(h[0]);for(var g=1,y=h.length;g<y;g++)t.push(h[g].add(h[g-1])._multi(.5)),r.push([h[g-1],h[g]])}}else if("vertex-first"===e){var _=this._getPrjCoordinates(),x=_.length,b=x?n._prjToPointAtRes(_[0],i):null;t=x?[b]:[],r=x?[[b,_[1]?n._prjToPointAtRes(_[1],i):b]]:[]}else if("vertex-last"===e){var w=this._getPrjCoordinates(),S=w.length,M=S?n._prjToPointAtRes(w[S-1],i):null;t=S?[M]:[];var T=S>1?S-2:S-1;r=S?[[w[T]?n._prjToPointAtRes(w[T],i):M,M]]:[]}else{var E=this.getCenter();if(E){var C=this._getProjection().project(E);t=[n._prjToPointAtRes(C,i)]}else t=[]}return[t,r]}};bE.include(eA),vE.include(eA);var tA={within:!1,center:[0,0]};function nA(e){if(e&&e._containerBbox){tA.within=!1;var t=e._containerBbox,n=t.minx,i=t.miny,r=t.maxx,a=t.maxy,o=Math.abs(r-n),s=Math.abs(a-i);o<=1&&s<=1&&(tA.within=!0,tA.center[0]=(n+r)/2,tA.center[1]=(i+a)/2),delete e._containerBbox}else tA.within=!1;return tA}UT.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1},_getRenderBBOX:function(e,t){return e.isHitTesting?null:(Fw(Uw),Bw(t,Uw),Uw)}});var iA={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof IE||this instanceof DE},_paintAsPath:function(){var e=this.getMap();return this._getAltitude()>0||e.getPitch()||this instanceof IE&&e.getBearing()},_getPaintParams:function(){var e=this.getMap();if(this._paintAsPath())return vE.prototype._getPaintParams.call(this,!0);var t=this._getPrjCoordinates(),n=e._prjToPointAtRes(t,e.getGLRes()),i=this._getRenderSize(n);return[n].concat(i)},_paintOn:function(){return this._paintAsPath()?Zw.polygon.apply(Zw,arguments):Zw.ellipse.apply(Zw,arguments)},_getRenderSize:function(e){var t=this.getMap(),n=t.getGLRes(),i=this._getPrjExtent(),r=t._prjToPointAtRes(i.getMin(),n),a=t._prjToPointAtRes(i.getMax(),n);return[Math.abs(a.x-r.x)/2,Math.abs(a.y-e.y),Math.abs(e.y-r.y)]}};IE.include(iA),LE.include(iA),OE.include({_getPaintParams:function(){var e=this.getMap(),t=this._getPrjShell();return[this._getPath2DPoints(t,!1,e.getGLRes())]},_paintOn:Zw.polygon}),DE.include(iA,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return vE.prototype._getPaintParams.call(this,!0);var e=this.getMap(),t=e._prjToPointAtRes(this._getPrjCoordinates(),e.getGLRes());return[t,this._getRenderSize(t)[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return Zw.polygon.apply(Zw,arguments);var e=this.getMap().getBearing(),t=arguments;return e&&(t[3]=t[3].slice(0),t[3][0]+=e,t[3][1]+=e),Zw.sector.apply(Zw,t)}}),pE.include({_paintAsPath:function(){return!0}}),bE.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(e,t,n,i,r){if(!e||!t||e.equals(t))return null;r||(r=0);var a,o=n*i[0],s=n*i[1]+r,l=o/2+r;(a=t.nextCtrlPoint||t.prevCtrlPoint?t.prevCtrlPoint?t.sub(new ax(t.prevCtrlPoint)):t.sub(new ax(t.nextCtrlPoint)):t.sub(e))._unit();var u=t.sub(a.multi(s));a._perp();var c=u.add(a.multi(l));return a._multi(-1),[c,t,u.add(a.multi(l)),c]},_getPaintParams:function(){var e=this._getPrjCoordinates();return[this._getPath2DPoints(e,!1,this.getMap().getGLRes())]},_paintOn:function(e,t,n,i,r){var a=nA(this._painter);return a.within?Zw.pixelRect(e,a.center,n,i):this.options.smoothness?Zw.paintSmoothLine(e,t,n,this.options.smoothness,!1,this._animIdx,this._animTailRatio):Zw.path(e,t,n,null,r),this._paintArrow(e,t,n),this._getRenderBBOX(e,t)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var e=this.options.arrowStyle;return e?Array.isArray(e)?e:this.arrowStyles[e]:null},_getArrows:function(e,t,n){var i=this._getArrowStyle();if(!i||e.length<2)return[];for(var r=e.length>0&&Array.isArray(e[0])?e:[e],a=this._getArrowPlacement(),o=[],s=this.getMap(),l=s.coordToContainerPoint(this.getFirstCoordinate()),u=s.coordToContainerPoint(this.getLastCoordinate()),c=r.length-1;c>=0;c--){if("vertex-first"===a||"vertex-firstlast"===a&&r[c][0].closeTo(l,.01)){var h=this._getArrowShape(r[c][1],r[c][0],t,i,n);h&&o.push(h)}if("vertex-last"===a||"vertex-firstlast"===a&&r[c][r[c].length-1].closeTo(u,.01)){var f=this._getArrowShape(r[c][r[c].length-2],r[c][r[c].length-1],t,i,n);f&&o.push(f)}else"point"===a&&this._getArrowPoints(o,r[c],t,i,n)}return o},_getArrowPoints:function(e,t,n,i,r){for(var a=0,o=t.length-1;a<o;a++){var s=this._getArrowShape(t[a],t[a+1],n,i,r);s&&e.push(s)}},_paintArrow:function(e,t,n){var i=this._getInternalSymbol().lineWidth;(!r_(i)||i<3)&&(i=3);var r=this._getArrows(t,i);if(r.length){e.setLineDash&&e.setLineDash([]);for(var a=r.length-1;a>=0;a--)e.fillStyle=e.strokeStyle,Zw.polygon(e,r[a],n,n)}}}),vE.include({_getPaintParams:function(e){var t=this.getMap().getGLRes(),n=this._getPrjShell(),i=this._getPath2DPoints(n,e,t),r=i.length>0&&Array.isArray(i[0]);r&&(i=[[i[0]],[i[1]]]);var a=this._getPrjHoles(),o=[];if(a&&a.length>0){for(var s=this._simplified,l=0;l<a.length;l++){var u=this._getPath2DPoints(a[l],e,t);Array.isArray(u)&&r?Array.isArray(u[0])?(i[0].push(u[0]),i[1].push(u[1])):i[0].push(u):o.push(u)}s&&(this._simplified=s)}return r||hx(i=[i],o),[i]},_paintOn:function(e,t,n,i,r){var a=nA(this._painter);return a.within?Zw.pixelRect(e,a.center,n,i):Zw.polygon(e,t,n,i,r,this.options.smoothness),this._getRenderBBOX(e,t)}}),QT.VERSION="1.0.0-rc.25";var rA=function(e){var t=(0,i.useRef)(),n=(0,i.useRef)(),r=window.innerWidth>660?window.innerWidth-360:300,a=window.innerHeight>700?window.innerHeight-80:620;return(0,i.useEffect)((function(){var e=new QT("map",{center:[127.205438,34.609169],zoom:17,pitch:40,centerCross:!0,baseLayer:new Rk("tile",{urlTemplate:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"]})});t.current=e;var i=new bE(void 0,{properties:{altitude:[]},symbol:{lineColor:"rgb(255, 0, 55)",lineWidth:3}});return n.current=i,new $E("vector",i,{enableAltitude:!0}).addTo(e),function(){t.current&&t.current.remove(),n.current&&n.current.remove()}}),[]),(0,i.useEffect)((function(){if(Array.isArray(e.coord)&&Array.isArray(e.alt)&&e.coord.length>0&&e.alt.length==e.coord.length){var i=e.coord.length-1;t.current.setCenter(e.coord[i]),n.current.setCoordinates(e.coord),n.current.setProperties({altitude:e.alt})}}),[e.coord,e.alt]),(0,Py.jsx)("div",{id:"map",style:{width:r,height:a}})};var aA=function(){var e=h((0,i.useState)(!1),2),t=e[0],n=e[1],r=h((0,i.useState)([]),2),a=r[0],o=r[1],s=h((0,i.useState)(""),2),l=s[0],u=s[1],c=h((0,i.useState)(void 0),2),f=c[0],d=c[1],p=h((0,i.useState)(!1),2),m=p[0],v=p[1],g=h((0,i.useState)(!1),2),y=g[0],_=g[1];return(0,i.useEffect)((function(){var e=function(e){e.port?(d(e.port),it=!0,v(!0)):(0===e.port_list.length?d(void 0):d(e.port_list[0][0]),it=!1,v(!1)),_(!1),o(e.port_list),u(e.baud_rate)};return nt.on("current_ser_info",e),nt.emit("ser_info"),function(){nt.off("current_ser_info",e)}}),[]),(0,Py.jsxs)(Py.Fragment,{children:[(0,Py.jsx)("button",{onClick:function(){n(!t),nt.emit("ser_info")},style:{width:"20px",height:"20px",color:"gray",position:"absolute",top:"5px",left:"5px"}}),t&&(0,Py.jsx)("div",{style:{width:"100vw",height:"100vh",position:"absolute",top:"0",left:"0",zIndex:"2",backgroundColor:"rgba(0, 0, 0, 0.5)",textAlign:"center"},onClick:function(){n(!t)},children:(0,Py.jsxs)("div",{style:{width:"250px",height:"350px",marginTop:"-175px",marginLeft:"-125px",position:"absolute",top:"50%",left:"50%",backgroundColor:"#ddd",borderRadius:"30px"},onClick:function(e){e.stopPropagation()},children:[(0,Py.jsx)("h3",{style:{padding:"0",margin:"10px 0"},children:"\uc124\uc815"}),(0,Py.jsx)("p",{style:{margin:"0"},children:"\uc2dc\ub9ac\uc5bc \ud3ec\ud2b8"}),(0,Py.jsxs)("select",{id:"serial-port",style:{width:"200px",margin:"0 auto"},disabled:!!m,onChange:function(e){d(e.target.value)},value:f,children:[(0,Py.jsx)("optgroup",{label:"\uc2dc\ub9ac\uc5bc \ud3ec\ud2b8"}),a.map((function(e){return(0,Py.jsx)("option",{value:e[0],children:e[0]+e[1]})}))]}),(0,Py.jsx)("p",{style:{margin:"0"},children:"\ubcf4\ub4dc\ub808\uc774\ud2b8"}),(0,Py.jsx)("select",{id:"baudrate",style:{width:"200px",margin:"0 auto"},disabled:!!m,onChange:function(e){u(e.target.value)},value:l,children:(0,Py.jsxs)("optgroup",{label:"\ubcf4\ub4dc\ub808\uc774\ud2b8",children:[(0,Py.jsx)("option",{value:"9600",children:"9600"}),(0,Py.jsx)("option",{value:"115200",children:"115200"})]})}),(0,Py.jsxs)("div",{style:{marginTop:"10px"},children:[(0,Py.jsx)("button",{style:{width:"100px"},onClick:function(){nt.emit("ser_info")},children:"\uc0c8\ub85c\uace0\uce68"}),(0,Py.jsx)("button",{style:{width:"100px",marginLeft:"10px"},onClick:function(){if(it)nt.emit("discon_ser");else if(f&&l){var e={port:f,baud_rate:l};nt.emit("con_ser",e)}else nt.emit("ser_info");v(!0),_(!0)},disabled:!!y,children:it?"\uc5f0\uacb0\ud574\uc81c":"\uc5f0\uacb0"})]})]})})]})};var oA=function(){var e,t=h((0,i.useState)([]),2),n=t[0],r=t[1],a=h((0,i.useState)([]),2),o=a[0],s=a[1],u=h((0,i.useState)([]),2),c=u[0],f=u[1],d=h((0,i.useState)([]),2),p=d[0],m=d[1],v=(0,i.useRef)({imu:-1,gps:-1}),g=(0,i.useRef)();return window.innerWidth>660&&window.innerWidth,(0,i.useEffect)((function(){var e=function(e){Array.isArray(e.imu)&&e.imu.length>0&&(r((function(t){return[].concat(l(t),l(e.imu))})),v.current.imu=e.time)},t=function(e){if(Array.isArray(e.gps)&&e.gps.length>0){s([].concat(l(o),l(e.gps)));var t=[],n=[];e.gps.map((function(e){0===e.lon&&0===e.lat||(t.push([e.lon,e.lat]),n.push(e.height))})),f((function(e){return[].concat(l(e),t)})),m((function(e){return[].concat(l(e),n)})),v.current.gps=e.time}};nt.on("here_are_your_imu",e),nt.on("here_are_your_gps",t);nt.on("serialAck",(function(e){console.log("\uc2dc\ub9ac\uc5bc\uc744 \ud1b5\ud574 \uc131\uacf5\uc801\uc73c\ub85c \uc804\uc1a1\ub428: %s",e)}));var n=setInterval((function(){it&&nt.emit("give_me_imu",v.current.imu)}),15),i=setInterval((function(){it&&nt.emit("give_me_gps",v.current.gps)}),30);return function(){nt.off("here_are_your_imu",e),nt.off("here_are_your_gps",t),clearInterval(n),clearInterval(i)}}),[]),(0,Py.jsxs)("div",{className:"App",children:[(0,Py.jsx)(aA,{}),(0,Py.jsxs)("div",{className:"nav-info",children:[(0,Py.jsx)(Ry,{euler:null===(e=n[n.length-1])||void 0===e?void 0:e.euler}),(0,Py.jsx)(Ly,{imu:n,gps:o})]}),(0,Py.jsxs)("div",{className:"map",children:[(0,Py.jsxs)("div",{className:"serial-input",style:{height:"30px",marginBottom:"10px"},children:[(0,Py.jsx)("input",{ref:g,style:{width:"500px",height:"100%",float:"left"},type:"text",placeholder:"\uc2dc\ub9ac\uc5bc\ub85c \uc804\uc1a1\ud560 \uac12 \uc785\ub825"}),(0,Py.jsx)("button",{style:{width:"70px",height:"100%",float:"left"},onClick:function(){g.current.value?(nt.emit("serialInput",g.current.value),console.log("\uac12 '%s'\uac00 \uc804\uc1a1\ub428",g.current.value)):console.log("input\uc5d0 \uac12\uc774 \uc5c6\uc74c")},children:"\uc804\uc1a1"})]}),(0,Py.jsx)(rA,{coord:c,alt:p})]})]})},sA=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),a(e),o(e)}))};r.createRoot(document.getElementById("root")).render((0,Py.jsx)(i.StrictMode,{children:(0,Py.jsx)(oA,{})})),sA()}()}();
//# sourceMappingURL=main.d36e89d2.js.map